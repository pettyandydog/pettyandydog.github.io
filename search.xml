<?xml version="1.0" encoding="utf-8"?>
<search>
  
    
    <entry>
      <title><![CDATA[æ·±å…¥å¹¶å‘åŒ…-AQS]]></title>
      <url>%2F2017%2F06%2F27%2FAQS%2F</url>
      <content type="text"><![CDATA[ä»…ä¾›å­¦ä¹ äº¤æµ,å¦‚æœ‰é”™è¯¯è¯·æŒ‡å‡º,å¦‚è¦è½¬è½½è¯·åŠ ä¸Šå‡ºå¤„,è°¢è°¢ å‰è¨€åœ¨java.util.concurrentå¹¶å‘åŒ…ä¸­ï¼Œå¾ˆå¤šç±»çš„å¹¶å‘åŒæ­¥æŽ§åˆ¶éƒ½æ˜¯åŸºäºŽAbstractQueuedSynchronizerï¼ˆç®€ç§°AQSï¼‰è¿™ä¸ªåŒæ­¥å™¨æŠ½è±¡ç±»æ¥å®žçŽ°çš„ï¼Œæ¯”å¦‚ReentrantLockï¼ŒSemaphoreï¼ŒCountDownLatchï¼ŒReentrantReadWriteLockï¼ŒSynchronizerQueueå’ŒFutureTaskï¼Œå®ƒé€šè¿‡ä¾èµ–çŠ¶æ€æ¥å®žçŽ°èŽ·å–é”æˆ–è€…ä¸€ç§è®¸å¯çš„æœºåˆ¶ï¼Œä¸‹é¢é€šè¿‡æºç æ¥åˆ†æžAQSä»¥åŠReentrantLockå¯é‡å…¥é”ä¸­AQSçš„è¿ç”¨ AQSèŽ·å–é”å…ˆçœ‹ä¸‹ä»–çš„ç»§æ‰¿ä½“ç³»ï¼š123public abstract class AbstractQueuedSynchronizer extends AbstractOwnableSynchronizer implements java.io.Serializable &#123; AQSç»§æ‰¿äºŽAbstractOwnableSynchronizerï¼Œé¡¾åæ€ä¹‰ï¼šçº¿ç¨‹ç‹¬æœ‰çš„åŒæ­¥å™¨ï¼Œè¿™ä¸ºåˆ›å»ºéœ€è¦æ‰€æœ‰æƒçš„é”å’Œç›¸å…³çš„åŒæ­¥å™¨æä¾›äº†åŸºç¡€ï¼Œåœ¨AbstractOwnableSynchronizerä¸­åªæä¾›äº†ä¸€ä¸ªçº¿ç¨‹å±žæ€§çš„setterå’Œgetteræ–¹æ³•12345678private transient Thread exclusiveOwnerThread;protected final void setExclusiveOwnerThread(Thread thread) &#123; exclusiveOwnerThread = thread;&#125;protected final Thread getExclusiveOwnerThread() &#123; return exclusiveOwnerThread;&#125; AQSç»§æ‰¿äº†exclusiveOwnerThreadå±žæ€§ï¼Œè¡¨ç¤ºå½“å‰æ‹¥æœ‰ç‹¬å é”çš„çš„çº¿ç¨‹ï¼Œè¿™ä¹Ÿå¼•å…¥äº†é”çš„å¦ä¸€ä¸ªç‰¹æ€§ï¼šé‡å…¥æ€§ï¼Œå½“å‰çº¿ç¨‹ç›´æŽ¥é€šè¿‡if (currentThread == getExclusiveOwnerThread()){state++}åˆ¤æ–­æ˜¯å¦å·²ç»æ‹¥æœ‰äº†é” çŽ°åœ¨æˆ‘ä»¬å†å›žåˆ°AQSï¼ŒæŸ¥çœ‹AQSçš„å±žæ€§ç»“æž„1234567// å¤´ç»“ç‚¹ï¼Œä½ ç›´æŽ¥æŠŠå®ƒå½“åš å½“å‰æŒæœ‰é”çš„çº¿ç¨‹ å¯èƒ½æ˜¯æœ€å¥½ç†è§£çš„private transient volatile Node head;// é˜»å¡žçš„å°¾èŠ‚ç‚¹ï¼Œæ¯ä¸ªæ–°çš„èŠ‚ç‚¹è¿›æ¥ï¼Œéƒ½æ’å…¥åˆ°æœ€åŽï¼Œä¹Ÿå°±å½¢æˆäº†ä¸€ä¸ªéšè§†çš„é“¾è¡¨private transient volatile Node tail;// è¿™ä¸ªæ˜¯æœ€é‡è¦çš„ï¼Œä¸è¿‡ä¹Ÿæ˜¯æœ€ç®€å•çš„ï¼Œä»£è¡¨å½“å‰é”çš„çŠ¶æ€ï¼Œ0ä»£è¡¨æ²¡æœ‰è¢«å ç”¨ï¼Œå¤§äºŽ0ä»£è¡¨æœ‰çº¿ç¨‹æŒæœ‰å½“å‰é”// ä¹‹æ‰€ä»¥è¯´å¤§äºŽ0ï¼Œè€Œä¸æ˜¯ç­‰äºŽ1ï¼Œæ˜¯å› ä¸ºé”å¯ä»¥é‡å…¥å˜›ï¼Œæ¯æ¬¡é‡å…¥éƒ½åŠ ä¸Š1private volatile int state; å¦‚ä¸Šæ‰€ç¤ºå°±æ˜¯AQSå®šä¹‰çš„ä¸‰ä¸ªå±žæ€§ï¼Œå…¶å®žçº¿ç¨‹åœ¨AQSä¼šè¢«æŠ½è±¡æˆä¸€ä¸ªNodeçš„æ‰§è¡Œå•å…ƒï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€çœ‹Nodeçš„ç»“æž„ï¼š123456789101112131415161718192021222324252627282930313233343536static final class Node &#123; /** Marker to indicate a node is waiting in shared mode */ // æ ‡è¯†èŠ‚ç‚¹å½“å‰åœ¨å…±äº«æ¨¡å¼ä¸‹ static final Node SHARED = new Node(); /** Marker to indicate a node is waiting in exclusive mode */ // æ ‡è¯†èŠ‚ç‚¹å½“å‰åœ¨ç‹¬å æ¨¡å¼ä¸‹ static final Node EXCLUSIVE = null; // ======== ä¸‹é¢çš„å‡ ä¸ªintå¸¸é‡æ˜¯ç»™waitStatusç”¨çš„ =========== /** waitStatus value to indicate thread has cancelled */ // ä»£è¡¨æ­¤çº¿ç¨‹å–æ¶ˆäº†äº‰æŠ¢è¿™ä¸ªé” static final int CANCELLED = 1; /** waitStatus value to indicate successor's thread needs unparking */ // å®˜æ–¹çš„æè¿°æ˜¯ï¼Œå…¶è¡¨ç¤ºå½“å‰nodeçš„åŽç»§èŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹éœ€è¦è¢«å”¤é†’ static final int SIGNAL = -1; /** waitStatus value to indicate thread is waiting on condition */ // è¡¨ç¤ºçº¿ç¨‹å¤„äºŽç­‰å¾…çš„æ¡ä»¶ä¸‹çš„å€¼ï¼Œä¸Žä¸‹é¢çš„waitStatuså¯¹åº”ï¼Œè¿™åœ¨Lockä¸­çš„conditionä¸­ä¼šä½¿ç”¨ static final int CONDITION = -2; /** * waitStatus value to indicate the next acquireShared should * unconditionally propagate */ static final int PROPAGATE = -3; // ===================================================== // å–å€¼ä¸ºä¸Šé¢çš„1ã€-1ã€-2ã€-3ï¼Œæˆ–è€…0(ä»¥åŽä¼šè®²åˆ°) // è¿™ä¹ˆç†è§£ï¼Œæš‚æ—¶åªéœ€è¦çŸ¥é“å¦‚æžœè¿™ä¸ªå€¼ å¤§äºŽ0 ä»£è¡¨æ­¤çº¿ç¨‹å–æ¶ˆäº†ç­‰å¾…ï¼Œ // ä¹Ÿè®¸å°±æ˜¯è¯´åŠå¤©æŠ¢ä¸åˆ°é”ï¼Œä¸æŠ¢äº†ï¼ŒReentrantLockæ˜¯å¯ä»¥æŒ‡å®štimeouotçš„ã€‚ã€‚ã€‚ volatile int waitStatus; // å‰é©±èŠ‚ç‚¹çš„å¼•ç”¨ volatile Node prev; // åŽç»§èŠ‚ç‚¹çš„å¼•ç”¨ volatile Node next; // è¿™ä¸ªå°±æ˜¯çº¿ç¨‹æœ¬å°Š volatile Thread thread;&#125; è¿™å°±æ˜¯AQSçš„æ•°æ®ç»“æž„äº†ï¼Œå…¶å®žå°±æ˜¯ä¸€ä¸ªFIFOçš„é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹Nodeå°±æ˜¯ä»£è¡¨ä¸€ä¸ªå…·æœ‰çŠ¶æ€çš„çº¿ç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º æˆ‘ä»¬æ–°è¿›çš„çº¿ç¨‹ä¼šæ’å…¥é˜Ÿåˆ—çš„å°¾ç«¯tailï¼Œè€Œé˜Ÿåˆ—çš„æ‰§è¡Œåºåˆ—ä»Žheadå¼€å§‹ï¼ŒAQSçš„å·¥ä½œå°±æ˜¯ç»´æŠ¤è¿™ä¸ªé˜Ÿåˆ—ä»¥åŠnodeä¸­çº¿ç¨‹çš„å„ç§çŠ¶æ€ï¼Œä¸‹é¢ä»¥ReentrantLockçš„å…¬å¹³é”æ¥åˆ†æžAQSåœ¨å…¶ä¸­å‘æŒ¥çš„ä½œç”¨ æˆ‘ä»¬ä»¥ä¸‹é¢ReentrantLockçš„ä½¿ç”¨æ–¹æ³•æ¥è¿›å…¥AQS1234567891011public class LockTest&#123; private ReentrantLock reentrantLock = new ReentrantLock(true); //æž„å»ºReentrantLock public void lockService() &#123; try &#123; reentrantLock.lock(); //èŽ·å¾—é” // doä¸šåŠ¡ä»£ç  &#125; finally &#123; reentrantLock.unlock();// é‡Šæ”¾é” &#125; &#125;&#125; ReentrantLockçš„æž„é€ æ–¹æ³•å¦‚ä¸‹ 123public ReentrantLock(boolean fair) &#123; sync = fair ? new FairSync() : new NonfairSync();&#125; å½“fairå‚æ•°ä¸ºtrueæ—¶ï¼Œå°†ä¼šåˆ›å»ºå†…éƒ¨ç±»FairSyncç±»ï¼Œè¿™æ˜¯ä¸€ä¸ªå…¬å¹³é”çš„å®žçŽ°ï¼Œæºç ç»§æ‰¿ç»“æž„å¦‚ä¸‹123static final class FairSync extends Sync &#123; ......&#125; FairSyncç»§æ‰¿ä¸ŽSyncï¼Œè¿™æ˜¯AQSçš„å®žçŽ°ç±»ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹Syncçš„æºç ç»§æ‰¿ç»“æž„123abstract static class Sync extends AbstractQueuedSynchronizer &#123; ......&#125; ReentrantLockåªæ”¯æŒä»¥ç‹¬å é”çš„æ–¹å¼æ¥èŽ·å–é”ï¼Œæ‰€ä»¥ä¼šå®žçŽ°AQSä¸­çš„tryAcquireå’ŒtryReleaseå’ŒisHeldExclusivelyè¿™ä¸‰ä¸ªæ ¸å¿ƒçš„æ–¹æ³•ï¼Œå†…éƒ¨ä¼šç”¨åå«Syncçš„å†…éƒ¨æŠ½è±¡ç±»æ¥ç®¡ç†çº¿ç¨‹é”ï¼Œå½“çº¿ç¨‹è°ƒç”¨lockæ–¹æ³•èŽ·å–é”æ—¶ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹FairSyncçš„lockæ–¹æ³• 123final void lock() &#123; acquire(1); &#125; ä»–ä¼šè°ƒç”¨ç»§æ‰¿äºŽAQSçš„acquireçš„æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤º 123456789101112// æˆ‘ä»¬çœ‹åˆ°ï¼Œè¿™ä¸ªæ–¹æ³•ï¼Œå¦‚æžœtryAcquire(arg) è¿”å›žtrue, ä¹Ÿå°±ç»“æŸäº†ã€‚// å¦åˆ™ï¼ŒacquireQueuedæ–¹æ³•ä¼šå°†çº¿ç¨‹åŽ‹åˆ°é˜Ÿåˆ—ä¸­public final void acquire(int arg) &#123; // æ­¤æ—¶ arg == 1 // é¦–å…ˆè°ƒç”¨tryAcquire(1)ä¸€ä¸‹ï¼Œåå­—ä¸Šå°±çŸ¥é“ï¼Œè¿™ä¸ªåªæ˜¯è¯•ä¸€è¯• // å› ä¸ºæœ‰å¯èƒ½ç›´æŽ¥å°±æˆåŠŸäº†å‘¢ï¼Œä¹Ÿå°±ä¸éœ€è¦è¿›é˜Ÿåˆ—æŽ’é˜Ÿäº†ï¼Œ // å¯¹äºŽå…¬å¹³é”çš„è¯­ä¹‰å°±æ˜¯ï¼šæœ¬æ¥å°±æ²¡äººæŒæœ‰é”ï¼Œæ ¹æœ¬æ²¡å¿…è¦è¿›é˜Ÿåˆ—ç­‰å¾…(åˆæ˜¯æŒ‚èµ·ï¼Œåˆæ˜¯ç­‰å¾…è¢«å”¤é†’çš„) if (!tryAcquire(arg) &amp;&amp; // tryAcquire(arg)æ²¡æœ‰æˆåŠŸï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦æŠŠå½“å‰çº¿ç¨‹æŒ‚èµ·ï¼Œæ”¾åˆ°é˜»å¡žé˜Ÿåˆ—ä¸­ã€‚ acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) &#123; selfInterrupt(); &#125;&#125; å½“å‰çº¿ç¨‹ä¼šå°è¯•åŽ»èŽ·å–é”ï¼Œè°ƒç”¨FairSyncå®žçŽ°çš„tryAcquire(1)æ–¹æ³•,å¦‚ä¸‹æ‰€ç¤º 1234567891011121314151617181920212223242526272829303132333435// å°è¯•ç›´æŽ¥èŽ·å–é”ï¼Œè¿”å›žå€¼æ˜¯booleanï¼Œä»£è¡¨æ˜¯å¦èŽ·å–åˆ°é”// è¿”å›žtrueï¼š1.æ²¡æœ‰çº¿ç¨‹åœ¨ç­‰å¾…é”ï¼›2.é‡å…¥é”ï¼Œçº¿ç¨‹æœ¬æ¥å°±æŒæœ‰é”ï¼Œä¹Ÿå°±å¯ä»¥ç†æ‰€å½“ç„¶å¯ä»¥ç›´æŽ¥èŽ·å–protected final boolean tryAcquire(int acquires) &#123; final Thread current = Thread.currentThread(); int c = getState(); // å¦‚æžœstate == 0 è¡¨ç¤ºæ­¤æ—¶æ­¤åˆ»æ²¡æœ‰çº¿ç¨‹æŒæœ‰é” if (c == 0) &#123; // è™½ç„¶æ­¤æ—¶æ­¤åˆ»é”æ˜¯å¯ä»¥ç”¨çš„ï¼Œä½†æ˜¯è¿™æ˜¯å…¬å¹³é”ï¼Œæ—¢ç„¶æ˜¯å…¬å¹³ï¼Œå°±å¾—è®²ç©¶å…ˆæ¥åŽåˆ°ï¼Œ // çœ‹çœ‹æœ‰æ²¡æœ‰åˆ«äººåœ¨é˜Ÿåˆ—ä¸­ç­‰äº†åŠå¤©äº† if (!hasQueuedPredecessors() &amp;&amp; // å¦‚æžœæ²¡æœ‰çº¿ç¨‹åœ¨ç­‰å¾…ï¼Œé‚£å°±ç”¨CASå°è¯•ä¸€ä¸‹ï¼ŒæˆåŠŸäº†å°±èŽ·å–åˆ°é”äº†ï¼Œ // ä¸æˆåŠŸçš„è¯ï¼Œåªèƒ½è¯´æ˜Žä¸€ä¸ªé—®é¢˜ï¼Œå°±åœ¨åˆšåˆšå‡ ä¹ŽåŒä¸€æ—¶åˆ»æœ‰ä¸ªçº¿ç¨‹æŠ¢å…ˆäº† =_= // å› ä¸ºåˆšåˆšè¿˜æ²¡äººçš„ï¼Œæˆ‘åˆ¤æ–­è¿‡äº†ðŸ˜‚ðŸ˜‚ðŸ˜‚ compareAndSetState(0, acquires)) &#123; // åˆ°è¿™é‡Œå°±æ˜¯èŽ·å–åˆ°é”äº†ï¼Œæ ‡è®°ä¸€ä¸‹ï¼Œå‘Šè¯‰å¤§å®¶ï¼ŒçŽ°åœ¨æ˜¯æˆ‘å ç”¨äº†é” setExclusiveOwnerThread(current); return true; &#125; &#125; // åˆ¤æ–­æ˜¯å¦æ˜¯é‡å…¥çš„çº¿ç¨‹ï¼Œéœ€è¦æ“ä½œï¼šstate=state+1 else if (current == getExclusiveOwnerThread()) &#123; int nextc = c + acquires; if (nextc &lt; 0) throw new Error("Maximum lock count exceeded"); setState(nextc); return true; &#125; // å¦‚æžœåˆ°è¿™é‡Œï¼Œè¯´æ˜Žå‰é¢çš„ifå’Œelse iféƒ½æ²¡æœ‰è¿”å›žtrueï¼Œè¯´æ˜Žæ²¡æœ‰èŽ·å–åˆ°é” // å›žåˆ°ä¸Šé¢ä¸€ä¸ªå¤–å±‚è°ƒç”¨æ–¹æ³•ç»§ç»­çœ‹: // if (!tryAcquire(arg) // &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) // selfInterrupt(); return false;&#125; å¦‚æžœè¿”å›žfalseçš„è¯ï¼Œä¼šæŠŠå½“å‰çº¿ç¨‹åŠ å…¥é˜»å¡žé˜Ÿåˆ—ä¸­ï¼ŒçŽ°åœ¨æˆ‘ä»¬ç»§ç»­æ¥è¿›å…¥AQSä¸­çš„addWaiteræ–¹æ³•12345678910111213141516171819202122232425262728293031323334/** * Creates and enqueues node for current thread and given mode. * * @param mode Node.EXCLUSIVE for exclusive, Node.SHARED for shared * @return the new node */ // æ­¤æ–¹æ³•çš„ä½œç”¨æ˜¯æŠŠçº¿ç¨‹åŒ…è£…æˆnodeï¼ŒåŒæ—¶è¿›å…¥åˆ°é˜Ÿåˆ—ä¸­ // å‚æ•°modeæ­¤æ—¶æ˜¯Node.EXCLUSIVEï¼Œä»£è¡¨ç‹¬å æ¨¡å¼ private Node addWaiter(Node mode) &#123; //modeå€¼ä¸‹ä¸€ä¸ªç­‰å¾…çš„çº¿ç¨‹èŠ‚ç‚¹ï¼Œé»˜è®¤ä¸ºnull Node node = new Node(Thread.currentThread(), mode); // Try the fast path of enq; backup to full enq on failure // ä»¥ä¸‹å‡ è¡Œä»£ç æƒ³æŠŠå½“å‰nodeåŠ åˆ°é“¾è¡¨çš„æœ€åŽé¢åŽ»ï¼Œä¹Ÿå°±æ˜¯è¿›åˆ°é˜»å¡žé˜Ÿåˆ—çš„æœ€åŽ Node pred = tail; // tail!=null =&gt; é˜Ÿåˆ—ä¸ä¸ºç©º(tail==headçš„æ—¶å€™ï¼Œå…¶å®žé˜Ÿåˆ—æ˜¯ç©ºçš„ï¼Œä¸è¿‡ä¸ç®¡è¿™ä¸ªå§) if (pred != null) &#123; // è®¾ç½®è‡ªå·±çš„å‰é©± ä¸ºå½“å‰çš„é˜Ÿå°¾èŠ‚ç‚¹ node.prev = pred; // ç”¨CASæŠŠè‡ªå·±è®¾ç½®ä¸ºé˜Ÿå°¾, å¦‚æžœæˆåŠŸåŽï¼Œtail == nodeäº† if (compareAndSetTail(pred, node)) &#123; // è¿›åˆ°è¿™é‡Œè¯´æ˜Žè®¾ç½®æˆåŠŸï¼Œå½“å‰node==tail, å°†è‡ªå·±ä¸Žä¹‹å‰çš„é˜Ÿå°¾ç›¸è¿žï¼Œ // ä¸Šé¢å·²ç»æœ‰ node.prev = pred // åŠ ä¸Šä¸‹é¢è¿™å¥ï¼Œä¹Ÿå°±å®žçŽ°äº†å’Œä¹‹å‰çš„å°¾èŠ‚ç‚¹åŒå‘è¿žæŽ¥äº† pred.next = node; // çº¿ç¨‹å…¥é˜Ÿäº†ï¼Œå¯ä»¥è¿”å›žäº† return node; &#125; &#125; // ä»”ç»†çœ‹çœ‹ä¸Šé¢çš„ä»£ç ï¼Œå¦‚æžœä¼šåˆ°è¿™é‡Œï¼Œ // è¯´æ˜Ž pred==null(é˜Ÿåˆ—æ˜¯ç©ºçš„) æˆ–è€… CASå¤±è´¥(æœ‰çº¿ç¨‹åœ¨ç«žäº‰å…¥é˜Ÿ) enq(node); return node; &#125; å¦‚æžœé˜Ÿåˆ—æ˜¯ç©ºçš„ï¼Œæˆ–è€…æœ‰ç«žäº‰ï¼Œå°±è°ƒç”¨enqæ–¹æ³•é‡‡ç”¨è‡ªæ—‹çš„æ–¹å¼æ¥åŠ å…¥é˜»å¡žé˜Ÿåˆ—ï¼Œå¦‚ä¸‹æ‰€ç¤º 123456789101112131415161718192021222324252627282930313233343536373839/** * Inserts node into queue, initializing if necessary. See picture above. * @param node the node to insert * @return node's predecessor */ // é‡‡ç”¨è‡ªæ—‹çš„æ–¹å¼å…¥é˜Ÿ // ä¹‹å‰è¯´è¿‡ï¼Œåˆ°è¿™ä¸ªæ–¹æ³•åªæœ‰ä¸¤ç§å¯èƒ½ï¼šç­‰å¾…é˜Ÿåˆ—ä¸ºç©ºï¼Œæˆ–è€…æœ‰çº¿ç¨‹ç«žäº‰å…¥é˜Ÿï¼Œ // è‡ªæ—‹åœ¨è¿™è¾¹çš„è¯­ä¹‰æ˜¯ï¼šCASè®¾ç½®tailè¿‡ç¨‹ä¸­ï¼Œç«žäº‰ä¸€æ¬¡ç«žäº‰ä¸åˆ°ï¼Œæˆ‘å°±å¤šæ¬¡ç«žäº‰ï¼Œæ€»ä¼šæŽ’åˆ°çš„ private Node enq(final Node node) &#123; for (;;) &#123; Node t = tail; // ä¹‹å‰è¯´è¿‡ï¼Œé˜Ÿåˆ—ä¸ºç©ºä¹Ÿä¼šè¿›æ¥è¿™é‡Œ if (t == null) &#123; // Must initialize // åˆå§‹åŒ–headèŠ‚ç‚¹ // ç»†å¿ƒçš„è¯»è€…ä¼šçŸ¥é“åŽŸæ¥headå’Œtailåˆå§‹åŒ–çš„æ—¶å€™éƒ½æ˜¯nullï¼Œåæ­£æˆ‘ä¸ç»†å¿ƒ // è¿˜æ˜¯ä¸€æ­¥CASï¼Œä½ æ‡‚çš„ï¼ŒçŽ°åœ¨å¯èƒ½æ˜¯å¾ˆå¤šçº¿ç¨‹åŒæ—¶è¿›æ¥å‘¢ if (compareAndSetHead(new Node())) // ç»™åŽé¢ç”¨ï¼šè¿™ä¸ªæ—¶å€™headèŠ‚ç‚¹çš„waitStatus==0, çœ‹new Node()æž„é€ æ–¹æ³•å°±çŸ¥é“äº† // è¿™ä¸ªæ—¶å€™æœ‰äº†headï¼Œä½†æ˜¯tailè¿˜æ˜¯nullï¼Œè®¾ç½®ä¸€ä¸‹ï¼Œ // æŠŠtailæŒ‡å‘headï¼Œæ”¾å¿ƒï¼Œé©¬ä¸Šå°±æœ‰çº¿ç¨‹è¦æ¥äº†ï¼Œåˆ°æ—¶å€™tailå°±è¦è¢«æŠ¢äº† // æ³¨æ„ï¼šè¿™é‡Œåªæ˜¯è®¾ç½®äº†tail=headï¼Œè¿™é‡Œå¯æ²¡returnå“¦ï¼Œæ²¡æœ‰returnï¼Œæ²¡æœ‰return // æ‰€ä»¥ï¼Œè®¾ç½®å®Œäº†ä»¥åŽï¼Œç»§ç»­forå¾ªçŽ¯ï¼Œä¸‹æ¬¡å°±åˆ°ä¸‹é¢çš„elseåˆ†æ”¯äº† tail = head; &#125; else &#123; // ä¸‹é¢å‡ è¡Œï¼Œå’Œä¸Šä¸€ä¸ªæ–¹æ³• addWaiter æ˜¯ä¸€æ ·çš„ï¼Œ // åªæ˜¯è¿™ä¸ªå¥—åœ¨æ— é™å¾ªçŽ¯é‡Œï¼Œåæ­£å°±æ˜¯å°†å½“å‰çº¿ç¨‹æŽ’åˆ°é˜Ÿå°¾ï¼Œæœ‰çº¿ç¨‹ç«žäº‰çš„è¯æŽ’ä¸ä¸Šé‡å¤æŽ’ node.prev = t; if (compareAndSetTail(t, node)) &#123; t.next = node; return t; &#125; &#125; &#125; &#125; // ç„¶åŽå†æ¬¡å›žåˆ°è¿™æ®µä»£ç äº† // if (!tryAcquire(arg) // &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) // selfInterrupt(); æˆ‘ä»¬å†æ¥çœ‹ä¸€çœ‹acquireQueuedæ–¹æ³•ï¼Œåœ¨è¿›å…¥é˜»å¡žé˜Ÿåˆ—ä¸­ï¼Œä»–ä¼šå†æ¬¡å°è¯•èŽ·å–é”ï¼Œå¦‚ä¸‹æ‰€ç¤º1234567891011121314151617181920212223242526272829303132333435// ä¸‹é¢è¿™ä¸ªæ–¹æ³•ï¼Œå‚æ•°nodeï¼Œç»è¿‡addWaiter(Node.EXCLUSIVE)ï¼Œæ­¤æ—¶å·²ç»è¿›å…¥é˜»å¡žé˜Ÿåˆ—// æ³¨æ„ä¸€ä¸‹ï¼šå¦‚æžœacquireQueued(addWaiter(Node.EXCLUSIVE), arg))è¿”å›žtrueçš„è¯ï¼Œ// æ„å‘³ç€ä¸Šé¢è¿™æ®µä»£ç å°†è¿›å…¥selfInterrupt()ï¼Œæ‰€ä»¥æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸‹é¢åº”è¯¥è¿”å›žfalse// è¿™ä¸ªæ–¹æ³•éžå¸¸é‡è¦ï¼Œåº”è¯¥è¯´çœŸæ­£çš„çº¿ç¨‹æŒ‚èµ·ï¼Œç„¶åŽè¢«å”¤é†’åŽåŽ»èŽ·å–é”ï¼Œéƒ½åœ¨è¿™ä¸ªæ–¹æ³•é‡Œäº†final boolean acquireQueued(final Node node, int arg) &#123; boolean failed = true; try &#123; boolean interrupted = false; for (;;) &#123; final Node p = node.predecessor();//èŽ·å–å½“å‰nodeçš„å‰ä¸€ä¸ªnode // p == head è¯´æ˜Žå½“å‰èŠ‚ç‚¹è™½ç„¶è¿›åˆ°äº†é˜»å¡žé˜Ÿåˆ—ï¼Œä½†æ˜¯æ˜¯é˜»å¡žé˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªï¼Œå› ä¸ºå®ƒçš„å‰é©±æ˜¯head // æ³¨æ„ï¼Œé˜»å¡žé˜Ÿåˆ—ä¸åŒ…å«headèŠ‚ç‚¹ï¼Œheadä¸€èˆ¬æŒ‡çš„æ˜¯å æœ‰é”çš„çº¿ç¨‹ï¼ŒheadåŽé¢çš„æ‰ç§°ä¸ºé˜»å¡žé˜Ÿåˆ— // æ‰€ä»¥å½“å‰èŠ‚ç‚¹å¯ä»¥åŽ»è¯•æŠ¢ä¸€ä¸‹é” // è¿™é‡Œæˆ‘ä»¬è¯´ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆå¯ä»¥åŽ»è¯•è¯•ï¼š // é¦–å…ˆï¼Œå®ƒæ˜¯é˜Ÿå¤´ï¼Œè¿™ä¸ªæ˜¯ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼Œå…¶æ¬¡ï¼Œå½“å‰çš„headæœ‰å¯èƒ½æ˜¯åˆšåˆšåˆå§‹åŒ–çš„nodeï¼Œ // enq(node) æ–¹æ³•é‡Œé¢æœ‰æåˆ°ï¼Œheadæ˜¯å»¶æ—¶åˆå§‹åŒ–çš„ï¼Œè€Œä¸”new Node()çš„æ—¶å€™æ²¡æœ‰è®¾ç½®ä»»ä½•çº¿ç¨‹ // ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å‰çš„headä¸å±žäºŽä»»ä½•ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥ä½œä¸ºé˜Ÿå¤´ï¼Œå¯ä»¥åŽ»è¯•ä¸€è¯•ï¼Œ // tryAcquireå·²ç»åˆ†æžè¿‡äº†, å¿˜è®°äº†è¯·å¾€å‰çœ‹ä¸€ä¸‹ï¼Œå°±æ˜¯ç®€å•ç”¨CASè¯•æ“ä½œä¸€ä¸‹state if (p == head &amp;&amp; tryAcquire(arg)) &#123; setHead(node); p.next = null; // help GC failed = false; return interrupted; &#125; // åˆ°è¿™é‡Œï¼Œè¯´æ˜Žä¸Šé¢çš„ifåˆ†æ”¯æ²¡æœ‰æˆåŠŸï¼Œè¦ä¹ˆå½“å‰nodeæœ¬æ¥å°±ä¸æ˜¯é˜Ÿå¤´ï¼Œ // è¦ä¹ˆå°±æ˜¯tryAcquire(arg)æ²¡æœ‰æŠ¢èµ¢åˆ«äººï¼Œç»§ç»­å¾€ä¸‹çœ‹ if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) interrupted = true; &#125; &#125; finally &#123; if (failed) cancelAcquire(node); &#125;&#125; å½“å‰çº¿ç¨‹èŽ·å–é”å¤±è´¥ä¼šè°ƒç”¨shouldParkAfterFailedAcquireæ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤º12345678910111213141516171819202122232425262728293031323334353637383940414243444546 // åˆšåˆšè¯´è¿‡ï¼Œä¼šåˆ°è¿™é‡Œå°±æ˜¯æ²¡æœ‰æŠ¢åˆ°é”å‘—ï¼Œè¿™ä¸ªæ–¹æ³•è¯´çš„æ˜¯ï¼š"å½“å‰çº¿ç¨‹æ²¡æœ‰æŠ¢åˆ°é”ï¼Œæ˜¯å¦éœ€è¦æŒ‚èµ·å½“å‰çº¿ç¨‹ï¼Ÿ" // ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å‰é©±èŠ‚ç‚¹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ‰æ˜¯ä»£è¡¨å½“å‰çº¿ç¨‹çš„èŠ‚ç‚¹ private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) &#123; int ws = pred.waitStatus; //ä¸‹é¢çš„ä¸‰ä¸ªåˆ¤æ–­ç¬¦åˆä¸‹åˆ—ä¸‰ç§è§„åˆ™ // è§„åˆ™1ï¼šå¦‚æžœå‰ç»§çš„èŠ‚ç‚¹çŠ¶æ€ä¸ºSIGNALï¼Œè¡¨æ˜Žå½“å‰èŠ‚ç‚¹éœ€è¦unpark(å”¤é†’)ï¼Œåˆ™è¿”å›žæˆåŠŸï¼Œæ­¤æ—¶ acquireQueuedæ–¹æ³•çš„ç¬¬12è¡Œï¼ˆparkAndCheckInterruptï¼‰å°†å¯¼è‡´çº¿ç¨‹é˜»å¡ž // è§„åˆ™2ï¼šå¦‚æžœå‰ç»§èŠ‚ç‚¹çŠ¶æ€ä¸ºCANCELLED(ws&gt;0)ï¼Œè¯´æ˜Žå‰ç½®èŠ‚ç‚¹å·²ç»è¢«æ”¾å¼ƒï¼Œåˆ™å›žæº¯åˆ°ä¸€ä¸ªéžå–æ¶ˆçš„å‰ç»§èŠ‚ç‚¹ï¼Œè¿”å›žfalseï¼ŒacquireQueuedæ–¹æ³•çš„æ— é™å¾ªçŽ¯å°†é€’å½’è°ƒç”¨è¯¥æ–¹æ³•ï¼Œç›´è‡³è§„åˆ™1è¿”å›žtrueï¼Œå¯¼è‡´çº¿ç¨‹é˜»å¡ž // è§„åˆ™3ï¼šå¦‚æžœå‰ç»§èŠ‚ç‚¹çŠ¶æ€ä¸ºéžSIGNALã€éžCANCELLEDï¼Œåˆ™è®¾ç½®å‰ç»§çš„çŠ¶æ€ä¸ºSIGNALï¼Œè¿”å›žfalseåŽè¿›å…¥acquireQueuedçš„æ— é™å¾ªçŽ¯ï¼Œä¸Žè§„åˆ™2åŒ // å‰é©±èŠ‚ç‚¹çš„ waitStatus == -1 ï¼Œè¯´æ˜Žå‰é©±èŠ‚ç‚¹çŠ¶æ€æ­£å¸¸ï¼Œå½“å‰çº¿ç¨‹éœ€è¦æŒ‚èµ·ï¼Œç›´æŽ¥å¯ä»¥è¿”å›žtrue if (ws == Node.SIGNAL) /* * This node has already set status asking a release * to signal it, so it can safely park. */ return true; // å‰é©±èŠ‚ç‚¹ waitStatuså¤§äºŽ0 ï¼Œä¹‹å‰è¯´è¿‡ï¼Œå¤§äºŽ0 è¯´æ˜Žå‰é©±èŠ‚ç‚¹å–æ¶ˆäº†æŽ’é˜Ÿã€‚è¿™é‡Œéœ€è¦çŸ¥é“è¿™ç‚¹ï¼š // è¿›å…¥é˜»å¡žé˜Ÿåˆ—æŽ’é˜Ÿçš„çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œè€Œå”¤é†’çš„æ“ä½œæ˜¯ç”±å‰é©±èŠ‚ç‚¹å®Œæˆçš„ã€‚ // æ‰€ä»¥ä¸‹é¢è¿™å—ä»£ç è¯´çš„æ˜¯å°†å½“å‰èŠ‚ç‚¹çš„prevæŒ‡å‘waitStatus&lt;=0çš„èŠ‚ç‚¹ï¼Œ if (ws &gt; 0) &#123; /* * Predecessor was cancelled. Skip over predecessors and * indicate retry. */ do &#123; node.prev = pred = pred.prev; &#125; while (pred.waitStatus &gt; 0); pred.next = node; &#125; else &#123; /* * waitStatus must be 0 or PROPAGATE. Indicate that we * need a signal, but don't park yet. Caller will need to * retry to make sure it cannot acquire before parking. */ // ä»”ç»†æƒ³æƒ³ï¼Œå¦‚æžœè¿›å…¥åˆ°è¿™ä¸ªåˆ†æ”¯æ„å‘³ç€ä»€ä¹ˆ // å‰é©±èŠ‚ç‚¹çš„waitStatusä¸ç­‰äºŽ-1å’Œ1ï¼Œé‚£ä¹Ÿå°±æ˜¯åªå¯èƒ½æ˜¯0ï¼Œ-2ï¼Œ-3 // åœ¨æˆ‘ä»¬å‰é¢çš„æºç ä¸­ï¼Œéƒ½æ²¡æœ‰çœ‹åˆ°æœ‰è®¾ç½®waitStatusçš„ï¼Œæ‰€ä»¥æ¯ä¸ªæ–°çš„nodeå…¥é˜Ÿæ—¶ï¼ŒwaitStatuéƒ½æ˜¯0 // ç”¨CASå°†å‰é©±èŠ‚ç‚¹çš„waitStatusè®¾ç½®ä¸ºNode.SIGNAL(ä¹Ÿå°±æ˜¯-1) compareAndSetWaitStatus(pred, ws, Node.SIGNAL); &#125; return false; &#125;// å›žåˆ°ä¸‹é¢çš„ä»£ç // if (shouldParkAfterFailedAcquire(p, node) &amp;&amp;// parkAndCheckInterrupt()) å¦‚æžœæ­¤çº¿ç¨‹å–æ¶ˆäº†ç«žäº‰ï¼ˆä¹Ÿå°±æ˜¯waitStatus&gt;0ï¼‰ï¼Œå°±ä¼šè¿›å…¥é˜»å¡žä¸­æ–­ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦ä¸€ä¸ªå¥‘æœºå°†ä»–å”¤é†’ï¼Œæ‰€æœ‰è¦ä¸æ–­å¾ªçŽ¯å‰ä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºéœ€è¦ä½œä¸ºå”¤é†’çš„å¥‘æœºï¼ˆè¿™åœ¨åŽé¢çš„é‡Šæ”¾é”æ“ä½œä¼šæœ‰è¯´æ˜Žï¼‰ï¼Œè¿”å›žfalseï¼Œå¦‚æžœè¿”å›žtrueçš„è¯ï¼ŒæŽ¥ä¸‹æ¥ä¼šè°ƒç”¨parkAndCheckInterruptæ–¹æ³•æ¥æ£€æŸ¥ä¸­æ–­æ“ä½œï¼Œå¦‚ä¸‹æ‰€ç¤º 123456// è¿™ä¸ªæ–¹æ³•å¾ˆç®€å•ï¼Œå› ä¸ºå‰é¢è¿”å›žtrueï¼Œæ‰€ä»¥éœ€è¦æŒ‚èµ·çº¿ç¨‹ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯è´Ÿè´£æŒ‚èµ·çº¿ç¨‹çš„// è¿™é‡Œç”¨äº†LockSupport.park(this)æ¥æŒ‚èµ·çº¿ç¨‹ï¼Œç„¶åŽå°±åœåœ¨è¿™é‡Œäº†ï¼Œç­‰å¾…è¢«å”¤é†’=======private final boolean parkAndCheckInterrupt() &#123; LockSupport.park(this); return Thread.interrupted();&#125; é‡Šæ”¾é”çœ‹å®Œäº†èŽ·å–é”ï¼ŒçŽ°åœ¨æ¥çœ‹çœ‹é‡Šæ”¾é”çš„å®žçŽ°ï¼Œåœ¨å‰é¢reentrantLockçš„ä½¿ç”¨ç”¨ä¾‹ä¸­ï¼Œå½“çº¿ç¨‹æ‰§è¡Œå®Œä¼šåœ¨finallyå—ä¸­æ‰§è¡ŒreentrantLock.unlock()æ¥é‡Šæ”¾é”ï¼Œå¦‚ä¸‹æ‰€ç¤º123public void unlock() &#123; sync.release(1);&#125; ä»–ä¼šè°ƒç”¨release(1)æ–¹æ³•,å¦‚ä¸‹æ‰€ç¤º 123456789public final boolean release(int arg) &#123; if (tryRelease(arg)) &#123; Node h = head; if (h != null &amp;&amp; h.waitStatus != 0) unparkSuccessor(h); return true; &#125; return false;&#125; ä¸Šè¿°ä¼šå°è¯•æ‰§è¡Œé‡Šæ”¾é”çš„æ“ä½œï¼Œè°ƒç”¨FairSyncå®žçŽ°çš„tryReleaseæ–¹æ³•ï¼Œå’ŒèŽ·å–é”çš„è·¯å­ç±»ä¼¼ 1234567891011121314protected final boolean tryRelease(int releases) &#123; int c = getState() - releases; if (Thread.currentThread() != getExclusiveOwnerThread()) throw new IllegalMonitorStateException(); // æ˜¯å¦å®Œå…¨é‡Šæ”¾é” boolean free = false; // å…¶å®žå°±æ˜¯é‡å…¥çš„é—®é¢˜ï¼Œå¦‚æžœc==0ï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰åµŒå¥—é”äº†ï¼Œå¯ä»¥é‡Šæ”¾äº†ï¼Œå¦åˆ™è¿˜ä¸èƒ½é‡Šæ”¾æŽ‰ if (c == 0) &#123; free = true; setExclusiveOwnerThread(null); &#125; setState(c); return free;&#125; å¦‚æžœé‡Šæ”¾é”æˆåŠŸï¼Œä¸”headä¸ä¸ºç©ºå°±ä¼šè°ƒç”¨unparkSuccessoræ–¹æ³•æ¥å”¤é†’åŽç»§çš„çº¿ç¨‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š1234567891011121314151617181920212223242526272829303132// å”¤é†’åŽç»§èŠ‚ç‚¹// ä»Žä¸Šé¢è°ƒç”¨å¤„çŸ¥é“ï¼Œå‚æ•°nodeæ˜¯headå¤´ç»“ç‚¹private void unparkSuccessor(Node node) &#123; /* * If status is negative (i.e., possibly needing signal) try * to clear in anticipation of signalling. It is OK if this * fails or if status is changed by waiting thread. */ int ws = node.waitStatus; // å¦‚æžœheadèŠ‚ç‚¹å½“å‰waitStatus&lt;0, å°†å…¶ä¿®æ”¹ä¸º0 if (ws &lt; 0) compareAndSetWaitStatus(node, ws, 0); /* * Thread to unpark is held in successor, which is normally * just the next node. But if cancelled or apparently null, * traverse backwards from tail to find the actual * non-cancelled successor. */ // ä¸‹é¢çš„ä»£ç å°±æ˜¯å”¤é†’åŽç»§èŠ‚ç‚¹ï¼Œä½†æ˜¯æœ‰å¯èƒ½åŽç»§èŠ‚ç‚¹å–æ¶ˆäº†ç­‰å¾…ï¼ˆwaitStatus==1ï¼‰ // ä»Žé˜Ÿå°¾å¾€å‰æ‰¾ï¼Œæ‰¾åˆ°waitStatus&lt;=0çš„æ‰€æœ‰èŠ‚ç‚¹ä¸­æŽ’åœ¨æœ€å‰é¢çš„ Node s = node.next; if (s == null || s.waitStatus &gt; 0) &#123; s = null; // ä»ŽåŽå¾€å‰æ‰¾ï¼Œä»”ç»†çœ‹ä»£ç ï¼Œä¸å¿…æ‹…å¿ƒä¸­é—´æœ‰èŠ‚ç‚¹å–æ¶ˆ(waitStatus==1)çš„æƒ…å†µ for (Node t = tail; t != null &amp;&amp; t != node; t = t.prev) if (t.waitStatus &lt;= 0) s = t; &#125; if (s != null) // å”¤é†’çº¿ç¨‹ LockSupport.unpark(s.thread);&#125; å”¤é†’çš„çº¿ç¨‹ä¼šåœ¨å¦‚ä¸‹ä»£ç ç»§ç»­è¿›è¡Œ1234private final boolean parkAndCheckInterrupt() &#123; LockSupport.park(this); // åˆšåˆšçº¿ç¨‹è¢«æŒ‚èµ·åœ¨è¿™é‡Œäº† return Thread.interrupted();&#125; æ³¨æ„ï¼šLockSupportæ˜¯å¹¶å‘åŒ…ä¸­é’ˆå¯¹çº¿ç¨‹é˜»å¡žæ“ä½œçš„å·¥å…·ç±» æ‰§è¡Œå®Œï¼Œè¿™æ—¶ä¼šè¿”å›žåˆ°acquireQueued(final Node node, int arg)æ–¹æ³•ï¼Œè€Œæ–¹æ³•ä¸­çš„æ— é™å¾ªçŽ¯for(;;)å°±æ˜¯ä¸ºäº†å”¤é†’çš„çº¿ç¨‹é‡æ–°åŽ»èŽ·å–é”ï¼Œç›´åˆ°å¼‚å¸¸é€€å‡ºæˆ–è€…æ‰§è¡Œå®Œ æ€»ç»“AQSæ˜¯ç”±CLHé”å®žçŽ°çš„,æ˜¯ä¸€ç§åŸºäºŽé“¾è¡¨çš„å¯æ‰©å±•ã€é«˜æ€§èƒ½ã€å…¬å¹³çš„è‡ªæ—‹é”ï¼Œç”³è¯·çº¿ç¨‹åªåœ¨æœ¬åœ°å˜é‡ä¸Šè‡ªæ—‹ï¼Œå®ƒä¸æ–­è½®è¯¢å‰é©±çš„çŠ¶æ€ï¼Œå¦‚æžœå‘çŽ°å‰é©±é‡Šæ”¾äº†é”å°±ç»“æŸè‡ªæ—‹ï¼Œåœ¨æ•´ä¸ªå¹¶å‘åŒ…ä¸­ï¼Œå¾ˆå¤šåœ°æ–¹ä½ éƒ½ä¼šçœ‹è§AQSçš„èº«å½±ï¼Œä»–åœ¨å¹¶å‘æŽ§åˆ¶çš„ä½œç”¨æ— æ³•æ›¿ä»£ å‚è€ƒhttps://hongjiev.github.io/2017/06/16/AbstractQueuedSynchronizer/http://blog.csdn.net/chen77716/article/details/6641477]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[æ·±å…¥å¹¶å‘åŒ…-çº¿ç¨‹æ± ]]></title>
      <url>%2F2017%2F06%2F13%2Fthreadpool%2F</url>
      <content type="text"><![CDATA[ä»…ä¾›å­¦ä¹ äº¤æµ,å¦‚æœ‰é”™è¯¯è¯·æŒ‡å‡º,å¦‚è¦è½¬è½½è¯·åŠ ä¸Šå‡ºå¤„,è°¢è°¢ å‰è¨€çº¿ç¨‹æ˜¯åº”ç”¨ç¨‹åºæ‰§è¡Œä»»åŠ¡çš„æœ€å°å•å…ƒï¼Œåœ¨jvmä¸­å…è®¸åº”ç”¨ç¨‹åºåœ¨å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œç«Ÿå¯èƒ½åˆ©ç”¨æœåŠ¡å™¨çš„æ€§èƒ½æ¥æœ€å¤§åŒ–æé«˜åº”ç”¨ç¨‹åºçš„åžåé‡å’Œå“åº”æ€§ï¼Œä½†æ˜¯å¾€å¾€åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­ï¼Œå¦‚æžœæˆ‘ä»¬ä¸ºæ¯ä¸€ä¸ªä»»åŠ¡åˆ†é…ä¸€ä¸ªçº¿ç¨‹ï¼Œå½“åˆ›å»ºè¶³å¤Ÿå¤šçš„æ—¶å€™ï¼Œå°±ä¼šå­˜åœ¨ä¸€äº›æ˜Žæ˜¾çš„ç¼ºé™·ï¼š çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸå¼€é”€é«˜ï¼šçº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯æ˜¯éœ€è¦ä¸€å®šçš„æ—¶é—´ï¼Œå¹¶ä¸”éœ€è¦JVMå’Œæ“ä½œç³»ç»Ÿç›¸äº’è¾…åŠ©æ“ä½œï¼Œåœ¨åº”ç”¨ç¨‹åºåˆ›å»ºè¶³å¤Ÿå¤šçš„çº¿ç¨‹æ—¶ï¼Œè¿™ä¸ªæ¶ˆè€—ä¹Ÿæ˜¯å¾ˆå¯è§‚çš„ èµ„æºæ¶ˆè€—ï¼šæ´»è·ƒçš„çº¿ç¨‹ä¼šæ¶ˆè€—å¤§é‡çš„å†…å­˜ï¼Œå¦‚æžœä½ çš„å¤„ç†å™¨æ•°é‡å°‘äºŽä½ çš„å¤„ç†çº¿ç¨‹çš„æ•°é‡ï¼Œè¿™å°†ä¼šäº§ç”Ÿå¤§é‡çš„é—²ç½®çº¿ç¨‹ï¼Œè¿™ä¼šå ç”¨å¤§é‡çš„å†…å­˜ï¼Œä»¥åŠåœ¨å…±äº«èµ„æºçš„ç«žäº‰ä¸Šä¼šäº§ç”Ÿå…¶ä»–çš„æ€§èƒ½å¼€é”€ï¼ŒåŒæ—¶ä¹Ÿç»™GCå¸¦æ¥åŽ‹åŠ› ç¨³å®šæ€§ï¼šæ¯ä¸ªå¹³å°å¯¹äºŽçº¿ç¨‹éƒ½ä¼šæœ‰ä¸€å®šçš„é™åˆ¶ï¼Œå¯¹äºŽJVMæ¥è®²ï¼Œåœ¨JVMçš„å¯åŠ¨å‚æ•°æˆ–è€…Threadæž„é€ å‡½æ•°è¯·æ±‚æ ˆçš„å¤§å°è¿™éƒ½å¯¹çº¿ç¨‹çš„æ•°é‡é€ æˆä¸€å®šçš„é™åˆ¶ï¼Œå¦‚æžœè¶…è¿‡äº†è¿™äº›é™åˆ¶ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šé€ æˆéš¾ä»¥æ¢å¤çš„OutOfMemoryErrorçš„å¼‚å¸¸ï¼Œè¿˜æœ‰æ“ä½œç³»ç»Ÿæœ¬èº«å¯¹çº¿ç¨‹çš„ä¸€äº›é™åˆ¶ï¼Œéƒ½ä¼šé€ æˆåº”ç”¨ç¨‹åºçš„ä¸ç¨³å®šåŸºäºŽä»¥ä¸Šçš„ä¸€äº›ç¼ºé™·ï¼Œæ‰€ä»¥éœ€è¦æœ‰ä¸€ç§æœºåˆ¶æ¥ç®¡ç†çº¿ç¨‹ï¼Œè¿™å°±å‡ºçŽ°äº†Executoræ¡†æž¶ Executoræ¡†æž¶Executoræ¡†æž¶æ˜¯JDK1.5æå‡ºçš„ï¼Œç”±JAVAå¤§ç¥žDoug Leaç¼–å†™ï¼Œä»–å¾ˆè¯¦ç»†çš„æè¿°äº†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼ŒçŽ°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸€çœ‹Executoræ¡†æž¶çš„ç»“æž„å›¾ ExecutorExecutoræ˜¯Executoræ¡†æž¶æœ€é¡¶å±‚çš„æŽ¥å£ï¼Œä¹Ÿæ˜¯æœ€æ ¸å¿ƒçš„åŠŸèƒ½ï¼Œæˆ‘ä»¬è¿›å…¥ExecutoræŽ¥å£çš„æºç ï¼ˆJDK1.8ï¼‰çœ‹ä¸€çœ‹12345678910111213public interface Executor &#123; /** * Executes the given command at some time in the future. The command * may execute in a new thread, in a pooled thread, or in the calling * thread, at the discretion of the &#123;@code Executor&#125; implementation. * * @param command the runnable task * @throws RejectedExecutionException if this task cannot be * accepted for execution * @throws NullPointerException if command is null */ void execute(Runnable command);&#125; ç”±ä¸Šå¯çŸ¥ï¼ŒExecutoræŽ¥å£åªæœ‰ä¸€ä¸ªexecuteæ–¹æ³•ï¼Œä»–çš„åŠŸèƒ½ä»Žæ³¨é‡Šä¸­å¯çŸ¥ï¼šå°±æ˜¯æäº¤ä¸€ä¸ªä»»åŠ¡å‘½ä»¤ï¼Œç„¶åŽåœ¨å°†æ¥çš„æŸä¸ªæ—¶é—´æ®µæ‰§è¡Œè¯¥ï¼ˆä¸€ç»„æˆ–è€…ä¸€ä¸ªï¼‰ä»»åŠ¡å‘½ä»¤ï¼Œæ˜¾è€Œæ˜“è§ï¼Œè¿™æ˜¯ä¸ªæ‰§è¡Œçº¿ç¨‹çš„æ–¹æ³•ï¼Œä»–å°†çº¿ç¨‹çš„æäº¤è¿‡ç¨‹å’Œçº¿ç¨‹çš„æ‰§è¡Œè¿‡ç¨‹è§£è€¦å‡ºæ¥ï¼Œè¿™å°±ç›¸å½“äºŽç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼Œæäº¤è¿‡ç¨‹ç›¸å½“äºŽç”Ÿäº§è€…ï¼Œæ‰§è¡Œè¿‡ç¨‹ç›¸å½“äºŽæ¶ˆè´¹è€…ï¼Œç„¶åŽä»¥ä¸€ä¸ªå¼‚æ­¥çš„æ‰§è¡Œç­–ç•¥æ¥æ‰§è¡Œä»»åŠ¡ï¼ˆå½“ç„¶è¿™å¹¶ä¸æ˜¯ä¸¥æ ¼è¦æ±‚çš„ï¼‰ï¼Œè¿™æäº¤å’Œæ‰§è¡Œè¿‡ç¨‹ä¸­è¦ç¬¦åˆå†…å­˜ä¸€è‡´æ€§æ•ˆæžœï¼Œå°±æ˜¯çº¿ç¨‹ä¸­å°†Runnableå¯¹è±¡æäº¤åˆ°Executoræ‰§è¡Œä¹‹å‰è¦éµå¾ªhappen-beforeåŽŸåˆ™ ExecutorServiceåœ¨ä¸Šè¿°çš„Executorä¸­ï¼Œåªæ˜¯å¯¹äºŽçº¿ç¨‹çš„æäº¤ï¼Œæ‰§è¡Œçš„æè¿°ï¼Œå¹¶æ²¡æœ‰è€ƒè™‘åˆ°ä»»åŠ¡çº¿ç¨‹çš„å…³é—­ï¼Œåœ¨çº¿ç¨‹çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå…³é—­çº¿ç¨‹ä¹Ÿæ˜¯éžå¸¸é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚æžœä¸èƒ½æ­£å¸¸çš„å…³é—­ï¼Œä¼šå¯¼è‡´åº”ç”¨ç¨‹åºä¸€äº›æ„æƒ³ä¸åˆ°çš„å¼‚å¸¸ï¼Œæ‰€ä»¥ExecutorServiceçš„ä½œç”¨æ˜¯æ‰©å±•äº†Executorï¼Œå®Œå–„äº†ä»»åŠ¡çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†ï¼Œä»¥åŠè·Ÿè¸ªä¸€ä¸ªæˆ–å¤šä¸ªå¼‚æ­¥çš„ä»»åŠ¡çº¿ç¨‹æ‰§è¡ŒçŠ¶å†µè€Œç”ŸæˆFutureï¼Œä¸»è¦çš„æ–¹æ³•å¦‚ä¸‹ï¼š isShutdown() ï¼šåˆ¤æ–­å½“å‰åº”ç”¨ç¨‹åºæ˜¯å¦å…³é—­ï¼Œå¦‚æžœå·²å…³é—­è¿”å›žtrue shutdown()ï¼šå¯åŠ¨é¡ºåºå…³é—­æœºåˆ¶ï¼Œæ‰§è¡Œæ­¤å‰æäº¤çš„ä»»åŠ¡ï¼Œä¸å†æŽ¥å—æ–°çš„ä»»åŠ¡ shutdownNow() ï¼šè¯•å›¾ç«‹åˆ»æ‰§è¡Œå…³é—­æ‰€æœ‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¹¶ä¸”è¿”å›žç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ submit(Runnable task):submitæ˜¯å¯¹ ExecutoræŽ¥å£ä¸­çš„executeæ–¹æ³•çš„ä¸€ä¸ªæ‰©å±•ï¼Œä½¿ç”¨Futureå¯¹å¼‚æ­¥ä»»åŠ¡çº¿ç¨‹çš„æ‰§è¡ŒæŽ§åˆ¶ isTerminated() ï¼šåˆ¤æ–­æ‰€æœ‰çš„ä»»åŠ¡æ˜¯å¦éƒ½å·²ç»å®Œæˆï¼Œå®Œæˆå°±è¿”å›žtrue invokeAny(Collection&lt;? extends Callable&gt; tasks):æ‰§è¡Œç»™å®šçš„ä»»åŠ¡ï¼Œå¦‚æžœæŸä¸ªä»»åŠ¡å®Œæˆåˆ™è¿”å›žè¯¥ç»“æžœ invokeAll(Collection&lt;? extends Callable&gt; tasks):æ‰§è¡Œç»™å®šçš„ä»»åŠ¡ï¼Œå½“æ‰€æœ‰çš„ä»»åŠ¡å®Œæˆä¹‹åŽï¼Œè¿”å›žä¿æŒä»»åŠ¡çŠ¶æ€å’Œç»“æžœçš„Futrueåˆ—è¡¨ AbstractExecutorServiceAbstractExecutorServiceæ˜¯ExecutorServiceçš„é»˜è®¤å®žçŽ°ï¼Œä¸»è¦æ˜¯ä½¿ç”¨RunnableFutureï¼ˆå®ƒæ˜¯ä¸€ä¸ªRunnableçš„Futrueï¼ŒæŒ‡å¯ä»¥æ‰§è¡ŒRunnableå¹¶å¯ä»¥è®¿é—®å…¶ç»“æžœï¼‰å®žçŽ°submitï¼ŒinvokeAnyå’ŒinvokeAllç­‰æ–¹æ³•ï¼Œè€Œç”ŸæˆRunnableFutureçš„æ ¸å¿ƒæ–¹æ³•å°±æ˜¯newTaskForï¼Œä»–çš„å«ä¹‰ç»™æ‰§è¡Œçš„ä»»åŠ¡çº¿ç¨‹ç”Ÿæˆä¸€ä¸ªRunnableFuture ScheduledExecutorServiceå’ŒScheduledThreadPoolExecutorScheduledExecutorServiceæ˜¯ä¸€ç§å»¶è¿Ÿæ‰§è¡Œçš„ExecutorServiceï¼ŒScheduledThreadPoolExecutoræ˜¯å…¶å®žçŽ°ç±»ï¼ŒæŒ‡å®‰æŽ’æŒ‡å®šçš„å»¶è¿Ÿæ—¶é—´æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä¸»è¦æ–¹æ³•scheduleæ˜¯æŒ‡åˆ›å»ºå¹¶æ‰§è¡Œåœ¨ç»™å®šå»¶è¿Ÿæ—¶é—´å¯ç”¨çš„ScheduledFutureï¼ˆå®ƒæ˜¯ä¸€ä¸ªscheduledçš„Future,æŒ‡ä¸€ç§å»¶è¿Ÿå¹¶å¯ç»“æžœåŒ–çš„æ“ä½œï¼‰ ForkJoinPoolForkJoinPoolæ˜¯å¯¹AbstractExecutorServiceçš„æ‰©å±•ï¼Œæ˜¯åŸºäºŽåˆ†è€Œæ²»ä¹‹çš„æ€æƒ³ï¼Œå°†å¤æ‚çš„ä»»åŠ¡å¼‚æ­¥çš„åˆ†è§£æˆå¤šä¸ªå°ä»»åŠ¡åŽ»æ‰§è¡Œï¼Œè¯¥ç±»ä¹Ÿæ˜¯ForkJoinæ¡†æž¶æ ¸å¿ƒçš„ç±»ï¼Œè¿™é‡Œå°±ä¸åœ¨èµ˜è¿°äº† ThreadPoolExecutorä»»åŠ¡çš„çŠ¶æ€ThreadPoolExecutoré¡¾åæ€ä¹‰çº¿ç¨‹æ± ï¼Œæ˜¯Executoræ¡†æž¶çš„ä¸»è¦å®žçŽ°æ–¹æ³•ï¼Œä»–å®žçŽ°äº†ä¸»è¦çš„ä»»åŠ¡çº¿ç¨‹æ‰§è¡Œå’Œå…³é—­è¿‡ç¨‹ï¼Œä¸‹é¢é€šè¿‡æºç æ¥åˆ†æžä¸€ä¸‹ï¼ˆåŸºäºŽJDK1.8ï¼‰ ThreadPoolExecutorå®šä¹‰äº†äº”ç§ä»»åŠ¡çº¿ç¨‹çš„çŠ¶æ€ï¼Œå®ƒè®°å½•äº†çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹çš„å£°æ˜Žå‘¨æœŸï¼š RUNNINGï¼šå¯ä»¥æŽ¥å—æ–°çš„ä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥å¤„ç†é˜»å¡žé˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ SHUTDOWNï¼šä¸æŽ¥å—æ–°çš„ä»»åŠ¡ï¼Œä½†æ˜¯å¯ä»¥å¤„ç†é˜»å¡žé˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ STOPï¼šä¸æŽ¥å—æ–°çš„ä»»åŠ¡ï¼Œä¸å¤„ç†é˜»å¡žé˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ï¼Œä¸­æ–­æ­£åœ¨å¤„ç†çš„ä»»åŠ¡ TIDYINGï¼šè¿‡æ¸¡çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œäº†ï¼Œå½“å‰çº¿ç¨‹æ± å·²ç»æ²¡æœ‰æœ‰æ•ˆçš„çº¿ç¨‹ï¼Œè¿™ä¸ªæ—¶å€™çº¿ç¨‹æ± çš„çŠ¶æ€å°†ä¼šTIDYINGï¼Œå¹¶ä¸”å°†è¦è°ƒç”¨terminatedæ–¹æ³• TERMINATEDï¼šç»ˆæ­¢çŠ¶æ€ã€‚terminatedæ–¹æ³•è°ƒç”¨å®Œæˆä»¥åŽçš„çŠ¶æ€ çŠ¶æ€ä¹‹é—´å¯ä»¥è¿›è¡Œè½¬æ¢ï¼š RUNNING -&gt; SHUTDOWNï¼šæ‰‹åŠ¨è°ƒç”¨shutdownæ–¹æ³•ï¼Œæˆ–è€…ThreadPoolExecutorè¦è¢«GCå›žæ”¶çš„æ—¶å€™è°ƒç”¨finalizeæ–¹æ³•ï¼Œfinalizeæ–¹æ³•å†…éƒ¨ä¹Ÿä¼šè°ƒç”¨shutdownæ–¹æ³• (RUNNING or SHUTDOWN) -&gt; STOPï¼šè°ƒç”¨shutdownNowæ–¹æ³• SHUTDOWN -&gt; TIDYINGï¼šå½“é˜Ÿåˆ—å’Œçº¿ç¨‹æ± éƒ½ä¸ºç©ºçš„æ—¶å€™ STOP -&gt; TIDYINGï¼šå½“çº¿ç¨‹æ± ä¸ºç©ºçš„æ—¶å€™ TIDYING -&gt; TERMINATEDï¼šterminatedæ–¹æ³•è°ƒç”¨å®Œæˆä¹‹åŽ æºç å®šä¹‰å¦‚ä¸‹ï¼š123456789private final AtomicInteger ctl = new AtomicInteger(ctlOf(RUNNING, 0));private static final int COUNT_BITS = Integer.SIZE - 3;private static final int CAPACITY = (1 &lt;&lt; COUNT_BITS) - 1;// runState is stored in the high-order bitsprivate static final int RUNNING = -1 &lt;&lt; COUNT_BITS;private static final int SHUTDOWN = 0 &lt;&lt; COUNT_BITS;private static final int STOP = 1 &lt;&lt; COUNT_BITS;private static final int TIDYING = 2 &lt;&lt; COUNT_BITS;private static final int TERMINATED = 3 &lt;&lt; COUNT_BITS; ThreadPoolExecutorå¤„ç†æŸä¸ªçŠ¶æ€æ‹¥æœ‰çš„æ´»è·ƒçº¿ç¨‹æ•°é‡æ˜¯ç”¨ä¸€ä¸ªæ•´å½¢å¸¸é‡æ¥è¡¨ç¤ºï¼Œç”¨å‰ä¸‰ä½æ¥è¡¨ç¤ºçŠ¶æ€ï¼ŒåŽ29ä½æ¥è¡¨ç¤ºæ•°é‡ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹COUNT_BITSå¸¸é‡,é€šè¿‡è®¡ç®—å¯çŸ¥å®ƒçš„å€¼ä¸º29ï¼Œåœ¨javaä¸­ä¸€ä¸ªæ•´å½¢å ç”¨å››ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªå­—èŠ‚æ˜¯å…«ä½ï¼Œæ‰€ä»¥ä¸€ä¸ªæ•´å½¢å ç”¨32ä½ï¼Œè€ŒCOUNT_BITSè¡¨ç¤ºçš„å°±æ˜¯æ•´å½¢ä¸­çš„åŽ29ä½ï¼Œå®ƒçš„å«ä¹‰æ˜¯æ¥å­˜å‚¨æœ‰æ•ˆçº¿ç¨‹çš„çº¿ç¨‹æ•°ï¼Œé‚£çŠ¶æ€åˆæ€Žä¹ˆè¡¨ç¤ºäº†ï¼Œæˆ‘ä»¬æ¥çœ‹RUNNINGçŠ¶æ€ï¼š-1&lt;&lt;COUNT_BITSè¿™ä¸ªå·¦ç§»ä½è¿ç®—ï¼ˆä¸¢å¼ƒCOUNT_BITSæ•°é‡çš„æœ€é«˜ä½ï¼Œ0è¡¥æœ€ä½Žä½ï¼‰ï¼Œé€šè¿‡-1&lt;&lt;29å¾—åˆ°11100000000000000000000000000000ï¼Œå‰3ä½ä¸º111ï¼Œå°±æ˜¯è¡¨ç¤ºRUNNINGçš„çŠ¶æ€æ ‡å¿—ï¼Œå…¶å®ƒå››ç§çŠ¶æ€ä¹Ÿè·Ÿæ­¤è¡¨ç¤ºæ–¹æ³•ä¸€æ ·æ¥æ ‡å¿—ä¸Šè¿°ä»£ç ä¸­ï¼Œå¸¸é‡ctlè¡¨ç¤ºçš„æ˜¯åˆå§‹çº¿ç¨‹æ± çš„çŠ¶æ€å’Œæ•°é‡ï¼Œé»˜è®¤æ˜¯RUNNINGçŠ¶æ€å’Œ0ä¸ªæ´»è·ƒä»»åŠ¡çº¿ç¨‹æ•°é‡ï¼Œè€ŒCAPACITYè¡¨ç¤ºçš„æ˜¯çº¿ç¨‹æ± çš„å®¹é‡ï¼Œé€šè¿‡ï¼ˆ1&lt;&lt;29ï¼‰-1è¿ç®—èŽ·å¾—ï¼Œæ¸…æ¥šäº†ä»»åŠ¡çº¿ç¨‹çš„çŠ¶æ€å’Œæ•°é‡çš„å«ä¹‰ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸‰ä¸ªé‡è¦çš„å¯¹ä»»åŠ¡çº¿ç¨‹çš„çŠ¶æ€å’Œæ•°é‡æ“ä½œçš„å†…éƒ¨é™æ€æ–¹æ³• 123456// å¾—åˆ°çŠ¶æ€ï¼ŒCAPACITYçš„éžæ“ä½œå¾—åˆ°çš„äºŒè¿›åˆ¶ä½11100000000000000000000000000000ï¼Œç„¶åŽåšåœ¨ä¸€ä¸ªä¸Žæ“ä½œï¼Œç›¸å½“äºŽç›´æŽ¥å–å‰3ä½çš„çš„å€¼private static int runStateOf(int c) &#123; return c &amp; ~CAPACITY; &#125;// å¾—åˆ°çº¿ç¨‹æ•°ï¼Œä¹Ÿå°±æ˜¯åŽ29ä½çš„æ•°å­—ã€‚ ç›´æŽ¥è·ŸCAPACITYåšä¸€ä¸ªä¸Žæ“ä½œå³å¯ï¼ŒCAPACITYå°±æ˜¯çš„å€¼å°± 1 &lt;&lt; 29 - 1 = 00011111111111111111111111111111ã€‚ ä¸Žæ“ä½œçš„è¯å‰é¢3ä½è‚¯å®šä¸º0ï¼Œç›¸å½“äºŽç›´æŽ¥å–åŽ29ä½çš„å€¼private static int workerCountOf(int c) &#123; return c &amp; CAPACITY; &#125;// æˆ–æ“ä½œã€‚ç›¸å½“äºŽæ›´æ–°æ•°é‡å’ŒçŠ¶æ€ä¸¤ä¸ªæ“ä½œprivate static int ctlOf(int rs, int wc) &#123; return rs | wc; &#125; ä»»åŠ¡çš„åˆå§‹åŒ–ThreadPoolExecutoræä¾›äº†åˆå§‹åŒ–çš„æž„é€ æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š123456789101112131415161718192021public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler) &#123; if (corePoolSize &lt; 0 || maximumPoolSize &lt;= 0 || maximumPoolSize &lt; corePoolSize || keepAliveTime &lt; 0) throw new IllegalArgumentException(); if (workQueue == null || threadFactory == null || handler == null) throw new NullPointerException(); this.corePoolSize = corePoolSize; this.maximumPoolSize = maximumPoolSize; this.workQueue = workQueue; this.keepAliveTime = unit.toNanos(keepAliveTime); this.threadFactory = threadFactory; this.handler = handler;&#125; corePoolSizeï¼šçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ï¼Œå¦‚æžœæ‰§è¡Œçš„çº¿ç¨‹æ•°å¤§äºŽè¯¥æ•°é‡ï¼Œå°±è¿›å…¥é˜»å¡žé˜Ÿåˆ—è¿›è¡Œç­‰å¾… maximumPoolSizeï¼šçº¿ç¨‹æ± å…è®¸æœ€å¤§çš„çº¿ç¨‹æ•° keepAliveTimeï¼šæ‰§è¡Œçš„çº¿ç¨‹æ•°å¤§äºŽè¯¥çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ï¼Œå¤šä½™çš„ç©ºé—²çº¿ç¨‹åœ¨å›žæ”¶å‰ç­‰å¾…æ–°ä»»åŠ¡çš„æ—¶é—´ unitï¼šæ—¶é—´å•ä½ workQueueï¼šä¿å­˜æ‰§è¡Œä»»åŠ¡çš„é˜»å¡žé˜Ÿåˆ— threadFactoryï¼šåˆ›å»ºçº¿ç¨‹çš„çº¿ç¨‹å·¥åŽ‚ handlerï¼šæ‰§è¡Œè¢«é˜»æ­¢æ—¶ä½¿ç”¨çš„å¤„ç†ç¨‹åºï¼Œå› ä¸ºçº¿ç¨‹å·²è¾¾åˆ°çº¿ç¨‹é™åˆ¶å’Œé˜Ÿåˆ—å®¹é‡ ä½†æ˜¯JDKå¹¶ä¸æŽ¨èç›´æŽ¥ç”¨æž„é€ å‡½æ•°æ¥è¿›è¡Œçº¿ç¨‹æ± çš„åˆå§‹åŒ–ï¼Œç›´æŽ¥åˆå§‹åŒ–çš„çµæ´»æ€§å’Œç®¡ç†ä¸Šå¹¶ä¸å¥½ï¼ŒäºŽæ˜¯æä¾›äº†executorsçº¿ç¨‹æ± å·¥åŽ‚ç±»ï¼Œå®ƒåº”ç”¨ä¸Žå„ç§ä¸åŒåœºæ™¯ä¸‹å¯¹çº¿ç¨‹æ± çš„åˆå§‹åŒ–éœ€æ±‚ï¼Œä¸»è¦æœ‰å¦‚ä¸‹æ–¹æ³•ï¼š newFixedThreadPoolï¼šåˆ›å»ºä¸€ä¸ªå›ºå®šæ•°é‡çº§çš„çº¿ç¨‹æ± ï¼Œå¦‚æžœæ´»è·ƒçº¿ç¨‹æ•°è¶…è¿‡çº¿ç¨‹æ± æ•°é‡ï¼Œå®ƒä»¬å°†åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­çŸ¥é“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¯ç”¨ newSingleThreadExecutorï¼šåˆ›å»ºå•ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œå¦‚æžœè¯¥å•çº¿ç¨‹ç”±äºŽæ•…éšœç­‰åŽŸå› åœæ­¢ï¼Œæƒ³è¦æ‰§è¡ŒåŽç»­çš„ä»»åŠ¡ï¼Œåˆ™ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹åŽ»æ‰§è¡Œ newCachedThreadPoolï¼šåˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çš„çº¿ç¨‹æ± ï¼Œæ ¹æ®éœ€è¦ï¼Œå¦‚æžœæœ‰æ–°çš„ä»»åŠ¡è¿›æ¥ï¼Œçº¿ç¨‹æ± æ²¡æœ‰å¤šä½™çš„çº¿ç¨‹å¯ç”¨ï¼Œåˆ™åœ¨çº¿ç¨‹æ± ä¸­åˆ›å»ºæ–°çš„çº¿ç¨‹æ‰§è¡Œï¼Œæœ‰å°±å¤ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹ï¼Œå¦‚æžœçº¿ç¨‹æœ‰60ç§’æœªè¢«ä½¿ç”¨åˆ™ä¼šä»Žç¼“å­˜ä¸­å›žæ”¶ newSingleThreadScheduledExecutorï¼šåˆ›å»ºå•ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œä»¥å»¶è¿Ÿæˆ–å®šæ—¶çš„æ–¹å¼æ¥æ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æžœè¯¥å•çº¿ç¨‹ç”±äºŽæ•…éšœç­‰åŽŸå› åœæ­¢ï¼Œæƒ³è¦æ‰§è¡ŒåŽç»­çš„ä»»åŠ¡ï¼Œåˆ™ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹åŽ»æ‰§è¡Œ newScheduledThreadPoolï¼šåˆ›å»ºä¸€ä¸ªå›ºå®šçš„çº¿ç¨‹æ± ï¼Œä»¥å»¶è¿Ÿæˆ–è€…å®šæ—¶çš„æ–¹å¼æ¥æ‰§è¡Œä»»åŠ¡ ä»»åŠ¡çš„æ‰§è¡ŒThreadPoolExecutorå®žçŽ°äº†executeæ–¹æ³•ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹12345678910111213141516171819public void execute(Runnable command) &#123; if (command == null) throw new NullPointerException(); int c = ctl.get(); if (workerCountOf(c) &lt; corePoolSize) &#123; if (addWorker(command, true)) return; c = ctl.get(); &#125; if (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123; int recheck = ctl.get(); if (! isRunning(recheck) &amp;&amp; remove(command)) reject(command); else if (workerCountOf(recheck) == 0) addWorker(null, false); &#125; else if (!addWorker(command, false)) reject(command);&#125; æ‰§è¡Œexecuteæ–¹æ³•æ€»å…±æœ‰ä¸‰ä¸ªæ­¥éª¤ï¼Œä¹Ÿå°±æ˜¯ä¸Šè¿°ä»£ç çš„ä¸‰ä¸ªåˆ¤æ–­ if (workerCountOf(c) &lt; corePoolSize) ï¼šå¦‚æžœå½“å‰çš„å·¥ä½œçº¿ç¨‹æ•°é‡å°‘äºŽçº¿ç¨‹æ± çš„åŸºæœ¬æ•°é‡ï¼Œåˆ™ç›´æŽ¥åˆ›å»ºæ–°çš„å·¥ä½œçº¿ç¨‹æ‰§è¡Œï¼Œè°ƒç”¨addWorkeræ–¹æ³• if (isRunning(c) &amp;&amp; workQueue.offer(command))ï¼šå¦‚æžœå½“å‰çš„å·¥ä½œçº¿ç¨‹æ•°é‡å¤§äºŽç­‰äºŽçº¿ç¨‹æ± çš„åŸºæœ¬æ•°é‡ï¼Œä¸”æ˜¯RUNNINGçš„çŠ¶æ€ï¼Œå°±åŠ å…¥ç­‰å¾…é˜»å¡žé˜Ÿåˆ—ï¼Œå¦‚æžœæˆåŠŸçš„è¯ï¼Œå†è¿›è¡Œç¬¬äºŒæ¬¡éªŒè¯ï¼Œå¦‚æžœåœ¨é˜»å¡žé˜Ÿåˆ—ä¸­ç”±äºŽå¦ä¸€ä¸ªçº¿ç¨‹å…³é—­çº¿ç¨‹æ± æˆ–è€…çº¿ç¨‹å‡ºçŽ°æ­»äº¡äº†ï¼Œè¿™ä¸ªæ—¶å€™çº¿ç¨‹å¹¶ä¸åœ¨RUNNINGçŠ¶æ€ï¼Œå°±æŠŠåˆšåŠ å…¥çš„çº¿ç¨‹removeæŽ‰ï¼ŒæˆåŠŸçš„è¯å°±è°ƒç”¨rejectæ–¹æ³•ï¼Œå¦åˆ™åˆ¤æ–­å·¥ç¨‹çº¿ç¨‹æ˜¯å¦ä¸º0ï¼Œæ˜¯å°±è°ƒç”¨addWorker()åŠ å…¥ä¸€ä¸ªæ–°çº¿ç¨‹ å¦‚æžœæ”¾è¿›é˜»å¡žç­‰å¾…é˜Ÿåˆ—å¤±è´¥çš„è¯ï¼Œé‚£æˆ‘ä»¬å°è¯•æ·»åŠ ä¸€ä¸ªæ–°çš„çº¿ç¨‹æ‰§è¡Œï¼Œå¦‚æžœå¤±è´¥çš„è¯ï¼Œåˆ™åº”è¯¥æ˜¯çº¿ç¨‹æ± é¥±å’Œæˆ–è€…å…³é—­äº†ï¼Œè°ƒç”¨rejectæ–¹æ³• æ³¨æ„ï¼šåœ¨addWorkeræ–¹æ³•ä¸­ï¼Œç¬¬äºŒbooleanå‚æ•°çš„trueä»£è¡¨ä»¥corePoolSizeä¸ºæ ‡å‡†ï¼Œfalseä»¥maximumPoolSizeä¸ºåŸºå‡† executeæ–¹æ³•çš„æ ¸å¿ƒå°±æ˜¯åœ¨çº¿ç¨‹æ± ä¸­å¦‚ä½•å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯addWorkeræ–¹æ³•ï¼Œåœ¨æ·±å…¥addWorkeræ–¹æ³•ä¹‹å‰å…ˆè¦äº†è§£çº¿ç¨‹åœ¨çº¿ç¨‹æ± çš„è¡¨çŽ°çš„åŸºæœ¬å•å…ƒè½½ä½“ç±»Workerï¼ŒWorkeræ˜¯ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä»–çš„å®žçŽ°123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172private final class Worker extends AbstractQueuedSynchronizer implements Runnable&#123; /** * This class will never be serialized, but we provide a * serialVersionUID to suppress a javac warning. */ private static final long serialVersionUID = 6138294804551838833L; /** Thread this worker is running in. Null if factory fails. */ final Thread thread; /** Initial task to run. Possibly null. */ Runnable firstTask; /** Per-thread task counter */ volatile long completedTasks; /** * Creates with given first task and thread from ThreadFactory. * @param firstTask the first task (null if none) */ Worker(Runnable firstTask) &#123; // ä½¿ç”¨ThreadFactoryæž„é€ Threadï¼Œè¿™ä¸ªæž„é€ çš„Threadå†…éƒ¨çš„Runnableå°±æ˜¯æœ¬èº«ï¼Œä¹Ÿå°±æ˜¯Workerã€‚æ‰€ä»¥å¾—åˆ°Workerçš„threadå¹¶startçš„æ—¶å€™ï¼Œä¼šæ‰§è¡ŒWorkerçš„runæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡ŒThreadPoolExecutorçš„runWorkeræ–¹æ³• //æŠŠçŠ¶æ€ä½è®¾ç½®æˆ-1ï¼Œè¿™æ ·ä»»ä½•çº¿ç¨‹éƒ½ä¸èƒ½å¾—åˆ°Workerçš„é”ï¼Œé™¤éžè°ƒç”¨äº†unlockæ–¹æ³•ã€‚è¿™ä¸ªunlockæ–¹æ³•ä¼šåœ¨runWorkeræ–¹æ³•ä¸­ä¸€å¼€å§‹å°±è°ƒç”¨ï¼Œè¿™æ˜¯ä¸ºäº†ç¡®ä¿Workeræž„é€ å‡ºæ¥ä¹‹åŽï¼Œæ²¡æœ‰ä»»ä½•çº¿ç¨‹èƒ½å¤Ÿå¾—åˆ°å®ƒçš„é”ï¼Œé™¤éžè°ƒç”¨äº†runWorkerä¹‹åŽï¼Œå…¶ä»–çº¿ç¨‹æ‰èƒ½èŽ·å¾—Workerçš„é” setState(-1); this.firstTask = firstTask; this.thread = getThreadFactory().newThread(this); &#125; /** Delegates main run loop to outer runWorker */ public void run() &#123; runWorker(this); &#125; // Lock methods // // The value 0 represents the unlocked state. // The value 1 represents the locked state. protected boolean isHeldExclusively() &#123; return getState() != 0; &#125; protected boolean tryAcquire(int unused) &#123; if (compareAndSetState(0, 1)) &#123; setExclusiveOwnerThread(Thread.currentThread()); return true; &#125; return false; &#125; protected boolean tryRelease(int unused) &#123; setExclusiveOwnerThread(null); setState(0); return true; &#125; public void lock() &#123; acquire(1); &#125; public boolean tryLock() &#123; return tryAcquire(1); &#125; public void unlock() &#123; release(1); &#125; public boolean isLocked() &#123; return isHeldExclusively(); &#125; void interruptIfStarted() &#123; Thread t; if (getState() &gt;= 0 &amp;&amp; (t = thread) != null &amp;&amp; !t.isInterrupted()) &#123; try &#123; t.interrupt(); &#125; catch (SecurityException ignore) &#123; &#125; &#125; &#125;&#125; workeræ˜¯çº¿ç¨‹æ± çš„æ‰§è¡Œå•å…ƒï¼Œå®žçŽ°äº†AQSåŒæ­¥é”å’ŒrunnableæŽ¥å£ï¼ŒæŽ¥ä¸‹æ¥çœ‹ä¸€ä¸‹addWorkeræºç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374// ä¸¤ä¸ªå‚æ•°ï¼ŒfirstTaskè¡¨ç¤ºéœ€è¦è·‘çš„ä»»åŠ¡ã€‚booleanç±»åž‹çš„coreå‚æ•°ä¸ºtrueçš„è¯è¡¨ç¤ºä½¿ç”¨çº¿ç¨‹æ± çš„åŸºæœ¬å¤§å°ï¼Œä¸ºfalseä½¿ç”¨çº¿ç¨‹æ± æœ€å¤§å¤§å°// è¿”å›žå€¼æ˜¯booleanç±»åž‹ï¼Œtrueè¡¨ç¤ºæ–°ä»»åŠ¡è¢«æŽ¥æ”¶äº†ï¼Œå¹¶ä¸”æ‰§è¡Œäº†ã€‚å¦åˆ™æ˜¯falseprivate boolean addWorker(Runnable firstTask, boolean core) &#123; retry: for (;;) &#123; int c = ctl.get(); int rs = runStateOf(c); // çº¿ç¨‹æ± å½“å‰çŠ¶æ€ // è¿™ä¸ªåˆ¤æ–­è½¬æ¢æˆ rs &gt;= SHUTDOWN &amp;&amp; (rs != SHUTDOWN || firstTask != null || workQueue.isEmpty)ã€‚ // æ¦‚æ‹¬ä¸º3ä¸ªæ¡ä»¶ï¼š // 1. çº¿ç¨‹æ± ä¸åœ¨RUNNINGçŠ¶æ€å¹¶ä¸”çŠ¶æ€æ˜¯STOPã€TIDYINGæˆ–TERMINATEDä¸­çš„ä»»æ„ä¸€ç§çŠ¶æ€ // 2. çº¿ç¨‹æ± ä¸åœ¨RUNNINGçŠ¶æ€ï¼Œçº¿ç¨‹æ± æŽ¥å—äº†æ–°çš„ä»»åŠ¡ // 3. çº¿ç¨‹æ± ä¸åœ¨RUNNINGçŠ¶æ€ï¼Œé˜»å¡žé˜Ÿåˆ—ä¸ºç©ºã€‚ æ»¡è¶³è¿™3ä¸ªæ¡ä»¶ä¸­çš„ä»»æ„ä¸€ä¸ªçš„è¯ï¼Œæ‹’ç»æ‰§è¡Œä»»åŠ¡ if (rs &gt;= SHUTDOWN &amp;&amp; ! (rs == SHUTDOWN &amp;&amp; firstTask == null &amp;&amp; ! workQueue.isEmpty())) return false; for (;;) &#123; int wc = workerCountOf(c); // çº¿ç¨‹æ± çº¿ç¨‹ä¸ªæ•° if (wc &gt;= CAPACITY || wc &gt;= (core ? corePoolSize : maximumPoolSize)) // å¦‚æžœçº¿ç¨‹æ± çº¿ç¨‹æ•°é‡è¶…è¿‡çº¿ç¨‹æ± æœ€å¤§å®¹é‡æˆ–è€…çº¿ç¨‹æ•°é‡è¶…è¿‡äº†åŸºæœ¬å¤§å°(coreå‚æ•°ä¸ºtrueï¼Œcoreå‚æ•°ä¸ºfalseçš„è¯åˆ¤æ–­è¶…è¿‡æœ€å¤§å¤§å°) return false; // è¶…è¿‡ç›´æŽ¥è¿”å›žfalse if (compareAndIncrementWorkerCount(c)) // æ²¡æœ‰è¶…è¿‡å„ç§å¤§å°çš„è¯ï¼Œcasæ“ä½œçº¿ç¨‹æ± çº¿ç¨‹æ•°é‡+1ï¼ŒcasæˆåŠŸçš„è¯è·³å‡ºå¾ªçŽ¯ break retry; c = ctl.get(); // é‡æ–°æ£€æŸ¥çŠ¶æ€ if (runStateOf(c) != rs) // å¦‚æžœçŠ¶æ€æ”¹å˜äº†ï¼Œé‡æ–°å¾ªçŽ¯æ“ä½œ continue retry; // else CAS failed due to workerCount change; retry inner loop &#125; &#125; // èµ°åˆ°è¿™ä¸€æ­¥è¯´æ˜Žcasæ“ä½œæˆåŠŸäº†ï¼Œçº¿ç¨‹æ± çº¿ç¨‹æ•°é‡+1 boolean workerStarted = false; // ä»»åŠ¡æ˜¯å¦æˆåŠŸå¯åŠ¨æ ‡è¯† boolean workerAdded = false; // ä»»åŠ¡æ˜¯å¦æ·»åŠ æˆåŠŸæ ‡è¯† Worker w = null; try &#123; final ReentrantLock mainLock = this.mainLock; // å¾—åˆ°çº¿ç¨‹æ± çš„å¯é‡å…¥é” w = new Worker(firstTask); // åŸºäºŽä»»åŠ¡firstTaskæž„é€ worker final Thread t = w.thread; // ä½¿ç”¨Workerçš„å±žæ€§threadï¼Œè¿™ä¸ªthreadæ˜¯ä½¿ç”¨ThreadFactoryæž„é€ å‡ºæ¥çš„ if (t != null) &#123; // ThreadFactoryæž„é€ å‡ºçš„Threadæœ‰å¯èƒ½æ˜¯nullï¼Œåšä¸ªåˆ¤æ–­ mainLock.lock(); // é”ä½ï¼Œé˜²æ­¢å¹¶å‘ try &#123; // åœ¨é”ä½ä¹‹åŽå†é‡æ–°æ£€æµ‹ä¸€ä¸‹çŠ¶æ€ int c = ctl.get(); int rs = runStateOf(c); if (rs &lt; SHUTDOWN || (rs == SHUTDOWN &amp;&amp; firstTask == null)) &#123; // å¦‚æžœçº¿ç¨‹æ± åœ¨RUNNINGçŠ¶æ€æˆ–è€…çº¿ç¨‹æ± åœ¨SHUTDOWNçŠ¶æ€å¹¶ä¸”ä»»åŠ¡æ˜¯ä¸ªnull if (t.isAlive()) // åˆ¤æ–­çº¿ç¨‹æ˜¯å¦è¿˜æ´»ç€ï¼Œä¹Ÿå°±æ˜¯è¯´çº¿ç¨‹å·²ç»å¯åŠ¨å¹¶ä¸”è¿˜æ²¡æ­»æŽ‰ throw new IllegalThreadStateException(); // å¦‚æžœå­˜åœ¨å·²ç»å¯åŠ¨å¹¶ä¸”è¿˜æ²¡æ­»çš„çº¿ç¨‹ï¼ŒæŠ›å‡ºå¼‚å¸¸ workers.add(w); // workeræ·»åŠ åˆ°çº¿ç¨‹æ± çš„workerså±žæ€§ä¸­ï¼Œæ˜¯ä¸ªHashSet int s = workers.size(); // å¾—åˆ°ç›®å‰çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä¸ªæ•° if (s &gt; largestPoolSize) // å¦‚æžœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä¸ªæ•°è¶…è¿‡äº†çº¿ç¨‹æ± ä¸­çš„æœ€å¤§çº¿ç¨‹æ•°æ—¶ï¼Œæ›´æ–°ä¸€ä¸‹è¿™ä¸ªæœ€å¤§çº¿ç¨‹æ•° largestPoolSize = s; workerAdded = true; // æ ‡è¯†ä¸€ä¸‹ä»»åŠ¡å·²ç»æ·»åŠ æˆåŠŸ &#125; &#125; finally &#123; mainLock.unlock(); // è§£é” &#125; if (workerAdded) &#123; // å¦‚æžœä»»åŠ¡æ·»åŠ æˆåŠŸï¼Œè¿è¡Œä»»åŠ¡ï¼Œæ”¹å˜ä¸€ä¸‹ä»»åŠ¡æˆåŠŸå¯åŠ¨æ ‡è¯† t.start(); // å¯åŠ¨çº¿ç¨‹ï¼Œè¿™é‡Œçš„tæ˜¯Workerä¸­çš„threadå±žæ€§ï¼Œæ‰€ä»¥ç›¸å½“äºŽå°±æ˜¯è°ƒç”¨äº†Workerçš„runæ–¹æ³• workerStarted = true; &#125; &#125; &#125; finally &#123; if (! workerStarted) // å¦‚æžœä»»åŠ¡å¯åŠ¨å¤±è´¥ï¼Œè°ƒç”¨addWorkerFailedæ–¹æ³• addWorkerFailed(w); &#125; return workerStarted;&#125; åœ¨ä¸Šè¿°çš„ä»£ç ä¸­ï¼Œå¦‚æžœä»»åŠ¡æ·»åŠ æˆåŠŸï¼Œå°±ä¼šæ‰§è¡Œt.start()æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œworkerä¸­çš„runæ–¹æ³•ï¼Œè€Œworkerä¸­çš„runæ–¹æ³•è°ƒç”¨äº†runWorker(this)æ–¹æ³•ï¼ŒæŽ¥ä¸‹æ¥çœ‹ä¸€ä¸‹runWorkeræ–¹æ³•ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041final void runWorker(Worker w) &#123; Thread wt = Thread.currentThread(); // å¾—åˆ°å½“å‰çº¿ç¨‹ Runnable task = w.firstTask; // å¾—åˆ°Workerä¸­çš„ä»»åŠ¡taskï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·ä¼ å…¥çš„task w.firstTask = null; // å°†Workerä¸­çš„ä»»åŠ¡ç½®ç©º w.unlock(); // allow interruptsã€‚ boolean completedAbruptly = true; try &#123; // å¦‚æžœworkerä¸­çš„ä»»åŠ¡ä¸ä¸ºç©ºï¼Œç»§ç»­çŸ¥å¦ï¼Œå¦åˆ™ä½¿ç”¨getTaskèŽ·å¾—ä»»åŠ¡ã€‚ä¸€ç›´æ­»å¾ªçŽ¯ï¼Œé™¤éžå¾—åˆ°çš„ä»»åŠ¡ä¸ºç©ºæ‰é€€å‡º while (task != null || (task = getTask()) != null) &#123; w.lock(); // å¦‚æžœæ‹¿åˆ°äº†ä»»åŠ¡ï¼Œç»™è‡ªå·±ä¸Šé”ï¼Œè¡¨ç¤ºå½“å‰Workerå·²ç»è¦å¼€å§‹æ‰§è¡Œä»»åŠ¡äº†ï¼Œå·²ç»ä¸æ˜¯é—²ç½®Worker(é—²ç½®Workerçš„è§£é‡Šè¯·çœ‹ä¸‹é¢çš„çº¿ç¨‹æ± å…³é—­) // åœ¨æ‰§è¡Œä»»åŠ¡ä¹‹å‰å…ˆåšä¸€äº›å¤„ç†ã€‚ 1. å¦‚æžœçº¿ç¨‹æ± å·²ç»å¤„äºŽSTOPçŠ¶æ€å¹¶ä¸”å½“å‰çº¿ç¨‹æ²¡æœ‰è¢«ä¸­æ–­ï¼Œä¸­æ–­çº¿ç¨‹ 2. å¦‚æžœçº¿ç¨‹æ± è¿˜å¤„äºŽRUNNINGæˆ–SHUTDOWNçŠ¶æ€ï¼Œå¹¶ä¸”å½“å‰çº¿ç¨‹å·²ç»è¢«ä¸­æ–­äº†ï¼Œé‡æ–°æ£€æŸ¥ä¸€ä¸‹çº¿ç¨‹æ± çŠ¶æ€ï¼Œå¦‚æžœå¤„äºŽSTOPçŠ¶æ€å¹¶ä¸”æ²¡æœ‰è¢«ä¸­æ–­ï¼Œé‚£ä¹ˆä¸­æ–­çº¿ç¨‹ if ((runStateAtLeast(ctl.get(), STOP) || (Thread.interrupted() &amp;&amp; runStateAtLeast(ctl.get(), STOP))) &amp;&amp; !wt.isInterrupted()) wt.interrupt(); try &#123; beforeExecute(wt, task); // ä»»åŠ¡æ‰§è¡Œå‰éœ€è¦åšä»€ä¹ˆï¼ŒThreadPoolExecutoræ˜¯ä¸ªç©ºå®žçŽ° Throwable thrown = null; try &#123; task.run(); // çœŸæ­£çš„å¼€å§‹æ‰§è¡Œä»»åŠ¡ï¼Œè°ƒç”¨çš„æ˜¯runæ–¹æ³•ï¼Œè€Œä¸æ˜¯startæ–¹æ³•ã€‚è¿™é‡Œrunçš„æ—¶å€™å¯èƒ½ä¼šè¢«ä¸­æ–­ï¼Œæ¯”å¦‚çº¿ç¨‹æ± è°ƒç”¨äº†shutdownNowæ–¹æ³• &#125; catch (RuntimeException x) &#123; // ä»»åŠ¡æ‰§è¡Œå‘ç”Ÿçš„å¼‚å¸¸å…¨éƒ¨æŠ›å‡ºï¼Œä¸åœ¨runWorkerä¸­å¤„ç† thrown = x; throw x; &#125; catch (Error x) &#123; thrown = x; throw x; &#125; catch (Throwable x) &#123; thrown = x; throw new Error(x); &#125; finally &#123; afterExecute(task, thrown); // ä»»åŠ¡æ‰§è¡Œç»“æŸéœ€è¦åšä»€ä¹ˆï¼ŒThreadPoolExecutoræ˜¯ä¸ªç©ºå®žçŽ° &#125; &#125; finally &#123; task = null; w.completedTasks++; // è®°å½•æ‰§è¡Œä»»åŠ¡çš„ä¸ªæ•° w.unlock(); // æ‰§è¡Œå®Œä»»åŠ¡ä¹‹åŽï¼Œè§£é”ï¼ŒWorkerå˜æˆé—²ç½®Worker &#125; &#125; completedAbruptly = false; &#125; finally &#123; processWorkerExit(w, completedAbruptly); // å›žæ”¶Workeræ–¹æ³• &#125;&#125; åœ¨runWorkeræ–¹æ³•ä¸­ï¼Œå¦‚æžœä»»åŠ¡ä¸ºç©ºï¼Œwhileè¡¨è¾¾å¼æœ‰ä¸ªè½®è¯¢çš„æ–¹å¼åŽ»èŽ·å–ä»»åŠ¡ï¼Œå¦‚æžœtaskä¸ºnullçš„è¯ï¼Œä¼šåŽ»èŽ·å–æ–°çš„ä»»åŠ¡ï¼ŒæŽ¥ä¸‹æ¥çœ‹ä¸€ä¸‹èŽ·å–ä»»åŠ¡çš„æ–¹æ³•getTask() 123456789101112131415161718192021222324252627282930313233343536373839404142434445private Runnable getTask() &#123; boolean timedOut = false; // å¦‚æžœä½¿ç”¨è¶…æ—¶æ—¶é—´å¹¶ä¸”ä¹Ÿæ²¡æœ‰æ‹¿åˆ°ä»»åŠ¡çš„æ ‡è¯† retry: for (;;) &#123; int c = ctl.get(); int rs = runStateOf(c); // å¦‚æžœçº¿ç¨‹æ± æ˜¯SHUTDOWNçŠ¶æ€å¹¶ä¸”é˜»å¡žé˜Ÿåˆ—ä¸ºç©ºçš„è¯ï¼Œworkeræ•°é‡å‡ä¸€ï¼Œç›´æŽ¥è¿”å›žnull(SHUTDOWNçŠ¶æ€è¿˜ä¼šå¤„ç†é˜»å¡žé˜Ÿåˆ—ä»»åŠ¡ï¼Œä½†æ˜¯é˜»å¡žé˜Ÿåˆ—ä¸ºç©ºçš„è¯å°±ç»“æŸäº†)ï¼Œå¦‚æžœçº¿ç¨‹æ± æ˜¯STOPçŠ¶æ€çš„è¯ï¼Œworkeræ•°é‡å»ºè®®ï¼Œç›´æŽ¥è¿”å›žnull(STOPçŠ¶æ€ä¸å¤„ç†é˜»å¡žé˜Ÿåˆ—ä»»åŠ¡)[æ–¹æ³•ä¸€å¼€å§‹æ³¨é‡Šçš„2ï¼Œ3ä¸¤ç‚¹ï¼Œè¿”å›žnullï¼Œå¼€å§‹Workerå›žæ”¶] if (rs &gt;= SHUTDOWN &amp;&amp; (rs &gt;= STOP || workQueue.isEmpty())) &#123; decrementWorkerCount(); return null; &#125; boolean timed; // æ ‡è®°ä»Žé˜Ÿåˆ—ä¸­å–ä»»åŠ¡æ—¶æ˜¯å¦è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œå¦‚æžœä¸ºtrueè¯´æ˜Žè¿™ä¸ªworkerå¯èƒ½éœ€è¦å›žæ”¶ï¼Œä¸ºfalseçš„è¯è¿™ä¸ªworkerä¼šä¸€ç›´å­˜åœ¨ï¼Œå¹¶ä¸”é˜»å¡žå½“å‰çº¿ç¨‹ç­‰å¾…é˜»å¡žé˜Ÿåˆ—ä¸­æœ‰æ•°æ® for (;;) &#123; int wc = workerCountOf(c); // å¾—åˆ°å½“å‰çº¿ç¨‹æ± Workerä¸ªæ•° // allowCoreThreadTimeOutå±žæ€§é»˜è®¤ä¸ºfalseï¼Œè¡¨ç¤ºçº¿ç¨‹æ± ä¸­çš„æ ¸å¿ƒçº¿ç¨‹åœ¨é—²ç½®çŠ¶æ€ä¸‹è¿˜ä¿ç•™åœ¨æ± ä¸­ï¼›å¦‚æžœæ˜¯trueè¡¨ç¤ºæ ¸å¿ƒçº¿ç¨‹ä½¿ç”¨keepAliveTimeè¿™ä¸ªå‚æ•°æ¥ä½œä¸ºè¶…æ—¶æ—¶é—´ // å¦‚æžœworkeræ•°é‡æ¯”åŸºæœ¬å¤§å°è¦å¤§çš„è¯ï¼Œtimedå°±ä¸ºtrueï¼Œéœ€è¦è¿›è¡Œå›žæ”¶worker timed = allowCoreThreadTimeOut || wc &gt; corePoolSize; if (wc &lt;= maximumPoolSize &amp;&amp; ! (timedOut &amp;&amp; timed)) // æ–¹æ³•ä¸€å¼€å§‹æ³¨é‡Šçš„1ï¼Œ4ä¸¤ç‚¹ï¼Œä¼šè¿›è¡Œä¸‹ä¸€æ­¥workeræ•°é‡å‡ä¸€ break; if (compareAndDecrementWorkerCount(c)) // workeræ•°é‡å‡ä¸€ï¼Œè¿”å›žnullï¼Œä¹‹åŽä¼šè¿›è¡ŒWorkerå›žæ”¶å·¥ä½œ return null; c = ctl.get(); // é‡æ–°æ£€æŸ¥çº¿ç¨‹æ± çŠ¶æ€ if (runStateOf(c) != rs) // çº¿ç¨‹æ± çŠ¶æ€æ”¹å˜çš„è¯é‡æ–°å¼€å§‹å¤–éƒ¨å¾ªçŽ¯ï¼Œå¦åˆ™ç»§ç»­å†…éƒ¨å¾ªçŽ¯ continue retry; // else CAS failed due to workerCount change; retry inner loop &#125; try &#123; // å¦‚æžœéœ€è¦è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œä½¿ç”¨pollæ–¹æ³•ï¼Œå¦åˆ™ä½¿ç”¨takeæ–¹æ³•ä¸€ç›´é˜»å¡žç­‰å¾…é˜»å¡žé˜Ÿåˆ—æ–°è¿›æ•°æ® Runnable r = timed ? workQueue.poll(keepAliveTime, TimeUnit.NANOSECONDS) : workQueue.take(); if (r != null) return r; timedOut = true; &#125; catch (InterruptedException retry) &#123; timedOut = false; // é—²ç½®Workerè¢«ä¸­æ–­ &#125; &#125;&#125; ä»»åŠ¡çº¿ç¨‹ä¼šä»Žé˜»å¡žé˜Ÿåˆ—ä¸­èŽ·å–ï¼Œå¦‚æžœå‘ç”Ÿå¦‚ä¸‹æƒ…å†µï¼Œé‚£ä¹ˆworkeréœ€è¦è¢«å›žæ”¶ï¼š Workerä¸ªæ•°æ¯”çº¿ç¨‹æ± æœ€å¤§å¤§å°è¦å¤§ çº¿ç¨‹æ± å¤„äºŽSTOPçŠ¶æ€ çº¿ç¨‹æ± å¤„äºŽSHUTDOWNçŠ¶æ€å¹¶ä¸”é˜»å¡žé˜Ÿåˆ—ä¸ºç©º ä½¿ç”¨è¶…æ—¶æ—¶é—´ä»Žé˜»å¡žé˜Ÿåˆ—é‡Œæ‹¿æ•°æ®ï¼Œå¹¶ä¸”è¶…æ—¶ä¹‹åŽæ²¡æœ‰æ‹¿åˆ°æ•°æ®(allowCoreThreadTimeOut || workerCount &gt; corePoolSize) å›žæ”¶ä¼šåœ¨runWorkeræ–¹æ³•ä¸­å‘ç”Ÿå¦‚ä¸Šäº‹ä»¶æŠ›å‡ºå¼‚å¸¸ï¼Œåœ¨finallyå—ä¸­è°ƒç”¨processWorkerExitæ–¹æ³•è¿›è¡Œå›žæ”¶ 1234567891011121314151617181920212223242526272829303132private void processWorkerExit(Worker w, boolean completedAbruptly) &#123; if (completedAbruptly) // å¦‚æžœWorkeræ²¡æœ‰æ­£å¸¸ç»“æŸæµç¨‹è°ƒç”¨processWorkerExitæ–¹æ³•ï¼Œworkeræ•°é‡å‡ä¸€ã€‚å¦‚æžœæ˜¯æ­£å¸¸ç»“æŸçš„è¯ï¼Œåœ¨getTaskæ–¹æ³•é‡Œworkeræ•°é‡å·²ç»å‡ä¸€äº† decrementWorkerCount(); final ReentrantLock mainLock = this.mainLock; mainLock.lock(); // åŠ é”ï¼Œé˜²æ­¢å¹¶å‘é—®é¢˜ try &#123; completedTaskCount += w.completedTasks; // è®°å½•æ€»çš„å®Œæˆä»»åŠ¡æ•° workers.remove(w); // çº¿ç¨‹æ± çš„workeré›†åˆåˆ é™¤æŽ‰éœ€è¦å›žæ”¶çš„Worker &#125; finally &#123; mainLock.unlock(); // è§£é” &#125; tryTerminate(); // å°è¯•ç»“æŸçº¿ç¨‹æ±  int c = ctl.get(); if (runStateLessThan(c, STOP)) &#123; // å¦‚æžœçº¿ç¨‹æ± è¿˜å¤„äºŽRUNNINGæˆ–è€…SHUTDOWNçŠ¶æ€ if (!completedAbruptly) &#123; // Workeræ˜¯æ­£å¸¸ç»“æŸæµç¨‹çš„è¯ int min = allowCoreThreadTimeOut ? 0 : corePoolSize; if (min == 0 &amp;&amp; ! workQueue.isEmpty()) min = 1; if (workerCountOf(c) &gt;= min) return; // ä¸éœ€è¦æ–°å¼€ä¸€ä¸ªWorker &#125; // æ–°å¼€ä¸€ä¸ªWorkerä»£æ›¿åŽŸå…ˆçš„Worker // æ–°å¼€ä¸€ä¸ªWorkeréœ€è¦æ»¡è¶³ä»¥ä¸‹3ä¸ªæ¡ä»¶ä¸­çš„ä»»æ„ä¸€ä¸ªï¼š // 1. ç”¨æˆ·æ‰§è¡Œçš„ä»»åŠ¡å‘ç”Ÿäº†å¼‚å¸¸ // 2. Workeræ•°é‡æ¯”çº¿ç¨‹æ± åŸºæœ¬å¤§å°è¦å° // 3. é˜»å¡žé˜Ÿåˆ—ä¸ç©ºä½†æ˜¯æ²¡æœ‰ä»»ä½•Workeråœ¨å·¥ä½œ addWorker(null, false); &#125;&#125; åœ¨å›žæ”¶Workerçš„æ—¶å€™çº¿ç¨‹æ± ä¼šå°è¯•ç»“æŸè‡ªå·±çš„è¿è¡Œï¼ŒtryTerminateæ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930313233343536final void tryTerminate() &#123; for (;;) &#123; int c = ctl.get(); // æ»¡è¶³3ä¸ªæ¡ä»¶ä¸­çš„ä»»æ„ä¸€ä¸ªï¼Œä¸ç»ˆæ­¢çº¿ç¨‹æ±  // 1. çº¿ç¨‹æ± è¿˜åœ¨è¿è¡Œï¼Œä¸èƒ½ç»ˆæ­¢ // 2. çº¿ç¨‹æ± å¤„äºŽTIDYINGæˆ–TERMINATEDçŠ¶æ€ï¼Œè¯´æ˜Žå·²ç»åœ¨å…³é—­äº†ï¼Œä¸å…è®¸ç»§ç»­å¤„ç† // 3. çº¿ç¨‹æ± å¤„äºŽSHUTDOWNçŠ¶æ€å¹¶ä¸”é˜»å¡žé˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œè¿™æ—¶å€™è¿˜éœ€è¦å¤„ç†é˜»å¡žé˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œä¸èƒ½ç»ˆæ­¢çº¿ç¨‹æ±  if (isRunning(c) || runStateAtLeast(c, TIDYING) || (runStateOf(c) == SHUTDOWN &amp;&amp; ! workQueue.isEmpty())) return; // èµ°åˆ°è¿™ä¸€æ­¥è¯´æ˜Žçº¿ç¨‹æ± å·²ç»ä¸åœ¨è¿è¡Œï¼Œé˜»å¡žé˜Ÿåˆ—å·²ç»æ²¡æœ‰ä»»åŠ¡ï¼Œä½†æ˜¯è¿˜è¦å›žæ”¶æ­£åœ¨å·¥ä½œçš„Worker if (workerCountOf(c) != 0) &#123; // ç”±äºŽçº¿ç¨‹æ± ä¸è¿è¡Œäº†ï¼Œè°ƒç”¨äº†çº¿ç¨‹æ± çš„å…³é—­æ–¹æ³•ï¼Œåœ¨è§£é‡Šçº¿ç¨‹æ± çš„å…³é—­åŽŸç†çš„æ—¶å€™ä¼šè¯´é“è¿™ä¸ªæ–¹æ³• interruptIdleWorkers(ONLY_ONE); // ä¸­æ–­é—²ç½®Workerï¼Œç›´åˆ°å›žæ”¶å…¨éƒ¨çš„Workerã€‚è¿™é‡Œæ²¡æœ‰é‚£ä¹ˆæš´åŠ›ï¼Œåªä¸­æ–­ä¸€ä¸ªï¼Œä¸­æ–­ä¹‹åŽé€€å‡ºæ–¹æ³•ï¼Œä¸­æ–­äº†Workerä¹‹åŽï¼ŒWorkerä¼šå›žæ”¶ï¼Œç„¶åŽè¿˜æ˜¯ä¼šè°ƒç”¨tryTerminateæ–¹æ³•ï¼Œå¦‚æžœè¿˜æœ‰é—²ç½®çº¿ç¨‹ï¼Œé‚£ä¹ˆç»§ç»­ä¸­æ–­ return; &#125; // èµ°åˆ°è¿™é‡Œè¯´æ˜Žworkerå·²ç»å…¨éƒ¨å›žæ”¶äº†ï¼Œå¹¶ä¸”çº¿ç¨‹æ± å·²ç»ä¸åœ¨è¿è¡Œï¼Œé˜»å¡žé˜Ÿåˆ—å·²ç»æ²¡æœ‰ä»»åŠ¡ã€‚å¯ä»¥å‡†å¤‡ç»“æŸçº¿ç¨‹æ± äº† final ReentrantLock mainLock = this.mainLock; mainLock.lock(); // åŠ é”ï¼Œé˜²æ­¢å¹¶å‘ try &#123; if (ctl.compareAndSet(c, ctlOf(TIDYING, 0))) &#123; // casæ“ä½œï¼Œå°†çº¿ç¨‹æ± çŠ¶æ€æ”¹æˆTIDYING try &#123; terminated(); // è°ƒç”¨terminatedæ–¹æ³• &#125; finally &#123; ctl.set(ctlOf(TERMINATED, 0)); // terminatedæ–¹æ³•è°ƒç”¨å®Œæ¯•ä¹‹åŽï¼ŒçŠ¶æ€å˜ä¸ºTERMINATED termination.signalAll(); &#125; return; &#125; &#125; finally &#123; mainLock.unlock(); // è§£é” &#125; // else retry on failed CAS &#125;&#125; ThreadPoolExecutorçš„å…³é—­çº¿ç¨‹æ± çš„å…³é—­æœ‰ä¸¤ä¸ªé‡è¦çš„æ–¹æ³•ï¼šshutdownå’ŒshutdownNowï¼Œä¸‹é¢çœ‹ä¸€ä¸‹shutdownæ–¹æ³•çš„æºç ï¼š12345678910111213public void shutdown() &#123; final ReentrantLock mainLock = this.mainLock; mainLock.lock(); // å…³é—­çš„æ—¶å€™éœ€è¦åŠ é”ï¼Œé˜²æ­¢å¹¶å‘ try &#123; checkShutdownAccess(); // æ£€æŸ¥å…³é—­çº¿ç¨‹æ± çš„æƒé™ advanceRunState(SHUTDOWN); // æŠŠçº¿ç¨‹æ± çŠ¶æ€æ›´æ–°åˆ°SHUTDOWN interruptIdleWorkers(); // ä¸­æ–­é—²ç½®çš„Worker onShutdown(); // é’©å­æ–¹æ³•ï¼Œé»˜è®¤ä¸å¤„ç†ã€‚ScheduledThreadPoolExecutorä¼šåšä¸€äº›å¤„ç† &#125; finally &#123; mainLock.unlock(); // è§£é” &#125; tryTerminate(); // å°è¯•ç»“æŸçº¿ç¨‹æ± ï¼Œä¸Šé¢å·²ç»åˆ†æžè¿‡äº†&#125; å†çœ‹çœ‹ä¸­æ–­çº¿ç¨‹çš„interruptIdleWorkersæ–¹æ³•æ–¹æ³•ï¼š 1234567891011121314151617181920212223242526// è°ƒç”¨ä»–çš„ä¸€ä¸ªé‡è½½æ–¹æ³•ï¼Œä¼ å…¥äº†å‚æ•°falseï¼Œè¡¨ç¤ºè¦ä¸­æ–­æ‰€æœ‰çš„æ­£åœ¨è¿è¡Œçš„é—²ç½®Workerï¼Œå¦‚æžœä¸ºtrueè¡¨ç¤ºåªæ‰“æ–­ä¸€ä¸ªé—²ç½®Workerprivate void interruptIdleWorkers() &#123; interruptIdleWorkers(false);&#125;private void interruptIdleWorkers(boolean onlyOne) &#123; final ReentrantLock mainLock = this.mainLock; mainLock.lock(); // ä¸­æ–­é—²ç½®Workeréœ€è¦åŠ é”ï¼Œé˜²æ­¢å¹¶å‘ try &#123; for (Worker w : workers) &#123; Thread t = w.thread; // æ‹¿åˆ°workerä¸­çš„çº¿ç¨‹ if (!t.isInterrupted() &amp;&amp; w.tryLock()) &#123; // Workerä¸­çš„çº¿ç¨‹æ²¡æœ‰è¢«æ‰“æ–­å¹¶ä¸”Workerå¯ä»¥èŽ·å–é”ï¼Œè¿™é‡ŒWorkerèƒ½èŽ·å–é”è¯´æ˜ŽWorkeræ˜¯ä¸ªé—²ç½®Workerï¼Œåœ¨é˜»å¡žé˜Ÿåˆ—é‡Œæ‹¿æ•°æ®ä¸€ç›´è¢«é˜»å¡žï¼Œæ²¡æœ‰æ•°æ®è¿›æ¥ã€‚å¦‚æžœæ²¡æœ‰èŽ·å–åˆ°Workeré”ï¼Œè¯´æ˜ŽWorkerè¿˜åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œä¸è¿›è¡Œä¸­æ–­(shutdownæ–¹æ³•ä¸ä¼šä¸­æ–­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡) try &#123; t.interrupt(); // ä¸­æ–­Workerçº¿ç¨‹ &#125; catch (SecurityException ignore) &#123; &#125; finally &#123; w.unlock(); // é‡Šæ”¾Workeré” &#125; &#125; if (onlyOne) // å¦‚æžœåªæ‰“æ–­1ä¸ªWorkerçš„è¯ï¼Œç›´æŽ¥breaké€€å‡ºï¼Œå¦åˆ™ï¼ŒéåŽ†æ‰€æœ‰çš„Worker break; &#125; &#125; finally &#123; mainLock.unlock(); // è§£é” &#125;&#125; è½®è¯¢æ‰€æœ‰çš„worker,åˆ¤æ–­æ˜¯ä¸æ˜¯ä¸­æ–­çš„çº¿ç¨‹ä¸”å¯ä»¥æ‹¿åˆ°é”ï¼ˆåˆ¤æ–­é—²ç½®çš„workerï¼‰,å°±ä¸­æ–­è¯¥çº¿ç¨‹,çŽ°åœ¨æ¥çœ‹ä¸€çœ‹å¦ä¸€ä¸ªå…³é—­çš„shutdownNowæ–¹æ³•12345678910111213141516// shutdownNowæ–¹æ³•ä¼šæœ‰è¿”å›žå€¼çš„ï¼Œè¿”å›žçš„æ˜¯ä¸€ä¸ªä»»åŠ¡åˆ—è¡¨ï¼Œè€Œshutdownæ–¹æ³•æ²¡æœ‰è¿”å›žå€¼public List&lt;Runnable&gt; shutdownNow() &#123; List&lt;Runnable&gt; tasks; final ReentrantLock mainLock = this.mainLock; mainLock.lock(); // shutdownNowæ“ä½œä¹Ÿéœ€è¦åŠ é”ï¼Œé˜²æ­¢å¹¶å‘ try &#123; checkShutdownAccess(); // æ£€æŸ¥å…³é—­çº¿ç¨‹æ± çš„æƒé™ advanceRunState(STOP); // æŠŠçº¿ç¨‹æ± çŠ¶æ€æ›´æ–°åˆ°STOP interruptWorkers(); // ä¸­æ–­Workerçš„è¿è¡Œ tasks = drainQueue(); &#125; finally &#123; mainLock.unlock(); // è§£é” &#125; tryTerminate(); // å°è¯•ç»“æŸçº¿ç¨‹æ± ï¼Œä¸Šé¢å·²ç»åˆ†æžè¿‡äº† return tasks;&#125; shutdownNowæ–¹æ³•çš„è¯­ä¹‰æ˜¯ç«‹åˆ»å…³é—­æ‰€æœ‰çš„worker,è€Œä¸æ˜¯shutdownæ–¹æ³•å…³é—­é—²ç½®çš„æ–¹æ³•,è€Œä¸”shutdownNowç›´æŽ¥å°†çŠ¶æ€æ”¹ä¸ºSTOPï¼Œè¿™æ ·çš„è¯ï¼Œä¸ä¼šæ‰§è¡Œæ–°çš„ä»»åŠ¡ï¼ŒåŒæ—¶å›žæ”¶æ‰€æœ‰çš„workerï¼Œè€Œshutdownåªæ˜¯å°†çŠ¶æ€å˜ä¸ºSHUTDOWN,æŽ¥ä¸‹æ¥çœ‹ä¸€çœ‹shutdownNowçš„ä¸­æ–­workeræ–¹æ³•interruptWorkers():12345678910private void interruptWorkers() &#123; final ReentrantLock mainLock = this.mainLock; mainLock.lock(); // ä¸­æ–­Workeréœ€è¦åŠ é”ï¼Œé˜²æ­¢å¹¶å‘ try &#123; for (Worker w : workers) w.interruptIfStarted(); // ä¸­æ–­Workerçš„æ‰§è¡Œ &#125; finally &#123; mainLock.unlock(); // è§£é” &#125;&#125; Workerçš„interruptIfStartedæ–¹æ³•ä¸­æ–­Workerçš„æ‰§è¡Œï¼š 12345678910void interruptIfStarted() &#123; Thread t; // Workeræ— è®ºæ˜¯å¦è¢«æŒæœ‰é”ï¼Œåªè¦è¿˜æ²¡è¢«ä¸­æ–­ï¼Œé‚£å°±ä¸­æ–­Worker if (getState() &gt;= 0 &amp;&amp; (t = thread) != null &amp;&amp; !t.isInterrupted()) &#123; try &#123; t.interrupt(); // å¼ºè¡Œä¸­æ–­Workerçš„æ‰§è¡Œ &#125; catch (SecurityException ignore) &#123; &#125; &#125;&#125; æ€»ç»“åœ¨ä¸åŒçš„åº”ç”¨åœºæ™¯ä¸‹ï¼Œçº¿ç¨‹æ± çš„ç”Ÿæ€ä¹Ÿè¶Šæ¥è¶Šå¤§ï¼Œå®ƒçš„æ„ä¹‰æ˜¯è®©ç”¨æˆ·æ›´åŠ é«˜æ•ˆçš„åº”ç”¨çº¿ç¨‹åŽ»æ‰§è¡Œä¸åŒçš„ä»»åŠ¡ï¼Œä¸ºçº¿ç¨‹æä¾›å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸï¼Œè™½ç„¶çº¿ç¨‹æ± æä¾›äº†å¾ˆå¥½çš„çº¿ç¨‹å¤ç”¨æœºåˆ¶ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯å°±å¯ä»¥æ»¥ç”¨çº¿ç¨‹æ± æ¥åˆ›å»ºåŽ»æ‰§è¡Œä»»åŠ¡ï¼Œåœ¨æ“ä½œç³»ç»Ÿæˆ–è€…JVMå¹³å°ä¸‹éƒ½æœ‰å¯¹äºŽçº¿ç¨‹ä¸€å®šçš„é™åˆ¶ï¼Œåˆç†çš„ä½¿ç”¨æ‰èƒ½æ›´åŠ çš„é«˜æ•ˆï¼ï¼ï¼ å‚è€ƒhttp://www.jianshu.com/p/758a99c83ef1http://fangjian0423.github.io/2016/03/22/java-threadpool-analysis/ã€Šjavaå¹¶å‘ç¼–ç¨‹å®žæˆ˜ã€‹ç¬¬å…­ç« ]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[æ·±å…¥å¹¶å‘å…³é”®å­—-synchronized]]></title>
      <url>%2F2017%2F05%2F24%2Fsynchronized%2F</url>
      <content type="text"><![CDATA[ä»…ä¾›å­¦ä¹ äº¤æµ,å¦‚æœ‰é”™è¯¯è¯·æŒ‡å‡º,å¦‚è¦è½¬è½½è¯·åŠ ä¸Šå‡ºå¤„,è°¢è°¢ å‰è¨€synchronizedï¼ˆåŒæ­¥ï¼‰æ˜¯javaä¸­åœ¨å¤šå¤„ç†å™¨ä¸­å®žçŽ°çº¿ç¨‹å®‰å…¨æœ€åŸºæœ¬çš„æ‰‹æ®µï¼Œåœ¨javaè¯­è¨€è§„èŒƒï¼ˆç¬¬ä¸‰ç‰ˆï¼‰ä¸­æåˆ°é”çš„åŒæ­¥æœºåˆ¶ï¼ŒæŒ‡åœ¨javaä¸­ï¼Œçº¿ç¨‹ä¹‹é—´é€šä¿¡çš„æœºåˆ¶æœ€åŸºæœ¬çš„å°±æ˜¯åŒæ­¥åŒ–ï¼Œæ­¤æ–¹æ³•æ˜¯ä½¿ç”¨ç›‘è§†å™¨ï¼ˆmonitorï¼ŒåŽé¢ä¼šè®²åˆ°ï¼‰å®žçŽ°çš„ï¼Œæ¯ä¸ªå¯¹è±¡ä¸Žä¸€ä¸ªç›‘è§†å™¨å…³è”ï¼Œä¸€ä¸ªçº¿ç¨‹å¯ä»¥åŠ é”å’Œè§£é”æ­¤ç›‘è§†å™¨ï¼Œè€Œä¸”åŒä¸€æ—¶é—´æ®µåªæœ‰ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ç›‘è§†å™¨ä¸Šçš„é”ï¼Œå…¶ä»–çº¿ç¨‹å°±ä¼šè¢«é˜»å¡žï¼Œç›´åˆ°ä»–ä»¬å¯ä»¥åœ¨è¯¥ç›‘è§†å™¨ä¸ŠèŽ·å–é” å…¶å®žä¸€ä¸ªå¯¹è±¡éƒ½å¯ä»¥çœ‹åšä¸€ä¸ªé”ï¼Œåœ¨javaä¸­ï¼Œæœ‰ä¸‰ç§å¯¹äºŽsynchronizedçš„ç”¨æ³• å¯¹äºŽåŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰å®žä¾‹å¯¹è±¡ã€‚ å¯¹äºŽé™æ€åŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰å¯¹è±¡çš„Classå¯¹è±¡ã€‚ å¯¹äºŽåŒæ­¥æ–¹æ³•å—ï¼Œé”æ˜¯Synchonizedæ‹¬å·é‡Œé…ç½®çš„å¯¹è±¡ã€‚ å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®synchronizedä¿®é¥°çš„ä»£ç å—æ—¶ï¼Œä»–å¿…é¡»è¦èŽ·å–ä¸€ä¸ªé”ï¼Œæ ¹æ®ä¸åŒçš„ä¿®é¥°æ–¹å¼æ¥èŽ·å–æ‰€å¯¹åº”çš„å¯¹è±¡çš„é”ï¼Œé€€å‡ºæˆ–è€…æ˜¯å‘ç”Ÿå¼‚å¸¸æ—¶é‡Šæ”¾é”ï¼Œä¸‹é¢å°†ä¸€æ­¥ä¸€æ­¥æ·±å…¥é”çš„å®žçŽ° é”çš„å®žçŽ°åŽŸç†æˆ‘ä»¬å…ˆå°†é€šè¿‡ä¸€ä¸ªç®€å•çš„åŒæ­¥ä»£ç å¼€å§‹12345678public class SynchronizedTest &#123; public static Object object = new Object(); public static void main(String[] args)&#123; synchronized(object) &#123; // synchronized test &#125; &#125;&#125; ä¸Šè¿°ä»£ç mainå‡½æ•°ä¸­èŽ·å–äº†objectçš„é”ï¼Œæˆ‘ä»¬ç”¨javapå‘½ä»¤å·¥å…·åç¼–è¯‘è¯¥ç”Ÿæˆçš„classæ–‡ä»¶ï¼Œä¿¡æ¯å¦‚ä¸‹1234567891011121314151617181920212223242526272829303132333435363738394041Compiled from &quot;SynchronizedTest.java&quot;public class SynchronizedTest &#123; public static java.lang.Object object; public SynchronizedTest(); Code: 0: aload_0 1: invokespecial #1 // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V 4: aload_0 5: iconst_0 6: putfield #2 // Field a:I 9: return public static void main(java.lang.String[]); Code: 0: getstatic #3 // Field object:Ljava/lang/Object; 3: dup 4: astore_1 5: monitorenter 6: aload_1 7: monitorexit 8: goto 16 11: astore_2 12: aload_1 13: monitorexit 14: aload_2 15: athrow 16: return Exception table: from to target type 6 8 11 any 11 14 11 any static &#123;&#125;; Code: 0: new #4 // class java/lang/Object 3: dup 4: invokespecial #1 // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V 7: putstatic #3 // Field object:Ljava/lang/Object; 10: return&#125; ç”±ä¸Šè¿°åç¼–è¯‘classæ–‡ä»¶çš„æ‰§è¡Œä»£ç å¯çŸ¥ï¼Œåœ¨mainå‡½æ•°ä¸­æ‰§è¡Œsynchronizedä»£ç å—ä½¿ç”¨äº†monitorenterå’Œmonitorexitä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤ï¼ŒJVMé€šè¿‡monitorenterå­—èŠ‚ç æŒ‡ä»¤æ¥èŽ·å–å¯¹è±¡çš„é”ï¼Œé€šè¿‡monitorexitå­—èŠ‚ç æŒ‡ä»¤æ¥é‡Šæ”¾è¯¥å¯¹è±¡çš„é”ï¼Œå½“æ‰§è¡Œmonitorenterå­—èŠ‚ç æŒ‡ä»¤æ—¶ï¼Œé¦–å…ˆä¼šå°è¯•èŽ·å–å¯¹è±¡çš„é”ï¼Œå¦‚æžœè¯¥å¯¹è±¡æ²¡æœ‰æ²¡æœ‰è¢«é”å®šæˆ–è€…å½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰äº†è¯¥é”ï¼Œåˆ™é”çš„è®¡æ•°å™¨åŠ 1ï¼Œç›¸åº”çš„æ‰§è¡Œmonitorexitå­—èŠ‚ç æŒ‡ä»¤é‡Šæ”¾é”çš„æ—¶å€™ä¼šå‡1ï¼Œå½“è®¡æ•°å™¨ä¸º0è¡¨ç¤ºå¯¹è±¡æ²¡æœ‰é”å®šï¼Œå¦‚æžœä¸€ä¸ªçº¿ç¨‹èŽ·å–é”å¤±è´¥æ—¶ï¼Œé‚£å½“å‰çº¿ç¨‹å°±å¿…é¡»è¢«é˜»å¡žç­‰å¾…ï¼Œç›´åˆ°å¯¹è±¡é”è¢«å¦ä¸€å¯¹è±¡é‡Šæ”¾ï¼Œä¸‹é¢æˆ‘ä»¬é€šè¿‡ä»‹ç»å¯¹è±¡å¤´å’Œmonitorä»¥åŠJVMå¯¹é”çš„ä¼˜åŒ–æŽªæ–½è¿›ä¸€æ­¥äº†è§£å¦‚ä½•èŽ·å–å¯¹è±¡çš„é”å’Œé‡Šæ”¾å¯¹è±¡çš„é”ã€‚ å¯¹è±¡å¤´åœ¨HotSpotè™šæ‹Ÿæœºä¸­ï¼Œå¯¹è±¡çš„å†…å­˜å¸ƒå±€åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šå¯¹è±¡å¤´ï¼Œå®žä¾‹æ•°æ®å’Œå¯¹é½å¡«å……ï¼Œå…¶ä¸­å¯¹è±¡å¤´æ˜¯å¯¹è±¡çš„å†…å­˜å¸ƒå±€ä¸­å¾ˆé‡è¦çš„éƒ¨åˆ†ï¼Œä»–åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†çš„ä¿¡æ¯ï¼Œç¬¬ä¸€ä¸ªéƒ¨åˆ†å­˜å‚¨çš„æ˜¯å¯¹è±¡æœ¬èº«è¿è¡Œæ—¶çš„æ•°æ®ï¼Œæ¯”å¦‚å“ˆå¸Œç ï¼ŒGCåˆ†ä»£å¹´é¾„ç­‰ï¼Œç©ºé—´å¤§å°æ ¹æ®32ä½å’Œ64ä½çš„è™šæ‹Ÿæœºåˆ†åˆ«ä¸º32bitå’Œ64bitï¼Œè¿™è¿˜æœ‰å¦ä¸€ä¸ªå®˜æ–¹ç§°å·å«åšâ€œMark Wordâ€œï¼Œä»–æ˜¯å®žçŽ°è½»é‡çº§é”å’Œåå‘é”çš„å…³é”®ï¼Œè¿™ä¸ªåŽé¢ä¼šè®²åˆ°ï¼Œå¦ä¸€ä¸ªéƒ¨åˆ†ç”¨äºŽå­˜å‚¨æŒ‡å‘æ–¹æ³•åŒºå¯¹è±¡ç±»åž‹æ•°æ®çš„æŒ‡é’ˆï¼Œå¦‚æžœå­˜å‚¨çš„æ˜¯å¯¹è±¡æ•°ç»„çš„è¯ï¼Œè¿˜æœ‰ä¸€éƒ¨åˆ†ç©ºé—´å­˜å‚¨è¯¥æ•°ç»„çš„é•¿åº¦ï¼Œé»˜è®¤çš„å­˜å‚¨ç»“æž„å¦‚ä¸‹æ‰€ç¤ºï¼ˆ32ä½è™šæ‹Ÿæœºä¸ºä¾‹ï¼‰ï¼š è€ƒè™‘åˆ°è™šæ‹Ÿæœºçš„ç©ºé—´æ•ˆçŽ‡ï¼ŒMark Wordè¢«è®¾è®¡æˆä¸€ä¸ªéžå›ºå®šçš„æ•°æ®ç»“æž„ï¼Œä»¥ä¾¿åœ¨æžå°çš„ç©ºé—´å†…å­˜å‚¨æ›´å¤šçš„ä¿¡æ¯ï¼Œä»–ä¼šæ ¹æ®ä¸åŒçš„çŠ¶æ€å¤ç”¨è‡ªå·±çš„å­˜å‚¨ç©ºé—´ï¼Œå¦‚ä¸‹æ‰€ç¤º æ³¨æ„ï¼šå…¶ä¸­åå‘é”å’Œè½»é‡çº§é”è¿™ä¸¤ä¸ªé”çŠ¶æ€æ˜¯JDK1.6ä¹‹åŽå¼•å…¥çš„å¯¹é”çš„ä¼˜åŒ–ï¼Œä¹‹åŽä¼šä»‹ç» monitormonitoræ˜¯çº¿ç¨‹ç§æœ‰çš„æ•°æ®ç»“æž„ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªå¯ç”¨çš„monitor recordåˆ—è¡¨ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€ä¸ªå…¨å±€çš„å¯ç”¨åˆ—è¡¨ï¼Œæ¯ä¸€ä¸ªé”ä½çš„å¯¹è±¡éƒ½ä¼šå’Œä¸€ä¸ªmonitorå…³è”ï¼Œä¸‹é¢æ˜¯monitorçš„ç»“æž„ç»„æˆï¼š Ownerï¼šåˆå§‹æ—¶ä¸ºNULLè¡¨ç¤ºå½“å‰æ²¡æœ‰ä»»ä½•çº¿ç¨‹æ‹¥æœ‰è¯¥monitorï¼Œå½“çº¿ç¨‹æˆåŠŸæ‹¥æœ‰è¯¥é”åŽä¿å­˜çº¿ç¨‹å”¯ä¸€æ ‡è¯†ï¼Œå½“é”è¢«é‡Šæ”¾æ—¶åˆè®¾ç½®ä¸ºNULLï¼› EntryQï¼šå…³è”ä¸€ä¸ªç³»ç»Ÿäº’æ–¥é”ï¼ˆsemaphoreï¼‰ï¼Œé˜»å¡žæ‰€æœ‰è¯•å›¾é”ä½monitorå¤±è´¥çš„çº¿ç¨‹ã€‚ RcThisï¼šè¡¨ç¤ºblockedæˆ–waitingåœ¨è¯¥monitorä¸Šçš„æ‰€æœ‰çº¿ç¨‹çš„ä¸ªæ•°ã€‚ Nestï¼šç”¨æ¥å®žçŽ°é‡å…¥é”çš„è®¡æ•°ã€‚ HashCodeï¼šä¿å­˜ä»Žå¯¹è±¡å¤´æ‹·è´è¿‡æ¥çš„HashCodeå€¼ï¼ˆå¯èƒ½è¿˜åŒ…å«GC ageï¼‰ã€‚ Candidateï¼šç”¨æ¥é¿å…ä¸å¿…è¦çš„é˜»å¡žæˆ–ç­‰å¾…çº¿ç¨‹å”¤é†’ï¼Œå› ä¸ºæ¯ä¸€æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤ŸæˆåŠŸæ‹¥æœ‰é”ï¼Œå¦‚æžœæ¯æ¬¡å‰ä¸€ä¸ªé‡Šæ”¾é”çš„çº¿ç¨‹å”¤é†’æ‰€æœ‰æ­£åœ¨é˜»å¡žæˆ–ç­‰å¾…çš„çº¿ç¨‹ï¼Œä¼šå¼•èµ·ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆä»Žé˜»å¡žåˆ°å°±ç»ªç„¶åŽå› ä¸ºç«žäº‰é”å¤±è´¥åˆè¢«é˜»å¡žï¼‰ä»Žè€Œå¯¼è‡´æ€§èƒ½ä¸¥é‡ä¸‹é™ã€‚Candidateåªæœ‰ä¸¤ç§å¯èƒ½çš„å€¼ï¼š0è¡¨ç¤ºæ²¡æœ‰éœ€è¦å”¤é†’çš„çº¿ç¨‹ï¼Œ1è¡¨ç¤ºè¦å”¤é†’ä¸€ä¸ªç»§ä»»çº¿ç¨‹æ¥ç«žäº‰é”ã€‚ å½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥åŒæ­¥ä»£ç å—æ—¶ï¼Œè¯¥ä»£ç å—çš„åŒæ­¥å¯¹è±¡é€šè¿‡Mark Workä¸­çš„LockWordæŒ‡å‘monitorçš„èµ·å§‹åœ°å€æ¥å…³è”monitorï¼Œç”±monitoræ¥èŽ·å–é”å’Œé‡Šæ”¾é” ç”±äºŽåœ¨javaä¸­ï¼Œsynchronizedæ˜¯ä¸€ä¸ªé‡é‡çº§çš„é”ï¼Œåœ¨å¤šå¤„ç†å™¨å¹¶å‘ä¸­ï¼Œæ•ˆçŽ‡æ€»æ˜¯ä¸å°½äººæ„ï¼ŒJVMå›¢é˜Ÿè®¤ä¸ºè¿˜æœ‰å¾ˆå¤§çš„æ”¹è¿›ç©ºé—´ï¼Œæ‰€ä»¥è¿›è¡Œäº†é”çš„ä¸€ç³»åˆ—çš„ä¼˜åŒ–ï¼Œä¸‹é¢å°†ä»‹ç»é”çš„ä¼˜åŒ–æŽªæ–½ åå‘é”åå‘é”æ˜¯JDK1.6å¼•å…¥çš„ä¸€é¡¹é”ä¼˜åŒ–ï¼Œä»–çš„ç›®çš„æ˜¯æ¶ˆé™¤åœ¨æ— ç«žäº‰çš„æƒ…å†µä¸‹çš„åŒæ­¥åŽŸè¯­ï¼Œè¿›ä¸€æ­¥æé«˜ç¨‹åºçš„è¿è¡Œæ€§èƒ½ï¼Œè¯´ç™½äº†å°±æ˜¯å°†åŒæ­¥çš„æ“ä½œéƒ½æ¶ˆé™¤æŽ‰ï¼Œä¸‹é¢ä»‹ç»å¦‚ä½•èŽ·å–é”å’Œé‡Šæ”¾é” èŽ·å–é”å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥ä»£ç å—æ—¶ï¼Œä¼šæ‰§è¡Œmonitorenterå­—èŠ‚ç æŒ‡ä»¤ï¼Œå¯¹è±¡ä¼šåœ¨Mark Wordåˆ©ç”¨CASæ“ä½œè®°å½•å…³è”çš„çº¿ç¨‹IDæ ‡è¯†ï¼Œæ“ä½œæˆåŠŸå°±å°†æ ‡å¿—ä½ç½®ä¸ºâ€œ01â€ï¼Œå³åå‘é”çŠ¶æ€ï¼Œå†æ ‡è®°æ˜¯å¦æ˜¯åå‘é”ç½®ä¸ºâ€œ1â€,è¿™æ ·ä»¥åŽè¯¥çº¿ç¨‹,å†æ¬¡è¿›å…¥æˆ–è€…é€€å‡ºåŒæ­¥å—æ—¶ä¸éœ€è¦å…¶ä»–çš„åŒæ­¥æ“ä½œ é‡Šæ”¾é”å¦‚æžœæœ‰å¦ä¸€ä¸ªçº¿ç¨‹å°è¯•èŽ·å–è¿™ä¸ªé”ï¼Œåå‘é”å°±ä¼šå¤±æ•ˆï¼Œè¿™æ—¶ä¼šç­‰å¾…å…¨å±€å®‰å…¨ç‚¹ï¼ˆåœ¨è¿™ä¸ªæ—¶é—´ç‚¹ä¸Šæ²¡æœ‰å­—èŠ‚ç æ­£åœ¨æ‰§è¡Œï¼‰æ’¤é”€åå‘é”çŠ¶æ€åˆ°æ— é”çŠ¶æ€ï¼ˆæ ‡å¿—ä½â€œ01â€ï¼‰æˆ–è€…è†¨èƒ€åˆ°è½»é‡çº§é”çŠ¶æ€ï¼ˆæ ‡å¿—ä½â€œ00â€ï¼‰ï¼ŒæŠŠæ˜¯å¦æ˜¯åå‘é”ç½®ä¸º0ï¼Œå®ƒä¼šé¦–å…ˆæš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼Œç„¶åŽæ£€æŸ¥æŒæœ‰åå‘é”çš„çº¿ç¨‹æ˜¯å¦æ´»ç€ï¼Œå¦‚æžœçº¿ç¨‹ä¸å¤„äºŽæ´»åŠ¨çŠ¶æ€ï¼Œåˆ™å°†å¯¹è±¡å¤´è®¾ç½®æˆæ— é”çŠ¶æ€ï¼Œå¦‚æžœçº¿ç¨‹ä»ç„¶æ´»ç€ï¼Œæ‹¥æœ‰åå‘é”çš„æ ˆä¼šè¢«æ‰§è¡Œï¼ŒéåŽ†åå‘å¯¹è±¡çš„é”è®°å½•ï¼Œæ ˆä¸­çš„é”è®°å½•å’Œå¯¹è±¡å¤´çš„Mark Wordè¦ä¹ˆé‡æ–°åå‘äºŽå…¶ä»–çº¿ç¨‹ï¼Œè¦ä¹ˆæ¢å¤åˆ°æ— é”æˆ–è€…æ ‡è®°å¯¹è±¡ä¸é€‚åˆä½œä¸ºåå‘é”ï¼Œæœ€åŽå”¤é†’æš‚åœçš„çº¿ç¨‹ã€‚ åå‘é”åœ¨Java 6å’ŒJava 7é‡Œæ˜¯é»˜è®¤å¯ç”¨çš„ï¼Œä½†æ˜¯å®ƒåœ¨åº”ç”¨ç¨‹åºå¯åŠ¨å‡ ç§’é’Ÿä¹‹åŽæ‰æ¿€æ´»ï¼Œå¦‚æœ‰å¿…è¦å¯ä»¥ä½¿ç”¨JVMå‚æ•°æ¥å…³é—­å»¶è¿Ÿ-XXï¼šBiasedLockingStartupDelay = 0ã€‚å¦‚æžœä½ ç¡®å®šè‡ªå·±åº”ç”¨ç¨‹åºé‡Œæ‰€æœ‰çš„é”é€šå¸¸æƒ…å†µä¸‹å¤„äºŽç«žäº‰çŠ¶æ€ï¼Œå¯ä»¥é€šè¿‡JVMå‚æ•°å…³é—­åå‘é”-XX:-UseBiasedLocking=falseï¼Œé‚£ä¹ˆé»˜è®¤ä¼šè¿›å…¥è½»é‡çº§é”çŠ¶æ€ã€‚ è½»é‡çº§é”è½»é‡çº§é”ä¹Ÿæ˜¯JDK1.6ä¹‹ä¸­åŠ å…¥çš„æ–°åž‹é”æœºåˆ¶ï¼Œä»–çš„ä½œç”¨æ˜¯åœ¨æ²¡æœ‰å¤šçº¿ç¨‹çš„ç«žäº‰ä¸‹ï¼Œå‡å°‘ä¼ ç»Ÿçš„é‡é‡çº§é”ä½¿ç”¨æ“ä½œç³»ç»Ÿäº’æ–¥é‡äº§ç”Ÿçš„æ€§èƒ½æ¶ˆè€— èŽ·å–é”å½“çº¿ç¨‹è¿›å…¥ä»£ç å—æ—¶ï¼Œè¯¥åŒæ­¥å—çš„å¯¹è±¡æ²¡æœ‰è¢«é”å®šï¼Œå½“å‰çº¿ç¨‹ä¼šåœ¨è‡ªå·±çš„æ ˆå†…åˆ›å»ºä¸€ç‰‡ç©ºé—´æ¥å­˜å‚¨é”è®°å½•ï¼Œç„¶åŽå†å°†Mark Wordå¤åˆ¶åˆ°é”è®°å½•ä¸­ï¼ˆå®˜æ–¹åœ¨å¤åˆ¶æ—¶ä¼šåŠ ä¸€ä¸ªDisplacedå‰ç¼€ï¼Œå°±æ˜¯Displaced Mark Wordï¼‰ï¼Œç„¶åŽå°è¯•ç”¨CASæ“ä½œå°†Mark WordæŒ‡å‘è¯¥çº¿ç¨‹çš„æ ˆå¸§ä¸­çš„é”è®°å½•åœ°å€ï¼Œå¦‚æžœæˆåŠŸäº†å°±ä¼šæ‹¥æœ‰è¯¥å¯¹è±¡çš„é”ï¼Œé”çš„æ ‡å¿—ä½å°±å˜æˆäº†â€œ00â€ï¼Œæ­¤æ—¶å±žäºŽè½»é‡çº§é”çš„çŠ¶æ€ï¼Œå¦‚æžœæ›´æ–°å¤±è´¥çš„è¯ï¼Œè¯´æ˜Žå½“å‰å¯¹è±¡å­˜åœ¨ç«žäº‰ï¼Œé‚£è½»é‡çº§é”å°±ä¼šå¤±æ•ˆï¼Œè†¨èƒ€æˆé‡é‡çº§é”ï¼Œé”çš„æ ‡å¿—ä½å°±å˜æˆäº†â€œ10â€ï¼ŒMark WordæŒ‡å‘çš„å°±æ˜¯é‡é‡çº§é”çš„æŒ‡é’ˆï¼ŒåŽé¢çš„çº¿ç¨‹å°±ä¼šè¿›ç¨‹é˜»å¡ž é‡Šæ”¾é”è½»é‡çº§é”é‡Šæ”¾é”æ˜¯é€šè¿‡CASæ“ä½œå°†å½“å‰çš„Mark Wordå’Œå½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­çš„é”è®°å½•æ›¿æ¢å›žåŽ»ï¼Œå¦‚æžœæˆåŠŸçš„è¯ï¼Œè¡¨ç¤ºè®¿é—®å®Œæ•´ä¸ªåŒæ­¥å—äº†ï¼Œå¦‚æžœå¤±è´¥çš„è¯ï¼Œè¡¨ç¤ºæœ‰ç«žäº‰å‡ºçŽ°ï¼Œé‚£å°±è¦é©¬ä¸Šæ”¾å¼ƒè¯¥é”ï¼Œå”¤é†’è¢«æŒ‚èµ·çš„çº¿ç¨‹åœ¨å¤šæ ¸å¤„ç†å™¨çš„å¹¶å‘æƒ…å†µä¸‹ï¼Œé”çš„çŠ¶æ€ä¼šå› ä¸ºç«žäº‰çš„å…³ç³»è€Œå˜åŒ–ï¼Œç„¶è€Œå¯¹äºŽé”çš„çŠ¶æ€ä¼šéšç€è†¨èƒ€å‡çº§ï¼Œä»Žæœ€å¼€å§‹çš„æ— é”ï¼Œåˆ°åå‘é”ï¼Œå†åˆ°è½»é‡çº§é”ï¼Œæœ€åŽæ˜¯é‡é‡çº§é”ï¼Œé”åªèƒ½æ˜¯å‡çº§ï¼Œä¸èƒ½é™çº§ï¼Œä¸‹é¢æ˜¯ä¸‰ç§é”çŠ¶æ€çš„ä¼˜ç¼ºç‚¹æ¯”è¾ƒ JVMçš„å›¢é˜Ÿåœ¨é”çš„ä¼˜åŒ–ä¸‹äº†å¾ˆå¤§çš„åŠŸå¤«ï¼Œå…¶å®žè¿˜æœ‰åŒ…æ‹¬è‡ªæ—‹é”å’Œè‡ªé€‚åº”è‡ªæ—‹é”ï¼šä»¥æ¶ˆè€—CPUçš„ä»£ä»·æ¢å–åŠ é”è§£é”çš„æ¶ˆè€—ï¼Œé”æ¶ˆé™¤ï¼šæœ€å°çš„ç²’åº¦æ¶ˆé™¤åŠ é”è§£é”çš„æ¶ˆè€—ï¼Œé”ç²—åŒ–ï¼šç”¨ä¸€æ¬¡åŠ é”è§£é”çš„æ¶ˆè€—æ¥æ›¿ä»£å¤šæ¬¡çš„åŠ é”è§£é”çš„æ¶ˆè€—ï¼ŒSynchronizedçš„æ€§èƒ½ä¹Ÿè¶Šæ¥è¶Šå¥½ï¼Œåœ¨åˆç†çš„æƒ…å†µä¸‹ä½¿ç”¨ä¸ä¼šæ¯”concurrentåŒ…ä¸‹çš„lockæœºåˆ¶æ€§èƒ½å·®ã€‚ å‚è€ƒhttp://ifeve.com/java-synchronized/ å‘¨å¿—æ˜Žã€Šæ·±å…¥ç†è§£javaè™šæ‹Ÿæœºã€‹ç¬¬åä¸‰ç«  http://developer.51cto.com/art/201702/532564.htm]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[æ·±å…¥å¹¶å‘å…³é”®å­—-volatile]]></title>
      <url>%2F2017%2F05%2F22%2Fvolatile%2F</url>
      <content type="text"><![CDATA[ä»…ä¾›å­¦ä¹ äº¤æµ,å¦‚æœ‰é”™è¯¯è¯·æŒ‡å‡º,å¦‚è¦è½¬è½½è¯·åŠ ä¸Šå‡ºå¤„,è°¢è°¢ å‰è¨€å…³é”®å­—volatileå¯ä»¥è¯´æ˜¯JVMæä¾›çš„æœ€è½»é‡çš„åŒæ­¥æœºåˆ¶äº†ï¼Œä¹Ÿè¢«ç§°ä¸ºè½»é‡çº§çš„ synchronizedï¼Œä»–åœ¨å¤šå¤„ç†å™¨å¹¶å‘ç¼–ç¨‹ä¸­æä¾›äº†ä¸¤ä¸ªé‡è¦çš„ç‰¹æ€§ï¼š ä¿è¯å…±äº«å˜é‡çš„å¯è§æ€§ï¼ŒæŒ‡ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†ä¸€ä¸ªå…±äº«å˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿè¯»å–åˆ°æœ€æ–°çš„ä¿®æ”¹å€¼ ç¦æ­¢é‡æŽ’åºï¼ŒæŒ‡ç¦æ­¢ä»£ç åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ºä¼˜åŒ–æ€§èƒ½è€Œç¼–è¯‘çš„æ‰§è¡Œé¡ºåº å¦‚æžœåœ¨åˆé€‚çš„æƒ…å†µä¸‹ä½¿ç”¨volatileå…³é”®å­—ï¼Œç¨‹åºä¼šæ›´åŠ çš„é«˜æ•ˆï¼Œå› ä¸ºä»–å¯¹äºŽsynchronizedæ¥è®²ä¸ä¼šä½¿çº¿ç¨‹ä¸Šä¸‹æ–‡çš„è°ƒåº¦å’Œåˆ‡æ¢ volatileçš„å®žçŽ°åŽŸç†volatileæ˜¯å¦‚æžœå®žçŽ°å¯è§æ€§å’Œç¦æ­¢æŒ‡ä»¤é‡æŽ’åºçš„ï¼Ÿå…ˆé€šè¿‡ä¸€æ®µåŒé‡æ£€æŸ¥å•ä¾‹æ¨¡å¼ï¼ˆdouble checked singletonï¼‰ä»£ç å¼€å§‹1234567891011121314public class DoubleCheckedSingleton &#123; private volatile static DoubleCheckedSingleton instance; private DoubleCheckedSingleton ()&#123;&#125; public static DoubleCheckedSingleton getInstance() &#123; if (instance == null) &#123;//single checked synchronized (DoubleCheckedSingleton.class) &#123; if (instance == null) &#123;//double checked instance = new DoubleCheckedSingleton(); &#125; &#125; &#125; return instance; &#125;&#125; åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œç”±volatileä¿®é¥°çš„èµ‹å€¼ä»£ç ç‰‡æ®µinstance = new DoubleCheckedSingleton()ï¼›åœ¨x86å¤„ç†å™¨ä¸‹é€šè¿‡å·¥å…·èŽ·å–JITç¼–è¯‘å™¨ç”Ÿæˆçš„æ±‡ç¼–ä»£ç æŒ‡ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š120x01a3de1d: movb $0x0,0x1104800(%esi);0x01a3de24: lock addl $0x0,(%esp); ç›¸å¯¹äºŽæ™®é€šå˜é‡çš„èµ‹å€¼æ“ä½œæ¥è®²ï¼Œvolatileä¿®é¥°çš„å…±äº«å˜é‡çš„åœ¨èµ‹å€¼åŽå¤šæ‰§è¡Œäº†lock addl $0x0,(%esp)æŒ‡ä»¤æ“ä½œï¼Œå…¶ä¸­lockæŒ‡ä»¤å‰ç¼€åœ¨å¤šæ ¸å¤„ç†å™¨ä¸­ä¼šåšä¸¤ä»¶äº‹ï¼š å°†å½“å‰CPUç¼“å­˜è¡Œçš„æ•°æ®å†™å›žåˆ°ä¸»å†…å­˜ï¼› è¿™ä¸ªå†™å›žå†…å­˜çš„æ“ä½œä¼šå¯¼è‡´åœ¨å…¶å®ƒCPUé‡Œç¼“å­˜äº†è¯¥å†…å­˜åœ°å€çš„æ•°æ®æ— æ•ˆã€‚ å¤„ç†å™¨ä¸ºäº†æ›´åŠ é«˜æ•ˆçš„è¿è¡Œï¼Œä»–ä¸ä¼šç›´æŽ¥ä¸Žä¸»å†…å­˜è¿›è¡Œé€šä¿¡ï¼Œè€Œæ˜¯åœ¨å…ˆè¯»å–åˆ°å…¶å¤„ç†å™¨å†…éƒ¨ç¼“å­˜è¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œï¼Œä½†æ˜¯ä¸æ˜¯ç«‹åˆ»ä¼šå›žå†™åˆ°ä¸»å†…å­˜ä¸­ï¼Œå¯¹äºŽvolatileä¿®é¥°çš„å…±äº«å˜é‡è¿›è¡Œå†™æ“ä½œï¼ŒJVMä¼šå‘è¯¥å¤„ç†å™¨å‘é€ä¸€æ¡Lockå‰ç¼€çš„æŒ‡ä»¤ï¼Œé”ä½è¯¥ç¼“å­˜ï¼ˆæ—©æœŸçš„å¤„ç†å™¨æ˜¯é€šè¿‡é”ä½æ•´ä¸ªæ€»çº¿ï¼Œæ•ˆçŽ‡è¾ƒä½Žï¼‰ï¼Œå¹¶ä½¿ç”¨ç¼“å­˜ä¸€è‡´æ€§æ¥ç¡®ä¿ä¿®æ”¹çš„åŽŸå­æ€§ï¼Œè¯¥æ“ä½œç§°ä¸ºâ€œç¼“å­˜é”å®šâ€ï¼Œç„¶åŽå¼•èµ·è¯¥å¤„ç†å™¨å°†å†…éƒ¨ç¼“å­˜å›žå†™åˆ°ä¸»å†…å­˜ä¸­ï¼Œåœ¨ç¡®ä¿ç¼“å­˜ä¸€è‡´æ€§çš„æƒ…å†µä¸‹ï¼Œå¤„ç†å™¨é€šè¿‡å—…æŽ¢æŠ€æœ¯è®¿é—®ä¸»å†…å­˜å’Œå†…éƒ¨ç¼“å­˜ï¼Œç¡®ä¿å¤„ç†å™¨å†…éƒ¨ç¼“å­˜å’Œä¸»å†…å­˜ä¸Šçš„çŠ¶æ€ä¿æŒä¸€è‡´ï¼Œå¦‚æžœä¸€ä¸ªå¤„ç†å™¨åœ¨å†…éƒ¨ç¼“å­˜å¯¹ä¸€ä¸ªå…±äº«åœ°å€è¿›è¡Œå†™æ“ä½œæ—¶ï¼Œè¯¥å¤„ç†å™¨ä¼šæ— æ•ˆå…¶å¯¹åº”çš„ç¼“å­˜ï¼Œå†ä¸‹æ¬¡è®¿é—®è¯¥å†…å­˜åœ°å€æ—¶ï¼Œè¿›è¡Œè¯»å–ä¸»å†…å­˜åˆ°è¯¥å¤„ç†å™¨å†…éƒ¨ç¼“å­˜ã€‚ lockå‰ç¼€æŒ‡ä»¤ä¹Ÿç›¸å½“äºŽä¸€ä¸ªå†…å­˜å±éšœï¼ˆMemory Barrierï¼‰ï¼Œå¦‚ä¸Šæ‰€è¿°ï¼Œç”±äºŽç¼“å­˜é”å®šæ“ä½œï¼Œè¿™æ ·è®©è¯¥æŒ‡ä»¤æ‰§è¡Œå®Œï¼Œä¸‹ä¸€ä¸ªæŒ‡ä»¤æ‰èƒ½æ‰§è¡Œï¼Œè¿™ä¸ªå°±å®žçŽ°äº†ç¦æ­¢äº†æŒ‡ä»¤é‡æŽ’åºï¼Œå›žå†™ä¸»å†…å­˜åŒæ—¶ä½¿å…¶ä»–cpuè¯¥å†…å­˜åœ°å€æ— æ•ˆåŒ–ï¼Œè¿™æ ·ä¹Ÿå°±å®žçŽ°äº†å¯è§æ€§ã€‚ volatileå…³é”®å­—çš„ä½¿ç”¨å¦‚ä½•ä½¿ç”¨volatileå…³é”®å­—ï¼Œè¿™é‡Œè¦äº†è§£ç¡®ä¿å¹¶å‘å®‰å…¨çš„ä¸‰ä¸ªè¦ç´ ï¼šåŽŸå­æ€§ï¼Œå¯è§æ€§ï¼Œé¡ºåºæ€§ï¼Œå…¶ä¸­åŽŸå­æ€§æŒ‡è¯¥æ“ä½œä¸å¯åˆ†å‰²ï¼Œä¸å—å…¶ä»–çº¿ç¨‹å¹²æ‰°ï¼Œé¡ºåºæ€§å°±æ˜¯ç¦æ­¢æŒ‡ä»¤é‡æŽ’åºï¼Œå¯¹äºŽå…³é”®å­—volatileæ¥è®²ï¼Œvolatileå…³é”®å­—ä¿è¯äº†å¯è§æ€§å’Œé¡ºåºæ€§ï¼ŒåŒæ—¶å®ƒä¹Ÿæ˜¯ä¸€ä¸ªè½»é‡çº§çš„synchronized,å®ƒåœ¨å¤šå¤„ç†å™¨ä¸Šçš„å®‰å…¨æ€§ä½“çŽ°åœ¨æ›´åŠ ç»†å¾®çš„æ“ä½œï¼Œä¸Šè¿°ä¹Ÿæåˆ°ï¼Œç”±äºŽç¼“å­˜ä¸€è‡´æ€§ä¼šä¿è¯å•ä¸ªè¯»å†™æ“ä½œçš„åŽŸå­æ€§ï¼Œè¿™æ ·å°±ç¬¦åˆå¹¶å‘å®‰å…¨çš„ä¸‰è¦ç´ äº†ï¼Œç„¶è€Œåœ¨å¤§å¤šæ•°ç¨‹åºä¸­ï¼Œå¤§å¤šæ•°éƒ½æ˜¯å¯¹ä¸€äº›å…±äº«å˜é‡çš„å¤åˆæ“ä½œï¼Œæ¯”å¦‚i++æ“ä½œï¼Œè¿™å°±æ¶‰åŠåˆ°ä»Žä¸»å†…å­˜è¯»å–iåˆ°ç¼“å­˜ä¸­ï¼Œåœ¨ç¼“å­˜ä¸­è¿›è¡Œi+1çš„æ“ä½œå’Œå°†iå†™å…¥ä¸»å†…å­˜ä¸‰ä¸ªæ“ä½œï¼Œè¿™ä¸ªå°±æ— æ³•ä¿è¯i++æ“ä½œçš„åŽŸå­æ€§äº†ï¼Œå¯¹äºŽç±»ä¼¼çš„å¤åˆæ“ä½œæ¥è®²ï¼Œå¦‚æžœå…±äº«å˜é‡å…·æœ‰åŽŸå­æ€§æˆ–è€…åœ¨ä¸€äº›åŽŸå­æ“ä½œçš„åœºåˆä¸‹ï¼Œæ¯”å¦‚å…±äº«å˜é‡è¢«concurrentåŒ…ä¸‹çš„ä¸€äº›åŽŸå­ç±»ä¿®é¥°æˆ–è€…åšä¸€äº›CASçš„ä¸€äº›æ“ä½œï¼Œä½¿ç”¨volatileæ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ã€‚ å‚è€ƒhttp://ifeve.com/volatile/ å‘¨å¿—æ˜Žã€Šæ·±å…¥ç†è§£javaè™šæ‹Ÿæœºã€‹ç¬¬åäºŒç« ]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[NIOå­¦ä¹ ç¬”è®°]]></title>
      <url>%2F2017%2F03%2F17%2Fnio_note%2F</url>
      <content type="text"><![CDATA[ä»…ä¾›å­¦ä¹ äº¤æµ,å¦‚æœ‰é”™è¯¯è¯·æŒ‡å‡º,å¦‚è¦è½¬è½½è¯·åŠ ä¸Šå‡ºå¤„,è°¢è°¢ Channelå’ŒBufferæ¦‚è¿°ä¸Žå®žçŽ°æ‰€æœ‰çš„IOåœ¨NIOä¸­éƒ½æ˜¯ä»Žchannelå¼€å§‹ï¼Œchannelåƒæ˜¯æµï¼Œbufferåƒæ˜¯ç¼“å†²åŒºï¼Œæµå¯ä»¥è¯»åˆ°ç¼“å†²åŒºä¸­ï¼Œç¼“å†²åŒºå¯ä»¥å†™åˆ°æµä¸­ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º channelä¸»è¦å®žçŽ°ï¼šFileChannelï¼ˆæ–‡ä»¶æµï¼‰ï¼ŒDatagramChannelï¼ˆæ•°æ®æŠ¥æµ-UDPï¼‰ï¼ŒSocketChannelï¼ˆsocketæµ-TCPï¼‰ï¼ŒServerSocketChannelï¼ˆæœåŠ¡ç«¯socketæµ-TCPï¼‰ Bufferä¸»è¦å®žçŽ°ï¼ˆä¸»è¦æ˜¯ä¸ƒä¸ªIOçš„åŸºæœ¬ç±»åž‹ï¼‰ï¼šByteBufferï¼ŒCharBufferï¼ŒDoubleBufferï¼ŒFloatBufferï¼ŒIntBufferï¼ŒLongBufferï¼ŒShortBuffer ç®€å•çš„FileChannelè¯»å–æ•°æ®åˆ°bufferbufferå†…å­˜æ¨¡åž‹çš„ä¸‰ä¸ªæ ‡è®°ä½ï¼š1.capacity(å®¹é‡):bufferåˆå§‹åŒ–æ—¶åˆ†é…çš„å®¹é‡2.position(ä½ç½®):bufferå†…è¯»å–æˆ–å†™å…¥çš„ä½ç½®(è¯»å–æˆ–å†™å…¥æ—¶positionä»Ž0å¼€å§‹ï¼Œå¦‚æžœåœ¨get(position)æ–¹æ³•ä¸­æœ‰èµ‹å€¼ï¼Œåˆ™ä»Žè¯¥ä½ç½®å¼€å§‹)3.limit(æœ€å¤§å®¹é‡):è¯»å–æˆ–å†™å…¥çš„æœ€å¤§ä½ç½®(è¯»å–æ—¶ï¼Œç½®ä¸ºpositionçš„ä½ç½®ï¼Œå†™å…¥æ—¶ï¼Œç½®ä¸ºcatacityçš„ä½ç½®) æ€»ç»“ï¼šä¸ç®¡æ˜¯è¯»å–è¿˜æ˜¯å†™å…¥ï¼Œéƒ½æ˜¯ä»Žpositionæ ‡å¿—çš„ä½ç½®å¼€å§‹ï¼Œåˆ°limitçš„ä½ç½®ç»“æŸ å°†channelè¯»å…¥bufferçš„ç¤ºä¾‹å¦‚ä¸‹ï¼š12345678910111213141516171819202122232425262728293031public void simpleChannelToBuffer(String fromPath)&#123; ByteBuffer buffer=null; RandomAccessFile file=null; FileChannel fileChannel=null; try &#123; file = new RandomAccessFile(fromPath,"rw"); fileChannel = file.getChannel();//å»ºç«‹åˆ°ç›®çš„æ–‡ä»¶çš„é€šé“ buffer = ByteBuffer.allocate(48);//åˆ†é…48bytesçš„ç¼“å­˜åŒº int bytesRead =0 ; while((bytesRead=fileChannel.read(buffer))!=-1)&#123;//å°†é€šé“å†…çš„æ–‡ä»¶æ•°æ®è¯»å–åˆ°ç¼“å­˜åŒºä¸­ System.out.print(bytesRead); buffer.flip();//åˆ‡æ¢è¯»æ¨¡å¼ï¼Œpositionç½®ä¸º0ï¼Œlimitç½®ä¸ºå†™å…¥æ—¶çš„positionçš„ä½ç½® while(buffer.hasRemaining())&#123;//ç¼“å­˜åŒºä¸­æ˜¯å¦æœ‰æ•°æ® System.out.print((char)buffer.get()); &#125; buffer.clear();//æ¸…ç©ºæ‰€æœ‰çš„æ•°æ®ï¼Œåˆ‡æ¢æˆå†™æ¨¡å¼ //buffer.compact();//æ¸…ç©ºå·²ç»è¯»å–çš„æ•°æ®ï¼Œåˆ‡æ¢æˆå†™æ¨¡å¼ &#125; &#125; catch (FileNotFoundException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125;finally &#123; try &#123; fileChannel.close(); file.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125;&#125; Scatterï¼ˆåˆ†æ•£ï¼‰ä¸ŽGatherï¼ˆèšé›†ï¼‰Scatterï¼ˆåˆ†æ•£ï¼‰ï¼šä»Žchannelè¯»å–æ•°æ®å†™å…¥å¤šä¸ªbufferä¸­ ä»£ç å¦‚ä¸‹ï¼š1234ByteBuffer header = ByteBuffer.allocate(128);ByteBuffer body = ByteBuffer.allocate(1024);ByteBuffer[] bufferArray = &#123; header, body &#125;;channel.read(bufferArray); //ä¾æ¬¡å†™å…¥åˆ°bufferä¸­ Gatherï¼ˆèšé›†ï¼‰ï¼šå°†å¤šä¸ªbufferçš„æ•°æ®å†™å…¥åŒä¸€ä¸ªchannelä¸­ ä»£ç å¦‚ä¸‹1234ByteBuffer header = ByteBuffer.allocate(128);ByteBuffer body = ByteBuffer.allocate(1024);ByteBuffer[] bufferArray = &#123; header, body &#125;;channel.write(bufferArray); //ä¾æ¬¡å†™å…¥åˆ°channelä¸­ é€šé“ä¹‹é—´çš„æ•°æ®ä¼ è¾“12345678RandomAccessFile fromFile = new RandomAccessFile("fromFile.txt", "rw");FileChannel fromChannel = fromFile.getChannel();RandomAccessFile toFile = new RandomAccessFile("toFile.txt", "rw");FileChannel toChannel = toFile.getChannel();long position = 0; //è¯»å–çš„ä½ç½®long count = fromChannel.size(); //è¯»å–çš„å¤§å°toChannel.transferFrom(position, count, fromChannel); //æ•°æ®ä»ŽfromChannelåˆ°toChannel//å¦ä¸€ç§å†™æ³•ï¼šfromChannel.transferTo(position, count, toChannel); æ³¨æ„ï¼šåœ¨SocketChannelä¸­ï¼Œä¼ è¾“çš„åªä¼šæ˜¯å‡†å¤‡å¥½çš„æ•°æ®ï¼Œå¯èƒ½ä¸è¶³countå¤§å°ï¼Œä½†æ˜¯ä¸€æœ‰æ•°æ®å°±ä¼šä¼ è¾“ï¼Œåªåˆ°bufferè¢«å¡«æ»¡ Selectorå¦‚æžœä½ æƒ³å•çº¿ç¨‹å¼‚æ­¥å¤„ç†å¤šä¸ªæµï¼Œæˆ–è€…æ˜¯ä½ çš„åº”ç”¨æ‰“å¼€äº†å¤šä¸ªé“¾æŽ¥ï¼ˆé€šé“ï¼‰ï¼Œä½†æ˜¯æ¯ä¸ªé“¾æŽ¥çš„çš„æµé‡åˆå¾ˆä½Žï¼Œè¿™å°±æ˜¯Selectorçš„å·¥ä½œ Selectoré¦–å…ˆè¦æ³¨å†ŒChannelï¼Œè°ƒç”¨select()æ–¹æ³•ï¼Œä¸€ç›´é˜»å¡žåˆ°æœ‰æŸä¸ªæ³¨å†Œçš„é€šé“ï¼ˆChannelï¼‰æœ‰äº‹ä»¶ï¼ˆæ•°æ®æˆ–è€…æ–°æŽ¥è¿žï¼‰å°±ç»ªï¼Œç­‰åˆ°è¿™ä¸ªæ–¹æ³•è¿”å›žï¼Œçº¿ç¨‹å°±å¼€å§‹å¤„ç†è¿™ä¸ªé€šé“ä¸­çš„äº‹ä»¶ æ³¨æ„ï¼šä¸ŽSelectorä¸€èµ·ä½¿ç”¨æ—¶ï¼ŒChannelå¿…é¡»å¤„äºŽéžé˜»å¡žæ¨¡å¼ä¸‹ã€‚è¿™æ„å‘³ç€ä¸èƒ½å°†FileChannelä¸ŽSelectorä¸€èµ·ä½¿ç”¨ï¼Œå› ä¸ºFileChannelä¸èƒ½åˆ‡æ¢åˆ°éžé˜»å¡žæ¨¡å¼ã€‚è€Œå¥—æŽ¥å­—é€šé“éƒ½å¯ä»¥ selectorå¯ä»¥ç›‘å¬channelä»¥ä¸‹å››ç§ä¸åŒç±»åž‹çš„äº‹ä»¶ï¼š OP_CONNECT(è¿žæŽ¥å°±ç»ª) ï¼šæ¯”å¦‚ï¼šsocketChannel OP_ACCEPT(æŽ¥æ”¶å°±ç»ª)ï¼šæ¯”å¦‚ï¼šServerSocketChannel OP_READ(è¯»å°±ç»ª) OP_WRITE(å†™å°±ç»ª) ä»£ç å¦‚ä¸‹ï¼š123456789101112131415161718192021222324Selector selector = Selector.open();//åˆ›å»ºä¸€ä¸ªselectorchannel.configureBlocking(false);//è®¾ç½®éžé˜»å¡žæ¨¡å¼//selectoræ³¨å†Œchannelï¼Œäº‹ä»¶å¯ä»¥å¤šé€‰ï¼Œæ¯”å¦‚SelectionKey.OP_READ | SelectionKey.OP_WRITESelectionKey key = channel.register(selector, SelectionKey.OP_READ);while(true) &#123; int readyChannels = selector.select(); //è¿”å›žè¯»å°±ç»ªçš„channel if(readyChannels == 0) continue; //å¦‚æžœè¿˜æ²¡æœ‰å°±ç»§ç»­ç›‘å¬ Set selectedKeys = selector.selectedKeys();//èŽ·å–å·²å°±ç»ªçš„channelçš„é›†åˆ Iterator keyIterator = selectedKeys.iterator(); while(keyIterator.hasNext()) &#123; SelectionKey key = keyIterator.next();//å¦‚ä¸‹æ˜¯åˆ¤æ–­å“ªç§äº‹ä»¶çš„channelçš„å¤„ç† if(key.isAcceptable()) &#123; // a connection was accepted by a ServerSocketChannel. &#125; else if (key.isConnectable()) &#123; // a connection was established with a remote server. &#125; else if (key.isReadable()) &#123; // a channel is ready for reading &#125; else if (key.isWritable()) &#123; // a channel is ready for writing &#125; keyIterator.remove();//è¯¥äº‹ä»¶å¤„ç†å®Œå°±ç§»é™¤ &#125;&#125; pipeJava NIO ç®¡é“æ˜¯2ä¸ªçº¿ç¨‹ä¹‹é—´çš„å•å‘æ•°æ®è¿žæŽ¥ã€‚Pipeæœ‰ä¸€ä¸ªsourceé€šé“å’Œä¸€ä¸ªsinké€šé“ã€‚æ•°æ®ä¼šè¢«å†™åˆ°sinké€šé“ï¼Œä»Žsourceé€šé“è¯»å– é¦–å…ˆåˆ›å»ºPipeï¼šPipe pipe = Pipe.open();ThreadAå‘ç®¡é“å†™æ•°æ®ï¼Œè®¿é—®sinké€šé“ï¼Œä»£ç å¦‚ä¸‹ï¼š123456789Pipe.SinkChannel sinkChannel = pipe.sink();String newData = "New String to write to file..." + System.currentTimeMillis();ByteBuffer buf = ByteBuffer.allocate(48);buf.clear();buf.put(newData.getBytes());buf.flip();while(buf.hasRemaining()) &#123; sinkChannel.write(buf);&#125; ThreadBå‘ç®¡é“è¯»å–æ•°æ®ï¼Œè®¿é—®sourceé€šé“ï¼Œä»£ç å¦‚ä¸‹ï¼š123Pipe.SourceChannel sourceChannel = pipe.source();ByteBuffer buf = ByteBuffer.allocate(48);int bytesRead = sourceChannel.read(buf); NIOå’ŒIONIOä¸ŽIOçš„å·®å¼‚å¦‚ä¸‹: IO NIO é¢å‘æµ é¢å‘ç¼“å†² é˜»å¡žIO éžé˜»å¡žIO æ—  é€‰æ‹©å™¨ é¢å‘æµå’Œé¢å‘ç¼“å†²IOæ˜¯é¢å‘æµçš„ï¼Œæ˜¯ä¸€ä¸ªä¸å¯æŽ§åˆ¶å¤„ç†æ–¹å¼ï¼Œå¿…é¡»ä»Žå¤´åˆ°å°¾ç›´åˆ°è¯»å–æ‰€æœ‰çš„å­—èŠ‚ï¼Œæ²¡æœ‰ç¼“å†²çš„ä½™åœ°ï¼Œè€ŒNIOæ˜¯é¢å‘ç¼“å†²åŒºçš„ï¼Œå®ƒå…ˆå°†æµä¸­çš„æ•°æ®è¯»å–åˆ°ç¼“å†²åŒºä¸­ï¼Œç„¶åŽå†å¯¹æ•°æ®è¿›è¡Œå¤„ç†ï¼Œè¿™æ ·å¢žåŠ äº†æ•°æ®å¤„ç†çš„çµæ´»æ€§ é˜»å¡žå’Œéžé˜»å¡žIOæ˜¯é˜»å¡žIOï¼Œå½“ä¸€ä¸ªçº¿ç¨‹åœ¨è¯»å–æ•°æ®çš„æ—¶å€™æ˜¯é˜»å¡žçš„ï¼Œå†æ¬¡æœŸé—´ä¸èƒ½åšå…¶ä»–çš„ä»»ä½•äº‹æƒ…ï¼Œç›´åˆ°è¯»å†™æ•°æ®ç»“æŸNIOæ˜¯éžé˜»å¡žIOï¼Œå½“ä¸€ä¸ªçº¿ç¨‹åœ¨è¯»å–æ•°æ®æ—¶ï¼Œåœ¨è¯¥æ•°æ®å˜æˆå¯è¯»æ€§ä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯ç©ºé—²æ—¶é—´ï¼Œå¯ä»¥åšå…¶ä»–äº‹æƒ… é€‰æ‹©å™¨Java NIOçš„é€‰æ‹©å™¨å…è®¸ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æ¥ç›‘è§†å¤šä¸ªè¾“å…¥é€šé“ï¼Œä½ å¯ä»¥æ³¨å†Œå¤šä¸ªé€šé“ä½¿ç”¨ä¸€ä¸ªé€‰æ‹©å™¨ï¼Œç„¶åŽä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æ¥â€œé€‰æ‹©â€é€šé“ï¼šè¿™äº›é€šé“é‡Œå·²ç»æœ‰å¯ä»¥å¤„ç†çš„è¾“å…¥ï¼Œæˆ–è€…é€‰æ‹©å·²å‡†å¤‡å†™å…¥çš„é€šé“ã€‚è¿™ç§é€‰æ‹©æœºåˆ¶ï¼Œä½¿å¾—ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹å¾ˆå®¹æ˜“æ¥ç®¡ç†å¤šä¸ªé€šé“ å‚è€ƒhttp://ifeve.com/java-nio-all/]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[JVMåŠ è½½æœºåˆ¶]]></title>
      <url>%2F2017%2F03%2F06%2Fjvm_classLoad%2F</url>
      <content type="text"><![CDATA[ä»…ä¾›å­¦ä¹ äº¤æµ,å¦‚æœ‰é”™è¯¯è¯·æŒ‡å‡º,å¦‚è¦è½¬è½½è¯·åŠ ä¸Šå‡ºå¤„,è°¢è°¢ ç±»åŠ è½½è¿‡ç¨‹ç±»åŠ è½½æ˜¯æŒ‡ç±»é€šè¿‡JVMåŠ è½½åˆ°å†…å­˜å¼€å§‹åˆ°ä»Žå†…å­˜ä¸­å¸è½½å‡ºåŽ»çš„è¿‡ç¨‹ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬ä¸ƒä¸ªé˜¶æ®µï¼šåŠ è½½ï¼ˆLoadingï¼‰ï¼ŒéªŒè¯ï¼ˆVerificationï¼‰ï¼Œå‡†å¤‡ï¼ˆPreparationï¼‰ï¼Œè§£æžï¼ˆResolutionï¼‰ï¼Œåˆå§‹åŒ–ï¼ˆInitializationï¼‰ï¼Œä½¿ç”¨ï¼ˆUsingï¼‰ï¼Œå¸è½½ï¼ˆUnloadingï¼‰ï¼Œå…¶ä¸­éªŒè¯ï¼Œå‡†å¤‡å’Œè§£æžç»Ÿç§°ä¸ºé“¾æŽ¥è¿‡ç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç±»åŠ è½½å™¨ç±»åŠ è½½å™¨ä½œç”¨äºŽç±»çš„åŠ è½½è¿‡ç¨‹ï¼Œæ¯ä¸€ä¸ªåŠ è½½å™¨éƒ½æ‹¥æœ‰ç‹¬ç«‹çš„ç±»åç§°ç©ºé—´ï¼Œè€ŒJVMä¸­ï¼Œæœ‰ä¸¤ç§ç±»åž‹çš„ç±»åŠ è½½å™¨ï¼Œä¸€ç§æ˜¯ç”±C++è¯­è¨€å®žçŽ°çš„å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰ï¼Œå¦ä¸€ç§æ˜¯ç”±javaè¯­è¨€å®žçŽ°çš„ï¼Œç‹¬ç«‹äºŽè™šæ‹Ÿæœºå¤–éƒ¨ï¼Œå¹¶ä¸”å…¨éƒ¨ç»§æ‰¿æŠ½è±¡ç±»java.lang.ClassLoaderçš„ç±»åŠ è½½å™¨ åŒäº²å§”æ´¾æ¨¡åž‹åœ¨å¤§éƒ¨åˆ†å¼€å‘ç¨‹åºä¸­ï¼Œä¸€èˆ¬éƒ½ä¼šä½¿ç”¨ä¸‰ç§ç³»ç»Ÿæä¾›çš„ç±»åŠ è½½å™¨ å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰ï¼šç”±C++è¯­è¨€ç¼–å†™ï¼Œè´Ÿè´£åŠ è½½æ ¸å¿ƒjavaåº“ï¼ˆå­˜å‚¨åœ¨/jre/libï¼‰ æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰:ç”±sun.misc.Launcher$ExtClassLoaderå®žçŽ°ï¼Œè´Ÿè´£åŠ è½½javaæ‰©å±•åº“ï¼ˆå­˜å‚¨åœ¨ï¼‰ åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ˆApplication ClassLoaderï¼‰ï¼šç”±sun.misc.Launcher$AppClassLoaderå®žçŽ°ï¼Œè´Ÿè´£åŠ è½½åº”ç”¨ç¨‹åºçš„javaåº“ï¼ˆå­˜å‚¨åœ¨java.class.pathæˆ–CLASSPATHä¸‹çš„ç±»åº“ï¼‰ é™¤äº†ä»¥ä¸Šä¸‰ä¸ªç”±ç³»ç»Ÿå®žçŽ°çš„ç±»åŠ è½½å™¨ï¼Œè¿˜å¯ä»¥è‡ªå·±å®žçŽ°è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ï¼Œè€Œè¿™äº›ç±»çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¦‚ä¸Šç±»åŠ è½½å™¨çš„å±‚æ¬¡å…³ç³»å›¾ï¼Œå±•ç¤ºç±»åŠ è½½å™¨ä¸Žç±»åŠ è½½å™¨ä¹‹é—´çš„å±‚æ¬¡å…³ç³»ï¼Œè¿™è¢«ç§°ä¸ºåŒäº²å§”æ´¾æ¨¡åž‹ï¼Œæ¯ä¸€å±‚ä¸Šé¢ç›¸å½“äºŽæ˜¯è‡ªå·±çš„çˆ¶ç±»åŠ è½½å™¨ï¼Œä»¥ç»„åˆçš„æ¨¡å¼æ¥å¤ç”¨çˆ¶ç±»åŠ è½½å™¨çš„åŠŸèƒ½åŒäº²å§”æ´¾æ¨¡åž‹çš„å·¥ä½œè¿‡ç¨‹æ˜¯ï¼šå½“ä¸€ä¸ªåŠ è½½å™¨æ”¶åˆ°åŠ è½½è¯·æ±‚æ—¶ï¼Œä»–é¦–å…ˆä¼šè¯¥è¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨åŽ»å®Œæˆï¼Œæœ€ç»ˆä¼ é€’åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½ï¼Œåªæœ‰å½“çˆ¶ç±»åŠ è½½å™¨åŠ è½½ä¸äº†ï¼Œæ‰ä¼šè®©å­åŠ è½½å™¨è‡ªå·±åŽ»å°è¯•åŠ è½½ï¼Œè¿™æ ·çš„è¯ï¼Œå¯ä»¥é˜²æ­¢ä»£ç çš„é‡å¤ï¼Œæ¯”å¦‚Aç±»çš„åŠ è½½å™¨è¦åŠ è½½Systemï¼ŒBç±»åŠ è½½å™¨ä¹Ÿè¦åŠ è½½Systemï¼ŒåŒäº²å§”æ´¾æœºåˆ¶å¯èƒ½åœ¨ç³»ç»Ÿå®žçŽ°çš„ä¸‰ä¸ªç±»åŠ è½½å™¨å°±å¯ä»¥åŠ è½½äº†ã€‚ å‚è€ƒhttps://book.douban.com/subject/24722612/]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[JVMåžƒåœ¾æ”¶é›†]]></title>
      <url>%2F2017%2F02%2F14%2Fjvm_gc%2F</url>
      <content type="text"><![CDATA[ä»…ä¾›å­¦ä¹ äº¤æµ,å¦‚æœ‰é”™è¯¯è¯·æŒ‡å‡º,å¦‚è¦è½¬è½½è¯·åŠ ä¸Šå‡ºå¤„,è°¢è°¢ JVMåžƒåœ¾æ”¶é›†æŠ€æœ¯éœ€è¦å…³æ³¨ä¸‰ä¸ªæ­¥éª¤ï¼š1.å“ªäº›å¯¹è±¡éœ€è¦è¢«å›žæ”¶ï¼Œ2.ä»€ä¹ˆæ—¶å€™è¿›è¡Œå›žæ”¶ï¼Œ3.å¦‚ä½•è¿›è¡Œå›žæ”¶ å“ªäº›å¯¹è±¡éœ€è¦è¢«å›žæ”¶å¼•ç”¨è®¡æ•°ç®—æ³•å¼•ç”¨æŠ€æœ¯ç®—æ³•å¤§è‡´çš„è¿‡ç¨‹æ˜¯ç»™å¯¹è±¡åˆ†é…ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œå½“è¯¥å¯¹è±¡è¢«å¼•ç”¨æ—¶ï¼Œå¼•ç”¨è®¡æ•°å™¨å°±åŠ ä¸€ï¼Œè¯¥å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œè®¡æ•°å™¨å°±å‡ä¸€ï¼Œå½“è®¡æ•°å™¨ä¸ºé›¶æ—¶ï¼Œè¯´æ˜Žè¯¥å¯¹è±¡æ²¡æœ‰ä»»ä½•å¼•ç”¨ï¼Œå°±åˆ¤å®šè¯¥å¯¹è±¡å¯ä»¥è¢«å›žæ”¶ï¼Œè™½ç„¶å®ƒçš„å®žçŽ°ç®€å•å³é«˜æ•ˆï¼Œä¸è¿‡çŽ°ä»£ä¸»æµçš„JVMæ”¶é›†å™¨éƒ½æ²¡æœ‰ä½¿ç”¨è¯¥ç®—æ³•ï¼Œå®ƒæœ‰ä¸€ä¸ªè‡´å‘½çš„ç¼ºé™·æ˜¯æ— æ³•è§£å†³å¯¹è±¡ä¹‹é—´ç›¸äº’å¾ªçŽ¯å¼•ç”¨çš„é—®é¢˜ å¯è¾¾æ€§åˆ†æžç®—æ³•å¯è¾¾æ€§åˆ†æžç®—æ³•å¤§è‡´çš„è¿‡ç¨‹æ˜¯é€šè¿‡ä¸€ç³»åˆ—çš„æˆä¸ºGC Rootsçš„å¯¹è±¡ä½œä¸ºèµ·ç‚¹ï¼Œä»–ä¼šå‘ä¸‹è¿›è¡Œæœç´¢ï¼Œæ‰€èµ°è¿‡çš„è·¯å¾„æˆä¸ºå¼•ç”¨é“¾ï¼Œå¦‚æžœä¸€ä¸ªå¯¹è±¡åˆ°GC Rootsæ²¡æœ‰ä»»ä½•çš„å¼•ç”¨é“¾ï¼ˆæŒ‡è¯¥å¯¹è±¡åœ¨ç¨‹åºä¸­æ²¡æœ‰ä»»ä½•å…³ç³»äº†ï¼‰ï¼Œåˆ™è¯´æ˜Žè¯¥å¯¹è±¡æ˜¯å¯ä»¥è¢«å›žæ”¶çš„åœ¨javaè¯­è¨€ä¸­ï¼Œå¯ä»¥ä½œä¸ºGC Rootsçš„å¯¹è±¡åŒ…æ‹¬å¦‚ä¸‹ï¼š è™šæ‹Ÿæœºæ ˆä¸­çš„æ ˆå¸§å†…çš„æœ¬åœ°å˜é‡è¡¨ä¸­å¼•ç”¨çš„å¯¹è±¡ æ–¹æ³•åŒºä¸­ç±»é™æ€å±žæ€§å¼•ç”¨å’Œå¸¸é‡å¼•ç”¨çš„å¯¹è±¡ æœ¬åœ°æ–¹æ³•æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡ ä»€ä¹ˆæ—¶å€™è¿›è¡Œå›žæ”¶åœ¨çŽ°ä»£çš„å†…å­˜åˆ†é…ä¸­ï¼Œå †è¢«åˆ†ä¸ºå¹´è½»ä»£ï¼ˆ8ï¼š1æ¯”ä¾‹åˆ†é…çš„1ä¸ªEdenåŒºå’Œ2ä¸ªSurvivorï¼ˆFromSurvivor å’Œ ToSurvivorï¼‰ï¼‰å’Œè€å¹´ä»£ï¼Œé‚£ä»€ä¹ˆæ—¶å€™ä¼šå¯¹å¹´è½»ä»£å’Œè€å¹´ä»£çš„å¯¹è±¡è¿›è¡Œå›žæ”¶å‘¢ï¼Ÿ é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼ŒJVMä¼šç»™è¯¥å¯¹è±¡åˆ†é…ä¸€ä¸ªå¯¹è±¡å¹´é¾„è®¡æ•°å™¨ï¼Œè¯¥å¯¹è±¡å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¼šè¢«ä¼˜å…ˆåˆ†é…åˆ°å¹´è½»ä»£ä¸­çš„EdenåŒºä¸­ï¼ˆå¯¹äºŽå¤§å¯¹è±¡ï¼Œç›´æŽ¥åˆ†é…åˆ°è€å¹´ä»£ä¸­ï¼‰ï¼Œå½“EdenåŒºä¸­æ²¡æœ‰è¢«åˆ†é…çš„ç©ºé—´æ—¶ï¼Œè¿™æ—¶å€™JVMä¼šè§¦å‘ä¸€æ¬¡Minor GCï¼ˆå¹´è½»ä»£GCï¼‰ï¼Œè¯¥å¯¹è±¡çš„å¹´é¾„ç½®ä¸º1ï¼Œå­˜æ´»ä¸‹æ¥çš„å¯¹è±¡ä¼šå¾€ToSurvivoråŒºä¸­ç§»åŠ¨ï¼ŒFromSurvivoråŒºä¸­å­˜æ´»çš„å¯¹è±¡ä¹Ÿå¤åˆ¶åˆ°ToSurvivoråŒºä¸­ï¼Œè¿™æ—¶ï¼ŒToSurvivoråŒºå’ŒFromSurvivoråŒºèº«ä»½è°ƒæ¢ï¼Œå½“è¯¥å¯¹è±¡çš„å¹´é¾„å¢žåŠ åˆ°ä¸€å®šç¨‹åº¦ï¼ˆé»˜è®¤æ˜¯15ï¼‰æ—¶ï¼Œè¯¥å¯¹è±¡ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ä¸­ï¼Œå½“ç„¶å¦‚æžœFromSurvivorä¸­çš„ç›¸åŒå¹´é¾„æ®µçš„å¯¹è±¡è¶…è¿‡äº†ä¸€èˆ¬ï¼Œåˆ™å¤§äºŽè¯¥å¹´é¾„æ®µçš„å¯¹è±¡ç›´æŽ¥æ™‹å‡åˆ°è€å¹´ä»£ï¼Œåœ¨è€å¹´ä»£ä¸­å¦‚æžœæœ€å¤§å¯ç”¨çš„è¿žç»­ç©ºé—´å°äºŽæ™‹å‡åˆ°è€å¹´ä»£çš„å¯¹è±¡å¤§å°ï¼Œä¼šè¿›è¡Œä¸€æ¬¡Full GC å¦‚ä½•è¿›è¡Œå›žæ”¶åžƒåœ¾æ”¶é›†ç®—æ³•æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰æ ‡è®°-æ¸…é™¤ç®—æ³•çš„å›žæ”¶è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šæ ‡è®°å’Œæ¸…é™¤ï¼Œæ ‡è®°å°±æ˜¯æ ‡è®°å“ªäº›å¯¹è±¡å¯ä»¥è¢«å›žæ”¶ï¼ˆä¸Šé¢å·²ç»ä»‹ç»è¿‡äº†ï¼‰ï¼Œæ¸…é™¤å°±æ˜¯å›žæ”¶å“ªäº›è¢«æ ‡è®°çš„å¯å›žæ”¶å¯¹è±¡ï¼Œè¿™ä¸¤ä¸ªé˜¶æ®µçš„æ•ˆçŽ‡éƒ½ä¸æ˜¯å¾ˆé«˜ï¼Œè€Œä¸”ä¼šäº§ç”Ÿå¤§é‡çš„ç©ºé—´ç¢Žç‰‡ï¼Œè¿‡ç¨‹å¦‚ä¸‹å›¾ å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰å¤åˆ¶ç®—æ³•çš„å›žæ”¶è¿‡ç¨‹æ˜¯å°†å†…å­˜åˆ†æˆä¸¤å—ç­‰é‡å¤§å°çš„å†…å­˜å—ï¼Œä¸€å—æ˜¯å­˜å‚¨å¯¹è±¡æ•°æ®ï¼Œå¦ä¸€å—æ˜¯ä¿ç•™åŒºåŸŸï¼ˆä¸å­˜å‚¨ä»»ä½•æ•°æ®ï¼‰ï¼Œå½“å­˜å‚¨å¯¹è±¡æ•°æ®çš„å†…å­˜å—ç”¨å®Œäº†ï¼Œå°±å°†è¿˜å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°ä¿ç•™åŒºåŸŸï¼Œç„¶åŽå°†å·²ä½¿ç”¨è¿‡çš„å†…å­˜å—æ¸…ç†æŽ‰ï¼ŒåŽŸæ¥å­˜å‚¨å¯¹è±¡æ•°æ®çš„å†…å­˜å—å˜æˆäº†ä¿ç•™åŒºï¼ŒåŽŸæ¥çš„ä¿ç•™åŒºå˜æˆäº†å­˜å‚¨å¯¹è±¡æ•°æ®çš„å†…å­˜å—ï¼Œå¤åˆ¶è¿‡ç¨‹åªéœ€è¦ç§»åŠ¨å †é¡¶çš„æŒ‡é’ˆå¯ä»¥ï¼Œç®€å•é«˜æ•ˆï¼Œè€Œä¸”æ²¡æœ‰å†…å­˜ç¢Žç‰‡åŒ–çš„å­˜åœ¨ï¼Œä½†æ˜¯å´å°†åŽŸæœ‰çš„å†…å­˜ç¼©å°äº†ä¸€èˆ¬ï¼Œè¿™ä¹Ÿé€‚åˆçŽ°ä»£æ–°ç”Ÿä»£çš„å›žæ”¶æœºåˆ¶ï¼Œå› ä¸ºæ–°ç”Ÿä»£å¤§éƒ¨åˆ†éƒ½æ˜¯æœç”Ÿå¤•æ­»ï¼Œå½“ç„¶ä»–ä»¬çš„å†…å­˜åˆ’åˆ†æ¯”ä¾‹ä¸éœ€è¦åˆ°è¾¾1ï¼š1ï¼Œå…¸åž‹çš„å°±æ˜¯8ï¼š1çš„edenåŒºå’ŒsurvivoråŒºï¼Œå…·ä½“è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š æ ‡è®°-æ•´ç†ç®—æ³•æ ‡è®°-æ•´ç†ç®—æ³•çš„å›žæ”¶è¿‡ç¨‹åˆ†ä¸ºæ ‡è®°å’Œæ•´ç†ä¸¤ä¸ªé˜¶æ®µï¼Œå®ƒæ˜¯æ ‡è®°-æ¸…é™¤ç®—æ³•çš„æ”¹è¿›ç‰ˆæœ¬ï¼Œæ ‡è®°å’Œæ ‡è®°-æ¸…é™¤ç®—æ³•ä¸€è‡´ï¼Œä¸åŒçš„æ˜¯ï¼Œä»–ä¸æ˜¯ç›´æŽ¥å¯¹å¯å›žæ”¶çš„å¯¹è±¡è¿›è¡Œæ¸…é™¤ï¼Œè€Œæ˜¯å°†å­˜æ´»ä¸‹æ¥çš„å¯¹è±¡å¾€ä¸€ç«¯ç§»åŠ¨ï¼Œå†æ¸…ç†æŽ‰å­˜æ´»è¾¹ç•Œå¤–çš„å†…å­˜ï¼Œå®ƒè§£å†³äº†æ ‡è®°-æ¸…é™¤ç®—æ³•çš„å†…å­˜ç¢Žç‰‡åŒ–é—®é¢˜ï¼Œä½†æ˜¯æ•ˆçŽ‡ä¸æ˜¯å¾ˆé«˜ï¼Œå…·ä½“è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š åˆ†ä»£æ”¶é›†ç®—æ³•åˆ†ä»£æ”¶é›†ç®—æ³•æ˜¯æŒ‡æŒ‰ç…§å¯¹è±¡çš„å­˜æ´»å‘¨æœŸï¼Œåœ¨å †ä¸­åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œæ ¹æ®ä¸åŒå¹´ä»£çš„ç‰¹ç‚¹ä½¿ç”¨ä¸åŒæ”¶é›†ç®—æ³•çš„ç»„åˆï¼Œæ¯”å¦‚æ–°ç”Ÿä»£çš„ç‰¹ç‚¹æ˜¯æœç”Ÿå¤•æ­»ï¼Œå¯¹è±¡å­˜æ´»å‘¨æœŸçŸ­ï¼Œä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œåªéœ€è¦å°‘é‡çš„å­˜æ´»å¯¹è±¡çš„å¤åˆ¶æˆæœ¬å³å¯ï¼Œè€Œè€å¹´ä»£å­˜æ´»å‘¨æœŸé•¿ï¼Œä½¿ç”¨æ ‡è®°-æ¸…é™¤æˆ–è€…æ ‡è®°-æ•´ç†ç®—æ³•ï¼Œå› ä¸ºå®ƒä»¬çš„å†…å­˜ä¸å¤§ï¼Œæ²¡æœ‰é¢å¤–çš„ç©ºé—´è¿›è¡Œæ‹…ä¿ï¼Œè¿™æ ·å°±ä¼šå½¢æˆä¸€ä¸ªç»„åˆæ¥è¿›è¡Œåžƒåœ¾æ”¶é›† åžƒåœ¾æ”¶é›†å™¨JVMçš„å‘å±•ä¸­ï¼Œå‘å¸ƒäº†å¾ˆå¤šçš„æ”¶é›†å™¨ï¼Œä»Žæœ€å¼€å§‹çš„å•çº¿ç¨‹ç‰ˆçš„æ”¶é›†å™¨serial(é’ˆå¯¹æ–°ç”Ÿä»£)/serial oldï¼ˆé’ˆå¯¹è€å¹´ä»£ï¼‰æ”¶é›†å™¨ï¼ˆJDK1.3ä»¥å‰ï¼‰åˆ°å¤šçº¿ç¨‹çš„å¹¶è¡Œæ”¶é›†å™¨parallel scavengeï¼ˆé’ˆå¯¹æ–°ç”Ÿä»£ï¼‰/parallel old(é’ˆå¯¹è€å¹´ä»£)æ”¶é›†å™¨ï¼Œä¸€ç›´åˆ°çŽ°åœ¨é’ˆå¯¹å¤šæ ¸ï¼Œå¤šCPUçš„çŽ¯å¢ƒä¸‹ï¼Œå……åˆ†çš„åˆ©ç”¨å…¶ç¡¬ä»¶èµ„æºå’Œé‡è§†å¿«é€Ÿå“åº”çš„CMSæ”¶é›†å™¨ï¼ˆJDK1.5ä»¥åŽï¼‰å’ŒG1æ”¶é›†å™¨ï¼ˆJDK1.7ä»¥åŽï¼‰ CMSæ”¶é›†å™¨cmsï¼ˆConcurrent Mark Sweepï¼‰æ”¶é›†å™¨æ˜¯ä¸€æ¬¾é’ˆå¯¹äºŽæœ€çŸ­å›žæ”¶æ—¶é—´åœé¡¿çš„è€å¹´ä»£æ”¶é›†å™¨ï¼Œä»Žåç§°ä¸Šå°±å¯ä»¥çŸ¥é“è¯¥æ”¶é›†æ˜¯åŸºäºŽæ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Œå®ƒæ˜¯æŠŠæœ€è€—æ—¶é—´çš„æ ‡è®°ï¼ˆGC Root Tracingï¼‰å’Œæ¸…é™¤è¿‡ç¨‹ä½¿ç”¨äº†å¹¶å‘æœºåˆ¶ï¼Œå’Œç”¨æˆ·çº¿ç¨‹å…±åŒè¿è¡Œï¼Œå¤§å¤§çš„å‡å°‘äº†åœé¡¿æ—¶é—´ï¼Œå…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼šè¯¥æ”¶é›†å™¨å¯ä»¥åˆ†ä¸ºäº”ä¸ªæ­¥éª¤ï¼š åˆå§‹æ ‡è®°ï¼šæ ‡è®°GC Rootsæ‰€èƒ½å…³è”çš„å¯¹è±¡ å¹¶å‘æ ‡è®°ï¼šæ ¹æ®ç¬¬ä¸€æ­¥çš„å¯¹è±¡å¹¶å‘çš„éåŽ†å…¶ä»–çš„å¯¹è±¡ï¼ˆGC Roots Tracingï¼‰ é‡æ–°æ ‡è®°ï¼šç”±äºŽç¬¬äºŒæ­¥çš„è¿è¡Œæ—¶é—´è¾ƒé•¿ï¼Œå¯¹è±¡å¯èƒ½ä¼šäº§ç”Ÿå˜åŒ–ï¼Œå¼€å¯å¤šä¸ªçº¿ç¨‹é‡æ–°æ ‡è®°å·²æ ‡è®°çš„å¯¹è±¡ å¹¶å‘æ¸…ç†ï¼šå¹¶å‘çš„ä»Žéœ€è¦è¢«æ”¶é›†çš„å¯¹è±¡é›†åˆä¸­æ¸…é™¤è¿™äº›å¯¹è±¡ å¹¶å‘é‡ç½®ï¼šé‡ç½®CMSæ”¶é›†å™¨çš„æ•°æ®ï¼Œä¸ºä¸‹ä¸€æ¬¡æ”¶é›†åšå‡†å¤‡ ä¸Šè¿°çš„äº”å¤§æ­¥éª¤å°±æ˜¯CMSæ”¶é›†çš„è¿‡ç¨‹ï¼Œæ•´çš„æ¥è¯´å·²ç»å®žçŽ°äº†å¹¶å‘æ”¶é›†ï¼Œä½Žåœé¡¿ï¼Œå“åº”å¿«ç­‰ä¼˜ç‚¹ï¼Œä½†æ˜¯è¿˜æœ‰ä¸‰ä¸ªæ˜Žæ˜¾çš„ç¼ºç‚¹ï¼š ç”±äºŽCMSæ”¶é›†å™¨æ˜¯å¹¶å‘æ”¶é›†ï¼Œå®ƒä¼šå ç”¨å…¶ä»–çº¿ç¨‹çš„CPUèµ„æºï¼Œå¯¼è‡´åžåé‡ä½Žï¼Œéƒ¨åˆ†çº¿ç¨‹å˜æ…¢ CMSæ”¶é›†å™¨æ— æ³•å¤„ç†åœ¨é‡æ–°æ ‡è®°è¿™ä¸ªæ—¶é—´æ®µé‡Œçš„åžƒåœ¾ï¼Œå› ä¸ºåœ¨é‡æ–°æ ‡è®°æœŸé—´ï¼Œç¨‹åºä¼šäº§ç”Ÿæ–°çš„å¯¹è±¡æˆ–è€…å˜åŠ¨ï¼Œè¿™æ˜¯CMSæ”¶é›†å™¨ä¼šé¢„å…ˆé¢„ç•™ä¸€éƒ¨åˆ†å†…å­˜æ¥å¤„ç†ï¼Œæ‰€ä»¥åœ¨ä¸€å®šçš„æ¯”ä¾‹ä¸‹ï¼ˆé»˜è®¤è€å¹´ä»£ç©ºé—´ä½¿ç”¨çŽ‡åˆ°è¾¾68%ï¼‰ï¼Œå°±ä¼šè§¦å‘CMSæ”¶é›† CMSæ”¶é›†å™¨é‡‡ç”¨çš„æ˜¯æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Œæ‰€ä»¥ä¼šäº§ç”Ÿå¤§é‡çš„å†…å­˜ç¢Žç‰‡ G1æ”¶é›†å™¨G1æ”¶é›†å™¨ï¼ˆGarbage-Firstï¼‰æ˜¯ä¸€æ¬¾æœåŠ¡å™¨åž‹çš„åžƒåœ¾æ”¶é›†å™¨ï¼Œå®ƒæ˜¯ç”±ä¸€ä¸ªä¸ªå¤§å°ç›¸ç­‰çš„Regoinï¼ˆå†…å­˜åŒºåŸŸï¼‰ç»„æˆï¼Œé€šè¿‡ä¸€ç³»åˆ—çš„æ ‡è®°é˜¶æ®µä¹‹åŽï¼Œä¹‹åŽä¼˜å…ˆæ”¶é›†é‚£äº›åžƒåœ¾æœ€å¤šçš„åŒºåŸŸï¼Œå®ƒä¹Ÿä¿å­˜äº†ä»¥å¾€çš„åˆ†ä»£æ”¶é›†çš„æ¦‚å¿µï¼Œä½†æ˜¯æ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¸éœ€è¦è®¾å®šå›ºå®šçš„å¤§å°æ¥æŽ§åˆ¶ï¼Œè¿™æ ·åœ¨å†…å­˜çš„ä½¿ç”¨ä¸Šæä¾›äº†å¾ˆå¤§çš„çµæ´»æ€§ï¼Œä¼ ç»Ÿçš„å †åˆ†åŒºå¦‚ä¸‹ï¼šä¸Šè¿°çš„æ˜¯ä¼ ç»Ÿçš„æŠŠå †åˆ†æˆå¹´è½»ä»£ï¼ˆ1ä¸ªedenåŒºå’Œ2ä¸ªsurvivoråŒºï¼‰ï¼Œè€å¹´ä»£ï¼Œå’Œæ°¸ä¹…ä»£ï¼Œåœ¨G1æ”¶é›†å™¨ä¸­ä¹Ÿä¿æŒäº†åˆ†ä»£çš„ç†å¿µï¼Œå¦‚ä¸‹å›¾: å¦‚ä¸Šå›¾æ‰€è¿°ï¼Œä»–æ˜¯ç”¨ä¸€ä¸ªä¸ªå†…å­˜åŒºåŸŸçš„æ¦‚å¿µæ¥å­˜å‚¨åˆ†ä»£å¯¹è±¡ï¼Œå’ŒCMSæ”¶é›†å™¨ä¸åŒçš„æ˜¯å®ƒæ˜¯ç”¨æ ‡è®°-æ•´ä½“ç®—æ³•æ¥è¿›è¡Œæ”¶é›†è¿‡ç¨‹ï¼Œæ•´ä½“çš„è§£å†³äº†å†…å­˜ç¢Žç‰‡çš„é—®é¢˜ å‚è€ƒhttp://zhaoyanblog.com/archives/397.htmlhttps://book.douban.com/subject/24722612/]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[JVMè¿è¡Œæ—¶æ•°æ®åŒºåŸŸ]]></title>
      <url>%2F2017%2F02%2F10%2Fjvm_list_range%2F</url>
      <content type="text"><![CDATA[ä»…ä¾›å­¦ä¹ äº¤æµ,å¦‚æœ‰é”™è¯¯è¯·æŒ‡å‡º,å¦‚è¦è½¬è½½è¯·åŠ ä¸Šå‡ºå¤„,è°¢è°¢ Javaè™šæ‹Ÿæœºï¼ˆè‹±è¯­ï¼šJava Virtual Machineï¼Œç¼©å†™ä¸ºJVMï¼‰ï¼Œä¸€ç§èƒ½å¤Ÿè¿è¡ŒJava bytecodeçš„è™šæ‹Ÿæœºï¼Œä»¥å †æ ˆç»“æž„æœºå™¨æ¥è¿›è¡Œå®žåšã€‚æœ€æ—©ç”±å¤ªé˜³å¾®ç³»ç»Ÿæ‰€ç ”å‘å¹¶å®žçŽ°ç¬¬ä¸€ä¸ªå®žçŽ°ç‰ˆæœ¬ï¼Œæ˜¯Javaå¹³å°çš„ä¸€éƒ¨åˆ†ï¼Œèƒ½å¤Ÿè¿è¡Œä»¥Javaè¯­è¨€å†™ä½œçš„è½¯ä»¶ç¨‹åº(æ¥è‡ªwiki) è¿è¡Œæ—¶æ•°æ®åŒºåŸŸJVMè¿è¡Œæ—¶æ•°æ®åŒºåŸŸç”±javaæ ˆï¼ŒPCå¯„å­˜å™¨ï¼Œæœ¬åœ°æ–¹æ³•æ ˆï¼Œå †å’Œæ–¹æ³•åŒºç­‰äº”å¤§æ•°æ®åŒºåŸŸç»„æˆï¼Œå…¶ç»“æž„å›¾å¦‚ä¸‹ï¼š çº¿ç¨‹ç§æœ‰javaæ ˆjavaæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸä¼šéšç€çº¿ç¨‹çš„åˆ›å»ºè€Œå¼€å§‹ï¼Œæ‘§æ¯è€Œç»“æŸï¼Œå®ƒæè¿°ç€javaæ‰§è¡Œæ–¹æ³•çš„å†…å­˜æ¨¡åž‹ï¼šæ¯ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œæ–¹æ³•æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œè¯¥æ ˆå¸§å­˜å‚¨ç€æ–¹æ³•çš„æ‰€æœ‰ä¿¡æ¯ï¼ˆå±€éƒ¨å˜é‡è¡¨ï¼Œæ“ä½œæ•°æ ˆï¼Œæ ˆæ•°æ®åŒºå’Œæ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ï¼‰ï¼Œä¸€ä¸ªæ–¹æ³•çš„è°ƒç”¨å°±å¥½åƒæ˜¯JVMå¯¹æ ˆå¸§è¿›è¡Œè¿›æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹ï¼Œç”±äºŽå…¶ç”Ÿå‘½å‘¨æœŸå’Œçº¿ç¨‹ä¸€æ ·ï¼Œæ‰€ä»¥ä¸éœ€è¦GC PCå¯„å­˜å™¨PCå¯„å­˜å™¨ä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œæ˜¯ä¸€å—å¾ˆå°çš„å†…å­˜ï¼Œå®ƒæ˜¯å­˜å‚¨JVMå½“å‰æ–¹æ³•æ‰§è¡Œçš„æŒ‡ä»¤åœ°å€ï¼Œå°±åƒæ˜¯æ‰§è¡Œå­—èŠ‚ç çš„æŒ‡ç¤ºå™¨ï¼ŒæŽ§åˆ¶ç€å½“å‰ç¨‹åºçš„æ‰§è¡Œæ–¹å‘ï¼ŒJVMæ‰§è¡Œæ–¹æ³•æ—¶å°±éœ€è¦èŽ·å–è¯¥è®¡æ•°å™¨çš„æŒ‡ä»¤æ¥è¿›è¡Œä¸‹ä¸€æ­¥çš„æ“ä½œ æœ¬åœ°æ–¹æ³•æ ˆæœ¬åœ°æ–¹æ³•æ ˆä¸Žjavaæ ˆç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯javaæ ˆæ‰§è¡Œçš„æ˜¯javaæ–¹æ³•æœåŠ¡ï¼ˆå­—èŠ‚ç ï¼‰ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆæ‰§è¡Œçš„JVMè‡ªå·±å®šä¹‰çš„æœ¬åœ°æ–¹æ³•æœåŠ¡ï¼Œä¹Ÿå°±nativeä¿®é¥°çš„æ–¹æ³• çº¿ç¨‹å…±äº«å †å †æ˜¯çº¿ç¨‹å…±äº«çš„ï¼Œæ‰€ä»¥å®ƒçš„å£°æ˜Žå‘¨æœŸç”±è™šæ‹Ÿæœºåˆ›å»ºæ—¶å¼€å§‹ï¼Œä¸»è¦å­˜æ”¾çš„æ˜¯å¯¹è±¡çš„å®žä¾‹å’Œæ•°ç»„ï¼Œæ˜¯JVMå†…å­˜åˆ†é…æœ€å¤§çš„ï¼Œç”±äºŽå…¶ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿ï¼Œæ‰€ä»¥è¢«åžƒåœ¾å›žæ”¶æ”¶é›†å™¨ç®¡ç†ï¼Œç”±äºŽçŽ°ä»£çš„åžƒåœ¾æ”¶é›†å™¨éƒ½é‡‡ç”¨åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œæ‰€ä»¥è¿˜èƒ½ä»¥8æ¯”1çš„æ¯”ä¾‹ç»†åˆ†æˆä¸€ä¸ªEdenåŒºå’Œä¸¤ä¸ªSurvivoråŒºï¼ˆFromSurvivorå’ŒToSurvivorï¼‰ æ–¹æ³•åŒºæ–¹æ³•åŒºä¹Ÿæ˜¯çº¿ç¨‹å…±äº«çš„ï¼Œå®ƒç”¨äºŽå­˜å‚¨ç±»çš„ä¿¡æ¯ï¼Œå¸¸é‡ï¼Œé™æ€å˜é‡ç­‰ä¿¡æ¯ï¼ˆç±»çš„å…ƒæ•°æ®åœ¨JAVA1.8å·²ç»ç§»åŠ¨åˆ°ä¸€å—æœ¬åœ°å†…å­˜ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯å…ƒç©ºé—´ï¼‰ï¼Œè¿˜æœ‰è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºå¾ˆé‡è¦çš„éƒ¨åˆ†ï¼Œå­˜æ”¾ç¼–è¯‘å™¨ç¼–è¯‘æœŸé—´å„ç§classä¸­çš„å¸¸é‡å€¼å’Œç±»çš„æè¿°ä¿¡æ¯ã€‚ å¯¹è±¡åœ¨å†…å­˜åŒºåŸŸæ˜¯å¦‚ä½•è¿è¡Œå¯¹è±¡åœ¨å†…å­˜ä¸­æ˜¯å¦‚æžœåˆ›å»ºæˆ‘ä»¬åœ¨ä»£ç ä¸­ç›´æŽ¥ç”¨newæ¥è¡¨ç¤ºåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œè€Œåœ¨è™šæ‹Ÿæœºä¸­ï¼Œä¼šç¢°åˆ°ä¸€ä¸ªnewæŒ‡ä»¤ï¼Œé¦–å…ˆä¼šæ£€æŸ¥æŒ‡ä»¤çš„å‚æ•°åœ¨å¸¸é‡æ± ä¸­æ˜¯å¦æœ‰è¿™ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ï¼Œå†æ£€æŸ¥æ­¤ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½ï¼Œè§£æžå’Œåˆå§‹åŒ–è¿‡äº†ï¼Œå¦‚æžœæ²¡æœ‰å°±ä¼šæ‰§è¡Œç›¸åº”çš„åŠ è½½è¿‡ç¨‹ï¼Œç„¶åŽå°±ä¼šåœ¨å †ä¸­ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ï¼Œåˆ†é…å†…å­˜æœ‰ä¸¤ç§æ–¹å¼ï¼š æŒ‡é’ˆç¢°æ’žï¼šå¦‚æžœGCä½¿ç”¨çš„æ˜¯å¤åˆ¶ç®—æ³•ï¼ŒæŠŠå †å†…å­˜ä¸€åˆ†ä¸ºäºŒï¼Œä¸€è¾¹æ˜¯å·²åˆ†é…å†…å­˜ï¼Œä¸€è¾¹æ˜¯ç©ºé—²å†…å­˜ï¼Œæ²¡æœ‰å†…å­˜ç¢Žç‰‡ï¼Œé‚£ä¹ˆåªéœ€ä»Žä¸­é—´å¼€å§‹ï¼ŒæŒ‡é’ˆå¾€ç©ºé—²å†…å­˜ç©ºé—´ç§»åŠ¨ç›¸åº”å¤§å°çš„è·ç¦»å³å¯ ç©ºé—²åˆ—è¡¨ï¼šå¦‚æžœGCæ˜¯æ²¡æœ‰ä½¿ç”¨æ ‡è®°-æ•´ä½“çš„ç®—æ³•ï¼Œå­˜åœ¨å†…å­˜ç¢Žç‰‡ï¼Œè¿™æ—¶å€™ä¼šç»´æŠ¤ä¸€ç§è®°å½•å¯ç”¨å†…å­˜çš„è¡¨ï¼Œå†ä»Žè¡¨ä¸­å¯»æ‰¾ä¸€å—è¶³å¤Ÿå¤§å°çš„å†…å­˜ç©ºé—´åˆ†é…ç»™å¯¹è±¡å®žä¾‹ã€‚ ç”±äºŽå †æ˜¯çº¿ç¨‹å…±äº«çš„ï¼Œåœ¨åˆ†é…å†…å­˜æ—¶å­˜åœ¨ç€çº¿ç¨‹å®‰å…¨ï¼Œæ¯”å¦‚T1çº¿ç¨‹å‡†å¤‡åœ¨è¡¨ä¸­é€‰å–Aå†…å­˜åˆ†é…ï¼Œè¿˜æ²¡æœ‰å¼€å§‹åˆ†é…ï¼Œè¿™æ—¶T2çº¿ç¨‹ä¹Ÿå‡†å¤‡åœ¨è¡¨ä¸­é€‰å–Aå†…å­˜åˆ†é…ï¼Œè¿™å°±ä¼šé€ æˆå†²çªï¼Œè§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜æœ‰ä¸‹é¢ä¸¤ä¸ªæ–¹æ¡ˆï¼š CASåŒæ­¥ï¼Œåœ¨åˆ†é…æ“ä½œä¸Šä½¿ç”¨CASæ“ä½œä¿è¯åˆ†é…å†…å­˜çš„åŽŸå­æ€§ æ¯ä¸ªçº¿ç¨‹åœ¨å †ä¸Šé¢„å…ˆåˆ†é…è‡ªå·±çš„ä¸€å°å—å†…å­˜ï¼ˆæœ¬åœ°çº¿ç¨‹åˆ†é…ç¼“å†² TLABï¼‰ï¼Œåªéœ€è¦åœ¨è¯¥å†…å­˜ç”¨å®Œäº†ï¼Œå†åŒæ­¥åˆ†é…æ–°çš„TLAB å¯¹è±¡åœ¨å†…å­˜ä¸­çš„ç»“æž„ç»„æˆå¯¹è±¡å­˜å‚¨åœ¨å†…å­˜ä¸­åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼šå¯¹è±¡å¤´ï¼Œå®žä¾‹æ•°æ®ï¼Œå¯¹é½å¡«å…… å¯¹è±¡å¤´å¯¹è±¡å¤´åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯å­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼ˆå“ˆå¸Œç ï¼ŒGCåˆ†ä»£å¹´é¾„ï¼Œé”æ ‡å¿—ç­‰ï¼‰ï¼Œä¹Ÿå«Mark Wordï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯ç±»åž‹æŒ‡é’ˆï¼Œä¹Ÿå«å…ƒæ•°æ®æŒ‡é’ˆï¼Œæ¥ç¡®å®šè¯¥å¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®žä¾‹ å®žä¾‹æ•°æ®å®žä¾‹æ•°æ®å­˜å‚¨çš„æ˜¯è¯¥å¯¹è±¡å†…éƒ¨æ‰€å®šä¹‰çš„ç±»åž‹çš„å­—æ®µä¿¡æ¯ï¼ŒåŒ…æ‹¬ä»Žçˆ¶ç±»ç»§æ‰¿ä¸‹æ¥çš„ï¼Œè¿˜æ˜¯åœ¨å­ç±»å®šä¹‰çš„ å¯¹é½å¡«å……è¿™æ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼ŒJVMè§„å®šå¯¹è±¡çš„å¤§å°ä¸º8å­—èŠ‚çš„æ•´æ•°å€ï¼Œå¦‚æžœä¸æ˜¯å°±ç”¨å¯¹é½å¡«å……æ¥è¡¥å…¨ å¯¹è±¡åœ¨å†…å­˜ä¸­å¦‚ä½•è¢«è®¿é—®åœ¨å†…å­˜ä¸­è®¿é—®å¯¹è±¡æœ‰ä¸¤ç§æ–¹å¼ï¼šå¥æŸ„æ± å’Œç›´æŽ¥å¼•ç”¨ å¥æŸ„æ± å¥æŸ„æ± è®¿é—®æ˜¯æŒ‡åœ¨æ ˆä¸­çš„referenceå¼•ç”¨æŒ‡å‘çš„æ˜¯å¥æŸ„æ± ä¸Šçš„åœ°å€ï¼Œå†ç”±å¥æŸ„æ± æŒ‡å‘ç›¸åº”çš„å¯¹è±¡ä¿¡æ¯ï¼Œå¥æŸ„æ± çš„å†…å®¹åŒ…æ‹¬å¯¹è±¡å®žä¾‹æ•°æ®çš„æŒ‡é’ˆå’Œå¯¹è±¡ç±»åž‹æ•°æ®çš„æŒ‡é’ˆï¼Œåœ¨javaå †åˆ’åˆ†ä¸€å°å—å†…å­˜æ¥å­˜å‚¨å®ƒï¼Œå…·ä½“è®¿é—®è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š ç›´æŽ¥å¼•ç”¨ç›´æŽ¥å¼•ç”¨è®¿é—®æ˜¯æŒ‡æ ˆä¸­çš„referenceå¼•ç”¨ç›´æŽ¥æŒ‡å‘å †ä¸­å¯¹è±¡å®žä¾‹çš„åœ°å€ï¼Œè®¿é—®è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼šä»¥ä¸Šä¸¤ç§è®¿é—®æ–¹å¼å„æœ‰ä¼˜åŠ£ï¼Œå¥æŸ„æ± åœ¨å¯¹è±¡å®žä¾‹é¢‘ç¹çš„æ›´æ›¿æ—¶ï¼Œä¸éœ€è¦æ”¹åŠ¨referenceä¸­çš„æŒ‡é’ˆï¼Œåªéœ€æ”¹å˜å¥æŸ„æ± çš„æŒ‡é’ˆå³å¯ï¼Œä½†æ˜¯ç›´æŽ¥å¼•ç”¨çš„è®¿é—®é€Ÿåº¦æ¯”å¥æŸ„æ± æ›´å¿«ï¼ŒçœåŽ»äº†å¥æŸ„æ± çš„æŒ‡é’ˆæŒ‡å‘å¯¹è±¡å®žä¾‹çš„æ¶ˆè€—ï¼Œæ€»ç»“å‡ºæ¥å°±æ˜¯ï¼Œå¯¹è±¡æ›´æ›¿é¢‘ç¹çš„ä½¿ç”¨å¥æŸ„æ± ï¼Œå¯¹è±¡è®¿é—®é¢‘ç¹çš„ä½¿ç”¨ç›´æŽ¥å¼•ç”¨ å‚è€ƒhttps://book.douban.com/subject/24722612/]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[redisæŒä¹…åŒ–ç­–ç•¥]]></title>
      <url>%2F2017%2F01%2F17%2Fredis_data_persistence%2F</url>
      <content type="text"><![CDATA[ä»…ä¾›å­¦ä¹ äº¤æµ,å¦‚æœ‰é”™è¯¯è¯·æŒ‡å‡º,å¦‚è¦è½¬è½½è¯·åŠ ä¸Šå‡ºå¤„,è°¢è°¢ Redisæä¾›äº†ä¸¤ç§ä¸åŒçº§åˆ«çš„æŒä¹…åŒ–ç­–ç•¥ï¼ŒRDBï¼ˆredis databaseï¼‰æŒä¹…åŒ–å’ŒAOF(append only file)æŒä¹…åŒ–ï¼Œå®ƒä»¬åº”ç”¨åœ¨ä¸åŒçš„åœºæ™¯ä¸­ï¼Œå„æœ‰åƒç§‹ï¼Œä»¥ä¸‹æ˜¯ä¸¤ç§ç­–ç•¥çš„å®žçŽ°æ–¹æ¡ˆ RDBï¼ˆredis databaseï¼‰æŒä¹…åŒ–RDBï¼ˆredis databaseï¼‰æŒä¹…åŒ–æ˜¯å°†å†…å­˜ä¸­çš„æ•°æ®ç”Ÿæˆä¸€ä¸ªç‰¹å®šæ ¼å¼çš„äºŒè¿›åˆ¶çš„rdbæ–‡ä»¶ï¼Œä¿å­˜åœ¨ç£ç›˜ä¸­ï¼Œåœ¨redisæœåŠ¡è¿›ç¨‹å¼€å¯æ—¶é€šè¿‡è¯»å–ç£ç›˜ä¸­çš„rdbæ–‡ä»¶ï¼Œæ•°æ®åˆä¼šè¿˜åŽŸåˆ°å†…å­˜ä¸­ã€‚rdbæ–‡ä»¶ç»“æž„å¦‚ä¸‹ï¼š å†™å…¥æŒ‡ä»¤å†™å…¥ï¼ˆ1ï¼‰SAVEï¼šSAVEå‘½ä»¤æ˜¯åœ¨å½“å‰æœåŠ¡è¿›ç¨‹è¿›è¡ŒæŒä¹…åŒ–æ“ä½œï¼Œä¼šé˜»å¡žå…¶ä»–çš„æ“ä½œå‘½ä»¤ï¼Œç›´åˆ°RDBæ–‡ä»¶åˆ›å»ºå®Œæ¯•ï¼ˆ2ï¼‰BGSAVEï¼šBGSAVEå‘½ä»¤æ˜¯åˆ›å»ºä¸€ä¸ªå­æœåŠ¡è¿›ç¨‹æ¥ä¸“é—¨å¤„ç†æŒä¹…åŒ–æ“ä½œï¼Œå…¶å®ƒæ“ä½œå‘½ä»¤åœ¨çˆ¶æœåŠ¡è¿›ç¨‹ç»§ç»­æ‰§è¡Œ é—´éš”æ€§å†™å…¥åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®å†™å…¥è§¦å‘æ¡ä»¶,æ¯”å¦‚:SAVE 900 1,ä»£è¡¨åœ¨900ç§’å†…å¯¹æ•°æ®åº“è¿›è¡Œä¸€æ¬¡ä¿®æ”¹ï¼Œå°±è§¦å‘å†™å…¥ç¨‹åºã€‚ è½½å…¥åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œä¼šå¯¹å½“å‰çš„æŒä¹…åŒ–ç­–ç•¥è¿›è¡Œä¸€ä¸ªåˆ¤æ–­ï¼Œå¦‚æžœå½“å‰å·²ç»å¼€å¯äº†AOFæŒä¹…åŒ–åŠŸèƒ½ï¼Œé‚£å°±ä¼šä¼˜å…ˆè½½å…¥AOFè¿˜åŽŸç¨‹åºï¼Œå¦åˆ™æ‰è½½å…¥RDBæ–‡ä»¶ï¼Œæ•´ä¸ªè½½å…¥è¿‡ç¨‹éƒ½æ˜¯é˜»å¡žçš„ï¼Œä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ã€‚ AOF(append only file)æŒä¹…åŒ–AOF(append only file)æŒä¹…åŒ–æ˜¯åŸºäºŽredisæœåŠ¡å™¨å¯¹é”®å€¼å¯¹çš„æ“ä½œå‘½ä»¤ç”Ÿæˆçš„aofæ–‡ä»¶ï¼Œä¿å­˜åœ¨ç£ç›˜ä¸­,AOFæ–‡ä»¶çš„ç»“æž„å°±æ˜¯ä¸€ä¸²æ“ä½œå‘½ä»¤çš„æ–‡æœ¬æ–‡ä»¶ å†™å…¥AOFæŒä¹…åŒ–é€šè¿‡ä»¥ä¸‹æ­¥éª¤æ¥è¿›è¡ŒæŒä¹…åŒ–æ“ä½œï¼š 1. å‘½ä»¤è¿½åŠ ï¼ˆappendï¼‰åœ¨redisæœåŠ¡å™¨ä¸­æä¾›äº†ä¸€ä¸ªsdsï¼ˆç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼‰ç±»åž‹çš„ç¼“å†²åŒºaof_buff,å®ƒç”¨äºŽè®°å½•redisçš„æ“ä½œå‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯åˆ©ç”¨å‘½ä»¤è¿½åŠ ï¼ˆappendï¼‰æ¨¡å¼å°†redisçš„æ“ä½œå‘½ä»¤ä¸€æ¡ä¸€æ¡çš„è¿½åŠ åˆ°è¯¥ç¼“å†²åŒºçš„æœ«å°¾ 2. å†™å…¥AOFæ–‡ä»¶å°†å­˜å‚¨åˆ°ç¼“å†²åŒºaof_buffä¸­çš„æŒ‡ä»¤é€šè¿‡è°ƒç”¨flushAppendOnlyFileå‡½æ•°å†™å…¥AOFæ–‡ä»¶ä¸­ï¼Œå†™å…¥AOFæ–‡ä»¶æœ‰ä¸‰ä¸ªç­–ç•¥ï¼š â— alwaysï¼šæ¯ä¸€æ¬¡æ•°æ®æ“ä½œï¼Œå°±å°†aof_buffç¼“å†²åŒºä¸­çš„æ‰€æœ‰æ•°æ®åŒæ­¥å†™å…¥åˆ°AOFæ–‡ä»¶ä¸­ â— everysecï¼šå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œå®šæ—¶ï¼ˆæ¯éš”ä¸€ç§’ï¼‰å°†aof_buffç¼“å†²åŒºä¸­çš„æ‰€æœ‰æ•°æ®åŒæ­¥å†™å…¥AOFæ–‡ä»¶ä¸­ â— noï¼šä¸è¦æ±‚åŒæ­¥çš„æƒ…å†µä¸‹ï¼ˆaof_buffå­˜å‚¨æ»¡æº¢ï¼‰ï¼Œå°†aof_buffç¼“å†²åŒºä¸­çš„æ•°æ®å†™å…¥AOFæ–‡ä»¶ä¸­ä¸‰ä¸ªç­–ç•¥çš„å®‰å…¨æ€§ï¼šalways&gt;everysec&gt;no , æ•ˆçŽ‡ï¼šno&gt;everysec&gt;always è½½å…¥AOFæŒä¹…åŒ–çš„è½½å…¥æ–¹å¼æ˜¯åˆ›å»ºä¸€ä¸ªä¼ªå®¢æˆ·ç«¯åŽ»è¯»å–AOFæ–‡ä»¶ï¼Œå†åœ¨ä¼ªå®¢æˆ·ç«¯ä¸­æ‰§è¡Œè¯»å–AOFæ–‡ä»¶ä¸­çš„ä¸€æ¡æ¡æŒ‡ä»¤ï¼Œç›´åˆ°å®Œæ¯•ï¼Œæ•°æ®åº“å°±æ¢å¤äº†ä¹‹å‰çš„çŠ¶æ€ é‡å†™AOFæ–‡ä»¶å°±åƒæ˜¯æ•°æ®åº“æ“ä½œçš„æ—¥å¿—æ–‡ä»¶ï¼Œè®°å½•äº†æ•°æ®åº“å„ç§æ“ä½œçš„æŒ‡ä»¤ï¼Œä½†æ˜¯ä¼šå‡ºçŽ°å†—ä½™çš„æŒ‡ä»¤è®°å½•ï¼Œé•¿æ—¶é—´ä¸‹åŽ»ï¼Œä¼šå¯¼è‡´æ–‡ä»¶ä½“ç§¯å˜å¾—å¤ªå¤§ï¼Œæ¯”å¦‚ï¼Œæ‰§è¡Œå¦‚ä¸‹æ“ä½œ1234RPUSH msg &apos;a&apos;RPUSH msg &apos;b&apos;RPUSH msg &apos;c&apos;RPUSH msg &apos;d&apos; å¦‚ä¸Šæ‰€ç¤ºï¼Œæœ€åŽmsgçš„ç»“æžœæ˜¯â€™aâ€™,â€™bâ€™,â€™câ€™,â€™dâ€™ï¼ŒAOFæ–‡ä»¶å°±ä¼šæœ‰å››æ¡æŒ‡ä»¤çš„è®°å½•ï¼Œå…¶å®žåªè¦ä¸€æ¡æŒ‡ä»¤è®°å½•å°±å¯ä»¥äº†ï¼Œè¿™æ—¶ï¼ŒAOFæŒä¹…åŒ–æä¾›äº†ä¸€ç§é‡å†™çš„æœºåˆ¶ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹æ¥å¤„ç†ï¼Œåœ¨å­è¿›ç¨‹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„AOFæ–‡ä»¶ï¼Œé’ˆå¯¹ä¸Šé¢æƒ…å†µï¼Œå¯¹ä¸€ä¸ªå¯¹è±¡çš„å¤šæ¬¡æ“ä½œï¼Œå®ƒä¼šç”¨ä¸€æ¡æŒ‡ä»¤æ¥è¡¨ç¤ºï¼Œè¿™æ ·æ–°çš„AOFæ–‡ä»¶å°±å¤§å¤§å‡å°‘äº†å­˜å‚¨ä½“ç§¯ï¼Œç”±äºŽåœ¨å­è¿›ç¨‹è¿›è¡Œé‡å†™çš„æ—¶å€™ï¼Œçˆ¶è¿›ç¨‹è¿˜ä¼šå¤„ç†æ“ä½œæŒ‡ä»¤ï¼Œåœ¨é‡å†™æœŸé—´æ‰§è¡Œçš„æ“ä½œæŒ‡ä»¤ä¼šè¢«å†™åˆ°ä¸€ä¸ªaofé‡å†™ç¼“å†²åŒºä¸­ï¼Œæ‰€ä»¥ä¸ä»…ä»…æ˜¯aofç¼“å†²åŒºå†™å…¥æ–°çš„AOFæ–‡ä»¶ä¸­ï¼Œaofé‡å†™ç¼“å†²åŒºä¹Ÿä¼šå†™è¿›æ–°çš„AOFæ–‡ä»¶ä¸­ï¼Œè¿™æ ·å’Œæ—§çš„AOFæ–‡ä»¶ä¿å­˜çš„æ•°æ®åº“çŠ¶æ€æ˜¯ä¸€è‡´çš„ï¼Œæœ€åŽæ›¿æ¢æ—§çš„AOFæ–‡ä»¶ æ€è€ƒä¼˜åŠ£æ¯”è¾ƒRDBæŒä¹…åŒ–çš„ä¼˜ç‚¹åœ¨äºŽï¼šï¼ˆ1ï¼‰RDBæ–‡ä»¶æ˜¯ä¸€ä¸ªéžå¸¸ç´§å‡‘çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ‰€ä»¥åœ¨è¿œç¨‹ä¼ è¾“ä¸Šæœ‰å¾ˆå¤§çš„ä¼˜åŠ¿ï¼Œå¯ç”¨äºŽç¾å¤‡ä¸­å¿ƒçš„å­˜å‚¨æ–‡ä»¶ï¼ˆ2ï¼‰åœ¨è½½å…¥æ•°æ®åº“ä¸Šï¼Œå¤§æ•°æ®é‡çš„æƒ…å†µä¸‹ï¼ŒRDBæ¯”AOFæ›´åŠ å¿«é€Ÿï¼ˆ3ï¼‰åœ¨æŒä¹…åŒ–ä¸Šï¼ŒRDBæŒä¹…åŒ–æ–¹å¼ä¼šforkä¸€ä¸ªå­è¿›ç¨‹æ¥æ‰§è¡Œï¼Œè¿™æ ·ä¼šä¿è¯Redisæœ€å¤§çš„æ€§èƒ½ç¼ºç‚¹å¦‚ä¸‹ï¼šï¼ˆ1ï¼‰Redisçš„æ•°æ®å­˜å‚¨æ˜¯åŸºäºŽå†…å­˜çš„ï¼Œå¦‚æžœç¢°ä¸Šæ„å¤–ï¼ˆå®•æœºæˆ–è€…ç”µæºä¸­æ–­ï¼‰ï¼Œå¦‚æžœä½ æ˜¯æ¯ä¸ªäº”åˆ†é’Ÿç”šè‡³æ›´é•¿è¿›è¡Œä¸€æ¬¡æŒä¹…åŒ–ï¼Œé‚£ä¹ˆå°†ä¼šæŸå¤±è¿™å‡ åˆ†é’Ÿçš„æ•°æ®ï¼ˆ2ï¼‰RDBæ˜¯forkå­è¿›ç¨‹æ¥è¿›è¡ŒæŒä¹…åŒ–çš„ï¼Œæ‰€ä»¥å½“å¤§æ•°æ®é›†çš„æ—¶å€™ï¼Œè¿™ä¼šåŠ å¤§cpuçš„å“åº”æ—¶é—´ï¼Œå½±å“Redisçš„å¤„ç†é€Ÿåº¦AOFæŒä¹…åŒ–çš„ä¼˜ç‚¹åœ¨äºŽï¼šï¼ˆ1ï¼‰AOFä½¿ç”¨çš„æ˜¯fsyncç­–ç•¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œæ‰€ä»¥å³ä½¿ç¢°ä¸Šæ„å¤–ï¼Œä¹Ÿåªæ˜¯æŸå¤±1ç§’çš„æ•°æ®ï¼ˆ2ï¼‰AOFæ–‡ä»¶æ˜¯ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œç”±æŒ‡ä»¤é›†ç»„æˆï¼Œé€šä¿—æ˜“æ‡‚ï¼Œä½¿ä½¿ç”¨è€…æ›´åŠ çš„å¥½ç»´æŠ¤ç¼ºç‚¹å¦‚ä¸‹ï¼šï¼ˆ1ï¼‰ç›¸å¯¹äºŽRDBæ–‡ä»¶æ¥è¯´ï¼ŒAOFæ–‡ä»¶ç›¸å¯¹è¿‡å¤§äº† å¦‚ä½•é€‰æ‹©ä½¿ç”¨å“ªç§æŒä¹…åŒ–æ–¹å¼ä¸€èˆ¬æ¥è¯´ï¼Œ å¦‚æžœæƒ³è¾¾åˆ°è¶³ä»¥åª²ç¾Ž PostgreSQL çš„æ•°æ®å®‰å…¨æ€§ï¼Œ ä½ åº”è¯¥åŒæ—¶ä½¿ç”¨ä¸¤ç§æŒä¹…åŒ–åŠŸèƒ½ã€‚å¦‚æžœä½ éžå¸¸å…³å¿ƒä½ çš„æ•°æ®ï¼Œ ä½†ä»ç„¶å¯ä»¥æ‰¿å—æ•°åˆ†é’Ÿä»¥å†…çš„æ•°æ®ä¸¢å¤±ï¼Œ é‚£ä¹ˆä½ å¯ä»¥åªä½¿ç”¨ RDB æŒä¹…åŒ–ã€‚æœ‰å¾ˆå¤šç”¨æˆ·éƒ½åªä½¿ç”¨ AOF æŒä¹…åŒ–ï¼Œ ä½†æˆ‘ä»¬å¹¶ä¸æŽ¨èè¿™ç§æ–¹å¼ï¼š å› ä¸ºå®šæ—¶ç”Ÿæˆ RDB å¿«ç…§ï¼ˆsnapshotï¼‰éžå¸¸ä¾¿äºŽè¿›è¡Œæ•°æ®åº“å¤‡ä»½ï¼Œ å¹¶ä¸” RDB æ¢å¤æ•°æ®é›†çš„é€Ÿåº¦ä¹Ÿè¦æ¯” AOF æ¢å¤çš„é€Ÿåº¦è¦å¿«ï¼Œ é™¤æ­¤ä¹‹å¤–ï¼Œ ä½¿ç”¨ RDB è¿˜å¯ä»¥é¿å…ä¹‹å‰æåˆ°çš„ AOF ç¨‹åºçš„ bug å‚è€ƒhttp://www.redis.cn/topics/persistence.htmlhttps://read.douban.com/ebook/7519526/ï¼ˆæ•°æ®åº“çš„è®¾è®¡ä¸Žå®žçŽ°ï¼‰]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[redisåŸºæœ¬æ•°æ®ç±»åž‹åŠå…¶å®žçŽ°]]></title>
      <url>%2F2016%2F12%2F28%2Fredis_datatype%2F</url>
      <content type="text"><![CDATA[ä»…ä¾›å­¦ä¹ äº¤æµ,å¦‚æœ‰é”™è¯¯è¯·æŒ‡å‡º,å¦‚è¦è½¬è½½è¯·åŠ ä¸Šå‡ºå¤„,è°¢è°¢ Redisæ˜¯ä¸€ä¸ªä½¿ç”¨ANSI Cç¼–å†™çš„å¼€æºã€æ”¯æŒç½‘ç»œã€åŸºäºŽå†…å­˜ã€å¯é€‰æŒä¹…æ€§çš„é”®å€¼å¯¹å­˜å‚¨æ•°æ®åº“(æ¥è‡ªwiki)ï¼Œå®ƒæä¾›ä¸°å¯Œçš„æ•°æ®ç»“æž„ç±»åž‹ï¼šå­—ç¬¦ä¸²ï¼ˆStringsï¼‰ï¼Œåˆ—è¡¨ï¼ˆListsï¼‰ï¼Œå“ˆå¸Œï¼ˆHashedï¼‰ï¼Œé›†åˆï¼ˆSetsï¼‰ï¼Œæœ‰åºé›†åˆï¼ˆSorted setsï¼‰æ¥æ»¡è¶³æ•°æ®å­˜å‚¨çš„éœ€æ±‚ï¼Œä¸‹é¢åˆ†åˆ«å¯¹è¿™äº”å¤§æ•°æ®ç±»åž‹åŠå…¶å®žçŽ°è¿›è¡Œè¯¦è¿° å­—ç¬¦ä¸²ï¼ˆStringï¼‰å®žçŽ°çš„æ•°æ®ç»“æž„1. REDIS_ENCODING_INTï¼ˆlongç±»åž‹æ•´æ•°ï¼‰åœºæ™¯ï¼šSETçš„valueä¸ºæ•´æ•°æŒ‡ä»¤ï¼šSET msg 123 2. REDIS_ENCODING_RAWï¼ˆå¤§äºŽ32å­—èŠ‚çš„å­—ç¬¦ä¸²ï¼‰åœºæ™¯ï¼šSETçš„valueä¸ºå¤§äºŽ32å­—èŠ‚çš„å­—ç¬¦ä¸²æŒ‡ä»¤ï¼šSET msg LongString...... æ³¨æ„ï¼šSDSæ˜¯rediså†…éƒ¨æž„å»ºåŸºäºŽå­—ç¬¦ä¸²çš„æ•°æ®ç»“æž„ï¼ˆä¸æ˜¯ç›´æŽ¥ä½¿ç”¨Cå­—ç¬¦ä¸²ï¼‰ï¼Œå®ƒç”±freeï¼ˆæœªåˆ†é…ç©ºé—´ï¼‰ï¼Œlenï¼ˆå­—ç¬¦ä¸²é•¿åº¦æˆ–å·²ä½¿ç”¨é•¿åº¦ï¼‰ï¼Œbufï¼ˆå­˜å‚¨å­—ç¬¦æ•°ç»„ï¼‰ä¸‰éƒ¨åˆ†ç»„æˆï¼Œé™ä½Žæ“ä½œå­—ç¬¦ä¸²çš„å¤æ‚åº¦ï¼Œlenå±žæ€§è§£å†³äº†ä¸éœ€è¦éåŽ†æ•´ä¸ªå­—ç¬¦ä¸²æ‰èƒ½èŽ·å–ï¼Œfreeå±žæ€§é™ä½Žäº†å†…å­˜é‡æ–°åˆ†é…çš„æ¬¡æ•° 3. REDIS_ENCODING_EMBSTRï¼ˆå°äºŽ32å­—èŠ‚çš„å­—ç¬¦ä¸²ï¼‰åœºæ™¯ï¼šSETçš„valueä¸ºå°äºŽ32å­—èŠ‚çš„å­—ç¬¦ä¸²æŒ‡ä»¤ï¼šSET msg hello æ³¨æ„ï¼šå¯¹äºŽå­—ç¬¦ä¸²å­˜å‚¨ï¼Œå¯¹äºŽrawç¼–ç æ¨¡å¼ï¼Œéœ€è¦è°ƒç”¨ä¸¤æ¬¡è¿žç»­åˆ†é…å†…å­˜å‡½æ•°æž„å»ºRedisObjectå’ŒSDSè¿™ä¸¤å—å†…å­˜ï¼Œè€Œembstrçš„ç¼–ç åªéœ€è¦ä¸€æ¬¡æ€§çš„å†…å­˜åˆ†é…ä¸€å—è¿žç»­çš„å†…å­˜ç©ºé—´å³å¯ï¼Œ åˆ—è¡¨ï¼ˆListsï¼‰å®žçŽ°çš„æ•°æ®ç»“æž„1. REDIS_ENCODING_ZIPLISTï¼ˆåŽ‹ç¼©åˆ—è¡¨ï¼‰åœºæ™¯ï¼šï¼ˆ1ï¼‰åˆ—è¡¨ä¿å­˜çš„å…ƒç´ éƒ½å°‘äºŽ64ä¸ªå­—èŠ‚ ï¼ˆ2ï¼‰åˆ—è¡¨ä¿å­˜çš„å…ƒç´ æ•°é‡å°‘äºŽ512ä¸ªæŒ‡ä»¤ï¼šRPUSH msg &#39;a&#39; &#39;b&#39; &#39;c&#39;æ³¨æ„ï¼šZipListæ˜¯redisåŸºäºŽå°æ•°å€¼å’ŒçŸ­å­—ç¬¦ä¸²è€Œæž„å»ºçš„æ•°æ®ç»“æž„ï¼Œç”±zlbytesï¼ˆåŽ‹ç¼©åˆ—è¡¨å ç”¨çš„å­—èŠ‚æ•°ï¼‰ï¼Œzltailï¼ˆåŽ‹ç¼©åˆ—è¡¨å°¾èŠ‚ç‚¹åˆ°èµ·å§‹åœ°å€çš„åç§»é‡ï¼‰ï¼Œzllenï¼ˆèŠ‚ç‚¹æ•°ï¼‰ï¼Œentryxï¼ˆåŽ‹ç¼©åˆ—è¡¨çš„å„ä¸ªèŠ‚ç‚¹ï¼‰ï¼Œzlendï¼ˆåŽ‹ç¼©åˆ—è¡¨çš„å°¾ç«¯æ ‡è®°å€¼ï¼‰ 2. REDIS_ENCODING_LINKEDLISTï¼ˆé“¾è¡¨ï¼‰åœºæ™¯ï¼šï¼ˆ1ï¼‰åˆ—è¡¨ä¿å­˜çš„å…ƒç´ éƒ½å¤§äºŽ64ä¸ªå­—èŠ‚ ï¼ˆ2ï¼‰åˆ—è¡¨ä¿å­˜çš„å…ƒç´ æ•°é‡å¤§äºŽ512ä¸ªæŒ‡ä»¤ï¼šRPUSH msg &#39;a&#39; &#39;b&#39; &#39;c&#39; ......æ³¨æ„ï¼šLinkedListæ˜¯ç±»ä¼¼äºŽjavaä¸­çš„LinkedListï¼Œç”±ä¸€ä¸ªåŒå‘é“¾è¡¨æž„æˆï¼Œè‡ªå¸¦é•¿åº¦è®¡æ•°å™¨å’Œè¡¨å¤´è¡¨å°¾æŒ‡é’ˆï¼Œåœ¨å¯¹äºŽå¢žåŠ åˆ é™¤æ—¶èƒ½é«˜æ•ˆçš„è¿›è¡Œè°ƒæ•´ï¼ˆå‰åŽæŒ‡é’ˆé‡æ–°æŒ‡å®šï¼‰ å“ˆå¸Œï¼ˆHashesï¼‰å®žçŽ°çš„æ•°æ®ç»“æž„1. REDIS_ENCODING_ZIPLISTï¼ˆåŽ‹ç¼©åˆ—è¡¨ï¼‰åœºæ™¯ï¼šï¼ˆ1ï¼‰å“ˆå¸Œå¯¹è±¡ä¸­çš„é”®å€¼å¯¹çš„é•¿åº¦éƒ½å°äºŽ64å­—èŠ‚ ï¼ˆ2ï¼‰å“ˆå¸Œå¯¹è±¡ä¸­çš„é”®å€¼å¯¹çš„æ•°é‡å°äºŽ512ä¸ªæŒ‡ä»¤ï¼šHSET msg name &quot;andy&quot;æ³¨æ„ï¼šåˆ©ç”¨åŽ‹ç¼©åˆ—è¡¨å®žçŽ°é”®å€¼å¯¹ï¼Œå®žçŽ°æ–¹æ³•æ˜¯ï¼škeyåœ¨å‰ï¼Œvalueåœ¨åŽï¼Œå½¢æˆä¸€ä¸ªé“¾ 2. REDIS_ENCODING_HASHTABLEï¼ˆå“ˆå¸Œè¡¨ï¼‰åœºæ™¯ï¼šï¼ˆ1ï¼‰å“ˆå¸Œå¯¹è±¡ä¸­çš„é”®å€¼å¯¹çš„é•¿åº¦éƒ½å¤§äºŽ64å­—èŠ‚ ï¼ˆ2ï¼‰å“ˆå¸Œå¯¹è±¡ä¸­çš„é”®å€¼å¯¹çš„æ•°é‡å¤§äºŽ512ä¸ªæŒ‡ä»¤ï¼šHSET msg name &quot;andy&quot; age &quot;24&quot; ......æ³¨æ„ï¼šHashTableä¹Ÿå«å­—å…¸è¡¨ï¼Œæ˜¯æ•´ä¸ªredisçš„æ ¸å¿ƒï¼Œç±»ä¼¼äºŽjavaä¸­çš„HashTableï¼Œä½†æ˜¯åœ¨å…¶ç‰¹æ®Šçš„åº”ç”¨åœºæ™¯ä¸‹ï¼Œåšå‡ºäº†ä¸€äº›æ”¹è¿›ï¼Œæ¯”å¦‚æ¸è¿›å¼çš„rehashç­‰ç­‰ é›†åˆï¼ˆSetsï¼‰å®žçŽ°çš„æ•°æ®ç»“æž„1. REDIS_ENCODING_INTSETï¼ˆæ•´æ•°é›†åˆï¼‰åœºæ™¯ï¼šï¼ˆ1ï¼‰é›†åˆä¸­çš„å…ƒç´ ä¸ºæ•´æ•° ï¼ˆ2ï¼‰é›†åˆä¸­çš„å…ƒç´ ä¸ªæ•°å°äºŽ512ä¸ªæŒ‡ä»¤ï¼šSADD msg 1 2 3æ³¨æ„ï¼šIntSetæ˜¯rediså­˜å‚¨æ•´æ•°é›†åˆçš„æ•°æ®ç»“æž„ï¼Œæœ‰encodingï¼ˆç¼–ç ï¼Œä¿å­˜çš„ä½æ•°ç±»åž‹ï¼‰ï¼Œlengthï¼ˆé•¿åº¦ï¼‰å’Œcontentsï¼ˆæ•´æ•°æ•°ç»„ï¼‰æž„æˆï¼Œå¯ä»¥çµæ´»çš„æ ¹æ®æ•´æ•°çš„å­˜å‚¨ä½æ•°æ¥é€‰æ‹©ç›¸åº”çš„å­˜å‚¨æ–¹å¼æ¥èŠ‚çœå†…å­˜ 2. REDIS_ENCODING_HASHTABLEï¼ˆå“ˆå¸Œè¡¨ï¼‰åœºæ™¯ï¼šï¼ˆ1ï¼‰é›†åˆä¸­çš„å…ƒç´ ä¸ä¸ºæ•´æ•° ï¼ˆ2ï¼‰é›†åˆä¸­çš„å…ƒç´ ä¸ªæ•°å¤§äºŽ512ä¸ªæŒ‡ä»¤ï¼šSADD msg &quot;a&quot; &quot;b&quot; &quot;c&quot; æœ‰åºé›†åˆï¼ˆSorted Setsï¼‰å®žçŽ°çš„æ•°æ®ç»“æž„1. REDIS_ENCODING_ZIPLISTï¼ˆåŽ‹ç¼©è¡¨ï¼‰åœºæ™¯ï¼šï¼ˆ1ï¼‰æœ‰åºé›†åˆä¸­çš„å…ƒç´ å°äºŽ128ä¸ª ï¼ˆ2ï¼‰æœ‰åºé›†åˆä¸­æ‰€æœ‰å…ƒç´ çš„é›†åˆéƒ½å°‘äºŽ64ä¸ªå­—èŠ‚æŒ‡ä»¤ï¼šZADD a 8 b 5 2. REDIS_ENCODING_SKIPLISTï¼ˆè·³è·ƒè¡¨ï¼‰åœºæ™¯ï¼šï¼ˆ1ï¼‰æœ‰åºé›†åˆä¸­çš„å…ƒç´ å¤§äºŽ128ä¸ª ï¼ˆ2ï¼‰æœ‰åºé›†åˆä¸­æ‰€æœ‰å…ƒç´ çš„é›†åˆæœ‰å¤šäºŽ64ä¸ªå­—èŠ‚æŒ‡ä»¤ï¼šZADD a 8 b 5 ......æ³¨æ„ï¼šè·³è·ƒè¡¨æ˜¯ä¸€ç§æœ‰åºçš„æ•°æ®ç»“æž„ï¼Œå®ƒé€šè¿‡æ¯ä¸ªèŠ‚ç‚¹æŒ‡å‘å…¶å®ƒå¤šä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œæ¥åˆ°è¾¾æœ€å¿«çš„è®¿é—®èŠ‚ç‚¹é€Ÿåº¦ï¼Œç”±headerï¼ˆè¡¨å¤´èŠ‚ç‚¹ï¼‰ï¼Œtailï¼ˆè¡¨å°¾èŠ‚ç‚¹ï¼‰ï¼Œlevelï¼ˆèŠ‚ç‚¹æœ€å¤§å±‚æ•°ï¼‰ï¼Œlengthï¼ˆèŠ‚ç‚¹æ•°ï¼‰ï¼Œç®€å•çš„å®žçŽ°å°±æ˜¯é€šè¿‡ä¸€ä¸ªæœ‰åºçš„é“¾è¡¨ï¼Œè¡¨ç¤ºä¸ºç¬¬ä¸€å±‚ï¼Œå†å–å…¶ä¸­å¤´ç»“ç‚¹å’Œå°¾èŠ‚ç‚¹ï¼Œä¸­é—´éšæœºå¤šä¸ªä¸é‡å¤èŠ‚ç‚¹ç»„æˆæ–°çš„é“¾è¡¨ï¼Œå³ä¸ºç¬¬äºŒå±‚ï¼Œå¦‚ä¸‹é‡å¤ä¸‹åŽ»ï¼Œç›´åˆ°åˆ°è¾¾éšæœºï¼ˆ1-32å±‚ï¼‰çš„é˜ˆå€¼ï¼Œè¿™æ ·åˆ°è¾¾ä¸­é—´çš„èŠ‚ç‚¹çš„å¤æ‚åº¦å°†ä¼šå¤§å¤§çš„é™ä½Žã€‚ä¸Šå›¾ä¸­æ˜¯è¿˜ä½¿ç”¨äº†å“ˆå¸Œæ¥èŽ·å–å…ƒç´ çš„åˆ†æ•°å€¼æ¥è¿›è¡ŒæŽ’åºã€‚ å‚è€ƒhttp://www.redis.cn/topics/data-types.htmlhttps://read.douban.com/ebook/7519526/ï¼ˆæ•°æ®åº“çš„è®¾è®¡ä¸Žå®žçŽ°ï¼‰]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[æºç è§£æžStringï¼ŒStringBufferï¼ŒStringBuilderçš„åŒºåˆ«]]></title>
      <url>%2F2016%2F11%2F18%2FString%2F</url>
      <content type="text"><![CDATA[ä»…ä¾›å­¦ä¹ äº¤æµ,å¦‚æœ‰é”™è¯¯è¯·æŒ‡å‡º,å¦‚è¦è½¬è½½è¯·åŠ ä¸Šå‡ºå¤„,è°¢è°¢ Stringï¼ŒStringBufferï¼ŒStringBuilderä¸‰è€…æ˜¯å¤„ç†å­—ç¬¦ä¸²çš„å¸¸ç”¨ç±»ï¼ŒStringæ˜¯åœ¨JDK1.0æ—¶å°±å­˜åœ¨çš„å­—ç¬¦ä¸²å¤„ç†ç±»ï¼Œä¹Ÿæ˜¯ä½¿ç”¨æœ€å¹¿æ³›çš„ï¼ŒStringBufferä¹Ÿæ˜¯JDK1.0å¼€å§‹å‘å¸ƒçš„çº¿ç¨‹å®‰å…¨çš„å­—ç¬¦ä¸²å¤„ç†ç±»ï¼Œä»–æ”¹å˜äº†åŽŸæœ‰Stringä¸å¯æ”¹å˜çš„å­—ç¬¦ä¸²ï¼Œå¢žåŠ äº†ä¸€ä¸ªç¼“å†²çš„æ¦‚å¿µï¼ŒStringBuilderæ˜¯JDK1.5æå‡ºçš„å­—ç¬¦ä¸²å¤„ç†ç±»ï¼Œä»–å–æ¶ˆäº†StringBufferåŽŸæœ‰çš„çº¿ç¨‹å®‰å…¨çš„ç‰¹æ€§ï¼Œå¢žåŠ äº†å­—ç¬¦ä¸²å¤„ç†çš„æ•ˆçŽ‡ã€‚ å…¶å®žè¦è¯´å“ªç§å¤„ç†å­—ç¬¦ä¸²æ˜¯æ€§èƒ½æœ€å¥½çš„ï¼Œæˆ‘è§‰å¾—æ˜¯å“ªç§åœºæ™¯ä¸Šçš„å­—ç¬¦ä¸²å¤„ç†æ€§èƒ½æ˜¯æœ€å¥½çš„ï¼Œå› ä¸ºä»–ä»¬æ˜¯å„æœ‰åƒç§‹ï¼Œä¸‹é¢æ˜¯åŸºäºŽJDK1.8çš„æºç è§£æžè¿™ä¸‰ç§å­—ç¬¦ä¸²å¤„ç†æ–¹å¼çš„åŒºåˆ« String123public final class String implements java.io.Serializable, Comparable&lt;String&gt;, CharSequence &#123; private final char value[]; ç”±ä¸Šå¯çŸ¥ï¼ŒStringå®žçŽ°äº†åºåˆ—åŒ–å’Œå­—ç¬¦åºåˆ—ä¸¤ä¸ªæŽ¥å£ï¼Œè¿™ä¼šå¸¦æ¥ä¸¤ä¸ªç‰¹æ€§ï¼Œä¸€ä¸ªæ˜¯å¯ä¼ è¾“çš„ç‰¹æ€§ï¼Œä¸€ä¸ªæ˜¯å­—ç¬¦å¤„ç†çš„ç‰¹æ€§ï¼Œå†çœ‹Stringçš„æ ¸å¿ƒå±žæ€§valueï¼Œvalueæ˜¯å­˜å‚¨å­—ç¬¦ä¸²çš„è½½ä½“ï¼Œç”±äºŽè¢«finalä¿®é¥°äº†ï¼Œæ‰€æœ‰è¯¥å­—ç¬¦ä¸²è½½ä½“ä¸€æ—¦åˆå§‹åŒ–äº†å°±æ˜¯ä¸å¯å˜çš„ï¼Œæ­£æ˜¯Stringä¸å¯å˜è¿™ä¸€ç‰¹æ€§ï¼Œæ‰€ä»¥å®ƒåœ¨å¤„ç†å­—ç¬¦ä¸²çš„æ–¹å¼åªèƒ½é€šè¿‡æž„é€ åˆå§‹åŒ–çš„æ–¹å¼æ¥å®žçŽ° 1.åˆå§‹åŒ–ä¸€ä¸ªç©ºä¸²123public String() &#123; this.value = "".value;&#125; 2.åˆå§‹åŒ–ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡1234public String(String original) &#123; this.value = original.value; this.hash = original.hash;&#125; 3.åˆå§‹åŒ–ä¸€ä¸ªå­—ç¬¦ä¸²123public String(char value[]) &#123; this.value = Arrays.copyOf(value, value.length);&#125; 4.åˆå§‹åŒ–å­—èŠ‚ç±»åž‹çš„å­—ç¬¦ä¸²123public String(byte ascii[], int hibyte) &#123; this(ascii, hibyte, 0, ascii.length);&#125; å½“ç„¶è¿˜å¯ä»¥åˆå§‹åŒ–StringBufferï¼ŒStringBuilderæ¥æž„å»ºï¼ŒStringçš„æž„é€ æ–¹æ³•å¾ˆä¸°å¯Œï¼Œæä¾›äº†å¾ˆå¤šç±»åž‹ä¸”å¤šæ ·çš„æ•°æ®æºæ¥æ”¯æŒï¼Œå¦‚æžœä½ æƒ³è¦æž„å»ºä¸€ä¸ªä¸å˜çš„æˆ–è€…å˜åŒ–ä¸å¤šçš„å­—ç¬¦ä¸²ï¼ŒStringå¾ˆé€‚åˆä½  StringBuffer123public final class StringBuffer extends AbstractStringBuilder implements java.io.Serializable, CharSequence&#123; åœ¨StringBufferç»§æ‰¿ä½“ç³»æ¥çœ‹ï¼ŒStringBufferæ‹¥æœ‰Stringåº”æœ‰çš„ç‰¹æ€§ï¼Œè€Œä¸”è¿˜ç»§æ‰¿äº†AbstractStringBuilderè¿™ä¸ªæŠ½è±¡ç±»ï¼Œè¿™ä¸ªç±»å®šä¹‰äº†StringBufferçš„å­˜å‚¨è½½ä½“(ä¹Ÿæ˜¯StringBuilderçš„å­˜å‚¨è½½ä½“)ï¼ŒçŽ°åœ¨é€šè¿‡ä¸€ä¸ªappendæ–¹æ³•æ¥çœ‹çœ‹StringBufferå¤„ç†å­—ç¬¦ä¸²çš„æ–¹å¼ 12345public synchronized StringBuffer append(String str) &#123; toStringCache = null; super.append(str); return this;&#125; ç”±ä¸Šå¯çŸ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªStringBufferæ‹¼æŽ¥å­—ç¬¦ä¸²çš„æ–¹æ³•ï¼Œç”±synchronizedæ¥ä¿®é¥°ï¼Œæ‰€ä»¥StringBufferæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ˆå…¶å®žStringBufferå‡ ä¹Žæ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯ç”±synchronizedä¿®é¥°ï¼‰ï¼Œè¿™é‡Œå®ƒæ˜¯è°ƒç”¨çš„çˆ¶ç±»çš„appendæ–¹æ³• 123456789public AbstractStringBuilder append(String str) &#123; if (str == null) return appendNull(); int len = str.length(); ensureCapacityInternal(count + len); str.getChars(0, len, value, count); count += len; return this;&#125; è¿™æ˜¯çˆ¶ç±»AbstractStringBuilderçš„appendæ–¹æ³•ï¼Œåœ¨æ–¹æ³•å†…æœ‰æ˜¯ä¸¤ä¸ªå¾ˆé‡è¦æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ç¼“å†²åŒºçš„å®žçŽ° æ‰©å®¹æ–¹æ³•ï¼šensureCapacityInternal(int minimumCapacity) èµ‹å€¼æ–¹æ³•ï¼šstr.getChars(int srcBegin, int srcEnd, char dst[], int dstBegin) æˆ‘ä»¬å…ˆçœ‹çœ‹æ‰©å®¹æ–¹æ³•1234private void ensureCapacityInternal(int minimumCapacity) &#123; if (minimumCapacity - value.length &gt; 0) expandCapacity(minimumCapacity);&#125; è¿™é‡Œä¼šå¯¹æ‰€æ‹¼æŽ¥çš„å­—ç¬¦ä¸²åšä¸€ä¸ªåˆ¤æ–­ï¼Œä¹Ÿå°±æ˜¯æ‰€æ‹¼æŽ¥çš„å­—ç¬¦ä¸²ä¸èƒ½ä¸ºç©º1234567891011void expandCapacity(int minimumCapacity) &#123; int newCapacity = value.length * 2 + 2; if (newCapacity - minimumCapacity &lt; 0) newCapacity = minimumCapacity; if (newCapacity &lt; 0) &#123; if (minimumCapacity &lt; 0) throw new OutOfMemoryError(); newCapacity = Integer.MAX_VALUE; &#125; value = Arrays.copyOf(value, newCapacity);&#125; ä»¥ä¸Šä»£ç å¯çŸ¥ï¼Œä»–ä¼šå…ˆå¯¹åŽŸæœ‰çš„å­—ç¬¦æ•°ç»„çš„å®¹é‡æ‰©å¤§ä¸¤å€å†åŠ äºŒï¼Œåœ¨å’Œæœ€å°çš„å®¹é‡(åŽŸæœ‰çš„å®¹é‡+æ‹¼æŽ¥å­—ç¬¦ä¸²çš„å®¹é‡)æ¯”è¾ƒï¼Œæ²¡æœ‰æœ€å°å®¹é‡å¤§å°±å–æœ€å°å®¹é‡ï¼Œè¿™é‡Œä¹Ÿæœ‰ä¸€ä¸ªä»¥é˜²å†…å­˜æº¢å‡ºå¯¼è‡´å®¹é‡ä¸ºè´Ÿæ•°çš„ä¸€ä¸ªå¤„ç†ï¼Œæœ€åŽæ ¸å¿ƒçš„å°±æ˜¯ Arrays.copyOf(value, newCapacity)ï¼ŒArraysè¿™æ˜¯ä¸€ä¸ªæ•°ç»„çš„å·¥å…·ç±»ï¼ŒcopyOfæ–¹æ³•æ˜¯é’ˆå¯¹æ•°ç»„åœ¨åŽŸæœ‰çš„åŸºç¡€ä¸Šæ”¹å˜å…¶å®¹é‡ï¼Œè¿™å°±æ˜¯ç­‰äºŽå¯¹åŽŸæœ‰çš„å­—ç¬¦ä¸²æ•°ç»„è¿›è¡Œäº†æ‰©å®¹ï¼Œåœ¨å›žæ¥çœ‹çœ‹å°†æ‹¼æŽ¥çš„å­—ç¬¦æ•°ç»„é‡æ–°æ·»åŠ åˆ°æ–°çš„å­—ç¬¦æ•°ç»„çš„æ–¹æ³• 123456789101112public void getChars(int srcBegin, int srcEnd, char dst[], int dstBegin) &#123; if (srcBegin &lt; 0) &#123; throw new StringIndexOutOfBoundsException(srcBegin); &#125; if (srcEnd &gt; value.length) &#123; throw new StringIndexOutOfBoundsException(srcEnd); &#125; if (srcBegin &gt; srcEnd) &#123; throw new StringIndexOutOfBoundsException(srcEnd - srcBegin); &#125; System.arraycopy(value, srcBegin, dst, dstBegin, srcEnd - srcBegin);&#125; è¯¥æ–¹æ³•å¼€å§‹ä¼šå¯¹ä¸ç¬¦åˆæ¡ä»¶è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼Œæœ€åŽçš„è°ƒç”¨System.arraycopyæ–¹æ³•å°†æ‹¼æŽ¥å­—ç¬¦æ•°ç»„æ·»åŠ åˆ°æ–°çš„å­—ç¬¦æ•°ç»„ï¼Œè¿™å°±å®Œæˆäº†ä¸€ä¸ªå­—ç¬¦ä¸²æ‹¼æŽ¥çš„è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯ç¼“å†²æ± çš„å®žçŽ°ï¼Œåœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ä¿è¯å®‰å…¨çš„å‰æå­—ç¬¦ä¸²å¤§é‡çš„å˜åŠ¨ï¼Œä½¿ç”¨StringBufferæ˜¯æœ€å¥½çš„ StringBuilder123public final class StringBuilder extends AbstractStringBuilder implements java.io.Serializable, CharSequence å…¶å®žä»Žçˆ¶ç±»ä½“ç³»æ¥çœ‹ï¼ŒStringBuilderå’ŒStringBufferæ˜¯ä¸€æ ·çš„ï¼Œé‚£StringBuilderä¸ŽStringBufferæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿè®©æˆ‘ä»¬çœ‹çœ‹å®ƒçš„appendçš„æ–¹æ³• 1234public StringBuilder append(String str) &#123; super.append(str); return this;&#125; è¿™é‡Œä½ å°±ä¼šæ–¹æ³•å®ƒä¹Ÿæ˜¯è°ƒç”¨çˆ¶ç±»çš„appendæ–¹æ³•ï¼Œè€Œä»–ä»¬çš„çˆ¶ç±»åˆæ˜¯åŒä¸€ä¸ªï¼Œè¿™é‡Œä¸åŒçš„å°±æ˜¯StringBuilderçš„appendæ–¹æ³•æ²¡æœ‰ç”¨synchronizedä¿®é¥°ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸å®‰å…¨çš„ï¼Œå½“ç„¶ä¹Ÿå°±æ„å‘³ç€åœ¨å•çº¿ç¨‹çš„æƒ…å†µä¸‹æ¯”StringBufferçš„æ€§èƒ½æ˜¯è¦å¥½çš„ï¼Œå…¶å®žå¯¹äºŽStringBufferå’ŒStringBuilderæ¥è®²ï¼Œå®ƒä»¬éƒ½æ˜¯å¯¹äºŽAbstractStringBuilderç±»çš„å®žçŽ°ï¼Œæˆ–è®¸ä¼šæœ‰å…¶ä»–ç»†èŠ‚å¤„ç†çš„ä¸åŒï¼Œå¤§è‡´æ¥è®²ï¼Œä»–ä»¬çš„åŒºåˆ«å°±æ˜¯ä¸€ä¸ªæ˜¯çº¿ç¨‹å®‰å…¨çš„å®žçŽ°ï¼Œä¸€ä¸ªæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„å®žçŽ°ï¼Œåªæ˜¯è¦ä½ è‡ªå·±åŽ»æƒè¡¡çº¿ç¨‹å®‰å…¨ä¸Žæ€§èƒ½ä¹‹é—´çš„æŠ‰æ‹© æ€»ç»“StringBuilderæˆ–è€…StringBufferå¹¶ä¸ä¸€å®šæ¯”Stringçš„æ•ˆçŽ‡é«˜ï¼Œåœ¨å„ä¸ªåœºæ™¯ä¸­æœ‰ä¸åŒçš„ç”¨æ³•è€Œå·²ï¼Œå¯¹äºŽStringBuilderå’ŒStringBufferæ¥è®²ï¼Œä¹Ÿä¸æ˜¯æ–½äº†ä»€ä¹ˆé­”æ³•ï¼Œåªæ˜¯å®žçŽ°äº†CopyOnWriteçš„æ€æƒ³ï¼Œå¯¹å­—ç¬¦ä¸²çš„æ“ä½œçš„æ€§èƒ½æ›´é«˜äº†ï¼Œåº”å¯¹ä¸åŒæƒ…å†µçš„é€‰æ‹©è€Œå·²]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[è§£åˆ¨å•ä¾‹æ¨¡å¼]]></title>
      <url>%2F2016%2F11%2F01%2Fsingleton%2F</url>
      <content type="text"><![CDATA[ä»…ä¾›å­¦ä¹ äº¤æµ,å¦‚æœ‰é”™è¯¯è¯·æŒ‡å‡º,å¦‚è¦è½¬è½½è¯·åŠ ä¸Šå‡ºå¤„,è°¢è°¢ å•ä¾‹æ¨¡å¼ï¼Œä¹Ÿå«å•å­æ¨¡å¼ï¼Œæ˜¯ä¸€ç§å¸¸ç”¨çš„è½¯ä»¶è®¾è®¡æ¨¡å¼ã€‚åœ¨åº”ç”¨è¿™ä¸ªæ¨¡å¼æ—¶ï¼Œå•ä¾‹å¯¹è±¡çš„ç±»å¿…é¡»ä¿è¯åªæœ‰ä¸€ä¸ªå®žä¾‹å­˜åœ¨ã€‚è®¸å¤šæ—¶å€™æ•´ä¸ªç³»ç»Ÿåªéœ€è¦æ‹¥æœ‰ä¸€ä¸ªçš„å…¨å±€å¯¹è±¡ï¼Œè¿™æ ·æœ‰åˆ©äºŽæˆ‘ä»¬åè°ƒç³»ç»Ÿæ•´ä½“çš„è¡Œä¸ºã€‚æ¯”å¦‚åœ¨æŸä¸ªæœåŠ¡å™¨ç¨‹åºä¸­ï¼Œè¯¥æœåŠ¡å™¨çš„é…ç½®ä¿¡æ¯å­˜æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè¿™äº›é…ç½®æ•°æ®ç”±ä¸€ä¸ªå•ä¾‹å¯¹è±¡ç»Ÿä¸€è¯»å–ï¼Œç„¶åŽæœåŠ¡è¿›ç¨‹ä¸­çš„å…¶ä»–å¯¹è±¡å†é€šè¿‡è¿™ä¸ªå•ä¾‹å¯¹è±¡èŽ·å–è¿™äº›é…ç½®ä¿¡æ¯ã€‚è¿™ç§æ–¹å¼ç®€åŒ–äº†åœ¨å¤æ‚çŽ¯å¢ƒä¸‹çš„é…ç½®ç®¡ç†ã€‚â€”â€”æ¥è‡ªwikipedia å•ä¾‹æ¨¡å¼å¤§è‡´ä¸Šåˆ†ä¸ºä¸¤ç§æ¨¡å¼ï¼Œé¥¿æ±‰æ¨¡å¼å’Œæ‡’æ±‰æ¨¡å¼ï¼Œåœ¨å¼€å‘çŽ¯å¢ƒä¸­æœ‰å¾ˆå¤šçš„åº”ç”¨ï¼Œæ¯”å¦‚Springçš„beanå·¥åŽ‚å°±åº”ç”¨äº†å•ä¾‹æ¨¡å¼æ¥å¯¹beanè¿›è¡Œåˆå§‹åŒ–ï¼Œä»–å¯¹ç±»çš„å®žä¾‹è¿›è¡Œäº†ç»Ÿä¸€çš„ç®¡ç†ï¼Œæ¯æ¬¡è¿”å›žè¯¥ç±»çš„å”¯ä¸€å®žä¾‹ï¼Œä¹Ÿä¼˜åŒ–äº†å®žä¾‹åŒ–ç±»çš„èµ„æºåˆ©ç”¨ã€‚ é¥¿æ±‰æ¨¡å¼123456789public class HungrySingleton &#123; private final static HungrySingleton INSTANCE = new HungrySingleton(); private HungrySingleton() &#123;&#125; public static HungrySingleton getInstance() &#123; return INSTANCE; &#125;&#125; é¥¿æ±‰æ¨¡å¼æŒ‡åœ¨ç±»çš„å®žä¾‹åœ¨å…¨å±€å®šä¹‰ï¼Œåˆ©ç”¨staticå’Œfinalä¿®é¥°ï¼Œä¿æŒç±»çš„å”¯ä¸€æ€§ï¼Œåœ¨ç±»è£…è½½çš„æ—¶å€™å°±åˆå§‹åŒ–äº†ï¼Œ å› ä¸ºåˆ›å»ºå®žä¾‹æœ¬èº«æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥é¥¿æ±‰æ¨¡å¼ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ ä½†æ˜¯é¥¿æ±‰æ¨¡å¼çš„åº”ç”¨åœºæ™¯æ˜¯æ˜Žç¡®ç±»æœ¬èº«å®žä¾‹çš„ä¿¡æ¯ï¼Œå› ä¸ºè¿™æ˜¯åœ¨ç±»è£…è½½å‰å°±å®žä¾‹åŒ–äº†ï¼Œæ— æ³•æ”¹å˜ï¼Œä½†æ˜¯å¦‚æžœæƒ³æ ¹æ®ä¸Šä¸‹æ–‡æˆ–è€…æ‰€ä¾èµ–å‚æ•°çš„å˜åŒ–æ¥åŠ¨æ€çš„å®žä¾‹åŒ–ç±»ï¼Œé¥¿æ±‰æ¨¡å¼å°±ä¸åŒ¹é…äº†ï¼ŒäºŽæ˜¯å¦ä¸€ç§æ‡’æ±‰æ¨¡å¼å°±ç™»åœºäº†ã€‚ æ‡’æ±‰æ¨¡å¼æ‡’æ±‰æ¨¡å¼æŒ‡å…¨å±€çš„å®žä¾‹åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ—¶å€™æ‰åŠ è½½ ç®€å•æ¨¡å¼123456789101112public class LazySingleton &#123; private static LazySingleton instance; private LazySingleton ()&#123;&#125; public static LazySingleton getInstance() &#123; if (instance == null) &#123;// çº¿ç¨‹1 instance = new LazySingleton();// çº¿ç¨‹2 &#125; return instance; &#125;&#125; è¿™æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„æ‡’æ±‰æ¨¡å¼ï¼Œåœ¨å•çº¿ç¨‹çš„çŽ¯å¢ƒä¸‹ï¼Œé€šè¿‡ç¬¬ä¸€æ¬¡æ£€æŸ¥instanceæ˜¯å¦ä¸ºç©ºæ¥èŽ·å–å”¯ä¸€çš„å®žä¾‹ï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹çš„çŽ¯å¢ƒä¸‹ï¼Œç”±äºŽinstance = new LazySingleton()ä¸æ˜¯ä¸€ä¸ªåŽŸå­æ€§çš„æ“ä½œï¼Œä¼šå—åˆ°å…¶ä»–çº¿ç¨‹çš„å¹²æ‰°ï¼Œå¦‚ä¸Šæ‰€ç¤ºï¼š å¦‚æžœçº¿ç¨‹1åœ¨if (instance == null) {æŒ‚èµ·ï¼Œçº¿ç¨‹2åœ¨instance = new Singleton()å¼€å§‹æ‰§è¡Œï¼ŒinstanceæŒ‡å‘äº†ä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰å¼€å§‹åˆå§‹åŒ–å¯¹è±¡( æŒ‡ä»¤é‡æŽ’åºï¼Œä¸‹é¢ä¼šè®²åˆ° )ï¼Œçº¿ç¨‹2æŒ‚èµ·ï¼Œçº¿ç¨‹1è¿™ä¸ªæ—¶å€™ç»§ç»­ï¼Œè¿™ä¸ªæ—¶å€™åˆ¤æ–­instanceä¸ä¸ºnullï¼Œè¿”å›žçš„åªæ˜¯ä¸€ä¸ªç©ºå†…å­˜å—(æ²¡æœ‰å®žä¾‹åŒ–å¯¹è±¡)ï¼Œå¾ˆå®¹æ˜“é€ æˆNullPointExceptionï¼Œ å¦‚æžœçº¿ç¨‹2åœ¨instance = new Singleton()æŒ‚èµ·ï¼Œçº¿ç¨‹1åœ¨if (instance == null) {å¼€å§‹æ‰§è¡Œï¼Œè¿™ä¸ªæ—¶å€™instanceè¿˜æ²¡æœ‰æŒ‡å‘å†…å­˜ï¼Œinstanceä¸ºnullï¼Œä¹Ÿè¿›æ¥è¿›è¡Œäº†åˆ›å»ºå®žä¾‹çš„æ­¥éª¤ï¼Œçº¿ç¨‹1å’Œçº¿ç¨‹2åˆ›å»ºäº†ä¸¤ä¸ªå®žä¾‹ï¼Œè¿èƒŒäº†å•ä¾‹çš„æ€æƒ³ æ‰€ä»¥ä»¥ä¸Šä¸¤ç§æƒ…å†µè¡¨æ˜Žè¿™ç§ç®€å•æ¨¡å¼æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ å•é‡æ£€éªŒé”æ¨¡å¼ï¼ˆsingle checked locking patternï¼‰123456789101112public class LazySingleton &#123; private static LazySingleton instance; private LazySingleton ()&#123;&#125; public static synchronized LazySingleton getInstance() &#123; if (instance == null) &#123;// single check instance = new LazySingleton(); &#125; return instance; &#125;&#125; ä»¥ä¸Šçš„æ¨¡å¼æ˜¯åœ¨èŽ·å–å®žä¾‹çš„æ–¹æ³•getInstance()åŠ ä¸ŠåŒæ­¥é”synchronizedæ¥ä¿®é¥°ï¼Œä»¥ä¿è¯çº¿ç¨‹çš„å®‰å…¨æ€§ï¼Œä½†æ˜¯è™½ç„¶ä¿è¯äº†çº¿ç¨‹å®‰å…¨ï¼Œä½†æ˜¯è¿™ç§æš´åŠ›çš„åŒæ­¥ä¸¥é‡å½±å“äº†ç¨‹åºæ‰§è¡Œçš„æ€§èƒ½ï¼Œåœ¨æ‰§è¡ŒgetInstance()æ–¹æ³•æ—¶ï¼Œé¢‘ç¹çš„çº¿ç¨‹çš„æ›´æ¢è°ƒåº¦ï¼Œå¯¹äºŽæ€§èƒ½æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„å¼€é”€ã€‚ å¦‚æžœinstanceå·²ç»å®žä¾‹åŒ–äº†ï¼Œå¯¹äºŽä¸Šè¿°æ¨¡å¼æ¥è®²ï¼Œä»–è¿˜æ˜¯è¦ç­‰å¾…å‰é¢çš„çº¿ç¨‹èŽ·å–å®Œå®žä¾‹æ‰èƒ½èŽ·å–å®žä¾‹ï¼Œè¿™æ ·å®žçŽ°å¾ˆä½Žæ•ˆï¼Œå…¶å®žåŒæ­¥åªæ˜¯é’ˆå¯¹å®žä¾‹åŒ–å¯¹è±¡çš„è¿‡ç¨‹ï¼Œå¯¹äºŽå·²ç»å®žä¾‹åŒ–å¯¹è±¡çš„instanceæ¥è¯´ï¼Œåªéœ€è¦è¿”å›žå°±å¯ä»¥äº†ï¼Œä¸éœ€è¦åŒæ­¥ã€‚ åŒé‡æ£€éªŒé”æ¨¡å¼ï¼ˆdouble checked locking patternï¼‰1234567891011121314151617public class LazySingleton &#123; private static LazySingleton instance; private LazySingleton ()&#123;&#125; public static LazySingleton getInstance() &#123; if (instance == null) &#123;//single check çº¿ç¨‹1 synchronized (LazySingleton.class) &#123; if (instance == null) &#123;//double check instance = new LazySingleton(); //çº¿ç¨‹2 &#125; &#125; &#125; return instance; &#125;&#125; åŒé‡æ£€éªŒé”æ¨¡å¼åˆå¯¹å•é‡æ£€éªŒé”æ¨¡å¼è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä»–ç”¨ä¸¤æ¬¡æ£€æŸ¥æ¥åˆ¤æ–­instanceæ˜¯å¦è¢«å®žä¾‹åŒ–ï¼ŒåŒæ­¥é”åªæ˜¯é’ˆå¯¹instanceçš„å®žä¾‹åŒ–ï¼Œå¯¹äºŽinstanceå·²ç»å®žä¾‹åŒ–çš„æƒ…å†µä¸‹ï¼Œç›´æŽ¥è¿”å›žinstanceï¼Œä¸è¿›å…¥åŒæ­¥é”çš„ä»£ç å—ï¼Œå¤§å¤§çš„æé«˜äº†æ€§èƒ½ ä½†æ˜¯ï¼Œåˆé‡çŽ°äº†ç®€å•æ¨¡å¼çš„ç¬¬ä¸€ç§æƒ…å†µï¼Œå¦‚ä¸Šä»£ç æ‰€ç¤ºï¼Œå‡è®¾çº¿ç¨‹2åœ¨å®žä¾‹åŒ–å¯¹è±¡åªæ˜¯åœ¨instanceæŒ‡å‘äº†å†…å­˜ç©ºé—´ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰å®žä¾‹åŒ–å¯¹è±¡(æŒ‡ä»¤é‡æŽ’åº)ï¼Œè¿™ä¸ªæ—¶å€™çº¿ç¨‹1çš„instanceï¼=nullï¼Œç›´æŽ¥è¿”å›žinstanceï¼Œé€ æˆNullPointExceptionï¼ŒçŽ°åœ¨é—®é¢˜æ¥äº†ï¼Œä»€ä¹ˆæ˜¯æŒ‡ä»¤é‡æŽ’åºï¼Ÿ ä¸€èˆ¬çš„æƒ…å†µä¸‹ï¼Œç¨‹åºè¿è¡Œä»£ç æ˜¯é¡ºåºè¿è¡Œçš„ï¼Œä½†æ˜¯ä¼šå­˜åœ¨ä¸€äº›æŒ‡ä»¤çš„é‡æŽ’åºé—®é¢˜ï¼Œæ¯”å¦‚123int a=1ï¼›int b=1ï¼›int c=a+b; ä»¥ä¸Šä»£ç ä½¿ç”¨æŒ‡ä»¤æ¥æ‰§è¡Œï¼Œåˆ†ä¸ºä»¥ä¸‹5ä¸ªæ­¥éª¤ï¼š å¯¹aèµ‹å€¼1 å¯¹bèµ‹å€¼1 èŽ·å–açš„å€¼ èŽ·å–bçš„å€¼ è¿ç®—a+bçš„å€¼å­˜åœ¨cçš„å†…å­˜ä¸­ ä¸Šè¿°çš„äº”ä¸ªæ­¥éª¤æœ‰æ—¶å¹¶ä¸æ˜¯æŒ‰ç…§é¡ºåºè¿›è¡Œçš„ï¼Œæœ‰æ—¶ä½ æ‰§è¡Œæ­¥éª¤1å¯¹aèµ‹å€¼1æ—¶ï¼Œå°±ä¼šæ‰§è¡Œæ­¥éª¤3èŽ·å–açš„å€¼ï¼Œå› ä¸ºä»–ä»¬å­˜åœ¨æ•°æ®ä¾èµ–ï¼Œè¿™å°±æ˜¯å‘ç”Ÿäº†æŒ‡ä»¤é‡æŽ’(å…·ä½“äº†è§£ï¼Œè®¿é—® http://tech.meituan.com/java-memory-reordering.html )ï¼Œå¯¹äºŽå®žä¾‹åŒ–å¯¹è±¡æ¥è®²ï¼Œå…·ä½“çš„æ­¥éª¤å¦‚ä¸‹ï¼š åˆ†é…å†…å­˜ å®žä¾‹åŒ–å¯¹è±¡ å¼•ç”¨æŒ‡å‘å†…å­˜å¯¹è±¡ æ­£å¸¸çš„æƒ…å†µä¸‹åªæœ‰å®žä¾‹åŒ–äº†å¯¹è±¡æ‰ä¼šå¼•ç”¨æŒ‡å‘å†…å­˜å¯¹è±¡ï¼Œä½†æ˜¯å¦‚æžœè¿™æ—¶å‘ç”Ÿäº†æŒ‡ä»¤é‡æŽ’åºï¼Œæ‰§è¡Œé¡ºåºå˜æˆäº†1,3,2ï¼Œåœ¨æ‰§è¡Œæ­¥éª¤3è¿˜æ²¡æœ‰æ‰§è¡Œæ­¥éª¤2å°±æ‰§è¡Œçº¿ç¨‹1äº†ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šé€ æˆå¼‚å¸¸é”™è¯¯ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šä½¿ç”¨volatileå…³é”®å­—æ¥é¿å…æŒ‡ä»¤é‡æŽ’åºã€‚ volatileå¼æ¨¡å¼ï¼ˆdouble checked locking pattern with ï¼‰volatileçš„å®šä¹‰æ˜¯ï¼šjavaç¼–ç¨‹è¯­è¨€å…è®¸çº¿ç¨‹è®¿é—®å…±äº«å˜é‡ï¼Œä¸ºäº†ç¡®ä¿å…±äº«å˜é‡èƒ½è¢«å‡†ç¡®å’Œä¸€è‡´çš„æ›´æ–°ï¼Œçº¿ç¨‹åº”è¯¥ç¡®ä¿é€šè¿‡æŽ’ä»–é”å•ç‹¬èŽ·å¾—è¿™ä¸ªå˜é‡ã€‚Javaè¯­è¨€æä¾›äº†volatileï¼Œåœ¨æŸäº›æƒ…å†µä¸‹æ¯”é”æ›´åŠ æ–¹ä¾¿ã€‚å¦‚æžœä¸€ä¸ªå­—æ®µè¢«å£°æ˜Žæˆvolatileï¼Œjavaçº¿ç¨‹å†…å­˜æ¨¡åž‹ç¡®ä¿æ‰€æœ‰çº¿ç¨‹çœ‹åˆ°è¿™ä¸ªå˜é‡çš„å€¼æ˜¯ä¸€è‡´çš„ã€‚ æ­£å¦‚ä¸Šæ‰€è¯´ï¼Œjavaçº¿ç¨‹å†…å­˜æ¨¡åž‹ç¡®ä¿æ‰€æœ‰çº¿ç¨‹çœ‹åˆ°è¿™ä¸ªå˜é‡çš„å€¼æ˜¯ä¸€è‡´çš„å°±æ˜¯volatileçš„å¯è§æ€§ï¼Œæ­£æ˜¯å› ä¸ºä»–çš„å¯è§æ€§ï¼Œè¦æ±‚æ‰€æœ‰çº¿ç¨‹çœ‹è§è¯¥å˜é‡è¦ä¸€è‡´ï¼Œæ‰€ä»¥ä»£è¡¨ç€volatileçš„å¦ä¸€ä¸ªç‰¹æ€§:ç¦æ­¢æŒ‡ä»¤é‡æŽ’åºï¼Œå…¶å®žï¼Œåœ¨JDK1.5ä¹‹å‰volatileæ˜¯ä¸èƒ½ä¿è¯èƒ½å¤Ÿç¦æ­¢æŒ‡ä»¤é‡æŽ’åºçš„ï¼Œåœ¨JDK1.5ä¹‹åŽæ‰èƒ½åº”ç”¨äºŽåŒé‡æ£€æŸ¥æ¨¡å¼ã€‚ 1234567891011121314151617public class LazySingleton &#123; private volatile static LazySingleton instance; private LazySingleton ()&#123;&#125; public static LazySingleton getInstance() &#123; if (instance == null) &#123;//single check synchronized(LazySingleton.class)&#123; if (instance == null) &#123;//double check instance = new LazySingleton(); &#125; &#125; &#125; &#125; return instance; &#125;&#125; é™æ€å†…éƒ¨ç±»æ¨¡å¼(static nested class pattern)é™æ€å†…éƒ¨ç±»æ¨¡å¼ä¹Ÿæ˜¯ä¸€ç§æ‡’æ±‰æ¨¡å¼ï¼Œä»–åˆ©ç”¨å†…éƒ¨ç±»çš„ç‰¹æ€§(è°ƒç”¨æ—¶æ‰åŠ è½½ï¼‰æ¥åˆ›å»ºå®žä¾‹ 123456789public class LazySingleton &#123; private static class SingletonClass &#123; private static final LazySingleton INSTANCE = new LazySingleton(); &#125; private LazySingleton ()&#123;&#125; public static final LazySingleton getInstance() &#123; return SingletonClass.INSTANCE; &#125; &#125; è¿™ç§æ¨¡å¼ä¹Ÿèƒ½ä¿è¯çº¿ç¨‹çš„å®‰å…¨æ€§ï¼ŒJVMåœ¨ä¿æŒç±»çš„ä¿¡æ¯çš„ä¸€è‡´æ€§ï¼ŒåŠ è½½ç±»çš„æ—¶å€™æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œä¸”ä¸éœ€è¦åŒæ­¥æ¥æ‰§è¡ŒgetInstance()æ–¹æ³•ã€‚ å‚è€ƒhttps://zh.wikipedia.org/wiki/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8Fhttp://tech.meituan.com/java-memory-reordering.html]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[åŠ¨æ€ä»£ç†]]></title>
      <url>%2F2016%2F10%2F05%2Fproxy%2F</url>
      <content type="text"><![CDATA[ä»…ä¾›å­¦ä¹ äº¤æµ,å¦‚æœ‰é”™è¯¯è¯·æŒ‡å‡º,å¦‚è¦è½¬è½½è¯·åŠ ä¸Šå‡ºå¤„,è°¢è°¢ ä»£ç†æ¨¡å¼ åœ¨ä»£ç†æ¨¡å¼ä¸­,è§’è‰²åˆ†é…å¦‚ä¸‹ï¼š Subject(1-k) : å§”æ‰˜å¯¹è±¡æ‰€å®žçŽ°çš„æ‰€æœ‰æŽ¥å£(i&gt;=1) RealSubject : å§”æ‰˜å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¢«ä»£ç†çš„å¯¹è±¡ ProxySubject : ä»£ç†å¯¹è±¡ åœ¨JDKå®žçŽ°çš„ä»£ç†æ¨¡å¼æ˜¯é¢å‘æŽ¥å£çš„ï¼Œä¸ç®¡æ˜¯å§”æ‰˜ç±»è¿˜æ˜¯ä»£ç†ç±»éƒ½åº”è¯¥å®žçŽ°ç›¸åŒçš„æŽ¥å£ï¼Œè¿™æ ·æ‰ä¼šä¿æŒè¡Œä¸ºçš„ä¸€è‡´æ€§ï¼Œå› ä¸ºå¯¹äºŽClientæ¥è¯´ï¼Œå®ƒåªè¦è¾“å‡ºå®ƒæ‰€æƒ³è¦çš„ç»“æžœï¼Œä¸ä¼šç®¡ä½ æ˜¯è°å®žçŽ°çš„ï¼Œæ‰€ä»¥ä¸ºäº†å‡è½»å§”æ‰˜å¯¹è±¡çš„åŽ‹åŠ›ï¼Œå°±å¿…é¡»è¦å…‹éš†å‡ºå…¶ä»–è·Ÿè‡ªå·±ä¸€æ ·çš„å¸®æ‰‹æ¥å¸®åŠ©è‡ªå·±ï¼Œå°±å¥½åƒç«è½¦ç¥¨ä»£å”®ç‚¹ä¸€æ ·ï¼Œä»£ç†å¯¹è±¡å°±ç”±æ­¤è€Œç”Ÿäº†ã€‚ é™æ€ä»£ç†é™æ€ä»£ç†æ˜¯æŒ‡åœ¨JVMæ‰§è¡Œå‰å°±æŠŠä½ çš„ä»£ç†ç±»ç»™å®šä¹‰å¥½äº†ï¼Œä¾‹å­å¦‚ä¸‹ï¼š Subject 123public interface Subject &#123; public void doSomething();&#125; RealSubject 1234567public class RealSubject implements Subject&#123; @Override public void doSomething() &#123; // TODO Auto-generated method stub System.out.println("i am just do something!!!!!"); &#125;&#125; ProxySubject 12345678910public class ProxySubject implements Subject&#123; Subject realSubject = null ; @Override public void doSomething() &#123; //ç±»ä¼¼äºŽSpringçš„@Before do something realSubject = new RealSubject(); realSubject.doSomething(); //ç±»ä¼¼äºŽSpringçš„@After do something &#125;&#125; ç”±ä¸Šå¯çŸ¥ï¼Œå…¶å®žè°ƒç”¨ä»£ç†ç±»(ProxySubject)å’Œè°ƒç”¨å§”æ‰˜ç±»(RealSubject)æ˜¯ä¸€æ ·çš„æ•ˆæžœï¼Œç­‰äºŽæ˜¯ä»£ç†ç±»å¯¹å§”æ‰˜ç±»åˆé‡æ–°å°è£…äº†ä¸€å±‚ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¦è¿™æ ·åšå‘¢ï¼Ÿ å¦‚æžœæ¯æ¬¡Clientè°ƒç”¨å§”æ‰˜ç±»æ¥å®Œæˆä¸šåŠ¡æ“ä½œï¼Œé‚£ä¹ˆæ¯æ¬¡å§”æ‰˜ç±»å°±å¾—åˆ›å»ºå¯¹è±¡æ¥å®Œæˆä¸šåŠ¡ï¼Œå¦‚æžœæ˜¯å¤§ä¸šåŠ¡åœºæ™¯ï¼Œæ¶ˆè€—çš„å†…å­˜æ˜¯å·¨å¤§çš„ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå¦‚æžœæ˜¯ä»£ç†ç±»æ¥å®žçŽ°ï¼Œå¯ä»¥åœ¨ä»£ç†ç±»å†…å¯¹å§”æ‰˜ç±»å®žçŽ°ç¼“å­˜æ“ä½œï¼Œè¿™æ ·å°±ä¼šå‡å°‘å¾ˆå¤§çš„å†…å­˜æ¶ˆè€—ã€‚ å¦‚æžœä½ æƒ³å¯¹åŽŸç”Ÿçš„å§”æ‰˜ç±»è¿›è¡Œæ‰©å±•(æ¯”å¦‚Springä¸­çš„@Afterå’Œ@Beforeçš„æ€æƒ³ï¼‰ï¼Œä½ å¯ä»¥å¯¹å§”æ‰˜ç±»è¿›è¡Œä¿®æ”¹ï¼Œä½†æ˜¯è¿™ä¼šå½±å“åŽŸæœ‰å·²ç»å®žçŽ°çš„ç¨‹åºé€»è¾‘ï¼Œå¦‚æžœä½¿ç”¨ä»£ç†ç±»ï¼Œåœ¨ä¸å½±å“åŽŸç”Ÿçš„å§”æ‰˜ç±»æƒ…å†µä¸‹å†è¿›è¡Œé€»è¾‘çš„æ‰©å±•ï¼Œä½¿ç¨‹åºå˜å¾—æ›´åŠ å¥å£®ã€‚ ç”±ä¸Šå¯çŸ¥ï¼Œä»£ç†ç±»çš„ä½œç”¨ä½¿åŽŸç”Ÿçš„å§”æ‰˜ç±»æ›´åŠ çš„çµæ´»è¢«è¿ç”¨ï¼Œèƒ½å¤Ÿåº”ä»˜ä¸åŒçš„ä¸åŒåº”ç”¨åœºæ™¯ï¼Œä½†æ˜¯ï¼Œå¦‚æžœå§”æ‰˜ç±»çš„ä¸€äº›åº”ç”¨æ–¹æ³•çš„åˆ å‡ï¼Œå®žçŽ°æŽ¥å£çš„å‡å°‘ï¼Œå¯¹äºŽä»£ç†ç±»æ¥è¯´ä¹Ÿè¦è¿›è¡Œå¾ˆå¤§çš„ä¿®æ”¹ï¼Œè¿™æ ·çš„æ”¹åŠ¨æœ‰æ—¶ä½¿ä»£ç†æ¨¡å¼å˜å¾—æ›´åŠ çš„å¤æ‚ï¼Œå˜å¾—ä¸æ˜¯é‚£ä¹ˆçš„çµæ´»ï¼Œå¦‚æžœæœ‰ä¸€ç§ä»£ç†ç±»èƒ½å¤Ÿéœ€è¦è°ƒç”¨çš„æ—¶å€™æ‰åŠ è½½ï¼Œä¸ç®¡æŽ¥å£çš„å˜åŠ¨ï¼Œä»£ç†ç±»éƒ½ä¼šè‡ªåŠ¨çš„æ›´æ–°ï¼Œæ— éœ€æ”¹å˜ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯åŠ¨æ€ä»£ç†ã€‚ åŠ¨æ€ä»£ç†åŠ¨æ€ä»£ç†æ˜¯åœ¨é™æ€ä»£ç†çš„åŸºç¡€ä¸Šå¯¹ä»£ç†ç±»è¿›è¡Œäº†ä¼˜åŒ–ï¼Œåˆ©ç”¨javaåå°„çš„åŽŸç†æ¥åˆ›å»ºä»£ç†ç±»ï¼Œä½¿ä»£ç†ç±»åœ¨JVMè¿è¡Œæ—¶åˆ›å»ºã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè¿™ä¸ªä»£ç†ç±»ä¼šæ ¹æ®çŽ°æœ‰çš„æŽ¥å£æ•°æˆ–è€…å®žçŽ°çš„æ–¹æ³•åŠ¨æ€çš„åŽ»åˆ›å»ºå¯¹è±¡ï¼Œå¯¹äºŽä¸šåŠ¡é¢‘ç¹æ›´æ›¿çš„åœºæ™¯ä¸‹ï¼Œä¸éœ€è¦å¯¹ä»£ç†ç±»è¿›è¡Œé¢‘ç¹çš„æ›´æ”¹ï¼Œæ›´åŠ çš„çµæ´»ï¼Œè€Œåœ¨javaä¸­ï¼Œå¯¹äºŽåŠ¨æ€ä»£ç†çš„å®žçŽ°ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ç§æ˜¯JDKå½¢å¼çš„å®žçŽ°ï¼Œä¸€ç§æ˜¯ç¬¬ä¸‰æ–¹åŒ…cglibçš„å®žçŽ°å½¢å¼ã€‚ JDKåŠ¨æ€ä»£ç†åœ¨JDKå®žçŽ°ä¸­ï¼Œä¸»è¦æ˜¯ä¸€ä¸ªç±»ï¼Œä¸€ä¸ªæŽ¥å£ï¼šåŠ¨æ€ä»£ç†ç±»Proxyå’Œè°ƒç”¨å¤„ç†å™¨InvocationHandler 1.Proxy Proxyæ˜¯åŠ¨æ€åˆ›å»ºä»£ç†ç±»çš„ç±»ï¼Œå®ƒä¸»è¦æ˜¯åˆ©ç”¨æŽ¥å£çš„ä¿¡æ¯åœ¨ç±»åŠ è½½å™¨ä¸­åŠ¨æ€çš„ç”Ÿæˆä»£ç†ç±»ï¼Œè€Œå…¶ä¸­ä¸»è¦çš„ç”Ÿæˆä»£ç†ç±»çš„æ–¹æ³•å°±æ˜¯newProxyInstanceæ–¹æ³•ï¼Œå®žçŽ°å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627public static Object newProxyInstance(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h) throws IllegalArgumentException &#123; // æ£€æŸ¥è°ƒç”¨å¤„ç†å™¨æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºæŠ›å¼‚å¸¸ if (h == null) &#123; throw new NullPointerException(); &#125; // èŽ·å¾—ä¸Žåˆ¶å®šç±»è£…è½½å™¨å’Œä¸€ç»„æŽ¥å£ç›¸å…³çš„ä»£ç†ç±»ç±»åž‹å¯¹è±¡ Class cl = getProxyClass(loader, interfaces); // é€šè¿‡åå°„èŽ·å–æž„é€ å‡½æ•°å¯¹è±¡å¹¶ç”Ÿæˆä»£ç†ç±»å®žä¾‹ try &#123; Constructor cons = cl.getConstructor(constructorParams); return (Object) cons.newInstance(new Object[] &#123; h &#125;); &#125; catch (NoSuchMethodException e) &#123; throw new InternalError(e.toString()); &#125; catch (IllegalAccessException e) &#123; throw new InternalError(e.toString()); &#125; catch (InstantiationException e) &#123; throw new InternalError(e.toString()); &#125; catch (InvocationTargetException e) &#123; throw new InternalError(e.toString()); &#125; &#125; ç”±ä¸Šå°±å¾ˆå®¹æ˜“å‘çŽ°ï¼Œè¿™æ˜¯ä¸ªç®€å•çš„javaåå°„åˆ›å»ºå¯¹è±¡ï¼ŒèŽ·å–Classå¯¹è±¡ï¼Œå†èŽ·å–æž„é€ å™¨ï¼Œæœ€åŽåå°„æˆå¯¹è±¡ï¼Œè¿™æ˜¯ä¸ªé™æ€æ–¹æ³•ï¼Œæ‰€ä»¥ç›´æŽ¥ç±»æœ¬èº«å°±å¯ä»¥è°ƒç”¨äº†ã€‚ Proxyè¿˜æœ‰å¾ˆå¤šçš„å®žçŽ°ï¼Œæ¯”å¦‚åˆ©ç”¨ä¸€ä¸ªHashMapæ¥å®žçŽ°å¯¹ä»£ç†ç±»çš„ç¼“å­˜ï¼Œkeyå°±æ˜¯æŽ¥å£åˆ—è¡¨ï¼Œvalueå°±æ˜¯ä»£ç†ç±»çš„å¯¹è±¡ï¼Œè¿˜æœ‰å…³è”è°ƒç”¨å¤„ç†å™¨çš„æ–¹æ³•ç­‰ç­‰ã€‚ 2.InvocationHandler InvocationHandleræ˜¯è°ƒç”¨å¤„ç†å™¨ï¼Œæ˜¯è´Ÿè´£æ–¹æ³•è°ƒç”¨æ—¶ï¼Œåˆ©ç”¨javaåå°„æœºåˆ¶åœ¨JVMè¿è¡Œæ—¶è°ƒç”¨è¯¥æ–¹æ³•ï¼Œå…¶ä¸­ä¸»è¦çš„æ–¹æ³•å°±æ˜¯invokeæ–¹æ³•ï¼Œæœ‰ä¸‰ä¸ªå‚æ•°proxy,method,argsï¼Œè¿™æ˜¯éœ€è¦è‡ªå·±åŽ»å®žçŽ°çš„ï¼Œä»¥ä¸‹æ˜¯invokeæ–¹æ³•çš„å®žçŽ° 12345public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; //æ–¹æ³•åå°„ Object obj = method.invoke(proxyObj, args); return obj; &#125; 3.ä»£ç å®žçŽ° MyInvocationHandler 1234567891011public class MyInvocationHandler implements InvocationHandler &#123; public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; ////ç±»ä¼¼äºŽSpringçš„@Before do something //æ–¹æ³•åå°„ Object obj = method.invoke(proxyObj, args); //ç±»ä¼¼äºŽSpringçš„@After do something return obj; &#125;&#125; JdkProxyFactory 1234567891011public class JdkProxyFactory &#123; private Object proxyObj = null;//ä»£ç†ç±» // åˆ›å»ºä»£ç† public Object createProxy(Object targetObject,InvocationHandler myInvocationHandler) &#123; if (null != targetObject) &#123; this.proxyObj = targetObject; &#125; return Proxy.newProxyInstance(this.proxyObj.getClass().getClassLoader(), this.proxyObj.getClass().getInterfaces(), myInvocationHandler); &#125;&#125; ä»¥ä¸Šå°±æ˜¯ä¸€ä¸ªç®€å•çš„JDKå®žçŽ°çš„ä»£ç†ç±»ï¼Œç›´æŽ¥ç”¨ä»¥ä¸‹çš„ä»£ç è°ƒç”¨å°±å¯ä»¥äº† 123Subject proxySubject = (Subject)new JdkProxyFactory().createProxy(new RealSubject(),new MyInvocationHandler());proxySubject.doSomething(); å½“æˆ‘ä»¬è°ƒç”¨doSomethingæ–¹æ³•æ—¶ï¼Œä½ ä»¥ä¸ºæ˜¯è°ƒç”¨RealSubjectå¯¹è±¡çš„doSomethingæ–¹æ³•ï¼Œå…¶å®žæ˜¯è°ƒç”¨ä»£ç†ç±»$ProxyN(ç”Ÿæˆä»£ç†ç±»çš„åç§°ï¼ŒNä»Ž1å¼€å§‹)çš„doSomethingæ–¹æ³•ï¼Œä»–ä¼šè§¦å‘è¯¥æ–¹æ³•çš„è°ƒç”¨å¤„ç†å™¨invokeæ–¹æ³•æ¥è°ƒç”¨doSomethingæ–¹æ³•ã€‚ cglibåŠ¨æ€ä»£ç†CGLibæ˜¯é¢å‘ç±»çš„ï¼Œè€ŒcglibåŠ¨æ€ä»£ç†çš„å®žçŽ°ä¹Ÿæ˜¯ä¸€ä¸ªç±»å’Œä¸€ä¸ªæŽ¥å£ï¼šEnhancerå’ŒMethodInterceptorï¼Œå’ŒJDKçš„Proxyå’ŒInvocationHandlerèŒèƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸€ä¸ªæ˜¯è´Ÿè´£åˆ›å»ºç±»ï¼Œä¸€ä¸ªæ˜¯è´Ÿè´£è°ƒç”¨æ–¹æ³•çš„å¤„ç† 1.Enhancer Enhancerå¯ä»¥è¯´æ˜¯CGLibçš„ä¸€ä¸ªå­—èŠ‚ç å¢žå¼ºå™¨ï¼Œå®ƒçš„ä½œç”¨é€šè¿‡å§”æ‰˜ç±»çš„å­ç±»æ¥å®žçŽ°ä»£ç†ç±»çš„åˆ›å»ºï¼Œåˆ›å»ºè¿‡ç¨‹å¦‚ä¸‹ï¼š é€šè¿‡å§”æ‰˜ç±»åˆ›å»ºå®ƒçš„å­ç±»ï¼Œåœ¨å­ç±»ä¸­çš„æ¯ä¸ªæ–¹æ³•è®¾ç½®å›žè°ƒæ–¹æ³•ï¼Œç„¶åŽèŽ·å–å®ƒçš„Classå¯¹è±¡ åˆ©ç”¨Classå¯¹è±¡æ ¹æ®GeneratorStrategy.generateæ–¹æ³•ç”Ÿæˆä»£ç†ç±»çš„å­—èŠ‚ç  é€šè¿‡åç¼–è¯‘ç”Ÿæˆä»£ç†ç±»çš„Classå¯¹è±¡ å†é€šè¿‡åå°„æœºåˆ¶åˆ›å»ºä»£ç†ç±»çš„å¯¹è±¡ 2.MethodInterceptor MethodInterceptoræ˜¯ä¸€ä¸ªæ–¹æ³•æ‹¦æˆªå™¨ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯åœ¨ä»£ç†ç±»æ¯æ‰§è¡Œä¸€ä¸ªæ–¹æ³•æ—¶æ‰§è¡Œæ‹¦æˆªæ–¹æ³•å¹¶è¿”å›žï¼Œå…¶ä¸­æœ€ä¸»è¦çš„æ–¹æ³•interceptå®žçŽ°å¦‚ä¸‹ 123456public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable &#123; //ç›¸å½“äºŽè°ƒç”¨äº†ä»£ç†ç±»æœ¬èº«çš„æ–¹æ³• Object result = proxy.invokeSuper(obj, args); return result; &#125; CGLibå®žçŽ°äº†Fastclassæœºåˆ¶ï¼Œå¯¹ä»£ç†ç±»çš„æ–¹æ³•å»ºç«‹äº†ç´¢å¼•ï¼ŒæŠŠæ–¹æ³•å­˜å‚¨åœ¨ç´¢å¼•ä¸­ï¼Œé€šè¿‡æ–¹æ³•åå’Œå®ƒçš„ä¿¡æ¯å°±å¯ä»¥èŽ·å–è¯¥æ–¹æ³•ï¼Œä¸éœ€è¦è¿›è¡Œåå°„æ¥è¿›è¡Œæ–¹æ³•çš„è°ƒç”¨ã€‚ 3.ä»£ç å®žçŽ° MyMethodInterceptor 1234567891011public class MyMethodInterceptor implements MethodInterceptor &#123; public Object intercept(Object obj, Method method, Object[] arg, MethodProxy proxy) throws Throwable &#123; ////ç±»ä¼¼äºŽSpringçš„@Before do something //æ–¹æ³•åå°„ Object object = proxy.invokeSuper(obj, arg); //ç±»ä¼¼äºŽSpringçš„@After do something return object; &#125;&#125; CglibProxyFactory 12345678910111213public class CglibProxyFactory &#123; private Object proxyObj = null;//ä»£ç†ç±» // åˆ›å»ºä»£ç† public Object createProxy(Object targetObject,MethodInterceptor MyMethodInterceptor) &#123; if (null != targetObject) &#123; this.proxyObj = targetObject; &#125; Enhancer enhancer = new Enhancer(); enhancer.setSuperclass(this.proxyObj.class); enhancer.setCallback(MyMethodInterceptor); return enhancer.create(); &#125;&#125; è¿™æ˜¯ä¸€æ®µCglibä»£ç†ç±»çš„å®žçŽ°ï¼Œè°ƒç”¨ä»£ç å¦‚ä¸‹ï¼š 12Subject proxySubject = (Subject)new CglibProxyFactory().createProxy(new RealSubject(),new MethodInterceptor());proxySubject.doSomething(); ç›¸æ¯”äºŽJDKä»£ç†å®žçŽ°ï¼ŒCglibçš„å®žçŽ°æ›´å¿«ï¼Œå®ƒçš„ä¸åŒä¹‹å¤„åœ¨äºŽ Cglibä»£ç†æ‘’é™¤äº†JDKä»£ç†åˆ©ç”¨åå°„æ¥è°ƒç”¨æ–¹æ³•(åå°„çš„æ•ˆçŽ‡æ˜¯å¾ˆä½Žçš„ï¼‰ï¼Œåˆ©ç”¨ç´¢å¼•æ¥å®žçŽ°ã€‚ Cglibä»£ç†æ˜¯é¢å‘extendsçš„ï¼Œæ„å‘³ç€ä¸€äº›ä¸èƒ½ç»§æ‰¿çš„ç±»æ— æ³•ç”¨Cglibæ¥å®žçŽ°ï¼Œè€ŒJDKä»£ç†æ˜¯é¢å‘implements,è¿™æ–¹é¢æ›´è§„èŒƒã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[neo4jçš„å¯¼å…¥æ–¹æ¡ˆ]]></title>
      <url>%2F2016%2F09%2F27%2Fneo4j-import%2F</url>
      <content type="text"><![CDATA[ä»…ä¾›å­¦ä¹ äº¤æµ,å¦‚æœ‰é”™è¯¯è¯·æŒ‡å‡º,å¦‚è¦è½¬è½½è¯·åŠ ä¸Šå‡ºå¤„,è°¢è°¢ æ¦‚è¿°Neo4jæ˜¯ä¸€ç§å¼ºå¤§çš„ï¼Œå¯æ‰©å±•çš„å’Œé«˜æ€§èƒ½çš„å›¾å½¢æ•°æ®åº“ï¼Œç”±è¾¹ï¼Œå±žæ€§å’ŒèŠ‚ç‚¹ç»„æˆï¼Œæ˜¯ç”¨æ¥æè¿°èŠ‚ç‚¹ä¸ŽèŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»ï¼Œç”±ä½äºŽç¾Žå›½æ—§é‡‘å±±çš„NeoæŠ€æœ¯å…¬å¸è¿›è¡Œå¼€å‘å’Œç»´æŠ¤ï¼Œå®ƒå±žäºŽNoSqlçš„èŒƒå›´å†…ï¼Œåœ¨ä¸€äº›ç¤¾äº¤çš„é¡¹ç›®ä¸­å¤„ç†äººä¸Žäººæˆ–ç‰©ä¹‹é—´çš„å…³ç³»æŒ¥å‘è¿™å·¨å¤§çš„ä½œç”¨ï¼Œä»¥ä¸‹åˆ—ä¸¾å®ƒçš„ä¸€äº›ç‰¹ç‚¹ æ”¯æŒACIDäº‹åŠ¡ é«˜å¯ç”¨æ€§ å¯æ‰©å±•åˆ°æ•°åäº¿çš„èŠ‚ç‚¹å’Œå…³ç³» é«˜æ•ˆä¸”å¿«é€Ÿçš„éåŽ†æŸ¥è¯¢(å›¾çš„éåŽ†) å¼ºå¤§çš„ç»“æž„åŒ–æŸ¥è¯¢è¯­è¨€Cypher å¯¼å…¥æ–¹æ¡ˆå¦‚æžœä½ æƒ³é€‰æ‹©Neo4jä½œä¸ºä½ çš„å¤„ç†å…³ç³»çš„æ•°æ®åº“ï¼Œé¦–å…ˆå¤„ç†çš„é—®é¢˜å°±æ˜¯å¯¼å…¥å¤–éƒ¨æ•°æ®ï¼Œå°†MySQLï¼ŒOracleæˆ–è€…PostgreSQLçš„å…³äºŽç”¨æˆ·çš„å…³ç³»æ•°æ®å¯¼å…¥Neo4jä¸­ï¼Œè¿™é‡Œæœ‰ä¸¤ç§å¯¼å…¥æ•°æ®çš„æ–¹å¼ï¼š 1. LOAD CSVLOAD CSVæ˜¯Cypherè¯­è¨€çš„æŒ‡ä»¤ï¼Œæ˜¯å°†csvæ–‡ä»¶ä¸­çš„å±žæ€§æ’å…¥Neo4jä¸­ï¼Œé¦–å…ˆå…ˆå°†åŽŸæ•°æ®åº“çš„æ•°æ®å¯¼å‡ºæˆcsvæ–‡ä»¶ï¼Œä»¥ç”µå½±ä¿¡æ¯ä¸ºä¾‹ï¼Œå¯¼å‡ºCSVæ–‡ä»¶å¦‚ä¸‹ï¼š movies.csvï¼š1234id,title,country,year1,Wall Street,USA,19872,The American President,USA,19953,The Shawshank Redemption,USA,1994 Neo4jæä¾›äº†ä¸€ä¸ªWEBç«¯çš„å®¢æˆ·ç«¯ç³»ç»Ÿï¼Œåˆ©ç”¨å¯è§†åŒ–çš„æ–¹å¼å±•ç¤ºèŠ‚ç‚¹ä¸ŽèŠ‚ç‚¹çš„å…³ç³»ï¼Œåœ¨ä¸Šé¢å¯ä»¥åˆ©ç”¨Cypherè¯­è¨€å¯¹æ•°æ®è¿›è¡Œæ“ä½œï¼Œä»£ç å¦‚ä¸‹ï¼š1234LOAD CSV WITH HEADERS FROM &quot;CSVåœ°å€&quot; AS csvLineMERGE (country:Country &#123; name: csvLine.country &#125;)CREATE (movie:Movie &#123; id: toInt(csvLine.id), title: csvLine.title, year:toInt(csvLine.year)&#125;)CREATE (movie)-[:MADE_IN]-&gt;(country) ä¸Šé¢çš„æ„æ€æ˜¯åˆ›å»ºcountryå’ŒmovieèŠ‚ç‚¹ï¼Œç„¶åŽå°†countryå’Œmovieå»ºç«‹MADE_INçš„å…³ç³»ï¼Œè¿™æ ·å°±å°†csvçš„æ•°æ®å¯¼å…¥äº†Neo4jä¸­äº†ï¼ŒLOAD CSVæŒ‡ä»¤å¯¼å…¥çš„å½¢å¼åªæ˜¯ç›¸å½“äºŽå¤šä¸ªCRATEæŒ‡ä»¤ï¼Œé€šè¿‡ç¹æ‚çš„JAVAç¨‹åºå‘ç¡¬ç›˜å†™æ•°æ®ï¼Œæ‰€ä»¥åªæ˜¯é€‚äºŽå°æ•°æ®é‡çš„å¯¼å…¥ æ³¨æ„ï¼šcsvä¸­å±žæ€§çš„æ•°æ®éƒ½æ˜¯Stringç±»åž‹çš„ï¼ŒNeo4jæ˜¯ç”±JAVAå†™çš„ï¼Œæ¯ä¸ªå±žæ€§æ˜¯æœ‰ç±»åž‹çš„ï¼Œæ‰€ä»¥å†…ç½®äº†toIntè¿™æ ·çš„ç±»åž‹è½¬æ¢æ–¹æ³• 2. neo4j-importneo4jå†…ç½®äº†ä¸€ä¸ªæ‰¹é‡å¯¼å…¥çš„è„šæœ¬ï¼Œå­˜å‚¨åœ¨/BINç›®å½•ä¸‹çš„neo4j-import.bat,å®ƒç›´æŽ¥åœ¨æ•°æ®åº“å­˜å‚¨æ–‡ä»¶ç›®å½•ä¸­ç”Ÿæˆä½ æ‰€éœ€åˆ›å»ºèŠ‚ç‚¹å’Œå…³ç³»æ–‡ä»¶ï¼Œæ‰€ä»¥å®ƒçš„é™åˆ¶ä¹Ÿå¾ˆå¤šï¼Œç¬¬ä¸€ç‚¹æ˜¯å¯¼å…¥å‰ï¼Œè¿˜æ²¡æœ‰åˆ›å»ºæ•°æ®åº“ï¼Œè®²ç™½äº†åªèƒ½æ˜¯ç¬¬ä¸€æ¬¡å¯¼å…¥æ‰æœ‰æ•ˆï¼Œç¬¬äºŒç‚¹æ˜¯èŠ‚ç‚¹å’Œå…³ç³»è¦åˆ†å¼€å¯¼å…¥å°±æ˜¯è¦é¢å¤–è¿›è¡Œå¯¼å‡ºå­˜å‚¨å…³ç³»çš„csvï¼Œç¬¬ä¸‰ç‚¹æ˜¯å¦‚æžœä¸è¿›è¡Œå¼ºåˆ¶æŒ‡å®šç±»åž‹ï¼Œæ¯ä¸ªèŠ‚ç‚¹(åŒ…æ‹¬ä¸åŒç±»åž‹çš„èŠ‚ç‚¹)çš„idä¸èƒ½ç›¸åŒï¼Œ movie.csvï¼š1234id,title,year1,Wall Street,19872,The American President,19953,The Shawshank Redemption,1994 country.csvï¼š1234id,name4,USA5,CHINA6,UK MADE_IN.csvï¼š1234:START_ID,:END_ID1,42,53,6 ï¼ˆ1ï¼‰ç”±äºŽé…ç½®æ–‡ä»¶çš„é»˜è®¤è¯»å–çš„ä½ç½®åœ¨importä¸­ï¼Œæ‰€ä»¥å¯¼å‡ºçš„csvæ ¼å¼çš„æ–‡ä»¶è¦å­˜å‚¨åœ¨neo4jå­˜å‚¨ç›®å½•ä¸‹çš„importç›®å½•ï¼ˆ2ï¼‰ä½¿ç”¨neo4j-importå·¥å…·,åœ¨neo4jçš„binç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹çš„æŒ‡ä»¤1neo4j-import --into ../data/databases/graph.db --id-type string --nodes:movie ../import/movie.csv --nodes:country ../import/country.csv --relationships:MADE_IN ../import/MADE_IN.csv --multiline-fields=true --skip-bad-relationships=true --bad-tolerance=2000 è¿™æ ·å°±å®Œæˆäº†neo4jçš„æ‰¹é‡å¯¼å…¥äº†ï¼Œå¤§çº¦1000ä¸‡çš„æ•°æ®é‡ï¼Œåå‡ åˆ†é’Ÿå°±å®Œæˆäº† æ³¨æ„ï¼šåœ¨å¯¼å…¥è¿‡ç¨‹ä¸­æœ‰å¯èƒ½é‡åˆ°å¦‚ä¸‹é”™è¯¯ï¼ˆ1ï¼‰./data/databases/graph.db already contains a databaseé”™è¯¯ï¼Œè¡¨ç¤ºgraph.dbå·²ç»åŒ…å«äº†ä¸€ä¸ªæ•°æ®åº“ï¼Œéœ€è¦å°†å…¶åˆ é™¤æ‰èƒ½å¯¼å…¥ï¼ˆ2ï¼‰Duplicate input ids that would otherwise clash can be put into separate id spaceï¼Œè¡¨ç¤ºæœ‰IDé‡å¤ï¼ŒæŒ‰æç¤ºæŸ¥è¯¢ï¼ˆ3ï¼‰panic calledï¼Œso exitingè¡¨ç¤ºå‡ºçŽ°ç‰¹æ®Šç¬¦å·ï¼Œå¯æ£€æŸ¥åˆ—ä¸­å¯å«æœ‰ç‰¹æ®Šç¬¦å· â€“multiline-fields=true :å¤šè¡Œå¯¼å…¥â€“skip-bad-relationships=trueï¼šè¿‡æ»¤é”™è¯¯çš„å…³ç³»ä¸å¯¼å…¥ï¼Œå¯ä»¥åœ¨logä¸­æŸ¥çœ‹â€“bad-tolerance=2000ï¼šé”™è¯¯çš„æœ€å¤§é™åˆ¶åœ¨2000ä¸ª]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[LRU(Least recently used-æœ€ä¹…æœªä½¿ç”¨ç®—æ³•)]]></title>
      <url>%2F2016%2F09%2F22%2FLeast_recently_used%2F</url>
      <content type="text"><![CDATA[ä»…ä¾›å­¦ä¹ äº¤æµ,å¦‚æœ‰é”™è¯¯è¯·æŒ‡å‡º,å¦‚è¦è½¬è½½è¯·åŠ ä¸Šå‡ºå¤„,è°¢è°¢ çŽ°åœ¨çš„æ•°æ®è¶Šæ¥è¶Šå¤šçš„è¢«å­˜å‚¨ï¼Œå¯¹äºŽæ•°æ®åº“æ¥è®²ï¼Œè®¿é—®å¤§æ•°æ®é‡ä¼šå˜å¾—è¶Šæ¥è¶Šæ…¢ï¼ŒäºŽæ˜¯ä¸ºäº†æé«˜è®¿é—®çš„é€Ÿåº¦ï¼Œå°†å°èŒƒå›´åŒºåŸŸçš„æ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªé«˜é€Ÿç¼“å†²å­˜å‚¨å™¨ï¼Œä»¥è‡³äºŽä¸ä¼šæ¯æ¬¡åŽ»è¯»å–ç£ç›˜ï¼Œè€Œæ˜¯åœ¨å†…å­˜ä¸­ç›´æŽ¥è®¿é—®æ•°æ®ã€‚å†…å­˜å­˜å‚¨çš„ä»£ä»·è¿œè¿œçš„å¤§äºŽç£ç›˜å­˜å‚¨çš„ä»·å€¼ï¼Œæ‰€ä»¥ç¼“å­˜å¾ˆå°ï¼Œå¹¶ä¸èƒ½å­˜å‚¨ä½ æ‰€æœ‰çš„æ•°æ®ï¼Œæ‰€ä»¥ä½ ä¸å¾—ä¸ä¿å­˜ä½ æ‰€è®¤ä¸ºé‡è¦çš„æ•°æ®(ä½¿ç”¨æ¬¡æ•°è¾ƒå¤šçš„æ•°æ®)ï¼Œé‚£å°±è¦æ·˜æ±°æœ€å°‘ä½¿ç”¨çš„æ•°æ®ï¼Œå¦‚ä½•ä»Žç¼“å­˜ä¸­æ·˜æ±°æœ€å°‘ä½¿ç”¨çš„æ•°æ®ï¼Œä¸€ä¸ªç®€å•è€Œä¸”æœ‰æ•ˆçš„ç®—æ³•ï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•LRU. LRUåŽŸç†æœ€ä¹…æœªä½¿ç”¨ç®—æ³•ï¼ˆLRUï¼‰ï¼šæœ€ä¹…æ²¡æœ‰è®¿é—®çš„å†…å®¹ä½œä¸ºæ›¿æ¢å¯¹è±¡ â€”â€“ æ¥è‡ªwiki LRUç¿»è¯‘è¿‡æ¥å°±æ˜¯æœ€ä¹…æœªä½¿ç”¨ï¼Œå½“ç¼“å­˜åˆ°è¾¾ä¸€å®šçš„é˜€å€¼æ—¶ï¼Œå‰”é™¤æŽ‰æœ€ä¹…æœªä½¿ç”¨çš„æ•°æ®ï¼Œé€šä¿—æ¥è®²ï¼Œæ¯”å¦‚ä¸€ä¸ªç¼“å­˜åªèƒ½ç¼“å­˜10000æ¡æ•°æ®ï¼Œ10000æ¡å°±æ˜¯è¿™ä¸ªç¼“å­˜çš„é˜€å€¼ï¼Œå°äºŽ10000æ¡æ—¶å¯ä»¥éšæ„æ·»åŠ ï¼Œä¸€æ—¦æ•°æ®é‡åˆ°è¾¾äº†10000æ¡æ—¶ï¼Œè¿™ä¸ªæ—¶å€™å°±è¦åˆ é™¤æœ€ä¹…æœªä½¿ç”¨çš„æ•°æ®äº†ï¼Œä»¥ä¿æŒæœ€å¤§ç¨‹åº¦çš„ä½¿ç”¨ç¼“å­˜ã€‚ LRUå®žçŽ°LRUçš„å®žçŽ°æœ€ç®€å•çš„å°±æ˜¯å•é“¾è¡¨çš„å®žçŽ°ï¼Œè¿™é‡Œå¼•ç”¨çš„å°±æ˜¯JDKä¸­çš„LinkedHashMap,å®ƒæœ‰ä¸¤ç§å½¢å¼ï¼Œä¸€ä¸ªæ˜¯æœ€æ™šè¯»çš„æ•°æ®æ”¾åœ¨å‰é¢ï¼Œæœ€æ—©è¯»çš„æ•°æ®æ”¾åœ¨åŽé¢ï¼Œå¦ä¸€ä¸ªå°±æ˜¯FIFOï¼Œä¹Ÿå°±æ˜¯å…ˆè¿›å…ˆå‡ºã€‚ æ™šè¯»æ”¾å‰ï¼Œæ—©è¯»æ”¾åŽ æ¯æ¬¡æ–°çš„æ•°æ®ä»Žå¤´éƒ¨å¼€å§‹æ’å…¥ï¼Œå½“é“¾è¡¨ç¼“å­˜ç©ºé—´æ»¡äº†çš„æ—¶å€™ï¼Œå°±ä»Žå°¾éƒ¨å¯¹æ•°æ®è¿›è¡Œåˆ é™¤ï¼Œå¦‚æžœæœ‰æ•°æ®å‘½ä¸­çš„è¯ï¼Œå°±å°†è¯¥æ•°æ®ç§»åŠ¨åˆ°å¤´éƒ¨ã€‚ è€ŒåŸºäºŽLinkedHashMapçš„å®žçŽ°æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ç§å°±æ˜¯ç»§æ‰¿LinkedHashMapçš„æ–¹å¼ï¼Œå«åšinheritanceï¼Œä¸€ç§ç›´æŽ¥ä½¿ç”¨LinkedHashMap,å«åšdelegationï¼Œè¿™ä¸¤ç§éƒ½å¯ä»¥å®žçŽ°LRUç®—æ³•ï¼Œè€Œå¤§éƒ¨åˆ†åŠŸèƒ½LinkedHashMapå·²ç»å®žçŽ°äº†,ä½†æ˜¯æ·˜æ±°çš„åˆ é™¤æ–¹æ³•å°±éœ€è¦é‡å†™äº†ã€‚12345678public LinkedHashMap(int initialCapacity, float loadFactor, boolean accessOrder) &#123; super(initialCapacity, loadFactor); this.accessOrder = accessOrder;&#125; protected boolean removeEldestEntry(Map.Entry&lt;K,V&gt; eldest) &#123; return false;&#125; è¿™æ˜¯LinkedHashMapçš„æž„é€ æ–¹æ³•å’Œåˆ é™¤å…ƒç´ çš„æ–¹æ³•ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒLinkedHashMapæ˜¯æ ¹æ®å…ƒç´ çš„æ·»åŠ é¡ºåºè¿›è¡Œå­˜å‚¨çš„,å¦‚æžœæž„é€ å‚æ•°accessOrderä¸ºtrueçš„è¯ï¼Œå°±ä¼šæŒ‰ç…§è®¿é—®æ•°æ®ï¼Œæœ€æ™šè®¿é—®çš„æ”¾åœ¨æœ€å‰ï¼Œæœ€æ—©è®¿é—®çš„æ”¾åœ¨æœ€åŽã€‚ inheritance12345678910111213public class LruInheritance&lt;K, V&gt; extends LinkedHashMap&lt;K, V&gt; &#123; private final int MAX_SIZE=100; public LruInheritance(int cacheSize) &#123; super((int) Math.ceil(cacheSize / 0.75)+1, 0.75f, true); MAX_SIZE = cacheSize; &#125; @Override protected boolean removeEldestEntry(Map.Entry eldest) &#123; return size() &gt; MAX_SIZE; &#125;&#125; åœ¨æž„é€ æ–¹æ³•ä¸­ï¼Œç”±äºŽå°†è´Ÿè½½å› å­è®¾ç½®ä¸º0.75ï¼Œæ‰€ä»¥åœ¨åŽŸæœ‰å®¹é‡è¦é™¤ä»¥è¯¥è´Ÿè½½å› å­ï¼Œå› ä¸ºMapä¸­çš„é˜€å€¼æ˜¯åŽŸæœ‰å®¹é‡*è´Ÿè½½å› å­ï¼Œä»¥æ­¤æ¥åˆ¤æ–­æ˜¯å¦è¶…æ ‡ã€‚è€ŒåŽŸæœ¬LinkedHashMapåˆ é™¤çš„æœºåˆ¶è¿”å›žçš„éƒ½æ˜¯falseï¼Œæ‰€ä»¥è¦é‡å†™removeEldestEntryæ–¹æ³•,å¦‚æžœè¶…è¿‡å½“å‰å®¹é‡å°±è¿”å›žtrueï¼Œå°±ä¼šåˆ é™¤å½“å‰å…ƒç´ äº†ã€‚ delegation12345678910111213141516public class LruDelegation&lt;K, V&gt; &#123; private final int MAX_SIZE; LinkedHashMap&lt;K, V&gt; map; public LruDelegation(int cacheSize) &#123; MAX_CACHE_SIZE = cacheSize; int capacity = (int) Math.ceil(MAX_SIZE / 0.75) + 1; map = new LinkedHashMap(capacity, 0.75f, true) &#123; @Override protected boolean removeEldestEntry(Map.Entry eldest) &#123; return size() &gt; MAX_SIZE; &#125; &#125;; &#125;&#125; åœ¨è¿™ä¸ªæž„é€ æ–¹æ³•ä¸­ï¼Œå®ƒå†…éƒ¨å°±æ˜¯ç”¨å·²ç»é‡å†™removeEldestEntryæ–¹æ³•çš„LinkedHashMapå®žçŽ°çš„ï¼Œä»–ä¸Žinheritanceä¸åŒçš„æ˜¯ï¼Œå¯¹LinkedHashMapä¸åŒä½¿ç”¨ï¼Œä¸€ä¸ªå½“çˆ¹ä½¿ï¼Œä¸€ä¸ªå½“æœ‹å‹ä½¿ã€‚ FIFO(å…ˆè¿›å…ˆå‡º)å…¶å®žä¸Žç¬¬ä¸€ç§æ–¹å¼ç›¸æ¯”ï¼Œå¯¹äºŽLinkedHashMapæ¥è®²ï¼Œå°±æ˜¯accessOrderå‚æ•°çš„å˜åŒ–ï¼Œä¸Šé¢ä¹Ÿæåˆ°ï¼ŒLinkedHashMapé»˜è®¤çš„æ˜¯FIFOçš„ï¼Œæž„é€ å‚æ•°accessOrderé»˜è®¤æ˜¯falseçš„ï¼Œæ‰€ä»¥ä¸Žç¬¬ä¸€ç§ç›¸æ¯”ï¼Œåªè¦å°†accessOrderç½®ä¸ºfalseï¼Œæˆ–è€…ä½¿ç”¨ä¸€ä¸ªæ— å‚æž„é€ ï¼Œå°±å¯ä»¥å®žçŽ°äº†ã€‚1234567final int MAX_SIZE= 100;LinkedHashMap&lt;Integer, String&gt; lru = new LinkedHashMap&lt;Integer, String&gt;() &#123; @Override protected boolean removeEldestEntry(Map.Entry&lt;Integer, String&gt; eldest) &#123; return size() &gt; MAX_SIZE; &#125;&#125;; è¿™ç§æ˜¯åŸºäºŽå•é“¾è¡¨å®žçŽ°LRUç¼ºç‚¹æ˜¯ï¼šç”±äºŽLinkedHashMapæœ¬èº«ç‰¹æ€§ï¼Œæ‰€ä»¥æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œè€Œä¸”å‘½ä¸­çŽ‡ä¸é«˜ã€‚ä¼˜ç‚¹æ˜¯ï¼šå®žçŽ°èµ·æ¥ç®€å•ï¼Œå¾ˆå¤šä¸œè¥¿LinkedHashMapå·²ç»å¸®ä½ å®žçŽ°äº† å…¶å®žå¤šé“¾è¡¨æˆ–è€…å¤šé˜Ÿåˆ—çš„ç»„åˆä½¿ç”¨ï¼Œæ•ˆçŽ‡å’Œå‘½ä¸­å¾ˆæ›´é«˜ï¼Œä¸€ä¸ªé“¾è¡¨æˆ–é˜Ÿåˆ—ä¸“é—¨ç”¨æ¥ç»´æŠ¤å‘½ä¸­æ¦‚çŽ‡ï¼ˆä½œä¸ºè®¿é—®åŽ†å²æ•°æ®å­˜å‚¨ï¼‰ï¼Œå¦ä¸€ä¸ªä½œä¸ºå¤šæ¬¡è®¿é—®æ•°æ®å­˜å‚¨ ### æ–°çš„æ•°æ®éƒ½ä¼šä»ŽåŽ†å²æ•°æ®çš„é˜Ÿåˆ—çš„å¤´éƒ¨æ’å…¥,å¦‚æžœå½“å‰é˜Ÿåˆ—å®¹é‡æ»¡äº†ä¹‹åŽï¼Œå°±ä¼šä»Žå°¾éƒ¨æ·˜æ±°ï¼Œå¦‚æžœå½“å‰åŽ†å²æ•°æ®è¢«è®¿é—®å¤šæ¬¡ï¼Œå°±ä¼šç§»åŠ¨åˆ°æ­£å¼çš„LRUæ•°æ®é˜Ÿåˆ—ä¸­ï¼Œç„¶åŽæŒ‰æ—¶é—´æŽ’åºï¼Œå½“è¯¥é˜Ÿåˆ—æ»¡äº†ä¹‹åŽï¼Œå°±ä¼šä»Žå°¾éƒ¨æ·˜æ±°ã€‚å¤šä¸ªé“¾è¡¨æˆ–é˜Ÿåˆ—ç»„åˆçš„LRUèƒ½å¤Ÿåº”è¯¥å¤æ‚çš„åœºæ™¯,èƒ½å¤Ÿåº”å¯¹ä¸åŒæƒ…å†µï¼Œä¸åŒçš„æ·˜æ±°æœºåˆ¶,æé«˜æ•°æ®çš„å‘½ä¸­çŽ‡ï¼ŒåŒæ—¶å“åº”çš„ç»´æŠ¤æˆæœ¬ä¹Ÿå“åº”çš„æé«˜äº†ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[åˆè¯†HTTP-1]]></title>
      <url>%2F2016%2F09%2F06%2Fmeet-http-1%2F</url>
      <content type="text"><![CDATA[ä»…ä¾›å­¦ä¹ äº¤æµ,å¦‚æœ‰é”™è¯¯è¯·æŒ‡å‡º,å¦‚è¦è½¬è½½è¯·åŠ ä¸Šå‡ºå¤„,è°¢è°¢ å®šä¹‰HTTPè¯‘ä¸ºè¶…æ–‡æœ¬ä¼ è¾“åè®®,æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯ç»ˆç«¯ï¼ˆç”¨æˆ·ï¼‰å’ŒæœåŠ¡å™¨ç«¯ï¼ˆç½‘ç«™ï¼‰è¯·æ±‚å’Œåº”ç­”çš„æ ‡å‡†ï¼ˆTCPï¼‰,ä¹Ÿæ˜¯åŸºäºŽè¶…æ–‡æœ¬ä¸ºè½½ä½“åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯è¿›è¡Œä¼ è¾“çš„åè®®ã€‚ è¶…æ–‡æœ¬æ˜¯åŸºäºŽè¶…æ–‡æœ¬æž„å»ºè¯­è¨€æž„å»ºçš„æ–‡æ¡£ï¼Œæ¯”å¦‚HTML(HyperText Markup Language è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€)å°±æ˜¯æ ‡å‡†çš„æž„æˆè¶…æ–‡æœ¬çš„è¯­è¨€,è€Œä¼ è¾“ï¼ˆè½¬ç§»ï¼‰æ˜¯åŸºäºŽè¶…æ–‡æœ¬çš„å†…å®¹åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯è¿›è¡Œé€šä¿¡ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„è¶…æ–‡æœ¬ä¼ è¾“çš„è¿‡ç¨‹ï¼Œ]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[javaåå°„ç¬”è®°(java reflection)]]></title>
      <url>%2F2016%2F09%2F04%2Fjava_reflection%2F</url>
      <content type="text"><![CDATA[ä»…ä¾›å­¦ä¹ äº¤æµ,å¦‚æœ‰é”™è¯¯è¯·æŒ‡å‡º,å¦‚è¦è½¬è½½è¯·åŠ ä¸Šå‡ºå¤„,è°¢è°¢ javaæ˜¯ä¸€é—¨é™æ€è¯­è¨€ï¼Œä¸€èˆ¬æ¥è®²ï¼Œç±»çš„å®šä¹‰éœ€è¦åœ¨JVMè¿è¡Œå‰å®Œæˆï¼Œè¦é€šè¿‡JVMç¼–è¯‘çŽ¯èŠ‚ï¼Œæ‰èƒ½è¿è¡Œåœ¨JVMä¸Šï¼Œè€Œjavaåå°„æœºåˆ¶ä½¿javaçš„ç±»å®šä¹‰èƒ½å¤Ÿåœ¨JVMè¿è¡Œæ—¶åŠ¨æ€çš„åŠ è½½ï¼Œè®©åœ¨æŸäº›åŠŸèƒ½ä¸Šæ›´åŠ çµæ´»å¤šç”¨ï¼Œæ ¹æ®ä¸åŒçš„ä¸Šä¸‹æ–‡æ¥å†³å®šç±»çš„åŠŸèƒ½ Classåœ¨æ¯ä¸€ä¸ªç±»éƒ½æœ‰Classå¯¹è±¡ï¼Œåœ¨JVMç¼–è¯‘çš„çŽ¯èŠ‚ä¸­ï¼Œä»–ä¼šæ£€æŸ¥ç±»çš„ä¿¡æ¯ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šèŽ·å–è¯¥ç±»çš„Classå¯¹è±¡ï¼Œå®ƒåŒ…å«äº†è¯¥ç±»çš„æ‰€æœ‰ä¿¡æ¯,èŽ·å–Classå¯¹è±¡æœ‰å¾ˆå¤šç§æ–¹æ³•ã€‚ èŽ·å–Classå¯¹è±¡1.åˆ©ç”¨ç±»æœ¬èº«çš„æƒ…å†µä¸‹ 1Class myClass = className.class; 2.åˆ©ç”¨ç±»åçš„æƒ…å†µä¸‹ 1Class myClass = Class.forName("className"); æ³¨æ„ï¼šåœ¨ä½¿ç”¨ç±»åèŽ·å–Classå¯¹è±¡æ—¶ï¼Œå‚æ•°åç§°å¿…é¡»æ˜¯ç±»çš„å…¨ç§°ï¼ŒåŒ…æ‹¬åŒ…çš„åç§°ï¼Œè¿™æ ·æ‰èƒ½æ‰¾å¾—åˆ° 3.åˆ©ç”¨ç±»å¯¹è±¡çš„æƒ…å†µä¸‹ 1Class myClass = new Object().getClass(); å½“ç„¶ï¼Œä½ æ‹¥æœ‰Classå¯¹è±¡ï¼Œç­‰äºŽä½ å°±çŸ¥é“è¯¥ç±»çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬å˜é‡ï¼Œæ–¹æ³•ï¼Œä¿®é¥°ç¬¦ï¼Œæ³¨è§£ï¼Œç”šè‡³å®ƒçš„çˆ¶ç±»ï¼Œå®žçŽ°çš„æŽ¥å£ï¼Œæ‰€åœ¨åŒ…çš„ä¿¡æ¯ï¼Œå…·ä½“çš„æ–¹æ³•å¯ä»¥å‚è€ƒç›¸åº”çš„æ–‡æ¡£ï¼šhttp://docs.oracle.com/javase/6/docs/api/java/lang/Class.html Constructoråœ¨javaä¸­ï¼Œåˆ›å»ºå®žä¾‹å¯¹è±¡æ˜¯æ ¹æ®æž„é€ å™¨æ¥å®žçŽ°çš„ï¼ŒJVMç¼–è¯‘çŽ¯èŠ‚é€šè¿‡Constructoræ¥æ£€æŸ¥ç±»ä¸­æž„é€ æ–¹æ³•çš„ä¿¡æ¯ï¼ŒConstructoræ‹¥æœ‰æž„é€ æ–¹æ³•æ‰€æœ‰çš„ä¿¡æ¯ï¼Œå¦‚æžœæˆ‘ä»¬èŽ·å–äº†Constructorå¯¹è±¡ï¼Œä¹Ÿå°±å¯ä»¥åå°„å‡ºæ‹¥æœ‰è¯¥æž„é€ å™¨çš„å¯¹è±¡ã€‚ èŽ·å–Constructorå¯¹è±¡1.èŽ·å–æ‰€æœ‰çš„Constructorå¯¹è±¡ 1Constructor[] constructors = myClass.getConstructors(); 2.èŽ·å–æŒ‡å®šçš„æž„é€ å™¨ 1Constructor constructor = myClass.getConstructor(String.class); getConstructoræ–¹æ³•çš„å‚æ•°æ˜¯æž„é€ æ–¹æ³•çš„å‚æ•°çš„Classå¯¹è±¡ å®žä¾‹åŒ–å¯¹è±¡12Object obj = constructor.newInstance("å‚æ•°å€¼"); ç›¸å½“äºŽSimpleReflection simpleReflection = new SimpleReflection(â€œå‚æ•°å€¼â€)ï¼ŒnewInstanceæ–¹æ³•çš„å‚æ•°æ˜¯æž„é€ æ–¹æ³•çš„å‚æ•°çš„å®žä¾‹ Fieldåœ¨javaçš„JVMç¼–è¯‘çŽ¯èŠ‚ä¸­ï¼Œé€šè¿‡Fieldæ¥æ£€æŸ¥ç±»å˜é‡çš„ä¿¡æ¯,å®ƒæ‹¥æœ‰ç±»å˜é‡æ‰€æœ‰çš„ä¿¡æ¯ã€‚ èŽ·å–Fieldå¯¹è±¡å…¬æœ‰(public)å˜é‡1.èŽ·å–æ‰€æœ‰Field 1Field[] fields = myClass.getFields(); 2.èŽ·å–æŒ‡å®šçš„Field 1Field field = myClass.getField(); ç§æœ‰(private)å˜é‡1.èŽ·å–æ‰€æœ‰Field 1Field[] privateFields = myClass.getDeclaredFields(); 2.èŽ·å–æŒ‡å®šçš„Field 1Field privateField = myClass.getDeclaredField(); èŽ·å–å˜é‡å±žæ€§1.èŽ·å–å˜é‡åç§° 1String fieldName = field.getName(); 2.èŽ·å–å˜é‡ç±»åž‹ 1Class fieldType = field.getType(); set&amp;getå˜é‡å…¬æœ‰(public)å˜é‡12Object value = field.get(new Object());field.set(new Object(), value); ç§æœ‰(private)å˜é‡é€šå¸¸æƒ…å†µä¸‹ï¼Œå¤–éƒ¨ç±»æ˜¯ä¸èƒ½è®¿é—®å†…éƒ¨çš„ç§æœ‰å˜é‡çš„ï¼Œå› ä¸ºåœ¨è®¿é—®å¯¹è±¡å˜é‡æ—¶ï¼ŒJVMä¼šæœ‰ä¸€ä¸ªåå°„è®¿é—®æ£€æŸ¥(reflection access check),ç§æœ‰å˜é‡æ²¡æœ‰è®¿é—®æƒé™æ˜¯ä¸èƒ½è®¿é—®çš„ï¼Œåœ¨Fieldå¯¹è±¡æœ‰ä¸€ä¸ªsetAccessibleæ–¹æ³•ï¼Œtrueè¡¨ç¤ºåœ¨å¤–éƒ¨å¯¹è±¡çš„ä½œç”¨åŸŸé‡Œå¯ä»¥è®¿é—®ç§æœ‰å˜é‡ã€‚ 123privateField.setAccessible(true);Object value = privateField.get(new Object());privateField.set(new Object(), value); éžé™æ€å˜é‡çš„Field.get()å’ŒField.set()æ–¹æ³•éœ€è¦æŒ‡å®šè¯¥å˜é‡æ‰€å±žçš„å¯¹è±¡ï¼Œå› ä¸ºæ¯ä¸ªå¯¹è±¡é‡Œæœ‰å¾ˆå¤šç›¸åŒå˜é‡ï¼Œå®ƒä»¬ç‹¬è‡ªäº«æœ‰ä¸€å—å†…å­˜ï¼Œå¦‚æžœä¸æŒ‡å®šå¯¹è±¡ï¼Œå°±ä¼šæœ‰æ­§ä¹‰ï¼Œè€Œå¯¹äºŽé™æ€å˜é‡ï¼Œå¯ä»¥å°†å‚æ•°è®¾ç½®ä¸ºNULLï¼Œå› ä¸ºåœ¨ç±»åŠ è½½æ—¶ï¼Œæ˜¯å…ˆåŠ è½½é™æ€å˜é‡ï¼ŒåŽåŠ è½½æž„é€ æ–¹æ³•ï¼Œæ‰€ä»¥é™æ€å˜é‡å’Œå¯¹è±¡æ²¡æœ‰å¿…è¦çš„å…³ç³»ã€‚ Methodåœ¨javaçš„JVMç¼–è¯‘çŽ¯èŠ‚ä¸­ï¼Œé€šè¿‡Methodæ¥æ£€æŸ¥æ–¹æ³•çš„ä¿¡æ¯,å®ƒæ‹¥æœ‰æ–¹æ³•æ‰€æœ‰çš„ä¿¡æ¯ã€‚ èŽ·å–Methodå¯¹è±¡å…¬æœ‰(public)æ–¹æ³•1.èŽ·å–æ‰€æœ‰çš„æ–¹æ³•1Method[] methods = myClass.getMethods(); 2.èŽ·å–æŒ‡å®šçš„æ–¹æ³•1Method method = myClass.getMethod("methodName", new Class[]&#123; String.class&#125;); ç§æœ‰(private)æ–¹æ³•1.èŽ·å–æ‰€æœ‰çš„æ–¹æ³•1Method[] privateMethods = myClass.getDeclaredMethods(); 2.èŽ·å–æŒ‡å®šçš„æ–¹æ³•1Method privateMethod = myClass.getDeclaredMethod("methodName", new Class[]&#123; String.class&#125;); èŽ·å–Methodä¿¡æ¯1.èŽ·å–æ–¹æ³•å1String methodName = method.getName(); 2.èŽ·å–è¿”å›žç±»åž‹1Class methodType = method.getReturnType(); 3.èŽ·å–å‚æ•°ç±»åž‹1Class[] types = method.getExceptionTypes(); Methodè®¿é—®æ–¹æ³•å…¬æœ‰(public)æ–¹æ³•1Object returnValue = method.invoke(new Object(), "æ–¹æ³•å‚æ•°åˆ—è¡¨"); ç§æœ‰(private)æ–¹æ³•åŽŸç†å’ŒFieldä¸€æ ·ï¼Œåœ¨JVMåå°„è®¿é—®æ£€æŸ¥æ—¶ï¼Œé€šè¿‡setAccessibleæ–¹æ³•æ¥è®¾ç½®ç§æœ‰æ–¹æ³•çš„è®¿é—®æƒé™ã€‚12privateMethod.setAccessible(true);Object returnValue = privateMethod.invoke(new Object(), "æ–¹æ³•å‚æ•°åˆ—è¡¨"); æ–¹æ³•ä¹Ÿæœ‰é™æ€çš„ï¼Œæ‰€ä»¥åœ¨invokeæ–¹æ³•ä¸­å¦‚æžœæ˜¯é™æ€æ–¹æ³•å¯ä»¥è®¾ç½®æˆNULL. Annotationæ³¨è§£åœ¨java 5æ‰å‡ºçŽ°ï¼Œå®ƒæ‰©å±•äº†ç±»ï¼Œå±žæ€§ï¼Œæ–¹æ³•ï¼Œå‚æ•°ç­‰ï¼Œåœ¨JVMç¼–è¯‘æ—¶ï¼Œé€šè¿‡Annotationæ¥æ£€æŸ¥æ³¨è§£çš„ä¿¡æ¯ ç±»æ³¨è§£1.èŽ·å–æ‰€æœ‰çš„æ³¨è§£1Annotation[] annotations = myClass.getAnnotations(); 2.èŽ·å–æŒ‡å®šçš„æ³¨è§£1Annotation annotation = myClass.getAnnotation(MyAnnotation.class); æ–¹æ³•æ³¨è§£1.èŽ·å–æ‰€æœ‰çš„æ³¨è§£1Annotation[] annotations = method.getAnnotations(); 2.èŽ·å–æŒ‡å®šçš„æ³¨è§£1Annotation annotation = method.getAnnotation(MyAnnotation.class); å‚æ•°æ³¨è§£12345Annotation[][] parameterAnnotations = method.getParameterAnnotations();for(Annotation[] annotations : parameterAnnotations)&#123; for(Annotation annotation : annotations)&#123; &#125;&#125; å˜é‡æ³¨è§£1.èŽ·å–æ‰€æœ‰çš„æ³¨è§£1Annotation[] annotations = field.getAnnotations(); 2.èŽ·å–æŒ‡å®šçš„æ³¨è§£1Annotation annotation = field.getAnnotation(MyAnnotation.class); è®¿é—®æ³¨è§£ä¿¡æ¯1234if(annotation instanceof MyAnnotation)&#123; MyAnnotation myAnnotation = (MyAnnotation) annotation; System.out.println("name: " + myAnnotation.name());//å‡è®¾æ³¨è§£ä¸­æœ‰nameå±žæ€§ï¼Œå°±å¯ä»¥è¿™æ ·è®¿é—®äº†&#125; Arrayåœ¨javaä¸­ï¼Œæ•°ç»„æ˜¯ä¸€ä¸ªå¾ˆç‰¹æ®Šçš„å¯¹è±¡ï¼Œå®ƒä¸ç»§æ‰¿äºŽObjectï¼Œå®ƒä»¬æ²¡æœ‰Objectçš„æ‰€æœ‰å±žæ€§å’Œæ–¹æ³•ï¼Œæ‰€ä»¥å®ƒä¸æ˜¯æœ‰æŸä¸ªç±»å®žä¾‹åŒ–å‡ºæ¥çš„ï¼Œå®ƒæ˜¯ç”±JVMåŠ¨æ€åˆ›å»ºçš„ï¼ŒJVMæœ‰ä¸€ä¸ªArrayé€šè¿‡åå°„æœºåˆ¶æ¥å¤„ç†æ•°ç»„ åˆ›å»ºæ•°ç»„1String[] arrays = (int[]) Array.newInstance(String.class, 3); ç›¸å½“äºŽString[] arrays = new String(3),newInstanceæ–¹æ³•ä¸­çš„å‚æ•°ä¸ºæ•°ç»„çš„ç±»åž‹å’Œå¤§å° è®¿é—®æ•°ç»„set(å¯¹æ•°ç»„èµ‹å€¼)12Array.set(arrays, 0, 'hello');Array.set(arrays, 1, 'world'); setæ–¹æ³•å‚æ•°ä¸ºåˆ«ä¸ºç›®æ ‡æ•°ç»„ï¼Œæ•°ç»„ä¸‹æ ‡ï¼Œå€¼ã€‚ get(èŽ·å–æ•°ç»„å€¼)1Array.get(arrays,0); getæ–¹æ³•å‚æ•°åˆ†åˆ«æ˜¯ç›®æ ‡æ•°ç»„ï¼Œæ•°ç»„ä¸‹æ ‡ã€‚ èŽ·å–Classå¯¹è±¡é€šè¿‡classå±žæ€§1Class class = String[].class; é€šè¿‡forNameæ–¹æ³•1Class intArray = Class.forName("[I"); â€œ[â€œä»£è¡¨çš„æ˜¯æ•°ç»„ï¼Œâ€Iâ€ä»£è¡¨çš„æ˜¯intç±»åž‹(é’ˆå¯¹äºŽåŸºæœ¬ç±»åž‹)ï¼Œè¿™ä¸ªæ˜¯åŽŸç”Ÿçš„æ•°ç»„åˆ›å»ºï¼Œå› ä¸ºåœ¨JVMåˆ›å»ºæ•°ç»„ï¼Œç±»åå°±æ˜¯â€[Iâ€ã€‚ è€Œå¯¹äºŽæ™®é€šç±»åž‹æ¥è®²ï¼Œåˆ›å»ºæ•°ç»„å°±éœ€è¦æ˜Žç¡®ç±»åž‹ï¼š1Class intArray = Class.forName("[Ljava.lang.String;"); â€œ[Lâ€å£°æ˜Žæ™®é€šç±»åž‹æ•°ç»„ï¼Œâ€java.lang.Stringâ€è¡¨ç¤ºç±»åž‹(ç±»åž‹å…¨ç§°)ï¼Œâ€;â€è¡¨ç¤ºç»“æŸ é€šè¿‡getClassæ–¹æ³•1Class class = arrays.getClass(); èŽ·å–æ•°ç»„å±žæ€§èŽ·å–æ•°ç»„ç±»åž‹1Class type = class.getComponentType(); å‚è€ƒhttp://ifeve.com/java-reflection/]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[HashMapçš„æ­»å¾ªçŽ¯(HashMap infinite loop)]]></title>
      <url>%2F2016%2F08%2F28%2FHashMap_infinite_loop%2F</url>
      <content type="text"><![CDATA[ä»…ä¾›å­¦ä¹ äº¤æµ,å¦‚æœ‰é”™è¯¯è¯·æŒ‡å‡º,å¦‚è¦è½¬è½½è¯·åŠ ä¸Šå‡ºå¤„,è°¢è°¢ HashMapæ˜¯ä¸€ä¸ªçº¿ç¨‹ä¸å®‰å…¨çš„key-valueçš„å­˜å‚¨é›†åˆï¼Œä¹Ÿæ„å‘³ç€å®ƒåœ¨å¤šçº¿ç¨‹çš„çŽ¯å¢ƒä¸­ä¹Ÿå­˜åœ¨å¾ˆå¤§çš„é£Žé™©ã€‚ HashMapçš„å­˜å‚¨ç»“æž„ï¼š é€šå¸¸æ¥è®²ï¼ŒHashMapæ˜¯ç”±ä¸€ä¸ªæ•°ç»„å’Œä¸€ä¸ªé“¾è¡¨ç»„æˆï¼Œåœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼ŒHashMapä¼šåˆå§‹åŒ–ä¸€ä¸ªæ•°ç»„table[],åœ¨ä¸æŒ‡å®šå®¹é‡çš„æƒ…å†µä¸‹é»˜è®¤ä¸º16ï¼Œè´Ÿè½½ç³»æ•°ä¸º0.75ï¼ŒHashMapåœ¨putçš„æ—¶å€™ä¼šé€šè¿‡keyçš„hashå€¼æ¥è®¡ç®—è¿™ä¸ªæ•°ç»„çš„ä¸‹æ ‡ï¼Œç„¶åŽå°±æŠŠè¿™ä¸ªå­˜å‚¨é›†åˆå­˜å‚¨åœ¨è¯¥ä¸‹æ ‡çš„æ•°ç»„ä¸­ï¼Œåœ¨æŸ¥æ‰¾æ—¶çš„å¤æ‚åº¦ä¸ºO(1),ç„¶è€Œåœ¨Hashç®—æ³•ä¸­ï¼Œå¾ˆæœ‰å¯èƒ½å­˜åœ¨ä¸åŒçš„keyç®—å‡ºç›¸åŒçš„å€¼ï¼ŒHashMapå°±ä¼šæŠŠç›¸åŒçš„å€¼ç”¨é“¾è¡¨æ¥è¡¨ç¤ºï¼Œè¿™ä¸ªæ—¶å€™å°±è¦éåŽ†é“¾è¡¨äº†ï¼ŒæŸ¥æ‰¾å¤æ‚åº¦ä¸ºO(n) æ­£æ˜¯ç”±äºŽé“¾è¡¨çš„å­˜åœ¨ï¼Œåœ¨å¤šçº¿ç¨‹çš„çŽ¯å¢ƒä¸‹ï¼Œå…±äº«é“¾è¡¨ï¼Œè¿™å°±ä¼šå˜å¾—ä¸å®‰å…¨äº† ä»€ä¹ˆæ—¶å€™é“¾è¡¨ä¼šå˜å¾—ä¸å®‰å…¨å‘¢ï¼ŸHashMapçš„å®¹é‡æ˜¯åŠ¨æ€çš„ï¼Œéšç€å®¹é‡çš„å¢žåŠ è€Œå¢žé‡ï¼Œåœ¨æ¯æ¬¡putçš„æ—¶å€™éƒ½ä¼šæ£€æŸ¥å½“å‰çš„å®¹é‡æ˜¯å¦æ»¡è¶³ï¼Œå‡è®¾ä¸Šè¿°å›¾ç‰‡çš„å®¹é‡ä¸º4ï¼Œå¦‚æžœå½“å‰çš„å®¹é‡å¤§äºŽ4ä¹˜ä»¥0.75(è´Ÿè½½å› å­)ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ª4ä¹˜ä»¥2çš„å®¹é‡çš„æ–°æ•°ç»„ï¼Œå°†è€çš„æ•°ç»„Copyåˆ°æ–°çš„æ•°ç»„ï¼Œç„¶åŽæ‰€æœ‰çš„å€¼å°±ä¼šé‡æ–°hashï¼Œä¹Ÿå°±æ˜¯rehash çŽ°åœ¨æˆ‘ä»¬æ¨¡æ‹Ÿä¸¤ä¸ªçº¿ç¨‹ä¸‹çš„rehashæƒ…å†µï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼šThread1ï¼ŒThread2ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹HashMapä¸­çš„rehashæ–¹æ³•transfer(). 123456789101112131415// tranfer()ç‰‡æ®µ// è¿™æ˜¯åœ¨resize()ä¸­è°ƒç”¨çš„æ–¹æ³•,resize()å°±æ˜¯HashMapæ‰©å®¹çš„æ–¹æ³• for (int j = 0; j &lt; src.length; j++) &#123; Entry e = src[j]; if (e != null) &#123; src[j] = null; do &#123; Entry next = e.next; //å‡è®¾çº¿ç¨‹1åœç•™åœ¨è¿™é‡Œå°±æŒ‚èµ·äº†,çº¿ç¨‹2ç™»åœº int i = indexFor(e.hash, newCapacity); e.next = newTable[i]; newTable[i] = e; e = next; &#125; while (e != null); &#125;&#125; æ­¤æ—¶è¿è¡Œå®ŒThread1ï¼š æ­¤æ—¶Entry eæ˜¯e1ï¼ŒEntry next = e.nextä¸­çš„nextæ˜¯next1,çº¢è‰²æ˜¯è¿˜æ²¡æœ‰å®Œæˆï¼ŒæŒ‡é’ˆæŒ‡å‘æ­¥éª¤è¿˜æ²¡æœ‰å¼€å§‹ã€‚çŽ°åœ¨Thread2ç™»åœºäº†ï¼ŒThread2è¿è¡Œå®Œç»“æž„å¦‚ä¸‹ï¼š å‘çŽ°ä¸ŽThread1çš„æƒ…å†µåˆšå¥½åè¿‡æ¥äº†ï¼Œæ­¤æ—¶Entry eæ˜¯e2ï¼ŒEntry next = e.nextä¸­çš„nextæ˜¯next2ï¼Œæ˜¯çš„ï¼ŒThread2å·²ç»å®Œæˆäº†æŒ‡é’ˆæŒ‡å‘æ“ä½œäº† 12345Entry next = e.next; int i = indexFor(e.hash, newCapacity);e.next = newTable[i];newTable[i] = e;e = next;//å‡è®¾Thread2å·²ç»èµ°äº†è¿™é‡Œ è¿™ä¸ªæ—¶å€™Thread1è¦ç™»åœºäº†ï¼Œä»ŽEntry next = e.next;å¼€å§‹ç»§ç»­è¿è¡Œä¸‹åŽ»,æ­¤æ—¶åœ¨Thread2çš„å½±å“ä¸‹Thread1è¿è¡Œçš„ç»“æž„å·²ç»å˜äº† æ­¤æ—¶ç”±äºŽThread2çš„å½±å“ï¼Œ(key:2 ,value:b)å·²ç»æŒ‡å‘äº†(key:1,value:a),è€Œçº¢çº¿æ˜¯Thread1æŽ¥ä¸‹æ¥çš„æ“ä½œ,å®ŒæˆæŒ‡é’ˆæŒ‡å‘æ“ä½œï¼Œå½“Thread1å®Œæˆæ—¶ç»“æž„å¦‚ä¸‹ è¿™ä¸ªæ—¶å€™ä½ å°±ä¼šå‘çŽ°åœ†åœˆå†…å½¢æˆäº†ä¸€ä¸ªé—­çŽ¯ï¼Œinfinite loopå°±å½¢æˆäº†ï¼ï¼ï¼ï¼]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[exportså’Œmodule.exportsçš„åŒºåˆ«]]></title>
      <url>%2F2016%2F08%2F22%2Fexports_module.exports%2F</url>
      <content type="text"><![CDATA[ä»…ä¾›å­¦ä¹ äº¤æµ,å¦‚æœ‰é”™è¯¯è¯·æŒ‡å‡º,å¦‚è¦è½¬è½½è¯·åŠ ä¸Šå‡ºå¤„,è°¢è°¢ é¦–å…ˆå¾—æ˜Žç¡®ä¸¤ä¸ªçš„å«ä¹‰ exports:é¦–å…ˆå¯¹äºŽæœ¬èº«æ¥è®²æ˜¯ä¸€ä¸ªå˜é‡ï¼ˆå¯¹è±¡ï¼‰ï¼Œå®ƒä¸æ˜¯moduleçš„å¼•ç”¨ï¼Œå®ƒæ˜¯{}çš„å¼•ç”¨ï¼Œå®ƒæŒ‡å‘module.exportsçš„{}æ¨¡å— module.exports:é¦–å…ˆï¼Œmoduleæ˜¯ä¸€ä¸ªå˜é‡ï¼ŒæŒ‡å‘ä¸€å—å†…å­˜ï¼Œexportsæ˜¯moduleä¸­çš„ä¸€ä¸ªå±žæ€§ï¼Œå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œç„¶åŽexportså±žæ€§æŒ‡å‘{}æ¨¡å— å†…å­˜ç¤ºæ„å›¾å¦‚ä¸‹ï¼š çŽ°åœ¨æ¥çœ‹çœ‹å®ƒä»¬åœ¨è¿ç”¨ä¸­çš„å¼‚åŒï¼š12exports.bar=function()&#123;&#125;;module.exports.bar=function()&#123;&#125; ä¸Šé¢çš„ä¸¤è¡Œä»£ç ï¼Œåˆ†åˆ«æ¥æš´éœ²ç›¸åŒçš„æ¨¡å—ï¼Œä¸¤ä¸ªæ–¹å¼æ˜¯ç­‰ä»·çš„ï¼Œå› ä¸ºä»–ä»¬æ”¹å˜çš„å†…å­˜æ˜¯æš´éœ²æ¨¡å—çš„{}ï¼Œä½¿æš´éœ²æ¨¡å—å˜æˆäº† exportså’Œmodule.exportsçš„ç­‰ä»·æ˜¯ç”±äºŽä»–ä»¬åœ¨æ“ä½œåŒä¸€å—å†…å­˜ï¼Œæ‰€ä»¥æ„ä¹‰æ˜¯ä¸€æ ·çš„12exports=function()&#123;&#125;;module.exports=function()&#123;&#125; çŽ°åœ¨æˆ‘ä»¬æŠŠbarå±žæ€§ç»™åŽ»æŽ‰ï¼Œè¿™æ—¶å€™æ•ˆæžœå°±å®Œå…¨ä¸ä¸€æ ·äº† è¿™æ—¶å€™exportså’Œmodule.exportsæ“ä½œçš„å°±ä¸æ˜¯åŒä¸€å—å†…å­˜äº†,exportsæŒ‡å‘äº†æ–°çš„å†…å­˜,å®žé™…ä¸Šmodule.exportsä¹ŸæŒ‡å‘äº†æ–°çš„å†…å­˜ï¼Œä½†æ˜¯nodejsä¸­å¯»æ‰¾çš„æ˜¯moduleå˜é‡ä¸‹çš„exportså±žæ€§æ‰€æŒ‡å‘çš„å†…å­˜å—,å¦‚æžœexportså’Œmodule.exportsæ“ä½œçš„ä¸æ˜¯åŒä¸€ä¸ªå†…å­˜å—çš„è¯ï¼Œexportså°±ä¸èµ·ä½œç”¨äº†ï¼Œæ‰€ä»¥ä¸ç®¡æ€Žä¹ˆæ ·ï¼Œä½¿ç”¨module.exportsæ˜¯ä¸‡æ— ä¸€å¤±çš„ã€‚ã€‚ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[dockerå­¦ä¹ ç¬”è®°]]></title>
      <url>%2F2016%2F07%2F07%2Fdocker%2F</url>
      <content type="text"><![CDATA[ä»…ä¾›å­¦ä¹ äº¤æµ,å¦‚æœ‰é”™è¯¯è¯·æŒ‡å‡º,å¦‚è¦è½¬è½½è¯·åŠ ä¸Šå‡ºå¤„,è°¢è°¢ ä»€ä¹ˆæ˜¯dockerdockeræ˜¯åŸºäºŽlinuxå†…æ ¸ï¼ˆæ¶‰åŠcgroupï¼Œnamespaceï¼Œä»¥åŠ AUFS ç±»çš„ Union FS ç­‰æŠ€æœ¯ï¼‰ï¼Œç”±goè¯­è¨€å¼€å‘çš„ï¼Œå®žé™…ä¸Šæ˜¯linuxçš„ä¸€ä¸ªç‹¬ç«‹å’Œè¢«éš”ç¦»çš„è¿›ç¨‹ï¼Œä¹Ÿå¯ä»¥ç§°ä¹‹ä¸ºå®¹å™¨ï¼Œå…¶ä¸­å«ä¹‰å¦‚ä¸Šé²¸é±¼èˆ¹çš„å›¾æ ‡ï¼ˆdockerçš„å›¾æ ‡ï¼‰ä¸€æ ·å½¢è±¡ï¼Œé²¸é±¼èˆ¹å°±åƒæ˜¯linuxä¸€æ ·ï¼Œèˆ¹æœ¬èº«ç›¸å½“äºŽå†…æ ¸ï¼Œèˆ¹ä¸Šå¯ä»¥è½½é‡çš„ç©ºé—´ç›¸å½“äºŽæ–‡ä»¶å­˜å‚¨ç³»ç»Ÿï¼Œè€Œåœ¨èˆ¹ä¸Šçš„ç®±å­å°±æ˜¯dockerï¼Œä»–åªæ˜¯è¿è¡Œåœ¨linuxå†…æ ¸ä¸Šï¼Œç®±å­å†…éƒ¨çš„ç©ºé—´ç›¸å½“äºŽå°åž‹çš„æ–‡ä»¶å­˜å‚¨ç³»ç»Ÿï¼Œè‡ªæˆä¸€ä½“ï¼Œä¸ä¼šå—åˆ°å¤–éƒ¨ç©ºé—´ï¼ˆå®¿ä¸»ï¼‰çš„å½±å“ï¼Œå¯ä»¥éšæ—¶æ¬åˆ°å¦ä¸€è‰˜èˆ¹(å†…æ ¸)è¿›è¡Œè¿è¾“ dockerå’Œä¼ ç»Ÿè™šæ‹Ÿæœºçš„åŒºåˆ«dockerå±žäºŽä¸€ç§è½»é‡çº§çš„è™šæ‹Ÿæœºï¼Œé‚£å®ƒæ¯”ä¼ ç»Ÿçš„è™šæ‹Ÿæœºç›¸æ¯”æœ‰ä»€ä¹ˆåŒºåˆ« ç”±ä¸Šå›¾å¯çŸ¥ï¼Œä¼ ç»Ÿçš„è™šæ‹Ÿæœºè¿è¡Œäº†ä¸€ä¸ªå®Œæ•´çš„Guest OS(æ“ä½œç³»ç»Ÿ)ï¼Œé€šè¿‡è™šæ‹ŸæŠ€æœ¯è¿è¡Œåœ¨å®¿ä¸»ä¸Šï¼Œè€Œdockerä¸Šæ²¡æœ‰è¿è¡Œä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œå®ƒåªæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œç”±dockerå¼•æ“Žè¿è¡Œåœ¨å®¿ä¸»ä¸Šï¼Œæœ¬è´¨ä¸Šæ¥è®²ä¼ ç»Ÿçš„è™šæ‹Ÿæœºæ˜¯åœ¨å®¿ä¸»ä¹‹ä¸Šè™šæ‹Ÿå‡ºä¸€å¥—ç¡¬ä»¶ï¼Œç‹¬ç«‹è¿è¡Œï¼Œè€Œdockeræ˜¯ç›´æŽ¥è¿è¡Œåœ¨å®¿ä¸»çš„å†…æ ¸ä¸Šï¼Œå…±äº«ç¡¬ä»¶èµ„æºï¼Œæ‰€ä»¥å®ƒçš„ä¼˜åŠ¿å¾ˆæ˜Žæ˜¾ èµ„æºåˆ©ç”¨ä¸Šæ›´é«˜æ•ˆ(æŽ¥è¿‘å®¿ä¸») è¿è¡Œé€Ÿåº¦é«˜(ä¸éœ€è¦å¦å¤–ä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿ) å¯ç§»æ¤æ€§é«˜(å…±äº«å†…æ ¸ï¼Œå¯ä»¥åœ¨å…¶ä»–çš„å®¿ä¸»ä¸Šè¿è¡Œ) å®‰è£…dockeræ”¯æŒå¾ˆå¤šä¸»æµå¹³å°çš„å®‰è£…ï¼ŒåŒ…æ‹¬windowsï¼Œmacï¼Œlinuxå„å¤§å‘è¡Œç‰ˆï¼Œåœ¨å®˜ç½‘ä¸Šå†™çš„å¾ˆè¯¦ç»†ï¼Œè¿™é‡Œè¯´å®‰è£…çš„ä¸€äº›æ³¨æ„ç‚¹ dockerå¯¹äºŽå®‰è£…çŽ¯å¢ƒæœ‰ä¸¤ä¸ªå¾ˆé‡è¦çš„è¦æ±‚ å®¿ä¸»æ˜¯linuxçš„64ä½ç³»ç»Ÿ å®¿ä¸»çš„å†…æ ¸ç‰ˆæœ¬ä¸èƒ½ä½ŽäºŽ3.10 å¦‚æžœä¸æ˜¯linux64ä½çš„ç³»ç»Ÿï¼Œé‚£åªæœ‰æ›´æ¢æˆ64ä½çš„ï¼Œå†…æ ¸ç‰ˆæœ¬å¯ä»¥é€šè¿‡uname -rshellå‘½ä»¤æŸ¥çœ‹ä½ ç³»ç»Ÿçš„å†…æ ¸ç‰ˆæœ¬ï¼Œå¦‚æžœå†…æ ¸ç‰ˆæœ¬è¿‡ä½Žï¼Œé€šè¿‡sudo apt-get install -y --install-recommends linux-generic-lts-xenialshellå‘½ä»¤åŽ»å‡çº§å†…æ ¸ï¼Œè¿™æ ·å°±å¯ä»¥å¼€å§‹dockerçš„å®‰è£…äº† å¦‚æžœåœ¨ä½¿ç”¨è„šæœ¬å®‰è£…çš„æ—¶å€™å‡ºé”™ï¼Œå¯èƒ½æ˜¯ç”±äºŽå›½å†…çš„é˜²ç«å¢™çš„åŽŸå› ï¼Œå¯ä»¥ä½¿ç”¨å›½å†…äº‘æœåŠ¡æä¾›çš„ä¿®æ”¹ç‰ˆæœ¬ é˜¿é‡Œäº‘ç‰ˆæœ¬ï¼š1curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh - DaoCloudç‰ˆæœ¬ï¼š1curl -sSL https://get.daocloud.io/docker | sh å¦‚æžœä½ çš„ç³»ç»Ÿå†…æ ¸ç¼ºå°‘AUFSå†…æ ¸é©±åŠ¨ï¼ˆè¿™æ˜¯dockeræœ€ä½³å®žè·µçš„å†…æ ¸ï¼‰çš„è¯ï¼Œå¯æ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤å®‰è£…1sudo apt-get install linux-image-extra-$(uname -r) linux-image-extra-virtual å¦‚æžœå®˜ç½‘çš„GPGå¯†é’¥åœ°å€æ— æ³•è¯†åˆ«ï¼Œå¯ä»¥æ‰§è¡Œå¦‚ä¸‹æŒ‡å®šè¿›è¡Œå®‰è£… 12sudo apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D å¦‚æžœä½ å·²ç»å®‰è£…å¥½äº†dockerå¼•æ“Žï¼Œè¿›è¡ŒdockeræœåŠ¡çš„å¯åŠ¨ï¼Œlinuxæ—§ç‰ˆæœ¬(CentOS 7ä¹‹å‰ï¼ŒUbuntu 12.04/14.04,Debian 7 Wheezy)çš„å¯åŠ¨æ–¹å¼ï¼š 1sudo service docker start å¦‚æžœæ˜¯é«˜ç‰ˆæœ¬(CentOS 7ä¹‹åŽï¼ŒUbuntu 16.04,Debian 8 Jessie/Stretch)çš„å¯åŠ¨æ–¹å¼ï¼š12sudo systemctl enable dockersudo systemctl start docker dockeræ ¸å¿ƒï¼šé•œåƒï¼Œå®¹å™¨ï¼Œä»“åº“å¼€å§‹dockerçš„ç¬¬ä¸€ä¸ªä¾‹å­hello world 1docker run hello-world ä»¥ä¸ŠæŒ‡ä»¤æ˜¯è¿è¡Œä¸€ä¸ªåä¸ºâ€˜hello-worldâ€™çš„é•œåƒï¼Œåˆ†è§£æˆä¸‹é¢çš„æ“ä½œ è¿è¡Œå®Œæˆä¼šç”Ÿæˆä¸€ä¸ªå®¹å™¨ï¼Œåˆ©ç”¨docker ps æŒ‡ä»¤å°±å¯ä»¥æŸ¥è¯¢ä½ æ‰€ç”Ÿæˆçš„å®¹å™¨ ç”±ä¸Šå¯çŸ¥ï¼Œè¿è¡Œhello-worldé•œåƒå¯ä»¥åˆ†è§£æˆä¸¤æ­¥ï¼š ä»Žæœ¬åœ°é•œåƒåº“æŸ¥æ‰¾ï¼Œå¦‚æžœåŒ¹é…åˆ™è¿è¡Œ å¦‚æžœæœ¬åœ°é•œåƒåº“æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ä¼šä»Žå®˜æ–¹ç»´æŠ¤çš„é•œåƒåº“å¼€å§‹æŸ¥æ‰¾è¿›è¡Œï¼Œå¦‚æžœåŒ¹é…åˆ™è¿è¡Œï¼Œä¸åŒ¹é…åˆ™æŠ¥é”™ ä¸Šé¢æ— è®ºæ˜¯æœ¬åœ°é•œåƒåº“ï¼Œè¿˜æ˜¯å®˜æ–¹é•œåƒåº“éƒ½æ˜¯å­˜å‚¨é•œåƒçš„ä»“åº“ï¼Œå…¶å®žå¯¹äºŽé•œåƒï¼Œå®¹å™¨å’Œä»“åº“è¿™ä¸‰è€…ï¼Œå¦‚æžœåŸºäºŽJAVAè¿™ç§é¢å‘å¯¹è±¡çš„è¯­è¨€æ¥ç†è§£ï¼Œé•œåƒç›¸å½“äºŽä¸€ä¸ªå£°æ˜Žç±»ï¼Œè€Œå®¹å™¨ç›¸å½“äºŽä¸€ä¸ªå®žä¾‹å¯¹è±¡ï¼Œä»“åº“å°±æ˜¯JDK,è€Œdockerå¼•æ“Žå°±æ˜¯ç­‰äºŽJVMï¼Œå½“ç„¶è¿™ä¸æ˜¯å¾ˆä¸¥è°¨ï¼Œä½†æ˜¯å¾ˆå½¢è±¡ é•œåƒé•œåƒæ˜¯dockerä¸€ä¸ªå¾ˆé‡è¦çš„ç»„ä»¶ï¼Œé€šè¿‡docker imagesæŒ‡ä»¤æ¥æŸ¥çœ‹æ‰€æœ‰çš„é•œåƒï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º ç”±ä¸Šå¯çŸ¥ï¼Œé•œåƒç”±äº”ä¸ªå±žæ€§ç»„æˆï¼š REPOSITORYï¼šé•œåƒå®žä½“ï¼Œä¸€èˆ¬æ¥è®²åä¸ºâ€˜hello-worldâ€™æ­¤ç±»é•œåƒæ˜¯æœ‰å®˜æ–¹ç»´æŠ¤çš„ï¼Œâ€˜andy/hello-worldâ€™æ­¤ç±»é•œåƒæ˜¯ç”±ç”¨æˆ·ç»´æŠ¤çš„ï¼Œandyæ˜¯ç”¨æˆ·å TAGï¼šæ ‡ç­¾ï¼Œå¯¹äºŽè½¯ä»¶è€Œè¨€ï¼Œç†è§£ä¹Ÿå¯ä»¥æˆç‰ˆæœ¬ï¼Œlasterè¡¨ç¤ºæ˜¯è¯¥é•œåƒçš„æœ€ç»ˆç‰ˆæœ¬ IMAGE IDï¼šé•œåƒçš„å”¯ä¸€æ ‡è¯† CREATEDï¼šæŒ‡é•œåƒçš„åˆ›å»ºæ—¶é—´ VIRTUAL SIZEï¼šè™šæ‹Ÿå¤§å°ï¼Œå¹¶ä¸æ˜¯å®žé™…çš„å¤§å°ï¼Œè·Ÿdockerçš„åˆ†å±‚å­˜å‚¨æœ‰å…³ åˆ©ç”¨docker pull [é€‰é¡¹] [Docker Registryåœ°å€]&lt;ä»“åº“å&gt;:&lt;æ ‡ç­¾&gt;å‘½ä»¤æ¥åŠ è½½é•œåƒï¼Œå¦‚æžœæ²¡æœ‰Docker Registryåœ°å€ï¼Œåˆ™é»˜è®¤ä¼šåŠ è½½å®˜æ–¹çš„é•œåƒï¼Œæ ‡ç­¾å¦‚æžœæ²¡æœ‰æŒ‡å®šï¼Œåˆ™é»˜è®¤ä¸‹è½½lasterç‰ˆæœ¬ ä¹Ÿå¯ä»¥åˆ©ç”¨docker rmi &lt;IMAGE ID&gt;æŒ‡ä»¤åŽ»åˆ é™¤æŒ‡å®šçš„é•œåƒï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨docker rmi $(docker iamges -q)åŽ»åˆ é™¤æ‰€æœ‰çš„é•œåƒ å®¹å™¨ç®€å•çš„è¯´ï¼Œå®¹å™¨æ˜¯ä¸€ç»„ç‹¬ç«‹è¿è¡Œçš„åº”ç”¨ï¼Œç”±dockerå¼•æ“Žæä¾›å®ƒçš„ä¸Šä¸‹æ–‡ï¼Œé•œåƒæä¾›å†…å®¹ï¼Œåˆ©ç”¨docker run æŒ‡ä»¤å¯ä»¥æ–°å»ºå’Œè¿è¡Œå®¹å™¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º åˆ©ç”¨docker ps -aæŒ‡ä»¤æ¥æŸ¥çœ‹ä½ æ‰€æœ‰çš„å®¹å™¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º ç”±ä¸Šå¯çŸ¥ï¼Œå®¹å™¨ç”±ä¸ƒé¡¹å±žæ€§ç»„æˆ CONTAINER IDï¼šå®¹å™¨å”¯ä¸€æ ‡è¯† IMAGEï¼šæ‰€ä¾èµ–çš„é•œåƒ COMMANDï¼šè¿è¡Œå®¹å™¨çš„å‘½ä»¤ CREATEï¼šå®¹å™¨çš„åˆ›å»ºæ—¶é—´ STATUSï¼šå®¹å™¨çš„çŠ¶æ€ PORTSï¼šæ‰€æš´éœ²çš„ç«¯å£ NAMESï¼šå®¹å™¨å åˆ©ç”¨docker stop &lt;container id&gt; æŒ‡ä»¤åœæ­¢æŒ‡å®šå®¹å™¨è¿è¡Œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨docker stop $(docker ps -a)åœæ­¢æ‰€æœ‰çš„å®¹å™¨å¦‚æžœä½ æƒ³å¯åŠ¨å®ƒï¼Œå¯ä»¥åˆ©ç”¨docker start &lt;container id&gt;å‘½ä»¤ï¼Œå¦‚æžœä½ è¿˜æƒ³é‡æ–°å¯åŠ¨ï¼Œå¯ä»¥åˆ©ç”¨docker restart &lt;container id&gt;,å¦‚æžœä½ æƒ³åˆ é™¤ä¸€ä¸ªå®¹å™¨,å¯ä»¥ä½¿ç”¨docker rm &lt;container id&gt;ï¼Œè¿™è·Ÿåˆ é™¤é•œåƒæœ‰ç‚¹ç›¸ä¼¼ï¼ŒrmæŒ‡ä»¤æ˜¯åˆ é™¤å®¹å™¨çš„ï¼ŒrmiæŒ‡ä»¤æ˜¯åˆ é™¤é•œåƒçš„ ä»“åº“ä»“åº“æ˜¯å­˜æ”¾é•œåƒçš„åœ°æ–¹ï¼Œå®˜æ–¹ç»´æŠ¤äº†ä¸€ä¸ªç±»ä¼¼äºŽgithubçš„dockerhubå…¬å…±ä»“åº“æ¥å­˜æ”¾é•œåƒï¼Œå®ƒçš„è®¾è®¡æ€æƒ³è·Ÿgithubå¾ˆåƒï¼Œåœ¨è¿™é‡Œä½ å¯ä»¥æ‰˜ç®¡ä½ çš„é•œåƒï¼Œä½ å¯ä»¥ç‚¹å‡»dockerhubæ³¨å†Œä¸€ä¸ªdockerhubçš„è´¦æˆ·ï¼Œç„¶åŽåœ¨ç»ˆç«¯åˆ©ç”¨docker loginå‘½ä»¤è¾“å…¥ä½ çš„ç”¨æˆ·åï¼Œå¯†ç å’Œé‚®ç®±è¿›è¡Œç™»å½•ï¼Œåœ¨æœ¬åœ°ç”¨æˆ·ç›®å½•å°±ä¼šç”Ÿæˆä¸€ä¸ª.dockercfgæ–‡ä»¶æ¥ä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œå¯ä»¥åˆ©ç”¨docker search &lt;image&gt;å‘½ä»¤æŸ¥è¯¢ä½ æ‰€è¦é•œåƒçš„ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º ç”±ä¸Šå¯çŸ¥ï¼Œä½ æ‰€æŸ¥è¯¢çš„è¯¥é•œåƒåœ¨å…¬å…±ä»“åº“çš„ä¿¡æ¯ï¼Œä»¥ä¸‹äº”é¡¹ç»„æˆ NAMEï¼šç›¸å…³é•œåƒçš„åç§° DESCRIPTIONï¼šç›¸å…³é•œåƒçš„æè¿° STARSï¼šå–œæ¬¢ç¨‹åº¦ï¼Œè¡¨ç¤ºè¯¥é•œåƒçš„å—æ¬¢è¿Žç¨‹åº¦ OFFICIALï¼šæ˜¯å¦æ˜¯å®˜æ–¹çš„é•œåƒ AUTOMATEDï¼šæ˜¯å¦æ˜¯è‡ªåŠ¨åˆ›å»ºçš„é•œåƒ ç„¶åŽä½¿ç”¨docker pull &lt;image&gt;å‘½ä»¤åŠ è½½å…¬å…±ä»“åº“çš„é•œåƒåˆ°æœ¬åœ°ï¼Œå½“ç„¶å¦‚æžœæƒ³è¦å°†è‡ªå·±çš„é•œåƒæŽ¨é€åˆ°å…¬å…±ä»“åº“ä¸Šåªéœ€è¦ä¸¤æ­¥ å°†ä½ è‡ªå·±çš„é•œåƒæ‰“ä¸Šæ ‡ç­¾ï¼šdocker tag &lt;IMAGE ID&gt; &lt;USERNAME&gt;/&lt;IAMGE NAME&gt;:&lt;TAG&gt;. æŽ¨é€åˆ°å…¬å…±ä»“åº“ï¼šdocker push &lt;USERNAME&gt;/&lt;REPOSITORY&gt;. è‡ªå®šä¹‰é•œåƒï¼šdockerfileçŽ°å®žä¸­ï¼Œå®˜æ–¹çš„é•œåƒæ˜¯æ ¹æœ¬ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå·±åŽ»è‡ªå®šä¹‰é•œåƒï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ›å»ºdockerfileæ–‡ä»¶ 123mkdir myimagecd myimagetouch Dockerfile çŽ°åœ¨å¯ä»¥å¼€å§‹æ¥æž„å»ºä¸€æ¡é²¸é±¼çš„é•œåƒï¼Œé¦–å…ˆç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€Dockerfileï¼Œç¼–è¾‘ä»¥ä¸‹å†…å®¹123FROM docker/whalesay:latestRUN apt-get -y update &amp;&amp; apt-get install -y fortunesCMD /usr/games/fortune -a | cowsay Dockerfileå†…å®¹ä¸€æ¡æŒ‡ä»¤ä¼šåŠ è½½ä¸€å±‚é•œåƒï¼Œä»¥ä¸‹ä¼šåˆ†æˆä¸‰æ­¥æ‰§è¡Œ åŠ è½½é²¸é±¼çš„é•œåƒ æ›´æ–°è½¯ä»¶æºï¼Œå¹¶ä¸‹è½½å®‰è£…fortunesåº”ç”¨ è¿è¡Œè¿™ä¸ªåº”ç”¨ çŽ°åœ¨åœ¨è¯¥ç›®å½•ä¸‹åˆ©ç”¨docker build -t docker-whale .æŒ‡ä»¤å°±å®Œæˆäº†è‡ªå·±çš„é•œåƒæž„å»ºäº†ï¼Œè¿™é‡Œè¦æ³¨æ„ä¸€ç‚¹ï¼Œåœ¨æž„å»ºçš„æ—¶å€™ï¼Œé•œåƒååŽä¼šè·Ÿéšä¸€ä¸ª.ï¼Œè¿™ä¸ªå¾€å¾€ä¼šè¢«å¿½ç•¥æŽ‰ï¼Œè¿™è¡¨ç¤ºè¿è¡Œè¯¥é•œåƒçš„ä¸Šä¸‹æ–‡ï¼Œä¸æ˜¯Dockerfileæ–‡ä»¶çš„ä½ç½®ï¼ŒDockerfileé‡Œæ‰€è¿è¡Œçš„ä¸Šä¸‹æ–‡éƒ½æ˜¯åŸºäºŽè¿™ä¸ªå®šä¹‰çš„ï¼Œä½ è‡ªå·±ä¹Ÿå¯ä»¥å®šä¹‰ä½ æƒ³è¦çš„ä¸Šä¸‹æ–‡ï¼Œæ¯”å¦‚ä½¿ç”¨/usr/localæ›¿æ¢.æœ€åŽä½¿ç”¨docker run docker-whaleæŒ‡ä»¤è¿è¡Œè¯¥é•œåƒï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¿™å°±æ˜¯ä¸€ä¸ªåŸºäºŽå®˜ç½‘çš„ä¾‹å­çš„è‡ªå®šä¹‰é•œåƒï¼Œè‡ªå®šä¹‰é•œåƒè®©dockeræ›´åŠ çµæ´»ï¼Œæ›´åŠ å¼ºå¤§ï¼Œè®©å°±åƒç¼–ç¨‹ä¸€æ ·ï¼Œæ‹¥æœ‰æ— é™é­”åŠ› è¿™é‡Œåˆ—ä¸¾è‡ªå®šä¹‰é•œåƒæœ€ä½³å®žè·µå’Œå»ºè®® Dockerfileçš„å®šä¹‰å°½é‡æ˜¯ç®€çŸ­çš„ï¼Œåˆç†è€Œåˆç®€çŸ­çš„é…ç½®ï¼Œä¸€ç«™åŒ–åœæ­¢å’Œé”€æ¯ æ¯ä¸ªDockerfileç›®å½•å°½é‡åªæœ‰Dockerfileæ–‡ä»¶ï¼Œå¦‚æžœæœ‰å…¶ä»–æ–‡ä»¶ï¼Œåœ¨æž„å»ºçš„æ—¶å€™ï¼Œå¯ä»¥æ–°å»ºä¸€ä¸ª.dockerignoreçš„æ–‡ä»¶åˆ°è¯¥ç›®å½•è¿›è¡ŒæŽ’é™¤å…¶ä»–ä¸å¿…è¦çš„æ–‡ä»¶ å°½é‡é¿å…å®‰è£…ä¸å¿…è¦çš„åŒ…ï¼Œå³ä½¿ä»–æ˜¯å¾ˆæœ‰ç”¨çš„ å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå®¹å™¨åªæ˜¯è¿è¡Œä¸€ä¸ªè¿›ç¨‹ï¼Œè¿™æ ·èƒ½å¤Ÿæ›´å®¹æ˜“æ‰©å±•å’Œé‡å¤ä½¿ç”¨(ä½¿ç”¨å®¹å™¨è¿žæŽ¥) å‡å°‘æž„å»ºå±‚æ•°æ¥å‡å°‘æž„å»ºçš„å¤æ‚åº¦ï¼Œä½¿ç”¨â€˜\â€™å’Œè¿žæŽ¥ç¬¦â€˜&amp;&amp;â€™æ¥è¿›è¡Œä¸€æ¬¡æ€§æž„å»º è¿™é‡Œå†åˆ—ä¸¾ä¸€äº›å¸¸ç”¨çš„DockerfileæŒ‡ä»¤ LABELè®°å½•ä½ çš„Dockerfileçš„ä¿¡æ¯ æ¯”å¦‚ï¼šLABEL version=â€0.0.1-betaâ€ RUNè¿è¡Œä½ çš„åº”ç”¨ç¨‹åºæˆ–è€…æ˜¯æŒ‡ä»¤ æ¯”å¦‚ï¼šRUN apt-get update &amp;&amp; apt-get install -y curlæ³¨æ„ï¼šå¦‚æžœä»¥ä¸Šå‘½ä»¤åˆ†æˆä¸¤å±‚å†™ï¼Œä¼šå¯¼è‡´èŽ·å–ç¼“å­˜å†…ä»¥å‰çš„ç‰ˆæœ¬ï¼Œå¯¼è‡´å®‰è£…æ— æ•ˆ CMDè¿è¡Œè¯¥é•œåƒåŒ…å«çš„è½¯ä»¶ æ¯”å¦‚ï¼šCMD [â€œshâ€,â€-sâ€â€œserver tomcat startâ€] ENTRYPOINTè¿è¡Œä½ çš„åº”ç”¨ç¨‹åºå’ŒæŒ‡ä»¤ï¼Œæˆ–è€…æ˜¯è„šæœ¬ ENTRYPOINT [â€œserverâ€]æ³¨æ„ï¼šå¦‚æžœæŒ‡å®šäº†ENTRYPOINTï¼Œé‚£ä¹ˆåŽé¢çš„CMDéƒ½å˜æˆäº†å®ƒçš„å‚æ•° EXPOSEæŒ‡å®šè¯¥å®¹å™¨æ‰€ç›‘å¬è¿žæŽ¥çš„é»˜è®¤ç«¯å£ï¼Œå¦‚æžœdocker run -pæŒ‡å®šç«¯å£ï¼Œåˆ™ä¼šè¦†ç›–è¯¥ç«¯å£ï¼Œæ¯”å¦‚EXPOSE 8080 ENVæ›´æ–°æˆ–æ·»åŠ ä½ å½“å‰å®¹å™¨çš„çŽ¯å¢ƒå˜é‡ æ¯”å¦‚ï¼šENV PATH /user/local/nginx/bin:$PATH ARGæž„å»ºä¸´æ—¶çš„çŽ¯å¢ƒå˜é‡ï¼Œåœ¨å®¹å™¨è¿è¡Œæ—¶ä¸ä¼šå­˜å‚¨è¿™äº›çŽ¯å¢ƒå˜é‡ æ¯”å¦‚ï¼šARG NAME [=jack] COPYæœ¬åœ°æ–‡ä»¶å¤åˆ¶åˆ°å®¹å™¨ æ¯”å¦‚ï¼šCOPY usr/local/ /usr/local/ ADDä¹Ÿæœ‰å¤åˆ¶çš„åŠŸèƒ½ï¼Œä½†åœ¨å…¶ä¸Šå¤šäº†è¿œç¨‹urlä¸‹è½½ï¼Œå’Œè‡ªåŠ¨è§£åŽ‹åŒ…çš„åŠŸèƒ½ æ¯”å¦‚ï¼šADD http://source.com/a.tar /usr/local (å…ˆä¸‹è½½urlçš„èµ„æºï¼Œå†è§£åŽ‹åˆ°ç›®æ ‡ç›®å½•ä¸­)æ³¨æ„ï¼šæŽ¨èä½¿ç”¨COPYï¼Œå› ä¸ºä»–çš„ç›®æ ‡æ›´æ˜Žç¡®ï¼ŒADDç›¸å½“äºŽä½¿ç”¨äº†å¤šå±‚çš„RUNï¼Œè¿˜ä¸å¦‚ä½¿ç”¨RUNåŠ è¿žæŽ¥ç¬¦ VOLUMEæŒ‡å®šæ•°æ®å­˜å‚¨åŒºï¼Œä½¿å®¹å™¨å’Œå®¿ä¸»è¿›è¡Œæ˜ å°„å­˜å‚¨ æ¯”å¦‚ï¼šVOLUME /data ç„¶åŽä½¿ç”¨docker run -dv mydata:/data å‘½ä»¤æŒ‡å®šå®¿ä¸»çš„mydataä½œä¸ºå®¹å™¨ä¸­dataç›®å½•çš„å­˜å‚¨åŒº WORKDIRæŒ‡å®šå½“å‰ç›®å½•(ç›®å½•å¿…é¡»å­˜åœ¨ï¼Œåº”ä½¿ç”¨ç»å¯¹è·¯å¾„)ï¼Œæ¯”å¦‚ï¼š WORKDIR /usr/local/ USERæŒ‡å®šå½“å‰ç”¨æˆ· æ¯”å¦‚ï¼šUSER docker ONBUILDæŒ‡å®šå½“å‰çš„é•œåƒåŽé¢çš„æŒ‡ä»¤ä¸ä¼šé©¬ä¸Šæž„å»ºï¼Œåªæœ‰åœ¨åˆ«çš„é•œåƒå¼•ç”¨æ—¶æ‰æž„å»ºåŠ è½½ï¼Œé€‚åˆä¸€äº›åŸºç¡€çš„ç»„ä»¶æž„å»º æ€»ç»“ï¼šè¿™æ˜¯ä¸€ç¯‡dockerçš„å­¦ä¹ ç¬”è®°ï¼Œdockerå¾ˆå¼ºå¤§ï¼Œç‰¹åˆ«åœ¨äº‘æœåŠ¡å¹³å°å‘æŒ¥å¾ˆå¤§çš„é‡è¦ï¼ŒçŽ°åœ¨åœ¨å¾ˆå¤šé›†ç¾¤ç®¡ç†ä¹Ÿä½¿ç”¨dockeræ¥æž„å»ºï¼Œå­¦ä¹ dockerä¹Ÿä¼šæœ‰å¾ˆå¤§çš„æå‡ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[åŽŸå­æ“ä½œ-CAS]]></title>
      <url>%2F2016%2F06%2F06%2Fcas%2F</url>
      <content type="text"><![CDATA[ä»…ä¾›å­¦ä¹ äº¤æµ,å¦‚æœ‰é”™è¯¯è¯·æŒ‡å‡º,å¦‚è¦è½¬è½½è¯·åŠ ä¸Šå‡ºå¤„,è°¢è°¢ æ¦‚å¿µCAS(compare and swap)ï¼Œæ¯”è¾ƒå’Œäº¤æ¢ï¼Œæ˜¯åŽŸå­æ“ä½œçš„ä¸€ç§ï¼Œå¯ç”¨äºŽåœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­å®žçŽ°ä¸è¢«æ‰“æ–­çš„æ•°æ®äº¤æ¢æ“ä½œï¼Œä»Žè€Œé¿å…å¤šçº¿ç¨‹åŒæ—¶æ”¹å†™æŸä¸€æ•°æ®æ—¶ç”±äºŽæ‰§è¡Œé¡ºåºä¸ç¡®å®šæ€§ä»¥åŠä¸­æ–­çš„ä¸å¯é¢„çŸ¥æ€§äº§ç”Ÿçš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚ è¯¥æ“ä½œé€šè¿‡å°†å†…å­˜ä¸­çš„å€¼ä¸ŽæŒ‡å®šæ•°æ®è¿›è¡Œæ¯”è¾ƒï¼Œå½“æ•°å€¼ä¸€æ ·æ—¶å°†å†…å­˜ä¸­çš„æ•°æ®æ›¿æ¢ä¸ºæ–°çš„å€¼â€”æ¥è‡ªwikipedia çŽ°ä»£çš„å¤§å¤šæ•°CPUéƒ½å®žçŽ°äº†CAS,å®ƒæ˜¯ä¸€ç§æ— é”(lock-free),ä¸”éžé˜»å¡žçš„ä¸€ç§ç®—æ³•ï¼Œä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ï¼ŒåŽŸç†å¹¶ä¸éš¾ç†è§£ï¼Œä¸‹é¢æ˜¯ä¸€æ®µCASçš„ç®€å•å®žçŽ°ï¼š 1234567891011121314public boolean cas(int old_v)&#123; for(;;)&#123; int new_v = old_v+1; int except_v = getMemoryValue(); if(expect_v == old_v)&#123; setMemoryValue(new_v); break; &#125;else&#123; old_v = except_v; &#125; &#125; return true;&#125; å…¶ä¸­getMemoryValue()æ–¹æ³•æŒ‡åœ¨å†…å­˜ä¸­å–å‡ºæœ€æ–°çš„å€¼ï¼ŒsetMemoryValue(new_v)æ–¹æ³•æŒ‡åœ¨è®²æ–°çš„å€¼æ”¾å…¥å†…å­˜ä¸­ï¼Œæ•´ä¸ªif-elseå°±æ˜¯CASçš„æ“ä½œï¼ˆexpect_v==old_væ˜¯compareï¼Œè€ŒsetMemoryValue(new_v)æ˜¯swapï¼‰ï¼Œå‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹è®¿é—®ä»¥ä¸Šä»£ç ï¼Œç”¨åˆ†æ®µå›¾è¡¨ç¤ºå¦‚ä¸‹ï¼š ä»¥ä¸Šå›¾å°±æ˜¯CASçš„æ“ä½œè¡¨çŽ°ï¼Œç”±æ­¤å¯çŸ¥ï¼Œåœ¨CASä¸­ï¼Œæœ‰ä¸‰ä¸ªæ ¸å¿ƒçš„å±žæ€§ï¼šold_i(æ—§å€¼)ï¼Œnew_i(æ–°å€¼)ï¼Œexpect_i(æœŸæœ›å€¼)ï¼Œå®ƒæ¯æ¬¡é€šè¿‡æ—§å€¼é€šè¿‡è®¡ç®—å¾—åˆ°æ–°å€¼ï¼Œç„¶åŽåˆ©ç”¨æ—§å€¼ä¸ŽæœŸæœ›å€¼(ä»Žå†…å­˜è¯»å–çš„æœ€æ–°çš„å€¼)ç›¸æ¯”è¾ƒï¼Œå¦‚æžœç›¸åŒï¼Œå°±å°†æ–°å€¼å†™å…¥å†…å­˜ä¸­æ›¿æ¢æœŸæœ›å€¼ï¼Œå¦‚æžœä¸ç›¸åŒï¼Œåˆ™è¡¨ç¤ºæ“ä½œå¤±è´¥ï¼Œé‡æ–°æ‰§è¡Œã€‚ ABAé—®é¢˜CASå¹¶ä¸æ˜¯ä¸€ä¸ªå®Œç¾Žçš„æ— é”ç®—æ³•ï¼Œåœ¨ä»¥ä¸Šçš„CASæ“ä½œä¸­ï¼ŒgetMemoryValue()æ–¹æ³•åªæ˜¯åœ¨å†…å­˜ä¸­å–å‡ºæœ€æ–°çš„å€¼ï¼Œå®ƒä¸ä¼šåœ¨ä¹Žå®ƒçš„å˜åŒ–ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¦‚æžœçº¿ç¨‹2æœŸé—´å‘ç”Ÿäº†ä¸¤æ¬¡å˜åŒ–ï¼Œçº¿ç¨‹1æ˜¯å¯Ÿè§‰ä¸åˆ°çš„ï¼Œç»å…¸çš„ä¾‹å­å°±æ˜¯å †çš„popå’Œpushï¼Œçº¿ç¨‹1å…¥æ ˆæ—¶ï¼Œtopçš„å€¼æ˜¯Aï¼Œç„¶åŽçº¿ç¨‹2è¿›è¡Œäº†ä¸¤æ¬¡å…¥å †ï¼Œç¬¬äºŒæ¬¡å…¥æ ˆçš„å€¼ä¹Ÿæ˜¯Aï¼Œçº¿ç¨‹1å¯¹topè¿›è¡Œcompareï¼Œå‘çŽ°å’Œæ—§å€¼æ˜¯ä¸€æ ·çš„ï¼Œå°±æ‰§è¡Œå…¥å †æ“ä½œï¼Œå…¶å®žè¿™æ—¶å †å·²ç»å‘ç”Ÿäº†æ”¹å˜å½“ç„¶å¦‚æžœæƒ³è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåªæœ‰åŠ ä¸Šä¸€ä¸ªæ ‡å¿—æˆ–è€…ç‰ˆæœ¬å·æ¥ç›‘è§†å®ƒçš„å˜åŒ–ï¼Œè¿™æ ·ç”±ä¸¤ä¸ªå€¼æ¥æœ€ä¸ºcompareçš„æ ¹æ®ï¼Œå¦‚è¿˜æ˜¯å †çš„popå’Œpushé—®é¢˜ï¼Œåªè¦åŠ ä¸Šä¸€ä¸ªæ“ä½œæ ‡å¿—ï¼Œå½“æ¯æ¬¡å¯¹è¿›è¡Œpopæˆ–è€…pushå°±åŠ 1ï¼Œé‚£compareçš„æ—¶å€™å†åŠ ä¸Šå¯¹åŽŸæ¥çš„æ”¹å˜æ¬¡æ•°å’ŒçŽ°åœ¨çš„æ”¹å˜æ¬¡æ•°è¿›è¡Œæ¯”è¾ƒï¼Œè¿™æ ·å°±å¯ä»¥é¿å…ABAé—®é¢˜äº† åº”ç”¨ä¹è§‚é”ä¹è§‚é”æ˜¯åœ¨æœ€ç†æƒ³çš„æƒ…å†µä¸‹åŽ»æ‰§è¡Œï¼Œåªæœ‰åœ¨å‘ç”Ÿå†²çªçš„æ—¶å€™å†è¿›è¡Œå¤„ç†ï¼Œå…¶å®žè¿™è·ŸCASçš„ç†å¿µæ˜¯å¾ˆç¬¦åˆçš„ï¼Œä¹Ÿå¯ä»¥è¿™ä¹ˆè®²ï¼ŒCASä¹Ÿæ˜¯ä¸€ç§ä¹è§‚é”æŠ€æœ¯ JAVAjavaä¸­å®žçŽ°äº†å¤§é‡çš„CASæ“ä½œï¼Œåœ¨JDK1.5å‘å¸ƒçš„java.util.concurrentåŒ…å°±æ˜¯å»ºç«‹åœ¨CASä¹‹ä¸Šçš„ï¼Œç›¸å¯¹æ¯”ä¸Žsynchronizedè¿™ç§é”æœºåˆ¶ä¸”é˜»å¡žçš„ç®—æ³•ï¼Œæ— é”ä¸”éžé˜»å¡žçš„CASæ— ç–‘åœ¨æ€§èƒ½ä¸Šæœ‰è´¨çš„æå‡ï¼Œæ¥çœ‹çœ‹javaå¯¹CASçš„å®žçŽ°ï¼Œä»¥AtomicIntegerçš„å¢žé‡æ–¹æ³•ä¸ºä¾‹(åŸºäºŽJDK1.8)123public final int incrementAndGet() &#123; return unsafe.getAndAddInt(this, valueOffset, 1) + 1;&#125; è¿™é‡Œä¼šè°ƒç”¨sun.miscåŒ…ä¸‹çš„Unsafeç±»ï¼Œè¿™æ˜¯ä¸€ä¸ªè°ƒç”¨åº•å±‚æŒ‡ä»¤é›†çš„finalç±»ï¼Œä¸‹é¢çœ‹ä¸€ä¸‹getAndAddIntæ–¹æ³•12345678public final int getAndAddInt(Object var1, long var2, int var4) &#123; int var5; do &#123; var5 = this.getIntVolatile(var1, var2); &#125; while(!this.compareAndSwapInt(var1, var2, var5, var5 + var4)); return var5;&#125; åœ¨è¿™é‡Œä½ ä¼šçœ‹è§compareAndSwapIntæ–¹æ³•ï¼Œè¿™æ˜¯ä¸€ä¸ªnativeçš„æ–¹æ³•ï¼Œç”¨æ¥è°ƒç”¨CPUçš„CASæŒ‡ä»¤å®žçŽ°æ— é”ä¸”éžé˜»å¡žçš„å¢žé‡æ“ä½œï¼Œè¿™åœ¨concurrentåŒ…ä¸‹æœ‰å¾ˆå¤šè¿™æ ·çš„æ“ä½œï¼ŒJDK1.8çš„concurrentHashMapæ”¾å¼ƒäº†åˆ†æ®µé”çš„æ¦‚å¿µï¼Œé‡‡ç”¨äº†CASæ“ä½œï¼Œè¿™å¤§å¤§çš„å¢žåŠ äº†å¤šçº¿ç¨‹ä¸‹çš„æ€§èƒ½ æ€»ç»“å¾ˆå¤šæ—¶å€™åœ¨çº¿ç¨‹å®‰å…¨å’Œæ€§èƒ½æ–¹é¢å¾ˆéš¾å¾—åˆ°æƒè¡¡ï¼Œçº¿ç¨‹å®‰å…¨çš„ä¸‰å¤§ç‰¹æ€§ï¼šå¯è§æ€§ï¼ŒåŽŸå­æ€§å’Œé¡ºåºæ€§ï¼ŒåŽŸå­æ€§å¾€å¾€å°±è¦åŠ ä¸Šé”åŽ»å®žçŽ°ï¼ŒçŽ°åœ¨ç”¨CASåŽ»æ›¿ä»£åŽŸå­æ€§ï¼Œvolatileä¿è¯å¯è§æ€§å’Œé¡ºåºæ€§ï¼Œå¤§å¤§å¢žåŠ äº†å¤šçº¿ç¨‹åœ¨æ“ä½œä¸Šçš„æ€§èƒ½ å‚è€ƒhttps://zh.wikipedia.org/wiki/%E6%AF%94%E8%BE%83%E5%B9%B6%E4%BA%A4%E6%8D%A2http://zl198751.iteye.com/blog/1848575]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[æ•°æ®åº“ç´¢å¼•]]></title>
      <url>%2F2016%2F05%2F12%2Fdatabase_index%2F</url>
      <content type="text"><![CDATA[ä»…ä¾›å­¦ä¹ äº¤æµ,å¦‚æœ‰é”™è¯¯è¯·æŒ‡å‡º,å¦‚è¦è½¬è½½è¯·åŠ ä¸Šå‡ºå¤„,è°¢è°¢ ç´¢å¼•æ¦‚è¿° ç´¢å¼•ï¼ˆè‹±è¯­ï¼šIndexï¼‰ï¼šåˆç¨±å¼•å¾—ï¼Œé€šæª¢ï¼Œå‚™æª¢ï¼Œæ˜¯ä¸€æœ¬ä¹¦ç±çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå®ƒæŠŠä¹¦ä¸­çš„é‡è¦åè¯åˆ—ç½—åˆ—å‡ºæ¥ï¼Œå¹¶ç»™å‡ºå®ƒä»¬ç›¸åº”çš„é¡µç ï¼Œæ–¹ä¾¿è¯»è€…å¿«é€ŸæŸ¥æ‰¾è¯¥å è¯çš„å®šä¹‰å’Œå«ä¹‰â€”-æ¥è‡ªç»´åŸºç™¾ç§‘ã€‚ æ•°æ®åº“ç´¢å¼•ï¼šæ˜¯æ•°æ®åº“ç®¡ç†ç³»ç»Ÿä¸­ä¸€ä¸ªæŽ’åºçš„æ•°æ®ç»“æž„ï¼Œä»¥ååŠ©å¿«é€ŸæŸ¥è¯¢ã€æ›´æ–°æ•°æ®åº“è¡¨ä¸­æ•°æ®â€”â€”æ¥è‡ªç»´åŸºç™¾ç§‘ã€‚ ç´¢å¼•å¾ˆæ™®éï¼Œä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œä»–èƒ½ä½¿äººèƒ½æ›´å¥½æ›´å¿«çš„æ‰¾åˆ°è‡ªå·±æƒ³è¦çš„ä¸œè¥¿ï¼Œåœ¨ç”Ÿæ´»ä¸­ä¹Ÿéƒ½èƒ½æœ‰å¾ˆå¥½çš„åº”ç”¨ï¼Œæ¯”å¦‚ä¸€äº›ä¹¦ç±ç›®å½•ï¼ŒæŒ‡ç¤ºç‰Œï¼Œé—¨ç‰Œå·ï¼Œè€Œä¸‹é¢è®²åˆ°çš„æ˜¯åœ¨æ•°æ®åº“ä¸­çš„åº”ç”¨ã€‚ æ•°æ®åº“ç´¢å¼•äºŒå‰æ ‘æŸ¥æ‰¾æ ‘è¦çŸ¥é“æ•°æ®åº“ç´¢å¼•ä¹‹å‰ï¼Œå¿…é¡»çŸ¥é“ä¸€ç§æ•°æ®ç»“æž„äºŒå‰æŸ¥æ‰¾æ ‘ äºŒå‰æŸ¥æ‰¾æ ‘æ˜¯ä¸€ç§ç‰¹æ®Šçš„äºŒå‰æ ‘ï¼Œå¿…é¡»è¦ç¬¦åˆä¸€å®šçš„ç»“æž„è§„åˆ™ï¼š ä»»æ„èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸ç©ºï¼Œåˆ™å·¦å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å°äºŽå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ï¼› ä»»æ„èŠ‚ç‚¹çš„å³å­æ ‘ä¸ç©ºï¼Œåˆ™å³å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å¤§äºŽå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ï¼› ä»»æ„èŠ‚ç‚¹çš„å·¦ã€å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æŸ¥æ‰¾æ ‘ï¼› æ²¡æœ‰é”®å€¼ç›¸ç­‰çš„èŠ‚ç‚¹ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºå¯çŸ¥ï¼Œæˆ‘ä»¬è¿™é¢—äºŒå‰æŸ¥æ‰¾æ ‘ä¸€å…±æœ‰7ä¸ªèŠ‚ç‚¹ï¼Œæ¯”å¦‚æˆ‘ä»¬çŽ°åœ¨è¦æœç´¢122è¿™ä¸ªèŠ‚ç‚¹ï¼Œä»Žæ ¹èŠ‚ç‚¹100å¼€å§‹éåŽ†ï¼š ç”±äºŽ100&lt;122ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŸ¥æ‰¾æ ¹èŠ‚ç‚¹çš„å³èŠ‚ç‚¹150 ç”±äºŽ122&lt;150ï¼Œæ‰€ä»¥æˆ‘ä»¬çŽ°åœ¨éœ€è¦æŸ¥æ‰¾å®ƒçš„å·¦èŠ‚ç‚¹122 ç”±äºŽ122==122ï¼Œè¿”å›žå½“å‰çš„èŠ‚ç‚¹(å¦‚æžœ122èŠ‚ç‚¹ç»‘å®šäº†å½“å‰æ•°æ®åº“çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ç´¢å¼•æ¥æŸ¥æ‰¾æ•°æ®äº†) äºŒå‰æŸ¥æ‰¾æ ‘æ˜¯æ ¹æ®æŸ¥æ‰¾çš„å±‚æ•°æ¥å†³å®šä½ çš„æŸ¥æ‰¾æ•ˆçŽ‡ï¼Œå½“ç„¶æœ€åçš„æŸ¥æ‰¾æ•ˆçŽ‡ä¹Ÿå°±O(n),ä½†å®ƒæ”¯æŒåŠ¨æ€æŸ¥è¯¢ï¼Œä¸”æœ‰å¾ˆå¤šæ”¹è¿›ç‰ˆçš„äºŒå‰æŸ¥æ‰¾æ ‘å¯ä»¥ä½¿æ ‘é«˜ä¸º O(log n),å¦‚SBT,AVLæ ‘ï¼Œçº¢é»‘æ ‘ç­‰ã€‚ å…¶å®žåœ¨è¿™é‡Œä½ å°±èƒ½å¤Ÿæƒ³è±¡åˆ°åœ¨æ•°æ®åº“ä¸­ä½¿ç”¨ç´¢å¼•çš„æŸ¥æ‰¾æ—¶çš„æ•´ä¸ªç»“æž„è¿‡ç¨‹ï¼Œä»¥ä¸Šæˆ‘ä»¬ä¼šå‘çŽ°ï¼ŒäºŒå‰æœç´¢æ ‘å¤ªä¾èµ–æœç´¢çš„å±‚æ•°ï¼Œæ•°æ®å¤ªå¤šä¹Ÿæ„å‘³ç€å±‚æ•°ä¹Ÿä¼šå¢žåŠ ï¼ŒæŸ¥è¯¢çš„æ•ˆçŽ‡ä¹Ÿä¼šç›¸åº”çš„ä¸‹é™ï¼Œé¢å¯¹ç™¾ä¸‡çº§ï¼Œç”šè‡³äº¿çº§çš„æŸ¥è¯¢æ—¶ï¼Œåˆ†åˆ†é’Ÿå´©æºƒï¼Œè€Œä¸”ä½ ä¹Ÿä¼šå‘çŽ°äºŒå‰æœç´¢æ ‘åº”å¯¹çš„æ˜¯å•å€¼æŸ¥è¯¢ï¼ˆwhere p=2ï¼‰ï¼Œåœ¨èŒƒå›´æŸ¥è¯¢ï¼ˆwhere 1&lt;p&lt;3ï¼‰ä¸­å°±æ‰è¥Ÿè§è‚˜äº†ï¼ˆè¦éåŽ†å¾ˆå¤šæ¬¡ï¼‰ï¼Œå…¶å®žåœ¨å•å€¼æŸ¥è¯¢ä¸­è¿˜æœ‰ä¸€ç§ç´¢å¼•ç»“æž„å«åšå“ˆå¸Œè¡¨ å“ˆå¸Œè¡¨å“ˆå¸Œè¡¨ï¼ˆHash tableï¼Œä¹Ÿå«æ•£åˆ—è¡¨ï¼‰ï¼Œæ˜¯æ ¹æ®é”®ï¼ˆKeyï¼‰è€Œç›´æŽ¥è®¿é—®åœ¨å†…å­˜å­˜å‚¨ä½ç½®çš„æ•°æ®ç»“æž„ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒé€šè¿‡è®¡ç®—ä¸€ä¸ªå…³äºŽé”®å€¼çš„å‡½æ•°ï¼Œå°†æ‰€éœ€æŸ¥è¯¢çš„æ•°æ®æ˜ å°„åˆ°è¡¨ä¸­ä¸€ä¸ªä½ç½®æ¥è®¿é—®è®°å½•ï¼Œè¿™åŠ å¿«äº†æŸ¥æ‰¾é€Ÿåº¦ã€‚ è¿™ä¸ªæ˜ å°„å‡½æ•°ç§°åšæ•£åˆ—å‡½æ•°ï¼Œå­˜æ”¾è®°å½•çš„æ•°ç»„ç§°åšæ•£åˆ—è¡¨ã€‚â€”-æ¥è‡ªç»´åŸºç™¾ç§‘ å…¶å®žåœ¨æ•°æ®åº“ä¸­ä¸€äº›ç®€å•å¸¸è§çš„è¿žæŽ¥æ“ä½œå«åšhashè¿žæŽ¥ï¼Œè¿™ä¸ªæ•°æ®ç»“æž„ä¹Ÿè¢«æ•°æ®åº“ç”¨æ¥ä¿å­˜ä¸€äº›å†…éƒ¨çš„ä¸œè¥¿ï¼ˆæ¯”å¦‚é”è¡¨æˆ–è€…ç¼“å†²æ± ï¼‰ å“ˆå¸Œè¡¨çš„å®šä¹‰ï¼š å…³é”®å­—çš„å“ˆå¸Œå‡½æ•°ã€‚å…³é”®å­—è®¡ç®—å‡ºæ¥çš„å“ˆå¸Œå€¼ç»™å‡ºäº†å…ƒç´ çš„ä½ç½®ï¼ˆå«åšå“ˆå¸Œæ¡¶ï¼‰ã€‚ å…³é”®å­—æ¯”è¾ƒå‡½æ•°ã€‚ä¸€æ—¦ä½ æ‰¾åˆ°æ­£ç¡®çš„å“ˆå¸Œæ¡¶ï¼Œä½ å¿…é¡»ç”¨æ¯”è¾ƒå‡½æ•°åœ¨æ¡¶å†…æ‰¾åˆ°ä½ è¦çš„å…ƒç´ ã€‚ ç”±å›¾å¯çŸ¥ï¼Œè¿™ä¸ªHash tableä¸­æœ‰0-9åä¸ªå“ˆå¸Œæ¡¶ï¼Œæˆ‘ä»¬æƒ³è±¡æˆæ˜¯ä¸€ä¸ªæ•°ç»„ï¼ˆä»¥0-9ä¸‹æ ‡ç»„æˆï¼‰,æ¯”å¦‚ä½ æ‰€è¦æŸ¥æ‰¾çš„å…³é”®å­—é€šè¿‡å“ˆå¸Œå‡½æ•°å¯¹10åŽ»æ¨¡ï¼Œä¿ç•™æ•´æ•°æœ‰æ•ˆä½æœ€åŽä¸€ä½ï¼Œç”¨å®ƒåˆ©ç”¨æ¯”è¾ƒå‡½æ•°ï¼ˆæ¯”å¦‚equalsï¼‰æ¥å®šä½å“ˆå¸Œæ¡¶çš„ä½ç½®ï¼š å¦‚æžœå…ƒç´ æœ€åŽä¸€ä½æ˜¯ 0ï¼Œåˆ™è¿›å…¥å“ˆå¸Œæ¡¶0ï¼Œ å¦‚æžœå…ƒç´ æœ€åŽä¸€ä½æ˜¯ 1ï¼Œåˆ™è¿›å…¥å“ˆå¸Œæ¡¶1ï¼Œ å¦‚æžœå…ƒç´ æœ€åŽä¸€ä½æ˜¯ 2ï¼Œåˆ™è¿›å…¥å“ˆå¸Œæ¡¶2 ã€‚ä¾æ¬¡ç±»æŽ¨ æ¯”æ–¹è¯´ä½ è¦æ‰¾å…ƒç´  78ï¼š å“ˆå¸Œè¡¨è®¡ç®— 78 çš„å“ˆå¸Œç ï¼Œç­‰äºŽ 8ã€‚ æŸ¥æ‰¾å“ˆå¸Œæ¡¶ 8ï¼Œæ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ 78ã€‚ è¿”å›žå…ƒç´  78 æŸ¥è¯¢ä»…è€—è´¹äº† 2 æ¬¡è¿ç®—ï¼ˆ1æ¬¡è®¡ç®—å“ˆå¸Œå€¼ï¼Œå¦ä¸€æ¬¡åœ¨å“ˆå¸Œæ¡¶ä¸­æŸ¥æ‰¾å…ƒç´ ï¼‰ã€‚ çŽ°åœ¨ï¼Œæ¯”æ–¹è¯´ä½ è¦æ‰¾å…ƒç´  59ï¼š å“ˆå¸Œè¡¨è®¡ç®— 59 çš„å“ˆå¸Œç ï¼Œç­‰äºŽ9ã€‚ æŸ¥æ‰¾å“ˆå¸Œæ¡¶ 9ï¼Œç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„å…ƒç´ æ˜¯ 99ã€‚å› ä¸º 99 ä¸ç­‰äºŽ 59ï¼Œ é‚£ä¹ˆ 99 ä¸æ˜¯æ­£ç¡®çš„å…ƒç´ ã€‚ ç”¨åŒæ ·çš„é€»è¾‘ï¼ŒæŸ¥æ‰¾ç¬¬äºŒä¸ªå…ƒç´ (9)ï¼Œç¬¬ä¸‰ä¸ª(79)ï¼Œâ€¦â€¦ï¼Œæœ€åŽä¸€ä¸ª(29)ã€‚ å…ƒç´ ä¸å­˜åœ¨ã€‚ æœç´¢è€—è´¹äº† 7 æ¬¡è¿ç®—å…¶å®žç”±ä¸Šå¯çŸ¥ï¼Œåªè¦ä½ çš„å“ˆå¸Œå‡½æ•°ä¸Žå“ˆå¸Œæ¡¶å®šä¹‰çš„è¶Šå¥½ï¼ŒæŸ¥æ‰¾çš„æ•ˆçŽ‡ä¹Ÿå°±ç›¸åº”çš„è¶Šé«˜ã€‚ B-Treeä»¥ä¸Šçš„å…³äºŽæŸ¥æ‰¾çš„æ•°æ®ç»“æž„éƒ½ä¸èƒ½æ»¡è¶³çŽ°åœ¨æ—¥æ–°æœˆå¼‚çš„æ•°æ®åº“äº†ï¼Œåœ¨äºŒå‰æ ‘æœç´¢æ ‘çš„åŸºç¡€ä¸Šï¼Œåˆæ¼”å˜å‡ºä¸€ç§æ–°çš„æ•°æ®ç»“æž„B-Tree Bæ ‘ï¼ˆè‹±è¯­ï¼šB-treeï¼‰æ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„æ ‘ï¼Œèƒ½å¤Ÿä¿æŒæ•°æ®æœ‰åºã€‚è¿™ç§èµ„æ–™ç»“æž„èƒ½å¤Ÿè®©æŸ¥æ‰¾æ•°æ®ï¼Œé¡ºåºè®¿é—®ï¼Œæ’å…¥æ•°æ®åŠåˆ é™¤çš„åŠ¨ä½œï¼Œéƒ½åœ¨å¯¹æ•°æ—¶é—´å†…å®Œæˆâ€”-æ¥è‡ªç»´åŸºç™¾ç§‘ ä¸€é¢—mé˜¶çš„B-Treeè§„åˆ™å¦‚ä¸‹ï¼š æ ‘ä¸­æ¯ä¸ªç»“ç‚¹è‡³å¤šæœ‰mä¸ªå­©å­ï¼› é™¤æ ¹ç»“ç‚¹å’Œå¶å­ç»“ç‚¹å¤–ï¼Œå…¶å®ƒæ¯ä¸ªç»“ç‚¹è‡³å°‘æœ‰m/2ä¸ªå­©å­ï¼› è‹¥æ ¹ç»“ç‚¹ä¸æ˜¯å¶å­ç»“ç‚¹ï¼Œåˆ™è‡³å°‘æœ‰2ä¸ªå­©å­ï¼› æ‰€æœ‰å¶å­ç»“ç‚¹(å¤±è´¥èŠ‚ç‚¹)éƒ½å‡ºçŽ°åœ¨åŒä¸€å±‚ï¼Œå¶å­ç»“ç‚¹ä¸åŒ…å«ä»»ä½•å…³é”®å­—ä¿¡æ¯ï¼› æ‰€æœ‰éžç»ˆç«¯ç»“ç‚¹ä¸­åŒ…å«ä¸‹åˆ—ä¿¡æ¯æ•°æ® ( n, A0 , K1 , A1 , K2 , A2 , â€¦ , Kn , An )ï¼Œå…¶ä¸­ï¼š Ki (i=1,â€¦,n)ä¸ºå…³é”®å­—ï¼Œä¸”Ki &lt; Ki+1 , Ai (i=0,â€¦,n)ä¸ºæŒ‡å‘å­æ ‘æ ¹ç»“ç‚¹çš„æŒ‡é’ˆ, nä¸ºå…³é”®å­—çš„ä¸ªæ•° éžå¶å­ç»“ç‚¹çš„æŒ‡é’ˆï¼šP[1], P[2], â€¦, P[M]ï¼›å…¶ä¸­P[1]æŒ‡å‘å…³é”®å­—å°äºŽK[1]çš„å­æ ‘ï¼ŒP[M]æŒ‡å‘å…³é”®å­—å¤§äºŽK[M-1]çš„å­æ ‘ï¼Œå…¶å®ƒP[i]æŒ‡å‘å…³é”®å­—å±žäºŽ(K[i-1], K[i])çš„å­æ ‘ï¼› ç›¸å¯¹äºŽäºŒå‰æœç´¢æ ‘è€Œè¨€ï¼ŒB-Treeåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸­æœ€å°‘éƒ½å¾—æœ‰ä¸¤ä¸ªå­©å­ï¼Œä¼˜åŒ–äº†äºŒå‰æœç´¢æ ‘è¿‡äºŽä¾èµ–å±‚æ•°ï¼Œä½¿å…¶æ›´åŠ çµæ´»ï¼Œç„¶è€Œç›¸åº”çš„ç»´æŠ¤æˆæœ¬å¤§å¤§çš„å¢žé«˜ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ¯”æ–¹è¯´ä½ è¦æŸ¥æ‰¾èŠ‚ç‚¹21,ä»Žæ ¹èŠ‚ç‚¹å¼€å§‹éåŽ†ï¼š åœ¨æ ¹èŠ‚ç‚¹ä¸­ï¼Œç”±äºŽèŠ‚ç‚¹21æ»¡è¶³20&lt;21&lt;30,æ‰€ä»¥æŒ‡é’ˆæŒ‡å‘äº†P2 åœ¨P2ä¸­ï¼ŒèŠ‚ç‚¹21æ»¡è¶³21&lt;22,ä½†æ˜¯æŒ‡é’ˆæ²¡æœ‰æŒ‡å‘ä»»ä½•åœ°å€ï¼Œæ‰€ä»¥è¿”å›žNULL åˆæ¯”æ–¹è¯´è¦æŸ¥æ‰¾èŠ‚ç‚¹88ï¼Œä»Žæ ¹èŠ‚ç‚¹å¼€å§‹éåŽ† åœ¨æ ¹èŠ‚ç‚¹ä¸­ï¼Œç”±äºŽèŠ‚ç‚¹88æ»¡è¶³30&lt;80,æ‰€ä»¥æŒ‡é’ˆæŒ‡å‘P3 åœ¨P3ä¸­ï¼ŒèŠ‚ç‚¹88æ»¡è¶³88&gt;62,æ‰€ä»¥æŒ‡é’ˆæŒ‡å‘P7 åœ¨P7ä¸­ï¼ŒèŠ‚ç‚¹88æ»¡è¶³88==88ï¼Œæ‰€ä»¥è¿”å›žP7ä¸­çš„88èŠ‚ç‚¹ ç”±äºŽB-Treeçš„ç´¢å¼•ç»“æž„æ–‡ä»¶å’Œè¡¨æ•°æ®å­˜å‚¨æ–‡ä»¶ä¸æ˜¯è¿žåœ¨ä¸€èµ·çš„ï¼Œè®¿é—®æ•°æ®ä¹Ÿæœ‰é¢å¤–æ¶ˆè€—äº† ç”±ä¸Šä½ å¯ä»¥å‘çŽ°è¿™ç§ç»“æž„è¿˜æ˜¯ä¸èƒ½é«˜æ•ˆè§£å†³èŒƒå›´æŸ¥è¯¢çš„åœºæ™¯ï¼Œå½“å‡ºçŽ°èŒƒå›´æŸ¥è¯¢ï¼ˆwhere 1&lt;p&lt;3ï¼‰,B-Treeè¿˜æ˜¯å¾—ä¸€éä¸€éçš„ä»Žæ ¹èŠ‚ç‚¹å¼€å§‹éåŽ†ï¼Œå†ä¸€æ¬¡ä¸€æ¬¡è¿›è¡Œç£ç›˜IOï¼ˆå› ä¸ºç´¢å¼•æ–‡ä»¶å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œè€Œç£ç›˜æ“ä½œæ˜¯ç‰©ç†æ“ä½œï¼Œéžå¸¸è€—æ—¶çš„ï¼Œæ‰€ä»¥ç£ç›˜IOæ˜¯æ•°æ®åº“æŸ¥è¯¢çš„ä¸€ä¸ªç“¶é¢ˆï¼ŒåŽé¢çš„B+Treeæ­£å¥½ä¼˜åŒ–äº†è¿™ä¸€ç‚¹ï¼‰ã€‚ B+Tree B+ æ ‘æ˜¯ä¸€ç§æ ‘æ•°æ®ç»“æž„ï¼Œé€šå¸¸ç”¨äºŽæ•°æ®åº“å’Œæ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚B+ æ ‘çš„ç‰¹ç‚¹æ˜¯èƒ½å¤Ÿä¿æŒæ•°æ®ç¨³å®šæœ‰åºï¼Œå…¶æ’å…¥ä¸Žä¿®æ”¹æ‹¥æœ‰è¾ƒç¨³å®šçš„å¯¹æ•°æ—¶é—´å¤æ‚åº¦ã€‚B+ æ ‘å…ƒç´ è‡ªåº•å‘ä¸Šæ’å…¥ï¼Œè¿™ä¸ŽäºŒå‰æ ‘æ°å¥½ç›¸åâ€”â€”æ¥è‡ªç»´åŸºç™¾ç§‘ åœ¨ä¸€ä¸ªB+æ ‘é‡Œç»“æž„ï¼š åªæœ‰æœ€åº•å±‚çš„èŠ‚ç‚¹ï¼ˆå¶å­èŠ‚ç‚¹ï¼‰æ‰ä¿å­˜ä¿¡æ¯ï¼ˆç›¸å…³è¡¨çš„è¡Œä½ç½®ï¼‰ å…¶å®ƒèŠ‚ç‚¹åªæ˜¯åœ¨æœç´¢ä¸­ç”¨æ¥æŒ‡å¼•åˆ°æ­£ç¡®èŠ‚ç‚¹çš„ æ‰€æœ‰çš„å¶å­èŠ‚ç‚¹éƒ½å¸¦æœ‰å…³é”®å­—ç›´è‡³åº•å±‚èŠ‚ç‚¹ B+æ ‘æ˜¯Bæ ‘çš„è¿›åŒ–ä½“,ä»–ä»Žç£ç›˜IOä¸Šå¯¹åŽŸæœ‰çš„ç»“æž„è¿›è¡Œäº†ä¼˜åŒ–,ä»¥è‡³äºŽå‡å°‘å¯¹ç£ç›˜çš„IOï¼ˆä¸Šé¢ä¹Ÿæåˆ°ï¼Œç£ç›˜IOæ˜¯ç‰©ç†æ“ä½œï¼Œè¿™å¯¹ç£ç›˜æ¥è¯´æ˜¯å¾ˆè€—æ—¶é—´çš„ï¼‰ï¼Œå¤§å¤§çš„å¢žåŠ äº†æœç´¢çš„æ•ˆçŽ‡ã€‚ ä¸Šé¢ä¹Ÿæåˆ°ï¼ŒBæ ‘å¯¹äºŽèŒƒå›´æŸ¥è¯¢æ¥è®²æ˜¯æ¯”è¾ƒåƒåŠ›çš„ï¼Œä¸èƒ½é«˜æ•ˆçš„æ»¡è¶³å®ƒçš„éœ€æ±‚ï¼Œå› ä¸ºèŒƒå›´æŸ¥è¯¢ï¼ˆwhere 1&lt;p&lt;3ï¼‰æ­£å¸¸æƒ…å†µä¸‹åœ¨Bæ ‘ä¸Šè¦éåŽ†ä¸¤æˆ–è€…ä¸‰éï¼ˆæ¯æ¬¡ä»Žæ ¹èŠ‚ç‚¹éåŽ†ï¼‰ï¼Œæ„å‘³ç€è¦è‡³å°‘è¿›è¡Œä¸¤ä¸‰æ¬¡çš„ç£ç›˜IOï¼Œè¿™å¯¹äºŽå¤§æ•°æ®é‡æŸ¥è¯¢æ¥è®²æ˜¯å¾ˆåƒåŠ›çš„ã€‚ B+æ ‘æ˜¯æ€Žä¹ˆæ ·è¿›è¡Œå‡å°‘ç£ç›˜IOçš„ä¼˜åŒ–å‘¢ï¼Ÿæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä¸€ä¸ªèŒƒå›´æŸ¥è¯¢åœ¨ç´¢å¼•æ˜¯æ€Žä¹ˆéåŽ†çš„ã€‚ æˆ‘ä»¬å‡è®¾ä¸€ä¸ªèŒƒå›´æŸ¥è¯¢ï¼šwhere 10&lt;p&lt;50 åœ¨æ ¹èŠ‚ç‚¹ä¸­ï¼Œæ»¡è¶³5&lt;10&lt;58,æ‰€ä»¥æŒ‡é’ˆæŒ‡å‘P1èŠ‚ç‚¹ åœ¨P1èŠ‚ç‚¹ä¸­ï¼Œæ»¡è¶³5&lt;10&lt;30,æ‰€ä»¥æŒ‡é’ˆæŒ‡å‘P2èŠ‚ç‚¹ åœ¨P2åº•å±‚èŠ‚ç‚¹ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¸¦æœ‰å…³é”®å­—ï¼Œä¸”æ¯ä¸ªèŠ‚ç‚¹ä¹‹é—´ç›¸äº’é“¾æŽ¥ï¼Œå¯ä»¥ä»Žä¸€ä¸ªèŠ‚ç‚¹éåŽ†åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸”éƒ½æ˜¯é¡ºåºçš„ï¼Œæ‰€ä»¥ï¼Œåœ¨å¤§äºŽæˆ–ç­‰äºŽ10çš„èŠ‚ç‚¹å¼€å§‹éåŽ†ï¼Œä¸€ç›´éåŽ†åˆ°å°äºŽç­‰äºŽ50ä¸ºæ­¢ ç”±ä¸Šå¯çŸ¥ï¼Œåœ¨åº•å±‚èŠ‚ç‚¹éƒ½æ˜¯äº’ç›¸è¿žæŽ¥çš„ï¼ŒéåŽ†ä¸­é—´çš„å€¼å°±æ˜¯æŸ¥è¯¢çš„ç»“æžœï¼Œè€Œä¸”B+æ ‘çš„è¡¨æ•°æ®å’Œç´¢å¼•æ–‡ä»¶æ˜¯å­˜å‚¨åœ¨ä¸€èµ·çš„ï¼Œæ‰€ä»¥éåŽ†çš„å°±æ˜¯è¡¨çš„è¡Œæ•°æ®ï¼Œè¿™æ ·åªè¦ä¸€æ¬¡IOå°±å®Œæˆäº†ã€‚ å‚è€ƒhttp://coding-geek.com/how-databases-work/http://blog.csdn.net/v_july_v/article/details/6530142]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[hexoæ­å»ºgithubåšå®¢]]></title>
      <url>%2F2016%2F05%2F11%2Fset_up_github_blog_with_hexo%2F</url>
      <content type="text"><![CDATA[ä»…ä¾›å­¦ä¹ äº¤æµ,å¦‚æœ‰é”™è¯¯è¯·æŒ‡å‡º,å¦‚è¦è½¬è½½è¯·åŠ ä¸Šå‡ºå¤„,è°¢è°¢ å®‰è£…çŽ¯å¢ƒ ç”±äºŽhexoæ˜¯åŸºäºŽnode.jsçš„ä¸€ä¸ªåšå®¢æ¡†æž¶ï¼Œæ‰€ä»¥åœ¨å®‰è£…hexoä¹‹å‰ï¼Œå…ˆå®‰è£…node.jsï¼Œç‚¹å‡»node.jsè¿›å…¥å®˜ç½‘è¿›è¡Œå®‰è£…å³å¯ å½“ç„¶è¿˜è¦å®‰è£…åŸºäºŽgithubçš„deployå·¥å…·gitï¼Œç‚¹å‡»gitï¼Œè¿›å…¥å®˜ç½‘è¿›è¡Œå®‰è£…å³å¯ ä»¥ä¸Šå®‰è£…å®Œæˆæ—¶ï¼Œåœ¨ä½ çš„åšå®¢ç£ç›˜åŒºåŸŸæ–°å»ºä¸€ä¸ªhexoæ–‡ä»¶å¤¹ï¼Œè¿›å…¥hexoæ–‡ä»¶å¤¹ï¼Œå³é”®ç‚¹å‡»Git Bash Hereï¼Œå°±ä¼šè¿›å…¥gitçš„äº¤äº’çŽ¯å¢ƒï¼Œå®‰è£…hexoçŽ¯å¢ƒåªéœ€ä¸‰ä¸ªæŒ‡ä»¤ 123$ npm install hexo-cli -g$ hexo init$ hexo g ä¾æ¬¡å®Œæˆä»¥ä¸Šçš„æŒ‡ä»¤ï¼Œå°±å®Œæˆäº†hexoçš„å®‰è£…ï¼ŒçŽ°åœ¨æˆ‘ä»¬å¯åŠ¨æœåŠ¡ï¼Œè¾“å…¥1$ hexo s å³å¯ä»¥å¯åŠ¨hexoæœåŠ¡ï¼Œæ ¹æ®æç¤ºåœ¨æµè§ˆå™¨è¾“å…¥ http://localhost:4000/ å°±å¯ä»¥æŸ¥çœ‹ä½ åšå®¢äº† å½“ç„¶è¿™é‡Œæœ‰ä¸€äº›å¸¸ç”¨å‘½ä»¤åšå‚è€ƒï¼š hexo new â€œpostNameâ€ # æ–°å»ºæ–‡ç«  hexo new page â€œpageNameâ€ # æ–°å»ºé¡µé¢ hexo generate # ç”Ÿæˆpublicç›®å½• hexo server # å¯åŠ¨æœåŠ¡ hexo deploy # éƒ¨ç½²åˆ°github hexo help # æŸ¥çœ‹å¸®åŠ© hexo version # æŸ¥çœ‹Hexoçš„ç‰ˆæœ¬ é€‰æ‹©ä¸»é¢˜åœ¨ http://localhost:4000/ çœ‹åˆ°çš„æ˜¯hexoé»˜è®¤çš„åšå®¢ä¸»é¢˜ï¼Œå¦‚æžœä½ æƒ³è¦åˆ«çš„ä¸»é¢˜ï¼Œç‚¹å‡» https://hexo.io/themes/ å°±å¯ä»¥æŸ¥çœ‹äº†hexoçš„ä¸»é¢˜å¤§å…¨ã€‚æˆ‘ä½¿ç”¨çš„Randomä¸»é¢˜ï¼Œä»–ç¬¦åˆä»¥ä¸‹äººç¾¤ï¼š å–œæ¬¢ç”¨å¤§å›¾åšèƒŒæ™¯ ä¸å–œæ¬¢æ–‡ç« æ‘˜è¦ ä¸å–œæ¬¢åœ¨æ–‡ç« åˆ—è¡¨ä¸­ç¿»é¡µ å¦‚æžœä½ ä¹Ÿå–œæ¬¢Randomä¸»é¢˜ï¼ŒæŽ¥ä¸‹æ¥ç®€å•çš„ä»‹ç»å®ƒçš„å®‰è£…ï¼Œå®‰è£…Randomåªéœ€ä¸¤ä¸ªæŒ‡ä»¤å°±å¯ä»¥å®Œæˆï¼Œè¿˜æ˜¯åœ¨/hexoç›®å½•ä¸‹è¿è¡Œä¸‹é¢çš„æŒ‡ä»¤1$ git clone https://github.com/stiekel/hexo-theme-random.git themes/random è¿™æ ·ä¸»é¢˜å°±ä¸‹è½½å¥½äº†,çŽ°åœ¨æ‰“å¼€ hexo/_config.yml (_config.ymlæ–‡ä»¶æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªåœ¨hexoçš„æ ¹ç›®å½•ä¸‹ï¼Œä¸€ä¸ªåœ¨ä½ çš„ä¸»é¢˜æ–‡ä»¶å¤¹çš„æ ¹ç›®å½•ä¸‹)ï¼Œæ‰¾åˆ°themeå±žæ€§ï¼Œå°†ä¸»é¢˜è®¾ä¸ºrandom1theme: random è¿™é‡Œè¦æ³¨æ„ä¸€ç‚¹ï¼Œyamlé…ç½®æ–‡ä»¶çš„å±žæ€§å†’å·ä¹‹åŽè¦æœ‰ä¸€ä¸ªç©ºæ ¼ï¼Œç„¶åŽæ˜¯å€¼ï¼Œå¦åˆ™å°†è¯»å–ä¸åˆ°ä½ çš„å€¼ç„¶åŽå†é‡å¯æœåŠ¡12$ hexo clean$ hexo s è¿™æ ·å°±å¯ä»¥æŸ¥çœ‹Randomä¸»é¢˜çš„æ•ˆæžœäº†ï¼Œå½“ç„¶äº†è¿˜æœ‰å…¶ä»–é…ç½®ï¼Œæ¯”å¦‚é…ç½®ä»–çš„tagsï¼Œcategoriesï¼Œaboutï¼Œè¿˜æœ‰ä½ çš„ç¤¾äº¤ç½‘ç«™çš„é“¾æŽ¥çš„é…ç½®ï¼Œä½ å¯ä»¥è®¿é—®çš„ä»–çš„ä¸­æ–‡æ–‡æ¡£ http://hexo-theme-random.herokuapp.com/2016/05/23/Hexo-theme-Random-Chinese-User-Guide/ è¿™é‡Œé¢å¯ä»¥å¾ˆå…¨é¢çš„åŽ»é…ç½®randomä¸»é¢˜çš„åšå®¢ã€‚ githubéƒ¨ç½²å¦‚æžœä½ æƒ³æŠŠä½ çš„æœ¬åœ°çš„é™æ€åšå®¢éƒ¨ç½²åˆ°çº¿ä¸Šï¼Œgithubæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œå®ƒæ˜¯ä¸€ä¸ªä»£ç æ‰˜ç®¡å·¥å…·ï¼Œç”±äºŽè¿˜æ”¯æŒmarkdownè¿™æ ·çš„æ–‡æœ¬ç¼–è¾‘æ ¼å¼ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç®—æ˜¯åšå®¢çš„æ‰˜ç®¡å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæˆ‘ä»¬çš„åšå®¢æ‰˜ç®¡åˆ°githubä¸Šï¼Œå°±å¯ä»¥é€šè¿‡æµè§ˆå™¨çš„urlè®¿é—®äº†ã€‚ å¦‚æžœä½ æ²¡æœ‰githubçš„è´¦å·ï¼Œä½ å¯ä»¥ç‚¹å‡» https://github.com/ ï¼Œæ ¹æ®å®ƒçš„æç¤ºæ³¨å†Œè´¦å·å’Œé…ç½®shhï¼Œä¹Ÿå¯ä»¥ç½‘ä¸Šæœç´¢githubå¦‚ä½•ä½¿ç”¨ï¼Œå¦‚æžœä½ æœ‰githubè´¦å·,æŽ¥ä¸‹æ¥å°±æ˜¯åˆ›å»ºåšå®¢çš„ä»“åº“ã€‚ åˆ›å»ºä»“åº“é¦–å…ˆä½ å…ˆåœ¨githubçš„repositoresé¡µé¢ç‚¹å‡»å³ä¸Šè§’çš„newæŒ‰é’®ï¼Œæ¥æ–°å»ºä¸€ä¸ªä»“åº“ï¼Œç„¶åŽåœ¨Repository nameä¸€æ ï¼Œå†™ä¸Šyourname.github.io (yournameæŒ‡ä½ çš„ç”¨æˆ·å)ï¼Œç„¶åŽç‚¹å‡»create repositoryæŒ‰é’®è¿›è¡Œåˆ›å»ºã€‚ é…ç½®_config.ymlåœ¨hexoæ ¹ç›®å½•ä¸‹çš„_config.ymlæ‰¾åˆ° deploy: å¤„ï¼Œè®¾ç½®ä½ è‡ªå·±çš„å‘å¸ƒä¿¡æ¯1234567deploy: #ç±»åž‹ä¸ºgit type: git #å¡«å†™ä½ ä»“åº“çš„åœ°å€ repository: https://github.com/yourname/yourname.github.io.git #æ ¹æ®ä½ è‡ªå·±çš„åˆ†æ”¯æƒ…å†µï¼Œå¦‚æžœæ²¡æœ‰å…¶ä»–åˆ†æ”¯ï¼Œä¸€èˆ¬ä¸ºä¸»åˆ†æ”¯ branch: master æ³¨æ„ï¼šåœ¨å‰é¢ä¹Ÿæåˆ°ï¼Œæ¯ä¸ªå±žæ€§åŽé¢çš„å€¼å‰é¢ä¸€å®šè¦æœ‰ä¸ªç©ºæ ¼ï¼Œæ¯”å¦‚ type:(ç©ºæ ¼)git å‘å¸ƒçŽ°åœ¨å°±æ˜¯å°†ä½ æœ¬åœ°çš„é™æ€åšå®¢å‘å¸ƒåˆ°githubä¸Š12$ hexo clean$ hexo d -g æ³¨æ„ï¼Œå¦‚æžœä½ çš„hexoæ˜¯5.0ä»¥ä¸Šæˆ–è€…å‡ºçŽ° error deployer not found é”™è¯¯ ï¼Œé‚£å°±å¿…é¡»å…ˆå®‰è£… hexo-deployer-git 1npm install hexo-deployer-git --save å‘½ä»¤ git d -gç›¸å½“äºŽgit gå†git dï¼Œå‘½ä»¤å®Œæˆä¹‹åŽåªéœ€è¾“å…¥ä½ çš„ç”¨æˆ·åå’Œå¯†ç å®ŒæˆéªŒè¯å³å¯ï¼Œå‘å¸ƒå®Œæˆï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥ http://yourname.github.io å°±å¯ä»¥æŸ¥çœ‹ä½ çš„åšå®¢äº†ã€‚ åŸŸåç®¡ç†å½“ç„¶å¦‚æžœä½ ä¸å–œæ¬¢githubçš„å­åŸŸåæ¥è®¿é—®ä½ çš„åšå®¢ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä½ å°±å¾—è‡ªå·±åˆ›å»ºåŸŸåäº† åŸŸåçš„ä¾›åº”å•†å¾ˆå¤šï¼Œä¸è¿‡å›½å†…å¤–æœ€æœ‰åçš„å°±æ˜¯ godaddy äº†ï¼Œç‹—çˆ¹æ˜¯ç›®å‰å·ç§°æœ€å¤§çš„åŸŸåæ³¨å†Œå•†ï¼Œå½“ç„¶å„ç§æœåŠ¡ä¹Ÿæ˜¯æŒºå¥½çš„ï¼Œå½“ç„¶è¿˜æœ‰ä¸­å›½çš„ ä¸‡ç»´ç½‘ ï¼Œä¸è¿‡è¿˜æ˜¯æŽ¨èç‹—çˆ¹ï¼Œè¿™é‡ŒåŸŸåæ³¨å†Œæˆ‘å°±ä¸ä»‹ç»äº†ï¼Œä½ åªéœ€æŒ‰ç…§ç½‘ç«™æ­¥éª¤å°±å¯ä»¥äº† ä¸è¿‡å¾—æ³¨æ„ç‹—çˆ¹ä¸Šå¾ˆå¤šåŸŸåäº§å“æ˜¯æœ‰ä¼˜æƒ çš„ï¼Œä½ åªéœ€googleæˆ–è€…ç™¾åº¦godaddyä¼˜æƒ ç å°±ä¼šæœ‰å¾ˆå¤šçš„ï¼Œå¯ä»¥ä¸€ä¸€åŽ»è¯•ï¼Œè¿˜æ˜¯èƒ½å¤Ÿçœä¸€ç‚¹çš„ï¼Œå¯¹äºŽå›½å†…æ¥è®²ï¼Œä¼˜æƒ ç ä¸€å®šè¦çœ‹å‡†æ˜¯å¦æ”¯æŒæ”¯ä»˜å®æ”¯ä»˜ï¼Œå› ä¸ºæœ‰äº›ä¼˜æƒ ç ä¸æ”¯æŒæ”¯ä»˜å®ï¼Œå½“ç„¶å¦‚æžœä½ æœ‰å›½å¤–çš„ä¿¡ç”¨å¡æˆ–è€…é“¶è”å°±å¦å½“åˆ«è®ºäº†ã€‚ CNAMEæƒ³è¦ä½ çš„åŸŸåè®¿é—®ä½ çš„githubçš„ä»“åº“ï¼Œå°±å¿…é¡»è¦åˆ›å»ºCNAMEæ–‡ä»¶,CNAMEæ–‡ä»¶åˆ›å»ºæœ‰ä¸¤ç§æ–¹æ³•ï¼š ç¬¬ä¸€ç§ç›´æŽ¥åœ¨ä½ çš„ä»“åº“çš„æ ¹ç›®å½•ä¸‹ç›´æŽ¥åˆ›å»ºCNAMEæ–‡ä»¶ï¼Œå†…å®¹ä¸ºä½ åŸŸåçš„åç§°ï¼Œæ¯”å¦‚ 1pettyandydog.com ç¬¬äºŒç§åœ¨ /hexo/source/ ç›®å½•ä¸‹åˆ›å»ºCNAMEæ–‡ä»¶( æŽ¨è )ï¼Œå†…å®¹ç›¸åŒï¼Œç„¶åŽå†é‡æ–°å‘å¸ƒ DNSé…ç½®å¦‚æžœä½ å·²ç»æ³¨å†Œå·åŸŸåäº†ï¼ŒæŽ¥ä¸‹æ¥å°±æ˜¯dnsé…ç½®äº†ï¼Œdnsé…ç½®æœ‰ä¸¤ç§ ç¬¬ä¸€ç§ç”¨æ˜¯godaddyè‡ªå·±çš„dnsè§£é‡Šå™¨ï¼Œæ‰“å¼€godaddyçš„è´¦æˆ·/äº§å“ï¼Œç‚¹å‡»å½“å‰åŸŸåä¸‹çš„DNSç®¡ç†æŒ‰é’®ï¼Œé…ç½®å¦‚ä¸‹ ç¬¬äºŒç§ä½¿ç”¨DNSpodåŸŸåDNSä»£ç†,æ³¨å†ŒDNSpodï¼Œè¿›å…¥DNSpodç®¡ç†ï¼Œæ·»åŠ ä½ è‡ªå·±çš„åŸŸåï¼Œä¸€æ ·æŒ‰ä¸Šå›¾æ·»åŠ è®°å½•ï¼Œç„¶åŽå°†godaddyçš„nameserversç•Œé¢å¢žåŠ ä¸¤æ¡è®°å½• è¿™æ ·å°±å¤§åŠŸå‘Šæˆï¼Œè¾“å…¥ä½ çš„ç½‘ç«™ ( æ¯”å¦‚ï¼šhttp://pettyandydog.com ) å°±å¯ä»¥è®¿é—®ä½ çš„åšå®¢äº†,æœ‰æ—¶å€™å¯èƒ½çŸ­æ—¶é—´è®¿é—®ä¸äº†ï¼Œåªéœ€ç­‰ä¸Šä¸€æ®µæ—¶é—´å°±å¯ä»¥äº†ã€‚]]></content>
    </entry>

    
  
  
</search>
